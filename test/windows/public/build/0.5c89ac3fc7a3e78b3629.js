webpackJsonp([0],{1463:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(1501),n(1502),n(1475),n(1510),n(1519),n(1659),n(1703),n(1709),n(1711),n(1718),n(1730),n(1735),n(1738)},1464:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1468),a=n(1534),i=n(1478),o=n(1536),s=n(1470);n.d(e,"PanelCtrl",function(){return r.a}),n.d(e,"MetricsPanelCtrl",function(){return a.a}),n.d(e,"QueryCtrl",function(){return i.a}),n.d(e,"alertTab",function(){return o.a}),n.d(e,"loadPluginCss",function(){return s.b})},1465:function(t,e,n){"use strict";function r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[t.length-1],r=t[0]||"",i=1;i<t.length-1;i++)r+=" "+t[i]||"";return n=a.a.regexEscape(n),null!==new RegExp("\\$("+n+")(?:\\W|$)|\\[\\[("+n+")\\]\\]","g").exec(r)}n.d(e,"c",function(){return o}),e.b=r;var a=n(224),i=n(528);n.d(e,"a",function(){return i.a});var o={}},1466:function(t,e,n){"use strict";var r=function(){function t(){this.columns=[],this.columnMap={},this.rows=[],this.type="table"}return t.prototype.sort=function(t){null===t.col||this.columns.length<=t.col||(this.rows.sort(function(e,n){return e=e[t.col],n=n[t.col],e<n?-1:e>n?1:0}),this.columns[t.col].sort=!0,t.desc?(this.rows.reverse(),this.columns[t.col].desc=!0):this.columns[t.col].desc=!1)},t.prototype.addColumn=function(t){this.columnMap[t.text]||(this.columns.push(t),this.columnMap[t.text]=t)},t}();e.a=r},1467:function(t,e,n){"use strict";function r(t){return h.a.filter(f,function(e){return!e.minVersion||e.minVersion<=t})}function a(t){return i(t.type)?w[t.type]:[]}function i(t){if(t){var e=w[t];return null!==e&&void 0!==e}return!1}function o(t){var e=[];return h.a.each(t.metrics,function(t){i(t.type)||e.push({text:c(t),value:t.id})}),e}function s(t,e){var n=[];return e?(h.a.each(k[t],function(t){t.isCheckbox||n.push(t)}),n):k[t]}function l(t){var e=[];return h.a.each(t.metrics,function(t){"count"!==t.type&&e.push({text:c(t),value:t.id})}),g.concat(e)}function u(t){return h.a.find(v,{value:t}).text}function c(t){return h.a.find(f,{value:t.type}).text+" "+t.field}function p(t,e){var n=h.a.find(g,{value:t});if(n)return n.text;var r=h.a.find(e.metrics,{id:t});return r?c(r):"metric not found"}n.d(e,"m",function(){return f}),n.d(e,"a",function(){return m}),n.d(e,"o",function(){return v}),n.d(e,"p",function(){return y}),n.d(e,"e",function(){return b}),n.d(e,"k",function(){return x}),n.d(e,"n",function(){return S}),e.f=r,e.j=a,e.l=i,e.i=o,e.g=s,e.h=l,e.c=u,e.b=c,e.d=p;var d=n(4),h=n.n(d),f=[{text:"Count",value:"count",requiresField:!1},{text:"Average",value:"avg",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Sum",value:"sum",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Max",value:"max",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Min",value:"min",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0},{text:"Extended Stats",value:"extended_stats",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Percentiles",value:"percentiles",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0},{text:"Unique Count",value:"cardinality",requiresField:!0,supportsMissing:!0},{text:"Moving Average",value:"moving_avg",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Derivative",value:"derivative",requiresField:!1,isPipelineAgg:!0,minVersion:2},{text:"Raw Document",value:"raw_document",requiresField:!1}],m=[{text:"Terms",value:"terms",requiresField:!0},{text:"Filters",value:"filters"},{text:"Geo Hash Grid",value:"geohash_grid",requiresField:!0},{text:"Date Histogram",value:"date_histogram",requiresField:!0},{text:"Histogram",value:"histogram",requiresField:!0}],g=[{text:"Doc Count",value:"_count"},{text:"Term value",value:"_term"}],v=[{text:"Top",value:"desc"},{text:"Bottom",value:"asc"}],y=[{text:"No limit",value:"0"},{text:"1",value:"1"},{text:"2",value:"2"},{text:"3",value:"3"},{text:"5",value:"5"},{text:"10",value:"10"},{text:"15",value:"15"},{text:"20",value:"20"}],b=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Sum",value:"sum"},{text:"Count",value:"count"},{text:"Std Dev",value:"std_deviation"},{text:"Std Dev Upper",value:"std_deviation_bounds_upper"},{text:"Std Dev Lower",value:"std_deviation_bounds_lower"}],x=[{text:"auto",value:"auto"},{text:"10s",value:"10s"},{text:"1m",value:"1m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"20m",value:"20m"},{text:"1h",value:"1h"},{text:"1d",value:"1d"}],S=[{text:"Simple",value:"simple"},{text:"Linear",value:"linear"},{text:"Exponentially Weighted",value:"ewma"},{text:"Holt Linear",value:"holt"},{text:"Holt Winters",value:"holt_winters"}],w={moving_avg:[{text:"window",default:5},{text:"model",default:"simple"},{text:"predict",default:void 0},{text:"minimize",default:!1}],derivative:[{text:"unit",default:void 0}]},k={simple:[],linear:[],ewma:[{text:"Alpha",value:"alpha",default:void 0}],holt:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0}],holt_winters:[{text:"Alpha",value:"alpha",default:void 0},{text:"Beta",value:"beta",default:void 0},{text:"Gamma",value:"gamma",default:void 0},{text:"Period",value:"period",default:void 0},{text:"Pad",value:"pad",default:void 0,isCheckbox:!0}]}},1468:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var r=n(22),a=n(4),i=n.n(a),o=n(16),s=n.n(o),l=n(225),u=n(231),c=n(514),p=n.n(c),d=n(228),h=n(109),f=function(){function t(t,e){var n=this;this.$injector=e,this.$scope=t,this.$timeout=e.get("$timeout"),this.editorTabIndex=0,this.events=this.panel.events,this.timing={};var a=r.a.panels[this.panel.type];a&&(this.pluginId=a.id,this.pluginName=a.name),t.$on("refresh",function(){return n.refresh()}),t.$on("component-did-mount",function(){return n.panelDidMount()}),t.$on("$destroy",function(){n.events.emit("panel-teardown"),n.events.removeAllListeners()})}return t.prototype.init=function(){this.events.emit("panel-initialized"),this.publishAppEvent("panel-initialized",{scope:this.$scope})},t.prototype.panelDidMount=function(){this.events.emit("component-did-mount")},t.prototype.renderingCompleted=function(){l.e.renderingCompleted(this.panel.id,this.timing)},t.prototype.refresh=function(){this.events.emit("refresh",null)},t.prototype.publishAppEvent=function(t,e){this.$scope.$root.appEvent(t,e)},t.prototype.changeView=function(t,e){this.publishAppEvent("panel-change-view",{fullscreen:t,edit:e,panelId:this.panel.id})},t.prototype.viewPanel=function(){this.changeView(!0,!1)},t.prototype.editPanel=function(){this.changeView(!0,!0)},t.prototype.exitFullscreen=function(){this.changeView(!1,!1)},t.prototype.initEditMode=function(){var t=this;this.editorTabs=[],this.addEditorTab("General","public/app/partials/panelgeneral.html"),this.editModeInitiated=!0,this.events.emit("init-edit-mode",null);var e=(this.$injector.get("$routeParams").tab||"").toLowerCase();e&&this.editorTabs.forEach(function(n,r){n.title.toLowerCase()===e&&(t.editorTabIndex=r)})},t.prototype.changeTab=function(t){this.editorTabIndex=t;var e=this.$injector.get("$route");e.current.params.tab=this.editorTabs[t].title.toLowerCase(),e.updateParams()},t.prototype.addEditorTab=function(t,e,n){var r={title:t,directiveFn:e};i.a.isString(e)&&(r.directiveFn=function(){return{templateUrl:e}}),n?this.editorTabs.splice(n,0,r):this.editorTabs.push(r)},t.prototype.getMenu=function(){var t=[];t.push({text:"View",click:"ctrl.viewPanel();",icon:"fa fa-fw fa-eye",shortcut:"v"}),this.dashboard.meta.canEdit&&t.push({text:"Edit",click:"ctrl.editPanel();",role:"Editor",icon:"fa fa-fw fa-edit",shortcut:"e"}),t.push({text:"Share",click:"ctrl.sharePanel();",icon:"fa fa-fw fa-share",shortcut:"p s"});var e=this.getExtendedMenu();return t.push({text:"More ...",click:"",icon:"fa fa-fw fa-cube",submenu:e}),this.dashboard.meta.canEdit&&(t.push({divider:!0,role:"Editor"}),t.push({text:"Remove",click:"ctrl.removePanel();",role:"Editor",icon:"fa fa-fw fa-trash",shortcut:"p r"})),t},t.prototype.getExtendedMenu=function(){var t=[];return!this.fullscreen&&this.dashboard.meta.canEdit&&(t.push({text:"Duplicate",click:"ctrl.duplicate()",role:"Editor",shortcut:"p d"}),t.push({text:"Copy",click:"ctrl.copyPanel()",role:"Editor"})),t.push({text:"Panel JSON",click:"ctrl.editPanelJson(); dismiss();"}),this.events.emit("init-panel-actions",t),t},t.prototype.otherPanelInFullscreenMode=function(){return this.dashboard.meta.fullscreen&&!this.fullscreen},t.prototype.calculatePanelHeight=function(){if(this.fullscreen){var t=s()(window).height(),e=Math.floor(.4*t),n=Math.floor(.8*t);this.containerHeight=this.editMode?e:n}else this.containerHeight=this.panel.gridPos.h*d.c+(this.panel.gridPos.h-1)*d.d;this.panel.soloMode&&(this.containerHeight=s()(window).height()),this.height=this.containerHeight-29},t.prototype.render=function(t){this.timing.renderStart=(new Date).getTime(),this.events.emit("render",t)},t.prototype.duplicate=function(){var t=this;this.dashboard.duplicatePanel(this.panel),this.$timeout(function(){t.$scope.$root.$broadcast("render")})},t.prototype.removePanel=function(){this.publishAppEvent("panel-remove",{panelId:this.panel.id})},t.prototype.editPanelJson=function(){var t=this.$scope.$root.$new();t.object=this.panel.getSaveModel(),t.updateHandler=this.replacePanel.bind(this),t.enableCopy=!0,this.publishAppEvent("show-modal",{src:"public/app/partials/edit_json.html",scope:t})},t.prototype.copyPanel=function(){h.a.set(d.f,JSON.stringify(this.panel.getSaveModel())),l.b.emit("alert-success",["Panel copied. Open Add Panel to paste"])},t.prototype.replacePanel=function(t,e){var n=this.dashboard,r=i.a.findIndex(n.panels,function(t){return t.id===e.id}),a=n.panels.splice(r,1);this.dashboard.events.emit("panel-removed",a),t=new u.a(t),t.id=e.id,n.panels.splice(r,0,t),n.sortPanelsByGridPos(),n.events.emit("panel-added",t)},t.prototype.sharePanel=function(){var t=this.$scope.$new();t.panel=this.panel,t.dashboard=this.dashboard,this.publishAppEvent("show-modal",{src:"public/app/features/dashboard/partials/shareModal.html",scope:t})},t.prototype.getInfoMode=function(){return this.error?"error":this.panel.description?"info":this.panel.links&&this.panel.links.length?"links":""},t.prototype.getInfoContent=function(t){var e=this.panel.description;"tooltip"===t.mode&&(e=this.error||this.panel.description);var n=this.$injector.get("linkSrv"),r=this.$injector.get("templateSrv"),a=r.replace(e,this.panel.scopedVars),i='<div class="markdown-html">';if(i+=(new p.a).render(a),this.panel.links&&this.panel.links.length>0){i+="<ul>";for(var o=0,s=this.panel.links;o<s.length;o++){var l=s[o],u=n.getPanelLinkAnchorInfo(l,this.panel.scopedVars);i+='<li><a class="panel-menu-link" href="'+u.href+'" target="'+u.target+'">'+u.title+"</a></li>"}i+="</ul>"}return i+"</div>"},t.prototype.openInspector=function(){var t=this.$scope.$new();t.panel=this.panel,t.dashboard=this.dashboard,t.panelInfoHtml=this.getInfoContent({mode:"inspector"}),t.inspector=s.a.extend(!0,{},this.inspector),this.publishAppEvent("show-modal",{src:"public/app/features/dashboard/partials/inspector.html",scope:t})},t}()},1469:function(t,e){!function(t){t.color={},t.color.make=function(e,n,r,a){var i={};return i.r=e||0,i.g=n||0,i.b=r||0,i.a=null!=a?a:1,i.add=function(t,e){for(var n=0;n<t.length;++n)i[t.charAt(n)]+=e;return i.normalize()},i.scale=function(t,e){for(var n=0;n<t.length;++n)i[t.charAt(n)]*=e;return i.normalize()},i.toString=function(){return i.a>=1?"rgb("+[i.r,i.g,i.b].join(",")+")":"rgba("+[i.r,i.g,i.b,i.a].join(",")+")"},i.normalize=function(){function t(t,e,n){return e<t?t:e>n?n:e}return i.r=t(0,parseInt(i.r),255),i.g=t(0,parseInt(i.g),255),i.b=t(0,parseInt(i.b),255),i.a=t(0,i.a,1),i},i.clone=function(){return t.color.make(i.r,i.b,i.g,i.a)},i.normalize()},t.color.extract=function(e,n){var r;do{if(""!=(r=e.css(n).toLowerCase())&&"transparent"!=r)break;e=e.parent()}while(e.length&&!t.nodeName(e.get(0),"body"));return"rgba(0, 0, 0, 0)"==r&&(r="transparent"),t.color.parse(r)},t.color.parse=function(n){var r,a=t.color.make;if(r=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n))return a(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10));if(r=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n))return a(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10),parseFloat(r[4]));if(r=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n))return a(2.55*parseFloat(r[1]),2.55*parseFloat(r[2]),2.55*parseFloat(r[3]));if(r=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(n))return a(2.55*parseFloat(r[1]),2.55*parseFloat(r[2]),2.55*parseFloat(r[3]),parseFloat(r[4]));if(r=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n))return a(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16));if(r=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n))return a(parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16),parseInt(r[3]+r[3],16));var i=t.trim(n).toLowerCase();return"transparent"==i?a(255,255,255,0):(r=e[i]||[0,0,0],a(r[0],r[1],r[2]))};var e={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(t){function e(e,n){var r=n.children("."+e)[0];if(null==r&&(r=document.createElement("canvas"),r.className=e,t(r).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(n),!r.getContext)){if(!window.G_vmlCanvasManager)throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");r=window.G_vmlCanvasManager.initElement(r)}this.element=r;var a=this.context=r.getContext("2d"),i=window.devicePixelRatio||1,o=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;this.pixelRatio=i/o,this.resize(n.width(),n.height()),this.textContainer=null,this.text={},this._textCache={},this._textSizeCache=window.flotTextSizeCache=window.flotTextSizeCache||{}}function n(n,a,i,o){function s(t,e){e=[dt].concat(e);for(var n=0;n<t.length;++n)t[n].apply(this,e)}function l(t){Z=u(t),m(),g()}function u(e){for(var n=[],r=0;r<e.length;++r){var a=t.extend(!0,{},tt.series);null!=e[r].data?(a.data=e[r].data,delete e[r].data,t.extend(!0,a,e[r]),e[r].data=a.data):a.data=e[r],n.push(a)}return n}function c(t,e){var n=t[e+"axis"];return"object"==typeof n&&(n=n.n),"number"!=typeof n&&(n=1),n}function p(){return t.grep(ot.concat(st),function(t){return t})}function d(t){var e,n,r={};for(e=0;e<ot.length;++e)(n=ot[e])&&n.used&&(r["x"+n.n]=n.c2p(t.left));for(e=0;e<st.length;++e)(n=st[e])&&n.used&&(r["y"+n.n]=n.c2p(t.top));return void 0!==r.x1&&(r.x=r.x1),void 0!==r.y1&&(r.y=r.y1),r}function h(t){var e,n,r,a={};for(e=0;e<ot.length;++e)if((n=ot[e])&&n.used&&(r="x"+n.n,null==t[r]&&1==n.n&&(r="x"),null!=t[r])){a.left=n.p2c(t[r]);break}for(e=0;e<st.length;++e)if((n=st[e])&&n.used&&(r="y"+n.n,null==t[r]&&1==n.n&&(r="y"),null!=t[r])){a.top=n.p2c(t[r]);break}return a}function f(e,n){return e[n-1]||(e[n-1]={n:n,direction:e==ot?"x":"y",options:t.extend(!0,{},e==ot?tt.xaxis:tt.yaxis)}),e[n-1]}function m(){var e,n=Z.length,r=-1;for(e=0;e<Z.length;++e){var a=Z[e].color;null!=a&&(n--,"number"==typeof a&&a>r&&(r=a))}n<=r&&(n=r+1);var i,o=[],s=tt.colors,l=s.length,u=0;for(e=0;e<n;e++)i=t.color.parse(s[e%l]||"#666"),e%l==0&&e&&(u=u>=0?u<.5?-u-.2:0:-u),o[e]=i.scale("rgb",1+u);var p,d=0;for(e=0;e<Z.length;++e){if(p=Z[e],null==p.color?(p.color=o[d].toString(),++d):"number"==typeof p.color&&(p.color=o[p.color].toString()),null==p.lines.show){var h,m=!0;for(h in p)if(p[h]&&p[h].show){m=!1;break}m&&(p.lines.show=!0)}null==p.lines.zero&&(p.lines.zero=!!p.lines.fill),p.xaxis=f(ot,c(p,"x")),p.yaxis=f(st,c(p,"y"))}}function g(){function e(t,e,n){e<t.datamin&&e!=-y&&(t.datamin=e),n>t.datamax&&n!=y&&(t.datamax=n)}var n,r,a,i,o,l,u,c,d,h,f,m,g=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,y=Number.MAX_VALUE;for(t.each(p(),function(t,e){e.datamin=g,e.datamax=v,e.used=!1}),n=0;n<Z.length;++n)o=Z[n],o.datapoints={points:[]},s(pt.processRawData,[o,o.data,o.datapoints]);for(n=0;n<Z.length;++n){if(o=Z[n],f=o.data,!(m=o.datapoints.format)){if(m=[],m.push({x:!0,number:!0,required:!0}),m.push({y:!0,number:!0,required:!0}),o.bars.show||o.lines.show&&o.lines.fill){var b=!!(o.bars.show&&o.bars.zero||o.lines.show&&o.lines.zero);m.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:b}),o.bars.horizontal&&(delete m[m.length-1].y,m[m.length-1].x=!0)}o.datapoints.format=m}if(null==o.datapoints.pointsize){o.datapoints.pointsize=m.length,u=o.datapoints.pointsize,l=o.datapoints.points;var x=o.lines.show&&o.lines.steps;for(o.xaxis.used=o.yaxis.used=!0,r=a=0;r<f.length;++r,a+=u){h=f[r];var S=null==h;if(!S)for(i=0;i<u;++i)c=h[i],d=m[i],d&&(d.number&&null!=c&&(c=+c,isNaN(c)?c=null:c==1/0?c=y:c==-1/0&&(c=-y)),null==c&&(d.required&&(S=!0),null!=d.defaultValue&&(c=d.defaultValue))),l[a+i]=c;if(S)for(i=0;i<u;++i)c=l[a+i],null!=c&&(d=m[i],!1!==d.autoscale&&(d.x&&e(o.xaxis,c,c),d.y&&e(o.yaxis,c,c))),l[a+i]=null;if(x&&a>0&&(!S||null!=l[a-u])){for(i=0;i<u;++i)l[a+u+i]=l[a+i];l[a+1]=l[a-u+1]||0,S&&(l[a]=h[0]),a+=u}}}}for(n=0;n<Z.length;++n){if(o=Z[n],l=o.datapoints.points,u=o.datapoints.pointsize,"negative-Y"===o.transform)for(r=0;r<l.length;r+=u)null!=l[r]&&(c=l[r+1],l[r+1]=-c);s(pt.processDatapoints,[o,o.datapoints])}for(n=0;n<Z.length;++n){o=Z[n],l=o.datapoints.points,u=o.datapoints.pointsize,m=o.datapoints.format;var w=g,k=g,_=v,C=v;for(r=0;r<l.length;r+=u)if(null!=l[r])for(i=0;i<u;++i)c=l[r+i],(d=m[i])&&!1!==d.autoscale&&c!=y&&c!=-y&&(d.x&&(c<w&&(w=c),c>_&&(_=c)),d.y&&(c<k&&(k=c),c>C&&(C=c)));if(o.bars.show){var T;switch(o.bars.align){case"left":T=0;break;case"right":T=-o.bars.barWidth;break;default:T=-o.bars.barWidth/2}o.bars.horizontal?(k+=T,C+=T+o.bars.barWidth):(w+=T,_+=T+o.bars.barWidth)}e(o.xaxis,w,_),e(o.yaxis,k,C)}t.each(p(),function(t,e){e.datamin==g&&(e.datamin=null),e.datamax==v&&(e.datamax=null)})}function v(){ft&&clearTimeout(ft),rt.unbind("mousemove",U),rt.unbind("mouseleave",V),rt.unbind("click",B),s(pt.shutdown,[rt])}function y(t){function e(t){return t}var n,r,a=t.options.transform||e,i=t.options.inverseTransform;"x"==t.direction?(n=t.scale=ut/Math.abs(a(t.max)-a(t.min)),r=Math.min(a(t.max),a(t.min))):(n=t.scale=ct/Math.abs(a(t.max)-a(t.min)),n=-n,r=Math.max(a(t.max),a(t.min))),t.p2c=a==e?function(t){return(t-r)*n}:function(t){return(a(t)-r)*n},t.c2p=i?function(t){return i(r+t/n)}:function(t){return r+t/n}}function b(t){for(var e=t.options,n=t.ticks||[],r=e.labelWidth||0,a=e.labelHeight||0,i=r||("x"==t.direction?Math.floor(et.width/(n.length||1)):null),o=t.direction+"Axis "+t.direction+t.n+"Axis",s="flot-"+t.direction+"-axis flot-"+t.direction+t.n+"-axis "+o,l=e.font||"flot-tick-label tickLabel",u=0;u<n.length;++u){var c=n[u];if(c.label){var p=et.getTextInfo(s,c.label,l,null,i);r=Math.max(r,p.width+1),a=Math.max(a,p.height)}}t.labelWidth=e.labelWidth||r,t.labelHeight=e.labelHeight||a}function x(e){var n=e.labelWidth,r=e.labelHeight,a=e.options.position,i="x"===e.direction,o=e.options.tickLength,s=tt.grid.axisMargin,l=tt.grid.labelMargin,u=tt.grid.eventSectionHeight,c=!0,p=!0,d=!0,h=!1;t.each(i?ot:st,function(t,n){n&&(n.show||n.reserveSpace)&&(n===e?h=!0:n.options.position===a&&(h?p=!1:c=!1),h||(d=!1))}),p&&(s=0),null==o&&(o=d?"full":5),isNaN(+o)||(l+=+o),i?(r+=l,r+=u,"bottom"==a?(lt.bottom+=r+s,e.box={top:et.height-lt.bottom,height:r}):(e.box={top:lt.top+s,height:r},lt.top+=r+s)):(n+=l,"left"==a?(e.box={left:lt.left+s,width:n},lt.left+=n+s):(lt.right+=n+s,e.box={left:et.width-lt.right,width:n})),e.position=a,e.tickLength=o,e.box.padding=l,e.box.eventSectionPadding=u,e.innermost=c}function S(t){"x"==t.direction?(t.box.left=lt.left-t.labelWidth/2,t.box.width=et.width-lt.left-lt.right+t.labelWidth):(t.box.top=lt.top-t.labelHeight/2,t.box.height=et.height-lt.bottom-lt.top+t.labelHeight)}function w(){var e,n=tt.grid.minBorderMargin;if(null==n)for(n=0,e=0;e<Z.length;++e)n=Math.max(n,2*(Z[e].points.radius+Z[e].points.lineWidth/2));var r={left:n,right:n,top:n,bottom:n};t.each(p(),function(t,e){e.reserveSpace&&e.ticks&&e.ticks.length&&("x"===e.direction?(r.left=Math.max(r.left,e.labelWidth/2),r.right=Math.max(r.right,e.labelWidth/2)):(r.bottom=Math.max(r.bottom,e.labelHeight/2),r.top=Math.max(r.top,e.labelHeight/2)))}),lt.left=Math.ceil(Math.max(r.left,lt.left)),lt.right=Math.ceil(Math.max(r.right,lt.right)),lt.top=Math.ceil(Math.max(r.top,lt.top)),lt.bottom=Math.ceil(Math.max(r.bottom,lt.bottom))}function k(){var e,n=p(),r=tt.grid.show;for(var a in lt){var i=tt.grid.margin||0;lt[a]="number"==typeof i?i:i[a]||0}s(pt.processOffset,[lt]);for(var a in lt)"object"==typeof tt.grid.borderWidth?lt[a]+=r?tt.grid.borderWidth[a]:0:lt[a]+=r?tt.grid.borderWidth:0;if(t.each(n,function(t,e){var n=e.options;e.show=null==n.show?e.used:n.show,e.reserveSpace=null==n.reserveSpace?e.show:n.reserveSpace,_(e)}),s(pt.processRange,[]),r){for(var o=t.grep(n,function(t){return t.show||t.reserveSpace}),l=!1,e=0;e<2&&(t.each(o,function(t,e){C(e),T(e),l=M(e,e.ticks)||l,b(e)}),l&&pt.processRange.length>0);e++)s(pt.processRange,[]),l=!1;for(e=o.length-1;e>=0;--e)x(o[e]);w(),t.each(o,function(t,e){S(e)})}ut=et.width-lt.left-lt.right,ct=et.height-lt.bottom-lt.top,t.each(n,function(t,e){y(e)}),r&&A(),N()}function _(t){var e=t.options,n=+(null!=e.min?e.min:t.datamin),r=+(null!=e.max?e.max:t.datamax),a=r-n;if(0==a){var i=Math.abs(0==r?1:.25*r);null==e.min&&(n-=i),null!=e.max&&null==e.min||(r+=i)}else{var o=e.autoscaleMargin;null!=o&&(null==e.min&&(n-=a*o)<0&&null!=t.datamin&&t.datamin>=0&&(n=0),null==e.max&&(r+=a*o)>0&&null!=t.datamax&&t.datamax<=0&&(r=0))}t.min=n,t.max=r}function C(e){var n,a=e.options;n="number"==typeof a.ticks&&a.ticks>0?a.ticks:.3*Math.sqrt("x"==e.direction?et.width:et.height);var i=(e.max-e.min)/n,o=-Math.floor(Math.log(i)/Math.LN10),s=a.tickDecimals;null!=s&&o>s&&(o=s);var l,u=Math.pow(10,-o),c=i/u;if(c<1.5?l=1:c<3?(l=2,c>2.25&&(null==s||o+1<=s)&&(l=2.5,++o)):l=c<7.5?5:10,l*=u,null!=a.minTickSize&&l<a.minTickSize&&(l=a.minTickSize),e.delta=i,e.tickDecimals=Math.max(0,null!=s?s:o),e.tickSize=a.tickSize||l,e.scaledDecimals=e.tickDecimals-Math.floor(Math.log(e.tickSize)/Math.LN10),"time"==a.mode&&!e.tickGenerator)throw new Error("Time mode requires the flot.time plugin.");if(e.tickGenerator||(e.tickGenerator=function(t){var e,n=[],a=r(t.min,t.tickSize),i=0,o=Number.NaN;do{e=o,o=a+i*t.tickSize,n.push(o),++i}while(o<t.max&&o!=e);return n},e.tickFormatter=function(t,e){var n=e.tickDecimals?Math.pow(10,e.tickDecimals):1,r=""+Math.round(t*n)/n;if(null!=e.tickDecimals){var a=r.indexOf("."),i=-1==a?0:r.length-a-1;if(i<e.tickDecimals)return(i?r:r+".")+(""+n).substr(1,e.tickDecimals-i)}return r}),t.isFunction(a.tickFormatter)&&(e.tickFormatter=function(t,e){return""+a.tickFormatter(t,e)}),null!=a.alignTicksWithAxis){var p=("x"==e.direction?ot:st)[a.alignTicksWithAxis-1];if(p&&p.used&&p!=e){var d=e.tickGenerator(e);if(d.length>0&&(null==a.min&&(e.min=Math.min(e.min,d[0])),null==a.max&&d.length>1&&(e.max=Math.max(e.max,d[d.length-1]))),e.tickGenerator=function(t){var e,n,r=[];for(n=0;n<p.ticks.length;++n)e=(p.ticks[n].v-p.min)/(p.max-p.min),e=t.min+e*(t.max-t.min),r.push(e);return r},!e.mode&&null==a.tickDecimals){var h=Math.max(0,1-Math.floor(Math.log(e.delta)/Math.LN10)),f=e.tickGenerator(e);f.length>1&&/\..*0$/.test((f[1]-f[0]).toFixed(h))||(e.tickDecimals=h)}}}}function T(e){var n=e.options.ticks,r=[];null==n||"number"==typeof n&&n>0?r=e.tickGenerator(e):n&&(r=t.isFunction(n)?n(e):n);var a,i;for(e.ticks=[],a=0;a<r.length;++a){var o=null,s=r[a];"object"==typeof s?(i=+s[0],s.length>1&&(o=s[1])):i=+s,null==o&&(o=e.tickFormatter(i,e)),isNaN(i)||e.ticks.push({v:i,label:o})}}function M(t,e){var n=!1;return t.options.autoscaleMargin&&e.length>0&&(null==t.options.min&&(t.min=Math.min(t.min,e[0].v),n=!0),null==t.options.max&&e.length>1&&(t.max=Math.max(t.max,e[e.length-1].v),n=!0)),n}function P(){et.clear(),s(pt.drawBackground,[at]);var t=tt.grid;t.show&&t.backgroundColor&&E(),t.show&&!t.aboveData&&$();for(var e=0;e<Z.length;++e)s(pt.drawSeries,[at,Z[e]]),D(Z[e]);s(pt.draw,[at]),t.show&&t.aboveData&&$(),et.render(),Q()}function O(t,e){for(var n,r,a,i,o=p(),s=0;s<o.length;++s)if(n=o[s],n.direction==e&&(i=e+n.n+"axis",t[i]||1!=n.n||(i=e+"axis"),t[i])){r=t[i].from,a=t[i].to;break}if(t[i]||(n="x"==e?ot[0]:st[0],r=t[e+"1"],a=t[e+"2"]),null!=r&&null!=a&&r>a){var l=r;r=a,a=l}return{from:r,to:a,axis:n}}function E(){at.save(),at.translate(lt.left,lt.top),at.fillStyle=X(tt.grid.backgroundColor,ct,0,"rgba(255, 255, 255, 0)"),at.fillRect(0,0,ut,ct),at.restore()}function $(){var e,n,r,a;at.save(),at.translate(lt.left,lt.top);var i=tt.grid.markings;if(i)for(t.isFunction(i)&&(n=dt.getAxes(),n.xmin=n.xaxis.min,n.xmax=n.xaxis.max,n.ymin=n.yaxis.min,n.ymax=n.yaxis.max,i=i(n)),e=0;e<i.length;++e){var o=i[e],s=O(o,"x"),l=O(o,"y");if(null==s.from&&(s.from=s.axis.min),null==s.to&&(s.to=s.axis.max),null==l.from&&(l.from=l.axis.min),null==l.to&&(l.to=l.axis.max),!(s.to<s.axis.min||s.from>s.axis.max||l.to<l.axis.min||l.from>l.axis.max)){s.from=Math.max(s.from,s.axis.min),s.to=Math.min(s.to,s.axis.max),l.from=Math.max(l.from,l.axis.min),l.to=Math.min(l.to,l.axis.max);var u=s.from===s.to,c=l.from===l.to;if(!u||!c)if(s.from=Math.floor(s.axis.p2c(s.from)),s.to=Math.floor(s.axis.p2c(s.to)),l.from=Math.floor(l.axis.p2c(l.from)),l.to=Math.floor(l.axis.p2c(l.to)),u||c){var d=o.lineWidth||tt.grid.markingsLineWidth,h=d%2?.5:0;at.beginPath(),at.strokeStyle=o.color||tt.grid.markingsColor,at.lineWidth=d,u?(at.moveTo(s.to+h,l.from),at.lineTo(s.to+h,l.to)):(at.moveTo(s.from,l.to+h),at.lineTo(s.to,l.to+h)),at.stroke()}else at.fillStyle=o.color||tt.grid.markingsColor,at.fillRect(s.from,l.to,s.to-s.from,l.from-l.to)}}n=p(),r=tt.grid.borderWidth;for(var f=0;f<n.length;++f){var m,g,v,y,b=n[f],x=b.box,S=b.tickLength;if(b.show&&0!=b.ticks.length){for(at.lineWidth=1,"x"==b.direction?(m=0,g="full"==S?"top"==b.position?0:ct:x.top-lt.top+("top"==b.position?x.height:0)):(g=0,m="full"==S?"left"==b.position?0:ut:x.left-lt.left+("left"==b.position?x.width:0)),b.innermost||(at.strokeStyle=b.options.color,at.beginPath(),v=y=0,"x"==b.direction?v=ut+1:y=ct+1,1==at.lineWidth&&("x"==b.direction?g=Math.floor(g)+.5:m=Math.floor(m)+.5),at.moveTo(m,g),at.lineTo(m+v,g+y),at.stroke()),at.strokeStyle=b.options.tickColor,at.beginPath(),e=0;e<b.ticks.length;++e){var w=b.ticks[e].v;v=y=0,isNaN(w)||w<b.min||w>b.max||"full"==S&&("object"==typeof r&&r[b.position]>0||r>0)&&(w==b.min||w==b.max)||("x"==b.direction?(m=b.p2c(w),y="full"==S?-ct:S,"top"==b.position&&(y=-y)):(g=b.p2c(w),v="full"==S?-ut:S,"left"==b.position&&(v=-v)),1==at.lineWidth&&("x"==b.direction?m=Math.floor(m)+.5:g=Math.floor(g)+.5),at.moveTo(m,g),at.lineTo(m+v,g+y))}at.stroke()}}r&&(a=tt.grid.borderColor,"object"==typeof r||"object"==typeof a?("object"!=typeof r&&(r={top:r,right:r,bottom:r,left:r}),"object"!=typeof a&&(a={top:a,right:a,bottom:a,left:a}),r.top>0&&(at.strokeStyle=a.top,at.lineWidth=r.top,at.beginPath(),at.moveTo(0-r.left,0-r.top/2),at.lineTo(ut,0-r.top/2),at.stroke()),r.right>0&&(at.strokeStyle=a.right,at.lineWidth=r.right,at.beginPath(),at.moveTo(ut+r.right/2,0-r.top),at.lineTo(ut+r.right/2,ct),at.stroke()),r.bottom>0&&(at.strokeStyle=a.bottom,at.lineWidth=r.bottom,at.beginPath(),at.moveTo(ut+r.right,ct+r.bottom/2),at.lineTo(0,ct+r.bottom/2),at.stroke()),r.left>0&&(at.strokeStyle=a.left,at.lineWidth=r.left,at.beginPath(),at.moveTo(0-r.left/2,ct+r.bottom),at.lineTo(0-r.left/2,0),at.stroke())):(at.lineWidth=r,at.strokeStyle=tt.grid.borderColor,at.strokeRect(-r/2,-r/2,ut+r,ct+r))),at.restore()}function A(){t.each(p(),function(t,e){var n,r,a,i,o,s=e.box,l=e.direction+"Axis "+e.direction+e.n+"Axis",u="flot-"+e.direction+"-axis flot-"+e.direction+e.n+"-axis "+l,c=e.options.font||"flot-tick-label tickLabel";if(et.removeText(u),e.show&&0!=e.ticks.length)for(var p=0;p<e.ticks.length;++p)n=e.ticks[p],!n.label||n.v<e.min||n.v>e.max||("x"==e.direction?(i="center",r=lt.left+e.p2c(n.v),"bottom"==e.position?a=s.top+s.padding+s.eventSectionPadding:(a=s.top+s.height-s.padding,o="bottom")):(o="middle",a=lt.top+e.p2c(n.v),"left"==e.position?(r=s.left+s.width-s.padding,i="right"):r=s.left+s.padding),et.addText(u,r,a,n.label,c,null,null,i,o))})}function D(t){t.lines.show&&I(t),t.bars.show&&R(t),t.points.show&&F(t)}function I(t){function e(t,e,n,r,a){var i=t.points,o=t.pointsize,s=null,l=null;at.beginPath();for(var u=o;u<i.length;u+=o){var c=i[u-o],p=i[u-o+1],d=i[u],h=i[u+1];if(null!=c&&null!=d){if(p<=h&&p<a.min){if(h<a.min)continue;c=(a.min-p)/(h-p)*(d-c)+c,p=a.min}else if(h<=p&&h<a.min){if(p<a.min)continue;d=(a.min-p)/(h-p)*(d-c)+c,h=a.min}if(p>=h&&p>a.max){if(h>a.max)continue;c=(a.max-p)/(h-p)*(d-c)+c,p=a.max}else if(h>=p&&h>a.max){if(p>a.max)continue;d=(a.max-p)/(h-p)*(d-c)+c,h=a.max}if(c<=d&&c<r.min){if(d<r.min)continue;p=(r.min-c)/(d-c)*(h-p)+p,c=r.min}else if(d<=c&&d<r.min){if(c<r.min)continue;h=(r.min-c)/(d-c)*(h-p)+p,d=r.min}if(c>=d&&c>r.max){if(d>r.max)continue;p=(r.max-c)/(d-c)*(h-p)+p,c=r.max}else if(d>=c&&d>r.max){if(c>r.max)continue;h=(r.max-c)/(d-c)*(h-p)+p,d=r.max}c==s&&p==l||at.moveTo(r.p2c(c)+e,a.p2c(p)+n),s=d,l=h,at.lineTo(r.p2c(d)+e,a.p2c(h)+n)}}at.stroke()}at.save(),at.translate(lt.left,lt.top),at.lineJoin="round";var n=t.lines.lineWidth,r=t.shadowSize;if(n>0&&r>0){at.lineWidth=r,at.strokeStyle="rgba(0,0,0,0.1)";var a=Math.PI/18;e(t.datapoints,Math.sin(a)*(n/2+r/2),Math.cos(a)*(n/2+r/2),t.xaxis,t.yaxis),at.lineWidth=r/2,e(t.datapoints,Math.sin(a)*(n/2+r/4),Math.cos(a)*(n/2+r/4),t.xaxis,t.yaxis)}at.lineWidth=n,at.strokeStyle=t.color;var i=j(t.lines,t.color,0,ct);i&&(at.fillStyle=i,function(t,e,n){for(var r=t.points,a=t.pointsize,i=Math.min(Math.max(0,n.min),n.max),o=0,s=!1,l=1,u=0,c=0;!(a>0&&o>r.length+a);){o+=a;var p=r[o-a],d=r[o-a+l],h=r[o],f=r[o+l];if(s){if(a>0&&null!=p&&null==h){c=o,a=-a,l=2;continue}if(a<0&&o==u+a){at.fill(),s=!1,a=-a,l=1,o=u=c+a;continue}}if(null!=p&&null!=h){if(p<=h&&p<e.min){if(h<e.min)continue;d=(e.min-p)/(h-p)*(f-d)+d,p=e.min}else if(h<=p&&h<e.min){if(p<e.min)continue;f=(e.min-p)/(h-p)*(f-d)+d,h=e.min}if(p>=h&&p>e.max){if(h>e.max)continue;d=(e.max-p)/(h-p)*(f-d)+d,p=e.max}else if(h>=p&&h>e.max){if(p>e.max)continue;f=(e.max-p)/(h-p)*(f-d)+d,h=e.max}if(s||(at.beginPath(),at.moveTo(e.p2c(p),n.p2c(i)),s=!0),d>=n.max&&f>=n.max)at.lineTo(e.p2c(p),n.p2c(n.max)),at.lineTo(e.p2c(h),n.p2c(n.max));else if(d<=n.min&&f<=n.min)at.lineTo(e.p2c(p),n.p2c(n.min)),at.lineTo(e.p2c(h),n.p2c(n.min));else{var m=p,g=h;d<=f&&d<n.min&&f>=n.min?(p=(n.min-d)/(f-d)*(h-p)+p,d=n.min):f<=d&&f<n.min&&d>=n.min&&(h=(n.min-d)/(f-d)*(h-p)+p,f=n.min),d>=f&&d>n.max&&f<=n.max?(p=(n.max-d)/(f-d)*(h-p)+p,d=n.max):f>=d&&f>n.max&&d<=n.max&&(h=(n.max-d)/(f-d)*(h-p)+p,f=n.max),p!=m&&at.lineTo(e.p2c(m),n.p2c(d)),at.lineTo(e.p2c(p),n.p2c(d)),at.lineTo(e.p2c(h),n.p2c(f)),h!=g&&(at.lineTo(e.p2c(h),n.p2c(f)),at.lineTo(e.p2c(g),n.p2c(f)))}}}}(t.datapoints,t.xaxis,t.yaxis)),n>0&&e(t.datapoints,0,0,t.xaxis,t.yaxis),at.restore()}function F(t){function e(t,e,n,r,a,i,o,s){for(var l=t.points,u=t.pointsize,c=0;c<l.length;c+=u){var p=l[c],d=l[c+1];null==p||p<i.min||p>i.max||d<o.min||d>o.max||(at.beginPath(),p=i.p2c(p),d=o.p2c(d)+r,"circle"==s?at.arc(p,d,e,0,a?Math.PI:2*Math.PI,!1):s(at,p,d,e,a),at.closePath(),n&&(at.fillStyle=n,at.fill()),at.stroke())}}at.save(),at.translate(lt.left,lt.top);var n=t.points.lineWidth,r=t.shadowSize,a=t.points.radius,i=t.points.symbol;if(0==n&&(n=1e-4),n>0&&r>0){var o=r/2;at.lineWidth=o,at.strokeStyle="rgba(0,0,0,0.1)",e(t.datapoints,a,null,o+o/2,!0,t.xaxis,t.yaxis,i),at.strokeStyle="rgba(0,0,0,0.2)",e(t.datapoints,a,null,o/2,!0,t.xaxis,t.yaxis,i)}at.lineWidth=n,at.strokeStyle=t.color,e(t.datapoints,a,j(t.points,t.color),0,!1,t.xaxis,t.yaxis,i),at.restore()}function q(t,e,n,r,a,i,o,s,l,u,c){var p,d,h,f,m,g,v,y,b;u?(y=g=v=!0,m=!1,p=n,d=t,f=e+r,h=e+a,d<p&&(b=d,d=p,p=b,m=!0,g=!1)):(m=g=v=!0,y=!1,p=t+r,d=t+a,h=n,(f=e)<h&&(b=f,f=h,h=b,y=!0,v=!1)),d<o.min||p>o.max||f<s.min||h>s.max||(p<o.min&&(p=o.min,m=!1),d>o.max&&(d=o.max,g=!1),h<s.min&&(h=s.min,y=!1),f>s.max&&(f=s.max,v=!1),p=o.p2c(p),h=s.p2c(h),d=o.p2c(d),f=s.p2c(f),i&&(l.fillStyle=i(h,f),l.fillRect(p,f,d-p,h-f)),c>0&&(m||g||v||y)&&(l.beginPath(),l.moveTo(p,h),m?l.lineTo(p,f):l.moveTo(p,f),v?l.lineTo(d,f):l.moveTo(d,f),g?l.lineTo(d,h):l.moveTo(d,h),y?l.lineTo(p,h):l.moveTo(p,h),l.stroke()))}function R(t){at.save(),at.translate(lt.left,lt.top),at.lineWidth=t.bars.lineWidth,at.strokeStyle=t.color;var e;switch(t.bars.align){case"left":e=0;break;case"right":e=-t.bars.barWidth;break;default:e=-t.bars.barWidth/2}var n=t.bars.fill?function(e,n){return j(t.bars,t.color,e,n)}:null;!function(e,n,r,a,i,o){for(var s=e.points,l=e.pointsize,u=0;u<s.length;u+=l)null!=s[u]&&q(s[u],s[u+1],s[u+2],n,r,a,i,o,at,t.bars.horizontal,t.bars.lineWidth)}(t.datapoints,e,e+t.bars.barWidth,n,t.xaxis,t.yaxis),at.restore()}function j(e,n,r,a){var i=e.fill;if(!i)return null;if(e.fillColor)return X(e.fillColor,r,a,n);var o=t.color.parse(n);return o.a="number"==typeof i?i:.4,o.normalize(),o.toString()}function N(){if(null!=tt.legend.container?t(tt.legend.container).html(""):n.find(".legend").remove(),tt.legend.show){for(var e,r,a=[],i=[],o=!1,s=tt.legend.labelFormatter,l=0;l<Z.length;++l)e=Z[l],e.label&&(r=s?s(e.label,e):e.label)&&i.push({label:r,color:e.color});if(tt.legend.sorted)if(t.isFunction(tt.legend.sorted))i.sort(tt.legend.sorted);else if("reverse"==tt.legend.sorted)i.reverse();else{var u="descending"!=tt.legend.sorted;i.sort(function(t,e){return t.label==e.label?0:t.label<e.label!=u?1:-1})}for(var l=0;l<i.length;++l){var c=i[l];l%tt.legend.noColumns==0&&(o&&a.push("</tr>"),a.push("<tr>"),o=!0),a.push('<td class="legendColorBox"><div style="border:1px solid '+tt.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+c.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+c.label+"</td>")}if(o&&a.push("</tr>"),0!=a.length){var p='<table style="font-size:smaller;color:'+tt.grid.color+'">'+a.join("")+"</table>";if(null!=tt.legend.container)t(tt.legend.container).html(p);else{var d="",h=tt.legend.position,f=tt.legend.margin;null==f[0]&&(f=[f,f]),"n"==h.charAt(0)?d+="top:"+(f[1]+lt.top)+"px;":"s"==h.charAt(0)&&(d+="bottom:"+(f[1]+lt.bottom)+"px;"),"e"==h.charAt(1)?d+="right:"+(f[0]+lt.right)+"px;":"w"==h.charAt(1)&&(d+="left:"+(f[0]+lt.left)+"px;");var m=t('<div class="legend">'+p.replace('style="','style="position:absolute;'+d+";")+"</div>").appendTo(n);if(0!=tt.legend.backgroundOpacity){var g=tt.legend.backgroundColor;null==g&&(g=tt.grid.backgroundColor,g=g&&"string"==typeof g?t.color.parse(g):t.color.extract(m,"background-color"),g.a=1,g=g.toString());var v=m.children();t('<div style="position:absolute;width:'+v.width()+"px;height:"+v.height()+"px;"+d+"background-color:"+g+';"> </div>').prependTo(m).css("opacity",tt.legend.backgroundOpacity)}}}}}function L(t,e,n){var r,a,i,o=tt.grid.mouseActiveRadius,s=o*o+1,l=null;for(r=Z.length-1;r>=0;--r)if(n(Z[r])){var u=Z[r],c=u.xaxis,p=u.yaxis,d=u.datapoints.points,h=c.c2p(t),f=p.c2p(e),m=o/c.scale,g=o/p.scale;if(i=u.datapoints.pointsize,c.options.inverseTransform&&(m=Number.MAX_VALUE),p.options.inverseTransform&&(g=Number.MAX_VALUE),u.lines.show||u.points.show)for(a=0;a<d.length;a+=i){var v=d[a],y=d[a+1];if(null!=v&&!(v-h>m||v-h<-m||y-f>g||y-f<-g)){var b=Math.abs(c.p2c(v)-t),x=Math.abs(p.p2c(y)-e),S=b*b+x*x;S<s&&(s=S,l=[r,a/i])}}if(u.bars.show&&!l){var w,k;switch(u.bars.align){case"left":w=0;break;case"right":w=-u.bars.barWidth;break;default:w=-u.bars.barWidth/2}for(k=w+u.bars.barWidth,a=0;a<d.length;a+=i){var v=d[a],y=d[a+1],_=d[a+2];null!=v&&((Z[r].bars.horizontal?h<=Math.max(_,v)&&h>=Math.min(_,v)&&f>=y+w&&f<=y+k:h>=v+w&&h<=v+k&&f>=Math.min(_,y)&&f<=Math.max(_,y))&&(l=[r,a/i]))}}}return l?(r=l[0],a=l[1],i=Z[r].datapoints.pointsize,{datapoint:Z[r].datapoints.points.slice(a*i,(a+1)*i),dataIndex:a,series:Z[r],seriesIndex:r}):null}function U(t){tt.grid.hoverable&&z("plothover",t,function(t){return 0!=t.hoverable})}function V(t){tt.grid.hoverable&&z("plothover",t,function(t){return!1})}function B(t){dt.isSelecting||z("plotclick",t,function(t){return 0!=t.clickable})}function z(t,e,r){var a=rt.offset(),i=e.pageX-a.left-lt.left,o=e.pageY-a.top-lt.top,s=d({left:i,top:o});s.pageX=e.pageX,s.pageY=e.pageY,s.ctrlKey=e.ctrlKey,s.metaKey=e.metaKey;var l=L(i,o,r);if(l&&(l.pageX=parseInt(l.series.xaxis.p2c(l.datapoint[0])+a.left+lt.left,10),l.pageY=parseInt(l.series.yaxis.p2c(l.datapoint[1])+a.top+lt.top,10)),tt.grid.autoHighlight){for(var u=0;u<ht.length;++u){var c=ht[u];c.auto!=t||l&&c.series==l.series&&c.point[0]==l.datapoint[0]&&c.point[1]==l.datapoint[1]||W(c.series,c.point)}l&&Y(l.series,l.datapoint,t)}n.trigger(t,[s,l])}function Q(){var t=tt.interaction.redrawOverlayInterval;if(-1==t)return void H();ft||(ft=setTimeout(H,t))}function H(){ft=null,it.save(),nt.clear(),it.translate(lt.left,lt.top);var t,e;for(t=0;t<ht.length;++t)e=ht[t],e.series.bars.show?J(e.series,e.point):K(e.series,e.point);it.restore(),s(pt.drawOverlay,[it])}function Y(t,e,n){if("number"==typeof t&&(t=Z[t]),"number"==typeof e){var r=t.datapoints.pointsize;e=t.datapoints.points.slice(r*e,r*(e+1))}var a=G(t,e);-1==a?(ht.push({series:t,point:e,auto:n}),Q()):n||(ht[a].auto=!1)}function W(t,e){if(null==t&&null==e)return ht=[],void Q();if("number"==typeof t&&(t=Z[t]),"number"==typeof e){var n=t.datapoints.pointsize;e=t.datapoints.points.slice(n*e,n*(e+1))}var r=G(t,e);-1!=r&&(ht.splice(r,1),Q())}function G(t,e){for(var n=0;n<ht.length;++n){var r=ht[n];if(r.series==t&&r.point[0]==e[0]&&r.point[1]==e[1])return n}return-1}function K(e,n){var r=n[0],a=n[1],i=e.xaxis,o=e.yaxis,s="string"==typeof e.highlightColor?e.highlightColor:t.color.parse(e.color).scale("a",.5).toString();if(!(r<i.min||r>i.max||a<o.min||a>o.max)){var l=e.points.radius+e.points.lineWidth/2;it.lineWidth=l,it.strokeStyle=s;var u=1.5*l;r=i.p2c(r),a=o.p2c(a),it.beginPath(),"circle"==e.points.symbol?it.arc(r,a,u,0,2*Math.PI,!1):e.points.symbol(it,r,a,u,!1),it.closePath(),it.stroke()}}function J(e,n){var r,a="string"==typeof e.highlightColor?e.highlightColor:t.color.parse(e.color).scale("a",.5).toString(),i=a;switch(e.bars.align){case"left":r=0;break;case"right":r=-e.bars.barWidth;break;default:r=-e.bars.barWidth/2}it.lineWidth=e.bars.lineWidth,it.strokeStyle=a,q(n[0],n[1],n[2]||0,r,r+e.bars.barWidth,function(){return i},e.xaxis,e.yaxis,it,e.bars.horizontal,e.bars.lineWidth)}function X(e,n,r,a){if("string"==typeof e)return e;for(var i=at.createLinearGradient(0,r,0,n),o=0,s=e.colors.length;o<s;++o){var l=e.colors[o];if("string"!=typeof l){var u=t.color.parse(a);null!=l.brightness&&(u=u.scale("rgb",l.brightness)),null!=l.opacity&&(u.a*=l.opacity),l=u.toString()}i.addColorStop(o/(s-1),l)}return i}var Z=[],tt={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,eventSectionHeight:0,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},et=null,nt=null,rt=null,at=null,it=null,ot=[],st=[],lt={left:0,right:0,top:0,bottom:0},ut=0,ct=0,pt={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],processRange:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},dt=this;dt.setData=l,dt.setupGrid=k,dt.draw=P,dt.getPlaceholder=function(){return n},dt.getCanvas=function(){return et.element},dt.getPlotOffset=function(){return lt},dt.width=function(){return ut},dt.height=function(){return ct},dt.offset=function(){var t=rt.offset();return t.left+=lt.left,t.top+=lt.top,t},dt.getData=function(){return Z},dt.getAxes=function(){var e={};return t.each(ot.concat(st),function(t,n){n&&(e[n.direction+(1!=n.n?n.n:"")+"axis"]=n)}),e},dt.getXAxes=function(){return ot},dt.getYAxes=function(){return st},dt.c2p=d,dt.p2c=h,dt.getOptions=function(){return tt},dt.highlight=Y,dt.unhighlight=W,dt.triggerRedrawOverlay=Q,dt.pointOffset=function(t){return{left:parseInt(ot[c(t,"x")-1].p2c(+t.x)+lt.left,10),top:parseInt(st[c(t,"y")-1].p2c(+t.y)+lt.top,10)}},dt.shutdown=v,dt.destroy=function(){v(),n.removeData("plot").empty(),Z=[],tt=null,et=null,nt=null,rt=null,at=null,it=null,ot=[],st=[],pt=null,ht=[],dt=null},dt.resize=function(){var t=n.width(),e=n.height();et.resize(t,e),nt.resize(t,e)},dt.hooks=pt,function(){for(var n={Canvas:e},r=0;r<o.length;++r){var a=o[r];a.init(dt,n),a.options&&t.extend(!0,tt,a.options)}}(),function(e){t.extend(!0,tt,e),e&&e.colors&&(tt.colors=e.colors),null==tt.xaxis.color&&(tt.xaxis.color=t.color.parse(tt.grid.color).scale("a",.22).toString()),null==tt.yaxis.color&&(tt.yaxis.color=t.color.parse(tt.grid.color).scale("a",.22).toString()),null==tt.xaxis.tickColor&&(tt.xaxis.tickColor=tt.grid.tickColor||tt.xaxis.color),null==tt.yaxis.tickColor&&(tt.yaxis.tickColor=tt.grid.tickColor||tt.yaxis.color),null==tt.grid.borderColor&&(tt.grid.borderColor=tt.grid.color),null==tt.grid.tickColor&&(tt.grid.tickColor=t.color.parse(tt.grid.color).scale("a",.22).toString());var r,a,i,o=n.css("font-size"),l=o?+o.replace("px",""):13,u={style:n.css("font-style"),size:Math.round(.8*l),variant:n.css("font-variant"),weight:n.css("font-weight"),family:n.css("font-family")};for(i=tt.xaxes.length||1,r=0;r<i;++r)a=tt.xaxes[r],a&&!a.tickColor&&(a.tickColor=a.color),a=t.extend(!0,{},tt.xaxis,a),tt.xaxes[r]=a,a.font&&(a.font=t.extend({},u,a.font),a.font.color||(a.font.color=a.color),a.font.lineHeight||(a.font.lineHeight=Math.round(1.15*a.font.size)));for(i=tt.yaxes.length||1,r=0;r<i;++r)a=tt.yaxes[r],a&&!a.tickColor&&(a.tickColor=a.color),a=t.extend(!0,{},tt.yaxis,a),tt.yaxes[r]=a,a.font&&(a.font=t.extend({},u,a.font),a.font.color||(a.font.color=a.color),a.font.lineHeight||(a.font.lineHeight=Math.round(1.15*a.font.size)));for(tt.xaxis.noTicks&&null==tt.xaxis.ticks&&(tt.xaxis.ticks=tt.xaxis.noTicks),tt.yaxis.noTicks&&null==tt.yaxis.ticks&&(tt.yaxis.ticks=tt.yaxis.noTicks),tt.x2axis&&(tt.xaxes[1]=t.extend(!0,{},tt.xaxis,tt.x2axis),tt.xaxes[1].position="top",null==tt.x2axis.min&&(tt.xaxes[1].min=null),null==tt.x2axis.max&&(tt.xaxes[1].max=null)),tt.y2axis&&(tt.yaxes[1]=t.extend(!0,{},tt.yaxis,tt.y2axis),tt.yaxes[1].position="right",null==tt.y2axis.min&&(tt.yaxes[1].min=null),null==tt.y2axis.max&&(tt.yaxes[1].max=null)),tt.grid.coloredAreas&&(tt.grid.markings=tt.grid.coloredAreas),tt.grid.coloredAreasColor&&(tt.grid.markingsColor=tt.grid.coloredAreasColor),tt.lines&&t.extend(!0,tt.series.lines,tt.lines),tt.points&&t.extend(!0,tt.series.points,tt.points),tt.bars&&t.extend(!0,tt.series.bars,tt.bars),null!=tt.shadowSize&&(tt.series.shadowSize=tt.shadowSize),null!=tt.highlightColor&&(tt.series.highlightColor=tt.highlightColor),r=0;r<tt.xaxes.length;++r)f(ot,r+1).options=tt.xaxes[r];for(r=0;r<tt.yaxes.length;++r)f(st,r+1).options=tt.yaxes[r];for(var c in pt)tt.hooks[c]&&tt.hooks[c].length&&(pt[c]=pt[c].concat(tt.hooks[c]));s(pt.processOptions,[tt])}(i),function(){n.find(".flot-temp-elem").remove(),"static"==n.css("position")&&n.css("position","relative"),et=new e("flot-base",n),nt=new e("flot-overlay",n),at=et.context,it=nt.context,rt=t(nt.element).unbind();var r=n.data("plot");r&&(r.shutdown(),nt.clear()),n.data("plot",dt)}(),l(a),k(),P(),function(){tt.grid.hoverable&&(rt.mousemove(U),rt.bind("mouseleave",V)),tt.grid.clickable&&rt.click(B),s(pt.bindEvents,[rt])}();var ht=[],ft=null}function r(t,e){return e*Math.floor(t/e)}var a=Object.prototype.hasOwnProperty;t.fn.detach||(t.fn.detach=function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})}),e.prototype.resize=function(t,e){if(t<=0||e<=0)throw new Error("Invalid dimensions for plot, width = "+t+", height = "+e);var n=this.element,r=this.context,a=this.pixelRatio;this.width!=t&&(n.width=t*a,n.style.width=t+"px",this.width=t),this.height!=e&&(n.height=e*a,n.style.height=e+"px",this.height=e),r.restore(),r.save(),r.scale(a,a)},e.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},e.prototype.render=function(){var t=this._textCache;for(var e in t)if(a.call(t,e)){var n=this.getTextLayer(e),r=t[e];n.hide();for(var i in r)if(a.call(r,i)){var o=r[i];for(var s in o)if(a.call(o,s)){for(var l,u=o[s].positions,c=0;l=u[c];c++)l.active?l.rendered||(n.append(l.element),l.rendered=!0):(u.splice(c--,1),l.rendered&&l.element.detach());0==u.length&&delete o[s]}}n.show()}},e.prototype.getTextLayer=function(e){var n=this.text[e];return null==n&&(null==this.textContainer&&(this.textContainer=t("<div class='flot-text flot-temp-elem'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),n=this.text[e]=t("<div></div>").addClass(e).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),n},e.prototype.getTextInfo=function(e,n,r,a,i){var o,s,l,u;if(n=""+n,o="object"==typeof r?r.style+" "+r.variant+" "+r.weight+" "+r.size+"px/"+r.lineHeight+"px "+r.family:r,s=this._textCache[e],null==s&&(s=this._textCache[e]={}),l=s[o],null==l&&(l=s[o]={}),null==(u=l[n])){var c=t("<div></div>").html(n).css({position:"absolute","max-width":i,top:-9999}).appendTo(this.getTextLayer(e));"object"==typeof r?c.css({font:o,color:r.color}):"string"==typeof r&&c.addClass(r),u=l[n]={element:c,positions:[]};var p=this._textSizeCache[n];p?(u.width=p.width,u.height=p.height):(u.width=c.outerWidth(!0),u.height=c.outerHeight(!0),this._textSizeCache[n]={width:u.width,height:u.height}),c.detach()}return u},e.prototype.addText=function(t,e,n,r,a,i,o,s,l){var u=this.getTextInfo(t,r,a,i,o),c=u.positions;"center"==s?e-=u.width/2:"right"==s&&(e-=u.width),"middle"==l?n-=u.height/2:"bottom"==l&&(n-=u.height);for(var p,d=0;p=c[d];d++)if(p.x==e&&p.y==n)return void(p.active=!0);p={active:!0,rendered:!1,element:c.length?u.element.clone():u.element,x:e,y:n},c.push(p),p.element.css({top:Math.round(n),left:Math.round(e),"text-align":s})},e.prototype.removeText=function(t,e,n,r,i,o){if(null==r){var s=this._textCache[t];if(null!=s)for(var l in s)if(a.call(s,l)){var u=s[l];for(var c in u)if(a.call(u,c))for(var p,d=u[c].positions,h=0;p=d[h];h++)p.active=!1}}else for(var p,d=this.getTextInfo(t,r,i,o).positions,h=0;p=d[h];h++)p.x==e&&p.y==n&&(p.active=!1)},t.plot=function(e,r,a){return new n(t(e),r,a,t.plot.plugins)},t.plot.version="0.8.3",t.plot.plugins=[],t.fn.plot=function(e,n){return this.each(function(){t.plot(this,e,n)})}}(jQuery)},1470:function(t,e,n){"use strict";function r(t,e){s.a.registerDynamic(t,[],!0,function(t,n,r){r.exports=e})}function a(t){var e=M.a[t];return e?Promise.resolve(e):s.a.import(t)}function i(t){y.a.bootData.user.lightTheme?s.a.import(t.light+"!css"):s.a.import(t.dark+"!css")}e.a=a,e.b=i;var o=n(1528),s=n.n(o),l=n(4),u=n.n(l),c=n(1464),p=n(224),d=n(1),h=n.n(d),f=n(21),m=n.n(f),g=n(16),v=n.n(g),y=n(22),b=n(144),x=n(1466),S=n(225),w=n(512),k=n(1479),_=n(1480),C=n(516),T=n(517),M=n(1538),P=n(515),O=n(511),E=(n.n(O),n(1631)),$=(n.n(E),n(1634)),A=(n.n($),n(1636)),D=(n.n(A),n(1645)),I=(n.n(D),n(1648)),F=(n.n(I),n(1469)),q=(n.n(F),n(1486)),R=(n.n(q),n(1487)),j=(n.n(R),n(1488)),N=(n.n(j),n(1655)),L=(n.n(N),n(1489)),U=(n.n(L),n(1490)),V=(n.n(U),n(1491)),B=(n.n(V),n(1492));n.n(B);s.a.config({baseURL:"public",defaultExtension:"js",packages:{plugins:{defaultExtension:"js"}},map:{text:"vendor/plugin-text/text.js",css:"vendor/plugin-css/css.js"},meta:{"*":{esModule:!0,authorization:!0}}});var z=s.a.locate;s.a.cacheBust="?bust="+Date.now(),s.a.locate=function(t){var e=this;return Promise.resolve(z.call(this,t)).then(function(t){return t+e.cacheBust})},r("lodash",u.a),r("moment",h.a),r("jquery",v.a),r("angular",m.a),r("d3",P),r("rxjs/Subject",E.Subject),r("rxjs/Observable",O.Observable),r("vendor/npm/rxjs/Rx",{Subject:E.Subject,Observable:O.Observable}),r("app/features/dashboard/impression_store",{impressions:T.a,__esModule:!0}),r("app/plugins/sdk",c),r("app/core/utils/datemath",w),r("app/core/utils/file_export",k),r("app/core/utils/flatten",_),r("app/core/utils/kbn",p.a),r("app/core/utils/ticks",C),r("app/core/config",y.a),r("app/core/time_series",b.a),r("app/core/time_series2",b.a),r("app/core/table_model",x.a),r("app/core/app_events",S.b),r("app/core/core_module",S.d),r("app/core/core",{coreModule:S.d,appEvents:S.b,contextSrv:S.c,__esModule:!0});for(var Q=["jquery.flot","jquery.flot.pie","jquery.flot.time","jquery.flot.fillbelow","jquery.flot.crosshair","jquery.flot.stack","jquery.flot.selection","jquery.flot.stackpercent","jquery.flot.events"],H=0,Y=Q;H<Y.length;H++){r(Y[H],{fakeDep:1})}},1471:function(t,e,n){"use strict";function r(t){for(var e={},n=0;n<t.length;n++){var r=t[n],a=n;if(isNaN(a))return e;for(var i=0,o=r.datapoints;i<o.length;i++){var s=o[i],l=s[k],u=s[_];if(w.a.isNumber(l)){var c=e[u];c||(c=e[u]={x:u,buckets:{}}),c.buckets[a]={y:a,count:l,bounds:{top:null,bottom:a},values:[],points:[]}}}}return e}function a(t,e){var n,r;try{n=i(t.label),r=i(e.label)}catch(t){return console.log(t.message||t),0}return n>r?1:n<r?-1:0}function i(t){if("+Inf"===t||"inf"===t)return 1/0;var e=Number(t);if(isNaN(e))throw new Error("Error parsing histogram label: "+t+" is not a number");return e}function o(t){var e=0,n=0,r=[];return w.a.forEach(t,function(t){w.a.forEach(t.buckets,function(a){var i={x:t.x,y:a.y,yBounds:a.bounds,values:a.values,count:a.count};r.push(i),1===r.length&&(e=a.count,n=a.count),e=a.count<e?a.count:e,n=a.count>n?a.count:n})}),{cards:r,cardStats:{min:e,max:n}}}function s(t,e){return w.a.forEach(t,function(t){var n=t.buckets,r={bounds:{bottom:0,top:0},values:[],points:[],count:0},a=n[0]||r,i=n[e]||r,o={y:0,bounds:{bottom:e,top:i.bounds.top||e},values:[],points:[],count:0};o.points=a.points.concat(i.points),o.values=a.values.concat(i.values),o.count=o.values.length,0!==o.count&&(delete n[e],n[0]=o)}),t}function l(t,e,n,r){void 0===r&&(r=1);for(var a={},i=0,o=t;i<o.length;i++){var s=o[i];!function(t){var e=t.datapoints,r=t.label;w.a.forEach(e,function(t){var e=h(t[_],n);u(a,t,e,r)})}(s)}return w.a.forEach(a,function(t){t.buckets=1!==r?v(t,e,r):f(t,e)}),a}function u(t,e,n,r){var a=e[k];if(null!==a&&void 0!==a&&!isNaN(a)){var i=w.a.concat(e,r);t[n]&&t[n].values?(t[n].values.push(a),t[n].points.push(i)):t[n]={x:n,values:[a],points:[i]}}}function c(t,e,n,r,a){var i=1;r.length>3&&(i=parseInt(r[2])),t[e]?(t[e].values.push(n),t[e].points.push(r),t[e].count+=i):t[e]={y:e,bounds:a,values:[n],points:[r],count:i}}function p(t,e,n){return 1===n?h(t,e):g(t,e,n)}function d(t,e){var n,r;return n=Math.floor(t/e)*e,r=(Math.floor(t/e)+1)*e,{bottom:n,top:r}}function h(t,e){return d(t,e).bottom}function f(t,e){var n=t.values,r=t.points,a={};return w.a.forEach(n,function(t,n){var i=d(t,e),o=i.bottom;c(a,o,t,r[n],i)}),a}function m(t,e,n){var r,a;if(0===t)return{bottom:0,top:0};var i,o,s=y(t,n);if(1!==e&&e){var l=1/e,u=s-Math.floor(s);u=Math.floor(u/l)*l,i=Math.floor(s)+u,o=i+l}else i=Math.floor(s),o=i+1;return a=Math.pow(n,i),r=Math.pow(n,o),{bottom:a,top:r}}function g(t,e,n){return m(t,e,n).bottom}function v(t,e,n){var r=t.values,a=t.points,i={};return w.a.forEach(r,function(t,r){var o=m(t,e,n),s=o.bottom;c(i,s,t,a[r],o)}),i}function y(t,e){return Math.log(t)/Math.log(e)}function b(t,e){void 0===e&&(e=1);var n=1/0;if(0===t.length)return 0;if(1===t.length)return t[0];t=w.a.sortBy(t);for(var r=1;r<t.length;r++){var a=x(t[r],t[r-1],e);n=a<n?a:n}return n}function x(t,e,n){return void 0===n&&(n=1),1===n?Math.abs(e-t):y(Math.max(t,e)/Math.min(t,e),n)}n.d(e,"c",function(){return l}),n.d(e,"e",function(){return r}),n.d(e,"b",function(){return o}),n.d(e,"f",function(){return s}),n.d(e,"d",function(){return p}),n.d(e,"a",function(){return b}),n.d(e,"g",function(){return a});var S=n(4),w=n.n(S),k=0,_=1},1472:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(511),i=function(t){function e(e){t.call(this),this.scheduler=e}return r(e,t),e.create=function(t){return new e(t)},e.dispatch=function(t){t.subscriber.complete()},e.prototype._subscribe=function(t){var n=this.scheduler;if(n)return n.schedule(e.dispatch,0,{subscriber:t});t.complete()},e}(a.Observable);e.EmptyObservable=i},1473:function(t,e,n){"use strict";function r(t){var e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;var n=t.Set;if(n&&"function"==typeof(new n)["@@iterator"])return"@@iterator";var r=t.Map;if(r)for(var a=Object.getOwnPropertyNames(r.prototype),i=0;i<a.length;++i){var o=a[i];if("entries"!==o&&"size"!==o&&r.prototype[o]===r.prototype.entries)return o}return"@@iterator"}var a=n(145);e.symbolIteratorPonyfill=r,e.iterator=r(a.root),e.$$iterator=e.iterator},1474:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(224),l=function(){function t(t,e){this.templateSrv=t,this.timeSrv=e}return t.$inject=["templateSrv","timeSrv"],t.prototype.getLinkUrl=function(t){var e=this.templateSrv.replace(t.url||""),n={};if(t.keepTime){var r=this.timeSrv.timeRangeForUrl();n.from=r.from,n.to=r.to}return t.includeVars&&this.templateSrv.fillVariableValuesForUrl(n),this.addParamsToUrl(e,n)},t.prototype.addParamsToUrl=function(t,e){var n=[];return o.a.each(e,function(t,e){null!==t&&(!0===t?n.push(e):o.a.isArray(t)?o.a.each(t,function(t){n.push(e+"="+encodeURIComponent(t))}):n.push(e+"="+encodeURIComponent(t)))}),0===n.length?t:this.appendToQueryString(t,n.join("&"))},t.prototype.appendToQueryString=function(t,e){if(!o.a.isUndefined(e)&&null!==e&&""!==e){var n=t.indexOf("?");-1!==n?t.length-n>1&&(t+="&"):t+="?",t+=e}return t},t.prototype.getAnchorInfo=function(t){var e={};return e.href=this.getLinkUrl(t),e.title=this.templateSrv.replace(t.title||""),e},t.prototype.getPanelLinkAnchorInfo=function(t,e){var n={};if("absolute"===t.type)n.target=t.targetBlank?"_blank":"_self",n.href=this.templateSrv.replace(t.url||"",e),n.title=this.templateSrv.replace(t.title||"",e);else if(t.dashUri)n.href="dashboard/"+t.dashUri+"?",n.title=this.templateSrv.replace(t.title||"",e),n.target=t.targetBlank?"_blank":"";else{n.title=this.templateSrv.replace(t.title||"",e);var r=s.a.slugifyForUrl(t.dashboard||"");n.href="dashboard/db/"+r+"?"}var a={};if(t.keepTime){var i=this.timeSrv.timeRangeForUrl();a.from=i.from,a.to=i.to}return t.includeVars&&this.templateSrv.fillVariableValuesForUrl(a,e),n.href=this.addParamsToUrl(n.href,a),t.params&&(n.href=this.appendToQueryString(n.href,this.templateSrv.replace(t.params,e))),n},t}();a.a.module("grafana.services").service("linkSrv",l)},1475:function(t,e,n){"use strict";var r=(n(1504),n(1507),n(1508));n(1476),n(1509);n.d(e,"a",function(){return r.a})},1476:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(){}return t}()},1477:function(t,e,n){"use strict";function r(t){return t.replace(/([\!\*\+\-\=<>\s\&\|\(\)\[\]\{\}\^\~\?\:\\/"])/g,"\\$1")}var a=n(224),i=n(4),o=n.n(i),s=function(){function t(){this.regex=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?::(\w+))?}/g,this.index={},this.grafanaVariables={},this.builtIns={},this.builtIns.__interval={text:"1s",value:"1s"},this.builtIns.__interval_ms={text:"100",value:"100"}}return t.prototype.init=function(t){this.variables=t,this.updateTemplateData()},t.prototype.updateTemplateData=function(){this.index={};for(var t=0;t<this.variables.length;t++){var e=this.variables[t];e.current&&(e.current.isNone||e.current.value)&&(this.index[e.name]=e)}},t.prototype.variableInitialized=function(t){this.index[t.name]=t},t.prototype.getAdhocFilters=function(t){for(var e=[],n=0;n<this.variables.length;n++){var r=this.variables[n];"adhoc"===r.type&&(r.datasource===t&&(e=e.concat(r.filters)),0===r.datasource.indexOf("$")&&this.replace(r.datasource)===t&&(e=e.concat(r.filters)))}return e},t.prototype.luceneFormat=function(t){return"string"==typeof t?r(t):"("+o.a.map(t,function(t){return'"'+r(t)+'"'}).join(" OR ")+")"},t.prototype.formatValue=function(t,e,n){if(n=n||{},"function"==typeof e)return e(t,n,this.formatValue);switch(e){case"regex":if("string"==typeof t)return a.a.regexEscape(t);var r=o.a.map(t,a.a.regexEscape);return 1===r.length?r[0]:"("+r.join("|")+")";case"lucene":return this.luceneFormat(t);case"pipe":return"string"==typeof t?t:t.join("|");case"distributed":return"string"==typeof t?t:this.distributeVariable(t,n.name);case"csv":return o.a.isArray(t)?t.join(","):t;default:return o.a.isArray(t)?"{"+t.join(",")+"}":t}},t.prototype.setGrafanaVariable=function(t,e){this.grafanaVariables[t]=e},t.prototype.getVariableName=function(t){this.regex.lastIndex=0;var e=this.regex.exec(t);return e?e[1]||e[2]:null},t.prototype.variableExists=function(t){var e=this.getVariableName(t);return e&&void 0!==this.index[e]},t.prototype.highlightVariablesAsHtml=function(t){var e=this;return t&&o.a.isString(t)?(t=o.a.escape(t),this.regex.lastIndex=0,t.replace(this.regex,function(t,n,r,a,i){return e.index[n||r||i]||e.builtIns[n||r||i]?'<span class="template-variable">'+t+"</span>":t})):t},t.prototype.getAllValue=function(t){if(t.allValue)return t.allValue;for(var e=[],n=1;n<t.options.length;n++)e.push(t.options[n].value);return e},t.prototype.replace=function(t,e,n){var r=this;if(!t)return t;var a,i,o;return this.regex.lastIndex=0,t.replace(this.regex,function(t,s,l,u,c,p){return a=r.index[s||l||c],n=u||p||n,e&&(o=e[s||l||c])?r.formatValue(o.value,n,a):a?(i=r.grafanaVariables[a.current.value])?r.formatValue(i,n,a):(o=a.current.value,r.isAllValue(o)&&(o=r.getAllValue(a),a.allValue)?o:r.formatValue(o,n,a)):t})},t.prototype.isAllValue=function(t){return"$__all"===t||Array.isArray(t)&&"$__all"===t[0]},t.prototype.replaceWithText=function(t,e){var n=this;if(!t)return t;var r;return this.regex.lastIndex=0,t.replace(this.regex,function(t,a,i,o,s){if(e){var l=e[a||i||s];if(l)return l.text}return r=n.index[a||i||s],r?n.grafanaVariables[r.current.value]||r.current.text:t})},t.prototype.fillVariableValuesForUrl=function(t,e){o.a.each(this.variables,function(n){e&&void 0!==e[n.name]?t["var-"+n.name]=e[n.name].value:t["var-"+n.name]=n.getValueForUrl()})},t.prototype.distributeVariable=function(t,e){return t=o.a.map(t,function(t,n){return 0!==n?e+"="+t:t}),t.join(",")},t}();e.a=new s},1478:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(4),a=n.n(r),i=function(){function t(t,e){this.$scope=t,this.$injector=e,this.panel=this.panelCtrl.panel,this.isLastQuery=a.a.indexOf(this.panel.targets,this.target)===this.panel.targets.length-1}return t.prototype.refresh=function(){this.panelCtrl.refresh()},t}()},1479:function(t,e,n){"use strict";function r(t,e,n){void 0===e&&(e=m),void 0===n&&(n=!1);var r=(n?"sep=;\n":"")+"Series;Time;Value\n";return p.a.each(t,function(t){p.a.each(t.datapoints,function(n){r+=t.alias+";"+h()(n[g]).format(e)+";"+n[v]+"\n"})}),r}function a(t,e,n){void 0===e&&(e=m),void 0===n&&(n=!1),u(r(t,e,n),"grafana_data_export.csv")}function i(t,e,n){void 0===e&&(e=m),void 0===n&&(n=!1);var r=(n?"sep=;\n":"")+"Time;";p.a.each(t,function(t){r+=t.alias+";"}),r=r.substring(0,r.length-1),r+="\n",t=o(t);var a=[[]],i=1;p.a.each(t,function(t){var n=0;a.push([]),p.a.each(t.datapoints,function(t){a[0][n]=h()(t[g]).format(e),a[i][n]=t[v],n++}),i++});for(var s=0;s<a[0].length;s++){r+=a[0][s]+";";for(var l=1;l<a.length;l++)r+=a[l][s]+";";r=r.substring(0,r.length-1),r+="\n"}return r}function o(t){for(var e=[],n=0;n<t.length;n++)for(var r=t[n].datapoints,a=0;a<r.length;a++)e.push(r[a][g]);e=p.a.sortedUniq(e.sort());for(var n=0;n<t.length;n++){for(var r=t[n].datapoints,i=p.a.map(r,function(t){return t[g]}),o=[],s=void 0,a=0;a<e.length;a++)s=p.a.sortedIndexOf(i,e[a]),-1!==s?o.push(r[s]):o.push([null,e[a]]);t[n].datapoints=o}return t}function s(t,e,n){void 0===e&&(e=m),void 0===n&&(n=!1),u(i(t,e,n),"grafana_data_export.csv")}function l(t,e){void 0===e&&(e=!1);var n=e?"sep=;\n":"";p.a.each(t.columns,function(t){n+=(t.title||t.text)+";"}),n+="\n",p.a.each(t.rows,function(t){p.a.each(t,function(t){n+=t+";"}),n+="\n"}),u(n,"grafana_data_export.csv")}function u(t,e){var n=new Blob([t],{type:"text/csv;charset=utf-8"});Object(f.saveAs)(n,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.convertSeriesListToCsv=r,e.exportSeriesListToCsv=a,e.convertSeriesListToCsvColumns=i,e.exportSeriesListToCsvColumns=s,e.exportTableDataToCsv=l,e.saveSaveBlob=u;var c=n(4),p=n.n(c),d=n(1),h=n.n(d),f=n(227),m=(n.n(f),"YYYY-MM-DDTHH:mm:ssZ"),g=1,v=0},1480:function(t,e,n){"use strict";function r(t,e){function n(t,s){Object.keys(t).forEach(function(l){var u=t[l],c=e.safe&&Array.isArray(u),p=Object.prototype.toString.call(u),d="[object Object]"===p,h=s?s+r+l:l;if(e.maxDepth||(a=i+1),!c&&d&&Object.keys(u).length&&i<a)return++i,n(u,h);o[h]=u})}e=e||{};var r=e.delimiter||".",a=e.maxDepth||3,i=1,o={};return n(t,null),o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r},1481:function(t,e,n){"use strict";function r(t,e){return new s(t).isGtOrEq(e)}n.d(e,"a",function(){return s}),e.b=r;var a=n(4),i=n.n(a),o=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/,s=function(){function t(t){var e=o.exec(t);e&&(this.major=Number(e[1]),this.minor=Number(e[2]||0),this.patch=Number(e[3]||0),this.meta=e[4])}return t.prototype.isGtOrEq=function(e){var n=new t(e);return!(this.major<n.major||this.minor<n.minor||this.patch<n.patch)},t.prototype.isValid=function(){return i.a.isNumber(this.major)},t}()},1482:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=function(){function t(){return{templateUrl:"public/app/plugins/datasource/cloudwatch/partials/query.parameter.html",controller:"CloudWatchQueryParameterCtrl",restrict:"E",scope:{target:"=",datasource:"=",onChange:"&"}}}return t}(),l=function(){function t(t,e,n,r,i){t.init=function(){var e=t.target;e.namespace=e.namespace||"",e.metricName=e.metricName||"",e.statistics=e.statistics||["Average"],e.dimensions=e.dimensions||{},e.period=e.period||"",e.region=e.region||"default",e.highResolution=e.highResolution||!1,t.regionSegment=n.getSegmentForValue(t.target.region,"select region"),t.namespaceSegment=n.getSegmentForValue(t.target.namespace,"select namespace"),t.metricSegment=n.getSegmentForValue(t.target.metricName,"select metric"),t.dimSegments=o.a.reduce(t.target.dimensions,function(t,e,r){return t.push(n.newKey(r)),t.push(n.newOperator("=")),t.push(n.newKeyValue(e)),t},[]),t.statSegments=o.a.map(t.target.statistics,function(t){return n.getSegmentForValue(t)}),t.ensurePlusButton(t.statSegments),t.ensurePlusButton(t.dimSegments),t.removeDimSegment=n.newSegment({fake:!0,value:"-- remove dimension --"}),t.removeStatSegment=n.newSegment({fake:!0,value:"-- remove stat --"}),o.a.isEmpty(t.target.region)&&(t.target.region="default"),t.onChange||(t.onChange=function(){})},t.getStatSegments=function(){return i.when(o.a.flatten([a.a.copy(t.removeStatSegment),o.a.map(t.datasource.standardStatistics,function(t){return n.getSegmentForValue(t)}),n.getSegmentForValue("pNN.NN")]))},t.statSegmentChanged=function(e,n){e.value===t.removeStatSegment.value?t.statSegments.splice(n,1):e.type="value",t.target.statistics=o.a.reduce(t.statSegments,function(t,e){return e.fake||t.push(e.value),t},[]),t.ensurePlusButton(t.statSegments),t.onChange()},t.ensurePlusButton=function(t){var e=t.length,r=t[Math.max(e-1,0)];r&&"plus-button"===r.type||t.push(n.newPlusButton())},t.getDimSegments=function(e,n){if("operator"===e.type)return i.when([]);var r=t.target,o=i.when([]);if("key"===e.type||"plus-button"===e.type)o=t.datasource.getDimensionKeys(t.target.namespace,t.target.region);else if("value"===e.type){var s=t.dimSegments[n-2].value;o=t.datasource.getDimensionValues(r.region,r.namespace,r.metricName,s,r.dimensions)}return o.then(t.transformToSegments(!0)).then(function(n){return"key"===e.type&&n.splice(0,0,a.a.copy(t.removeDimSegment)),n})},t.dimSegmentChanged=function(e,r){t.dimSegments[r]=e,e.value===t.removeDimSegment.value?t.dimSegments.splice(r,3):"plus-button"===e.type&&(t.dimSegments.push(n.newOperator("=")),t.dimSegments.push(n.newFake("select dimension value","value","query-segment-value")),e.type="key",e.cssClass="query-segment-key"),t.syncDimSegmentsWithModel(),t.ensurePlusButton(t.dimSegments),t.onChange()},t.syncDimSegmentsWithModel=function(){for(var e={},n=t.dimSegments.length,r=0;r<n-2;r+=3){var a=t.dimSegments[r],i=t.dimSegments[r+2];i.fake||(e[a.value]=i.value)}t.target.dimensions=e},t.getRegions=function(){return t.datasource.metricFindQuery("regions()").then(function(t){return t.unshift({text:"default"}),t}).then(t.transformToSegments(!0))},t.getNamespaces=function(){return t.datasource.metricFindQuery("namespaces()").then(t.transformToSegments(!0))},t.getMetrics=function(){return t.datasource.metricFindQuery("metrics("+t.target.namespace+","+t.target.region+")").then(t.transformToSegments(!0))},t.regionChanged=function(){t.target.region=t.regionSegment.value,t.onChange()},t.namespaceChanged=function(){t.target.namespace=t.namespaceSegment.value,t.onChange()},t.metricChanged=function(){t.target.metricName=t.metricSegment.value,t.onChange()},t.transformToSegments=function(t){return function(r){var a=o.a.map(r,function(t){return n.newSegment({value:t.text,expandable:t.expandable})});return t&&o.a.each(e.variables,function(t){a.unshift(n.newSegment({type:"template",value:"$"+t.name,expandable:!0}))}),a}},t.init()}return t.$inject=["$scope","templateSrv","uiSegmentSrv","datasourceSrv","$q"],t}();a.a.module("grafana.controllers").directive("cloudwatchQueryParameter",s),a.a.module("grafana.controllers").controller("CloudWatchQueryParameterCtrl",l)},1483:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(1484),o=n(224),s=function(){function t(t,e,n){this.target=t,this.templateSrv=e,this.scopedVars=n,t.policy=t.policy||"default",t.resultFormat=t.resultFormat||"time_series",t.orderByTime=t.orderByTime||"ASC",t.tags=t.tags||[],t.groupBy=t.groupBy||[{type:"time",params:["$__interval"]},{type:"fill",params:["null"]}],t.select=t.select||[[{type:"field",params:["value"]},{type:"mean",params:[]}]],this.updateProjection()}return t.$inject=["target","templateSrv","scopedVars"],t.prototype.updateProjection=function(){this.selectModels=a.a.map(this.target.select,function(t){return a.a.map(t,i.a.create)}),this.groupByParts=a.a.map(this.target.groupBy,i.a.create)},t.prototype.updatePersistedParts=function(){this.target.select=a.a.map(this.selectModels,function(t){return a.a.map(t,function(t){return{type:t.def.type,params:t.params}})})},t.prototype.hasGroupByTime=function(){return a.a.find(this.target.groupBy,function(t){return"time"===t.type})},t.prototype.hasFill=function(){return a.a.find(this.target.groupBy,function(t){return"fill"===t.type})},t.prototype.addGroupBy=function(t){var e=t.match(/^(\w+)\((.*)\)$/),n=e[1],r=e[2],a=i.a.create({type:n,params:[r]}),o=this.target.groupBy.length;0===o?this.target.groupBy.push(a.part):"time"===n?this.target.groupBy.splice(0,0,a.part):"tag"===n&&"fill"===this.target.groupBy[o-1].type?this.target.groupBy.splice(o-1,0,a.part):this.target.groupBy.push(a.part),this.updateProjection()},t.prototype.removeGroupByPart=function(t,e){var n=i.a.getCategories();"time"===t.def.type&&(this.target.groupBy=a.a.filter(this.target.groupBy,function(t){return"fill"!==t.type}),this.target.select=a.a.map(this.target.select,function(t){return a.a.filter(t,function(t){var e=i.a.create(t);return e.def.category!==n.Aggregations&&e.def.category!==n.Selectors})})),this.target.groupBy.splice(e,1),this.updateProjection()},t.prototype.removeSelect=function(t){this.target.select.splice(t,1),this.updateProjection()},t.prototype.removeSelectPart=function(t,e){if("field"===e.def.type){if(this.selectModels.length>1){var n=a.a.indexOf(this.selectModels,t);this.selectModels.splice(n,1)}}else{var r=a.a.indexOf(t,e);t.splice(r,1)}this.updatePersistedParts()},t.prototype.addSelectPart=function(t,e){var n=i.a.create({type:e});n.def.addStrategy(t,n,this),this.updatePersistedParts()},t.prototype.renderTagCondition=function(t,e,n){var r="",a=t.operator,i=t.value;return e>0&&(r=(t.condition||"AND")+" "),a||(a=/^\/.*\/$/.test(i)?"=~":"="),"=~"!==a&&"!~"!==a?(n&&(i=this.templateSrv.replace(i,this.scopedVars)),">"!==a&&"<"!==a&&(i="'"+i.replace(/\\/g,"\\\\")+"'")):n&&(i=this.templateSrv.replace(i,this.scopedVars,"regex")),r+'"'+t.key+'" '+a+" "+i},t.prototype.getMeasurementAndPolicy=function(t){var e=this.target.policy,n=this.target.measurement||"measurement";return n.match("^/.*/$")?t&&(n=this.templateSrv.replace(n,this.scopedVars,"regex")):n='"'+n+'"',(e="default"!==e?'"'+this.target.policy+'".':"")+n},t.prototype.interpolateQueryStr=function(t,e,n){return e.multi||e.includeAll?"string"==typeof t?o.a.regexEscape(t):"("+a.a.map(t,o.a.regexEscape).join("|")+")":t},t.prototype.render=function(t){var e=this,n=this.target;if(n.rawQuery)return t?this.templateSrv.replace(n.query,this.scopedVars,this.interpolateQueryStr):n.query;var r,i,o="SELECT ";for(r=0;r<this.selectModels.length;r++){var s=this.selectModels[r],l="";for(i=0;i<s.length;i++){l=s[i].render(l)}r>0&&(o+=", "),o+=l}o+=" FROM "+this.getMeasurementAndPolicy(t)+" WHERE ";var u=a.a.map(n.tags,function(n,r){return e.renderTagCondition(n,r,t)});u.length>0&&(o+="("+u.join(" ")+") AND "),o+="$timeFilter";var c="";for(r=0;r<this.groupByParts.length;r++){var p=this.groupByParts[r];r>0&&(c+="fill"===p.def.type?" ":", "),c+=p.render("")}return c.length&&(o+=" GROUP BY "+c),n.fill&&(o+=" fill("+n.fill+")"),"DESC"===n.orderByTime&&(o+=" ORDER BY time DESC"),n.limit&&(o+=" LIMIT "+n.limit),n.slimit&&(o+=" SLIMIT "+n.slimit),o},t.prototype.renderAdhocFilters=function(t){var e=this;return a.a.map(t,function(t,n){return e.renderTagCondition(t,n,!1)}).join(" ")},t}();e.a=s},1484:function(t,e,n){"use strict";function r(t){var e=m[t.type];if(!e)throw{message:"Could not find query part "+t.type};return new f.a(t,e)}function a(t){m[t.type]=new f.b(t),t.category.push(m[t.type])}function i(t,e){return e+' AS "'+t.params[0]+'"'}function o(t,e){return"*"===t.params[0]?"*":'"'+t.params[0]+'"'}function s(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.def.category===g.Aggregations)return void(t[n]=e);if(r.def.category===g.Selectors)return void(t[n]=e)}t.splice(1,0,e)}function l(t,e){var n;for(n=0;n<t.length;n++){var r=t[n];if(r.def.category===g.Math||r.def.category===g.Aliasing)break}t.splice(n,0,e)}function u(t,e){var n=t.length;if(n>0){if("math"===t[n-1].def.type)return void(t[n-1]=e);if(n>1&&"math"===t[n-2].def.type)return void(t[n-2]=e);if("alias"===t[n-1].def.type)return void t.splice(n-1,0,e)}t.push(e)}function c(t,e){var n=t.length;if(n>0&&"alias"===t[n-1].def.type)return void(t[n-1]=e);t.push(e)}function p(t,e,n){var a=h.a.map(t,function(t){return r({type:t.def.type,params:h.a.clone(t.params)})});n.selectModels.push(a)}var d=n(4),h=n.n(d),f=n(520),m=[],g={Aggregations:[],Selectors:[],Transformations:[],Predictors:[],Math:[],Aliasing:[],Fields:[]},v=[];a({type:"field",addStrategy:p,category:g.Fields,params:[{type:"field",dynamicLookup:!0}],defaultParams:["value"],renderer:o}),a({type:"count",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"distinct",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"integral",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"mean",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"median",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"mode",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"sum",addStrategy:s,category:g.Aggregations,params:[],defaultParams:[],renderer:f.c}),a({type:"derivative",addStrategy:l,category:g.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:f.c}),a({type:"spread",addStrategy:l,category:g.Transformations,params:[],defaultParams:[],renderer:f.c}),a({type:"non_negative_derivative",addStrategy:l,category:g.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:f.c}),a({type:"difference",addStrategy:l,category:g.Transformations,params:[],defaultParams:[],renderer:f.c}),a({type:"non_negative_difference",addStrategy:l,category:g.Transformations,params:[],defaultParams:[],renderer:f.c}),a({type:"moving_average",addStrategy:l,category:g.Transformations,params:[{name:"window",type:"int",options:[5,10,20,30,40]}],defaultParams:[10],renderer:f.c}),a({type:"cumulative_sum",addStrategy:l,category:g.Transformations,params:[],defaultParams:[],renderer:f.c}),a({type:"stddev",addStrategy:l,category:g.Transformations,params:[],defaultParams:[],renderer:f.c}),a({type:"time",category:v,params:[{name:"interval",type:"time",options:["$__interval","1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["$__interval"],renderer:f.c}),a({type:"fill",category:v,params:[{name:"fill",type:"string",options:["none","null","0","previous","linear"]}],defaultParams:["null"],renderer:f.c}),a({type:"elapsed",addStrategy:l,category:g.Transformations,params:[{name:"duration",type:"interval",options:["1s","10s","1m","5m","10m","15m","1h"]}],defaultParams:["10s"],renderer:f.c}),a({type:"holt_winters",addStrategy:l,category:g.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:f.c}),a({type:"holt_winters_with_fit",addStrategy:l,category:g.Predictors,params:[{name:"number",type:"int",options:[5,10,20,30,40]},{name:"season",type:"int",options:[0,1,2,5,10]}],defaultParams:[10,2],renderer:f.c}),a({type:"bottom",addStrategy:s,category:g.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:f.c}),a({type:"first",addStrategy:s,category:g.Selectors,params:[],defaultParams:[],renderer:f.c}),a({type:"last",addStrategy:s,category:g.Selectors,params:[],defaultParams:[],renderer:f.c}),a({type:"max",addStrategy:s,category:g.Selectors,params:[],defaultParams:[],renderer:f.c}),a({type:"min",addStrategy:s,category:g.Selectors,params:[],defaultParams:[],renderer:f.c}),a({type:"percentile",addStrategy:s,category:g.Selectors,params:[{name:"nth",type:"int"}],defaultParams:[95],renderer:f.c}),a({type:"top",addStrategy:s,category:g.Selectors,params:[{name:"count",type:"int"}],defaultParams:[3],renderer:f.c}),a({type:"tag",category:v,params:[{name:"tag",type:"string",dynamicLookup:!0}],defaultParams:["tag"],renderer:o}),a({type:"math",addStrategy:u,category:g.Math,params:[{name:"expr",type:"string"}],defaultParams:[" / 100"],renderer:f.d}),a({type:"alias",addStrategy:c,category:g.Aliasing,params:[{name:"name",type:"string",quote:"double"}],defaultParams:["alias"],renderMode:"suffix",renderer:i}),e.a={create:r,getCategories:function(){return g}}},1485:function(t,e,n){"use strict";function r(t,e){var n="",r=t.operator,a=t.value;return e>0&&(n=(t.condition||"AND")+" "),r||(r=/^\/.*\/$/.test(t.value)?"=~":"="),"=~"!==r&&"!~"!==r&&isNaN(+a)&&(a="'"+a+"'"),n+'"'+t.key+'" '+r+" "+a}n.d(e,"a",function(){return o});var a=n(4),i=n.n(a),o=function(){function t(t,e){this.target=t,this.database=e}return t.prototype.buildExploreQuery=function(t,e,n){var a,o,s;if("TAG_KEYS"===t)a="SHOW TAG KEYS",o=this.target.measurement,s=this.target.policy;else if("TAG_VALUES"===t)a="SHOW TAG VALUES",o=this.target.measurement,s=this.target.policy;else if("MEASUREMENTS"===t)a="SHOW MEASUREMENTS",n&&(a+=" WITH MEASUREMENT =~ /"+n+"/");else{if("FIELDS"===t)return o=this.target.measurement,s=this.target.policy,o.match("^/.*/")||(o='"'+o+'"',s&&"default"!==s&&(s='"'+s+'"',o=s+"."+o)),"SHOW FIELD KEYS FROM "+o;if("RETENTION POLICIES"===t)return a='SHOW RETENTION POLICIES on "'+this.database+'"'}if(o&&(o.match("^/.*/")||o.match(/^merge\(.*\)/)||(o='"'+o+'"'),s&&"default"!==s&&(s='"'+s+'"',o=s+"."+o),a+=" FROM "+o),e&&(a+=' WITH KEY = "'+e+'"'),this.target.tags&&this.target.tags.length>0){var l=i.a.reduce(this.target.tags,function(t,n){return n.key===e?t:(t.push(r(n,t.length)),t)},[]);l.length>0&&(a+=" WHERE "+l.join(" "))}return"MEASUREMENTS"===t&&(a+=" LIMIT 100"),a},t}()},1486:function(t,e){!function(t){function e(e){function n(t){f.active&&(u(t),e.getPlaceholder().trigger("plotselecting",[i()]))}function r(e){1==e.which&&(document.body.focus(),void 0!==document.onselectstart&&null==m.onselectstart&&(m.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==m.ondrag&&(m.ondrag=document.ondrag,document.ondrag=function(){return!1}),l(f.first,e),f.active=!0,g=function(t){a(t)},t(document).one("mouseup",g))}function a(t){return g=null,void 0!==document.onselectstart&&(document.onselectstart=m.onselectstart),void 0!==document.ondrag&&(document.ondrag=m.ondrag),f.active=!1,u(t),h()?o(t):(e.getPlaceholder().trigger("plotunselected",[]),e.getPlaceholder().trigger("plotselecting",[null])),setTimeout(function(){e.isSelecting=!1},10),!1}function i(){if(!h())return null;if(!f.show)return null;var n={},r=f.first,a=f.second,i=e.getAxes();return t.each(i,function(t,e){e.used&&(anyUsed=!1)}),t.each(i,function(t,e){if(e.used,!0){var i=e.c2p(r[e.direction]),o=e.c2p(a[e.direction]);n[t]={from:Math.min(i,o),to:Math.max(i,o)}}}),n}function o(t){var n=i();n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,e.getPlaceholder().trigger("plotselected",[n]),n.xaxis&&n.yaxis&&e.getPlaceholder().trigger("selected",[{x1:n.xaxis.from,y1:n.yaxis.from,x2:n.xaxis.to,y2:n.yaxis.to}])}function s(t,e,n){return e<t?t:e>n?n:e}function l(t,n){var r=e.getOptions(),a=e.getPlaceholder().offset(),i=e.getPlotOffset();t.x=s(0,n.pageX-a.left-i.left,e.width()),t.y=s(0,n.pageY-a.top-i.top,e.height()),"y"==r.selection.mode&&(t.x=t==f.first?0:e.width()),"x"==r.selection.mode&&(t.y=t==f.first?0:e.height())}function u(t){null!=t.pageX&&(l(f.second,t),h()?(e.isSelecting=!0,f.show=!0,e.triggerRedrawOverlay()):c(!0))}function c(t){f.show&&(f.show=!1,e.triggerRedrawOverlay(),t||e.getPlaceholder().trigger("plotunselected",[]))}function p(t,n){var r,a,i,o,s=e.getAxes();for(var l in s)if(r=s[l],r.direction==n&&(o=n+r.n+"axis",t[o]||1!=r.n||(o=n+"axis"),t[o])){a=t[o].from,i=t[o].to;break}if(t[o]||(r="x"==n?e.getXAxes()[0]:e.getYAxes()[0],a=t[n+"1"],i=t[n+"2"]),null!=a&&null!=i&&a>i){var u=a;a=i,i=u}return{from:a,to:i,axis:r}}function d(t,n){var r,a=e.getOptions();"y"==a.selection.mode?(f.first.x=0,f.second.x=e.width()):(r=p(t,"x"),f.first.x=r.axis.p2c(r.from),f.second.x=r.axis.p2c(r.to)),"x"==a.selection.mode?(f.first.y=0,f.second.y=e.height()):(r=p(t,"y"),f.first.y=r.axis.p2c(r.from),f.second.y=r.axis.p2c(r.to)),f.show=!0,e.triggerRedrawOverlay(),!n&&h()&&o()}function h(){var t=e.getOptions().selection.minSize;return Math.abs(f.second.x-f.first.x)>=t&&Math.abs(f.second.y-f.first.y)>=t}var f={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},m={},g=null;e.clearSelection=c,e.setSelection=d,e.getSelection=i,e.hooks.bindEvents.push(function(t,e){null!=t.getOptions().selection.mode&&(e.mousemove(n),e.mousedown(r))}),e.hooks.drawOverlay.push(function(e,n){if(f.show&&h()){var r=e.getPlotOffset(),a=e.getOptions();n.save(),n.translate(r.left,r.top);var i=t.color.parse(a.selection.color);n.strokeStyle=i.scale("a",.8).toString(),n.lineWidth=1,n.lineJoin=a.selection.shape,n.fillStyle=i.scale("a",.4).toString();var o=Math.min(f.first.x,f.second.x)+.5,s=Math.min(f.first.y,f.second.y)+.5,l=Math.abs(f.second.x-f.first.x)-1,u=Math.abs(f.second.y-f.first.y)-1;n.fillRect(o,s,l,u),n.strokeRect(o,s,l,u),n.restore()}}),e.hooks.shutdown.push(function(e,a){a.unbind("mousemove",n),a.unbind("mousedown",r),g&&t(document).unbind("mouseup",g)})}t.plot.plugins.push({init:e,options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery)},1487:function(t,e){!function(t){function e(t,e){return e*Math.floor(t/e)}function n(t,e,n,r){if("function"==typeof t.strftime)return t.strftime(e);var a=function(t,e){return t=""+t,e=""+(null==e?"0":e),1==t.length?e+t:t},i=[],o=!1,s=t.getHours(),l=s<12;null==n&&(n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),null==r&&(r=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var u;u=s>12?s-12:0==s?12:s;for(var c=0;c<e.length;++c){var p=e.charAt(c);if(o){switch(p){case"a":p=""+r[t.getDay()];break;case"b":p=""+n[t.getMonth()];break;case"d":p=a(t.getDate(),"");break;case"e":p=a(t.getDate()," ");break;case"h":case"H":p=a(s);break;case"I":p=a(u);break;case"l":p=a(u," ");break;case"m":p=a(t.getMonth()+1,"");break;case"M":p=a(t.getMinutes());break;case"q":p=""+(Math.floor(t.getMonth()/3)+1);break;case"S":p=a(t.getSeconds());break;case"y":p=a(t.getFullYear()%100);break;case"Y":p=""+t.getFullYear();break;case"p":p=l?"am":"pm";break;case"P":p=l?"AM":"PM";break;case"w":p=""+t.getDay()}i.push(p),o=!1}else"%"==p?o=!0:i.push(p)}return i.join("")}function r(t){function e(t,e,n,r){t[e]=function(){return n[r].apply(n,arguments)}}var n={date:t};void 0!=t.strftime&&e(n,"strftime",t,"strftime"),e(n,"getTime",t,"getTime"),e(n,"setTime",t,"setTime");for(var r=["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds"],a=0;a<r.length;a++)e(n,"get"+r[a],t,"getUTC"+r[a]),e(n,"set"+r[a],t,"setUTC"+r[a]);return n}function a(t,e){if("browser"==e.timezone)return new Date(t);if(e.timezone&&"utc"!=e.timezone){if("undefined"!=typeof timezoneJS&&void 0!==timezoneJS.Date){var n=new timezoneJS.Date;return n.setTimezone(e.timezone),n.setTime(t),n}return r(new Date(t))}return r(new Date(t))}function i(r){r.hooks.processOptions.push(function(r,i){t.each(r.getAxes(),function(t,r){var i=r.options;"time"==i.mode&&(r.tickGenerator=function(t){var n=[],r=a(t.min,i),o=0,l=i.tickSize&&"quarter"===i.tickSize[1]||i.minTickSize&&"quarter"===i.minTickSize[1]?c:u;null!=i.minTickSize&&(o="number"==typeof i.tickSize?i.tickSize:i.minTickSize[0]*s[i.minTickSize[1]]);for(var p=0;p<l.length-1&&!(t.delta<(l[p][0]*s[l[p][1]]+l[p+1][0]*s[l[p+1][1]])/2&&l[p][0]*s[l[p][1]]>=o);++p);var d=l[p][0],h=l[p][1];if("year"==h){if(null!=i.minTickSize&&"year"==i.minTickSize[1])d=Math.floor(i.minTickSize[0]);else{var f=Math.pow(10,Math.floor(Math.log(t.delta/s.year)/Math.LN10)),m=t.delta/s.year/f;d=m<1.5?1:m<3?2:m<7.5?5:10,d*=f}d<1&&(d=1)}t.tickSize=i.tickSize||[d,h];var g=t.tickSize[0];h=t.tickSize[1];var v=g*s[h];"second"==h?r.setSeconds(e(r.getSeconds(),g)):"minute"==h?r.setMinutes(e(r.getMinutes(),g)):"hour"==h?r.setHours(e(r.getHours(),g)):"month"==h?r.setMonth(e(r.getMonth(),g)):"quarter"==h?r.setMonth(3*e(r.getMonth()/3,g)):"year"==h&&r.setFullYear(e(r.getFullYear(),g)),r.setMilliseconds(0),v>=s.minute&&r.setSeconds(0),v>=s.hour&&r.setMinutes(0),v>=s.day&&r.setHours(0),v>=4*s.day&&r.setDate(1),v>=2*s.month&&r.setMonth(e(r.getMonth(),3)),v>=2*s.quarter&&r.setMonth(e(r.getMonth(),6)),v>=s.year&&r.setMonth(0);var y,b=0,x=Number.NaN;do{if(y=x,x=r.getTime(),n.push(x),"month"==h||"quarter"==h)if(g<1){r.setDate(1);var S=r.getTime();r.setMonth(r.getMonth()+("quarter"==h?3:1));var w=r.getTime();r.setTime(x+b*s.hour+(w-S)*g),b=r.getHours(),r.setHours(0)}else r.setMonth(r.getMonth()+g*("quarter"==h?3:1));else"year"==h?r.setFullYear(r.getFullYear()+g):r.setTime(x+v)}while(x<t.max&&x!=y);return n},r.tickFormatter=function(t,e){var r=a(t,e.options);if(null!=i.timeformat)return n(r,i.timeformat,i.monthNames,i.dayNames);var o,l=e.options.tickSize&&"quarter"==e.options.tickSize[1]||e.options.minTickSize&&"quarter"==e.options.minTickSize[1],u=e.tickSize[0]*s[e.tickSize[1]],c=e.max-e.min,p=i.twelveHourClock?" %p":"",d=i.twelveHourClock?"%I":"%H";return o=u<s.minute?d+":%M:%S"+p:u<s.day?c<2*s.day?d+":%M"+p:"%b %d "+d+":%M"+p:u<s.month?"%b %d":l&&u<s.quarter||!l&&u<s.year?c<s.year?"%b":"%b %Y":l&&u<s.year?c<s.year?"Q%q":"Q%q %Y":"%Y",n(r,o,i.monthNames,i.dayNames)})})})}var o={xaxis:{timezone:null,timeformat:null,twelveHourClock:!1,monthNames:null}},s={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,quarter:7776e6,year:525949.2*60*1e3},l=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"]],u=l.concat([[3,"month"],[6,"month"],[1,"year"]]),c=l.concat([[1,"quarter"],[2,"quarter"],[1,"year"]]);t.plot.plugins.push({init:i,options:o,name:"time",version:"1.0"}),t.plot.formatDate=n}(jQuery)},1488:function(t,e){!function(t){function e(t){function e(t,e){for(var n=null,r=0;r<e.length&&t!=e[r];++r)e[r].stack==t.stack&&(n=e[r]);return n}function n(t,n,r){if(null!=n.stack&&!1!==n.stack){var a=e(n,t.getData());if(a){for(var i,o,s,l,u,c,p,d,h=r.pointsize,f=r.points,m=a.datapoints.pointsize,g=a.datapoints.points,v=[],y=n.lines.show,b=n.bars.horizontal,x=h>2&&(b?r.format[2].x:r.format[2].y),S=y&&n.lines.steps,w=b?1:0,k=b?0:1,_=0,C=0;;){if(_>=f.length&&C>=g.length)break;if(p=v.length,_<f.length&&null==f[_]){for(d=0;d<h;++d)v.push(f[_+d]);_+=h}else if(_>=f.length){for(d=0;d<h;++d)v.push(g[C+d]);x&&(v[p+2]=g[C+k]),C+=m}else if(C>=g.length){for(d=0;d<h;++d)v.push(f[_+d]);_+=h}else if(C<g.length&&null==g[C])C+=m;else{if(i=f[_+w],o=f[_+k],l=g[C+w],u=g[C+k],c=0,i==l){for(d=0;d<h;++d)v.push(f[_+d]);v[p+k]+=u,c=u,_+=h,C+=m}else if(i>l){if(0==_){for(d=0;d<h;++d)v.push(g[C+d]);c=u}if(_>0&&null!=f[_-h]){for(s=o+(f[_-h+k]-o)*(l-i)/(f[_-h+w]-i),v.push(l),v.push(s+u),d=2;d<h;++d)v.push(f[_+d]);c=u}C+=m}else{for(d=0;d<h;++d)v.push(f[_+d]);C>0&&null!=g[C-m]&&(c=u+(g[C-m+k]-u)*(i-l)/(g[C-m+w]-l)),v[p+k]+=c,_+=h}fromgap=!1,p!=v.length&&x&&(v[p+2]=c)}if(S&&p!=v.length&&p>0&&null!=v[p]&&v[p]!=v[p-h]&&v[p+1]!=v[p-h+1]){for(d=0;d<h;++d)v[p+h+d]=v[p+d];v[p+1]=v[p-h+1]}}r.points=v}}}t.hooks.processDatapoints.push(n)}var n={series:{stack:null}};t.plot.plugins.push({init:e,options:n,name:"stack",version:"1.2"})}(jQuery)},1489:function(t,e){!function(t){function e(t){function e(t,e,r,a){if(i||(i=!0,o=n(t.getData())),1==e.stackpercent){var s=r.length;e.percents=[];var l=0,u=1;e.bars&&e.bars.horizontal&&!0===e.bars.horizontal&&(l=1,u=0);for(var c=0;c<s;c++){var p=o[r[c][l]+""];p>0?e.percents.push(100*r[c][u]/p):e.percents.push(0)}}}function n(t){var e=t.length,n={};if(e>0)for(var r=0;r<e;r++)if(t[r].stackpercent){var a=0,i=1;t[r].bars&&t[r].bars.horizontal&&!0===t[r].bars.horizontal&&(a=1,i=0);for(var o=t[r].data.length,s=0;s<o;s++){var l=0;null!=t[r].data[s][1]&&(l=t[r].data[s][i]),n[t[r].data[s][a]+""]?n[t[r].data[s][a]+""]+=l:n[t[r].data[s][a]+""]=l}}return n}function r(t,e,r){if(e.stackpercent){i||(o=n(t.getData()));var s=[],l=0,u=1;e.bars&&e.bars.horizontal&&!0===e.bars.horizontal&&(l=1,u=0);for(var c=0;c<r.points.length;c+=3)a[r.points[c+l]]||(a[r.points[c+l]]=0),s[c+l]=r.points[c+l],s[c+u]=r.points[c+u]+a[r.points[c+l]],s[c+2]=a[r.points[c+l]],a[r.points[c+l]]+=r.points[c+u],o[s[c+l]+""]>0?(s[c+u]=100*s[c+u]/o[s[c+l]+""],s[c+2]=100*s[c+2]/o[s[c+l]+""]):(s[c+u]=0,s[c+2]=0);r.points=s}}var a={},i=!1,o={};t.hooks.processRawData.push(e),t.hooks.processDatapoints.push(r)}var n={series:{stackpercent:null}};t.plot.plugins.push({init:e,options:n,name:"stackpercent",version:"0.1"})}(jQuery)},1490:function(t,e){!function(t){"use strict";function e(e){function n(t,e){var n;for(n=0;n<e.length;++n)if(e[n].id===t.fillBelowTo)return e[n];return null}function r(t,e,n,r,a,i,o,s){var l,u,c,p,d,h;return l=n-t,u=r-e,c=o-a,p=s-i,d=(-u*(t-a)+l*(e-i))/(-c*u+l*p),h=(c*(e-i)-p*(t-a))/(-c*u+l*p),d>=0&&d<=1&&h>=0&&h<=1?[t+h*l,e+h*u]:null}function a(e,a,i){function o(t,e){a.beginPath(),a.moveTo(i.xaxis.p2c(t)+v.left,i.yaxis.p2c(e)+v.top)}function s(){a.closePath(),a.fill()}function l(t,e){console.assert(e>t,"expects the end index to be greater than the start index");var n,r,a=0===t||null===f[t-1]||null===g[t-1],i=!1;for(n=t;n<e;n++)if(null===f[n*h+1]||null===g[n*h+1])i=!1,a=!0;else if(f[n*h+1]===g[n*m+1])i=!0,a=!1;else{if(f[n*h+1]>g[n*m+1])return a?o(f[n*h],f[n*h+1]):i?o(f[(n-1)*h],f[(n-1)*h+1]):(r=u(n),o(r[0],r[1])),void p(n,e);a=!1,i=!1}}function u(t){console.assert(t>0,"expects the second point in the series line segment");var e,n;for(e=1;e<g.length/m;e++)if(null!==(n=r(f[(t-1)*h],f[(t-1)*h+1],f[t*h],f[t*h+1],g[(e-1)*m],g[(e-1)*m+1],g[e*m],g[e*m+1])))return n;console.error("intersectionPoint() should only be called when an intersection happens")}function c(t,e){console.assert(t>=e,"the start should be the rightmost point, and the end should be the leftmost (excluding the equal or intersecting point)");var n;for(n=t;n>=e;n--)a.lineTo(d.xaxis.p2c(g[n*m])+v.left,d.yaxis.p2c(g[n*m+1])+v.top);s()}function p(t,e){console.assert(t<=e,"the start should be the rightmost point, and the end should be the leftmost (excluding the equal or intersecting point)");var n,r;for(n=t;n<e;n++){if(null===f[n*h+1]&&n>t)return c(n-1,t),void l(n,e);if(f[n*h+1]===g[n*m+1])return c(n,t),void l(n,e);if(f[n*h+1]<g[n*m+1])return r=u(n),a.lineTo(i.xaxis.p2c(r[0])+v.left,i.yaxis.p2c(r[1])+v.top),c(n,t),void l(n,e);a.lineTo(i.xaxis.p2c(f[n*h])+v.left,i.yaxis.p2c(f[n*h+1])+v.top)}c(e,t)}if(null!==i.fillBelowTo){var d,h,f,m,g,v,y;d=n(i,e.getData()),d&&(h=i.datapoints.pointsize,f=i.datapoints.points,m=d.datapoints.pointsize,g=d.datapoints.points,v=e.getPlotOffset(),function(){if(f.length/h!=g.length/m)return console.error("Refusing to graph inconsistent number of points"),!1;var t;for(t=0;t<f.length/h;t++)if(null!==f[t*h]&&null!==g[t*m]&&f[t*h]!==g[t*m])return console.error("Refusing to graph points without matching value"),!1;return!0}()&&(y=t.color.parse(i.color),y.a=.4,y.normalize(),a.fillStyle=y.toString(),l(0,f.length/h)))}}e.hooks.drawSeries.push(a)}var n={series:{fillBelowTo:null}};t.plot.plugins.push({init:e,options:n,name:"fillbelow",version:"0.1.0"})}(jQuery)},1491:function(t,e){!function(t){function e(t){function e(e){r.locked||-1!=r.x&&(r.x=-1,t.triggerRedrawOverlay())}function n(e){if(!r.locked){if(t.getSelection&&t.getSelection())return void(r.x=-1);var n=t.offset();r.x=Math.max(0,Math.min(e.pageX-n.left,t.width())),r.y=Math.max(0,Math.min(e.pageY-n.top,t.height())),t.triggerRedrawOverlay()}}var r={x:-1,y:-1,locked:!1};t.setCrosshair=function(e){if(e){var n=t.p2c(e);r.x=Math.max(0,Math.min(n.left,t.width())),r.y=Math.max(0,Math.min(n.top,t.height()))}else r.x=-1;t.triggerRedrawOverlay()},t.clearCrosshair=t.setCrosshair,t.lockCrosshair=function(e){e&&t.setCrosshair(e),r.locked=!0},t.unlockCrosshair=function(){r.locked=!1},t.hooks.bindEvents.push(function(t,r){t.getOptions().crosshair.mode&&(r.mouseout(e),r.mousemove(n))}),t.hooks.drawOverlay.push(function(t,e){var n=t.getOptions().crosshair;if(n.mode){var a=t.getPlotOffset();if(e.save(),e.translate(a.left,a.top),-1!=r.x){var i=t.getOptions().crosshair.lineWidth%2?.5:0;if(e.strokeStyle=n.color,e.lineWidth=n.lineWidth,e.lineJoin="round",e.beginPath(),-1!=n.mode.indexOf("x")){var o=Math.floor(r.x)+i;e.moveTo(o,0),e.lineTo(o,t.height())}if(-1!=n.mode.indexOf("y")){var s=Math.floor(r.y)+i;e.moveTo(0,s),e.lineTo(t.width(),s)}e.stroke()}e.restore()}}),t.hooks.shutdown.push(function(t,r){r.unbind("mouseout",e),r.unbind("mousemove",n)})}var n={crosshair:{mode:null,color:"rgba(170, 0, 0, 0.80)",lineWidth:1}};t.plot.plugins.push({init:e,options:n,name:"crosshair",version:"1.0"})}(jQuery)},1492:function(t,e){!function(t){function e(t){t.hooks.processDatapoints.push(function(t,e,n){e.dashes.show&&t.hooks.draw.push(function(t,r){function a(t,a){var i,l,u=n.points,c=n.pointsize,p=null,d=null,h=0,f=!0;e.dashes.dashLength[0]?(i=e.dashes.dashLength[0],l=e.dashes.dashLength[1]?e.dashes.dashLength[1]:i):l=i=e.dashes.dashLength,r.beginPath();for(var m=c;m<u.length;m+=c){var g=u[m-c],v=u[m-c+1],y=u[m],b=u[m+1];if(null!=g&&null!=y){if(v<=b&&v<s.min){if(b<s.min)continue;g=(s.min-v)/(b-v)*(y-g)+g,v=s.min}else if(b<=v&&b<s.min){if(v<s.min)continue;y=(s.min-v)/(b-v)*(y-g)+g,b=s.min}if(v>=b&&v>s.max){if(b>s.max)continue;g=(s.max-v)/(b-v)*(y-g)+g,v=s.max}else if(b>=v&&b>s.max){if(v>s.max)continue;y=(s.max-v)/(b-v)*(y-g)+g,b=s.max}if(g<=y&&g<o.min){if(y<o.min)continue;v=(o.min-g)/(y-g)*(b-v)+v,g=o.min}else if(y<=g&&y<o.min){if(g<o.min)continue;b=(o.min-g)/(y-g)*(b-v)+v,y=o.min}if(g>=y&&g>o.max){if(y>o.max)continue;v=(o.max-g)/(y-g)*(b-v)+v,g=o.max}else if(y>=g&&y>o.max){if(g>o.max)continue;b=(o.max-g)/(y-g)*(b-v)+v,y=o.max}g==p&&v==d||r.moveTo(o.p2c(g)+t,s.p2c(v)+a);var x,S=o.p2c(g)+t,w=s.p2c(v)+a,k=o.p2c(y)+t,_=s.p2c(b)+a;do{x=function(t){var e=Math.sqrt(Math.pow(k-S,2)+Math.pow(_-w,2));if(e<=t)return{deltaX:k-S,deltaY:_-w,distance:e,remainder:t-e};var n=k>S?1:-1,r=_>w?1:-1;return{deltaX:n*Math.sqrt(Math.pow(t,2)/(1+Math.pow((_-w)/(k-S),2))),deltaY:r*Math.sqrt(Math.pow(t,2)-Math.pow(t,2)/(1+Math.pow((_-w)/(k-S),2))),distance:t,remainder:0}}(h>0?h:f?i:l),0==x.deltaX&&0==x.deltaY||(f?r.lineTo(S+x.deltaX,w+x.deltaY):r.moveTo(S+x.deltaX,w+x.deltaY)),f=!f,h=x.remainder,S+=x.deltaX,w+=x.deltaY}while(x.distance>0);p=y,d=b}}r.stroke()}var i=t.getPlotOffset(),o=e.xaxis,s=e.yaxis;r.save(),r.translate(i.left,i.top),r.lineJoin="round";var l=e.dashes.lineWidth,u=e.shadowSize;if(l>0&&u>0){r.lineWidth=u,r.strokeStyle="rgba(0,0,0,0.1)";var c=Math.PI/18;a(Math.sin(c)*(l/2+u/2),Math.cos(c)*(l/2+u/2)),r.lineWidth=u/2,a(Math.sin(c)*(l/2+u/4),Math.cos(c)*(l/2+u/4))}r.lineWidth=l,r.strokeStyle=e.color,l>0&&a(0,0),r.restore()})})}t.plot.plugins.push({init:e,options:{series:{dashes:{show:!1,lineWidth:2,dashLength:10}}},name:"dashes",version:"0.1"})}(jQuery)},1493:function(t,e,n){"use strict";function r(t,e,n,r){void 0===r&&(r=0);var a=o[t.value],s="always"===t.invert||"dark"===t.invert&&!e,l=s?n:r,u=s?r:n;return i.scaleSequential(a).domain([l,u])}function a(t,e,n){void 0===n&&(n=0);var r;return"linear"===t.colorScale?r=i.scaleLinear().domain([n,e]).range([0,1]):"sqrt"===t.colorScale&&(r=i.scalePow().exponent(t.exponent).domain([n,e]).range([0,1])),r}e.a=r,e.b=a;var i=n(515),o=n(529)},1494:function(t,e,n){"use strict";function r(t,e){var n=new l.a;if(!t||0===t.length)return n;var r=u[e.transform];if(!r)throw{message:"Transformer "+e.transform+" not found"};return r.transform(t,e,n),n}n.d(e,"b",function(){return u}),n.d(e,"a",function(){return r});var a=n(4),i=n.n(a),o=n(1480),s=n(144),l=n(1466),u={};u.timeseries_to_rows={description:"Time series to rows",getColumns:function(){return[]},transform:function(t,e,n){n.columns=[{text:"Time",type:"date"},{text:"Metric"},{text:"Value"}];for(var r=0;r<t.length;r++)for(var a=t[r],i=0;i<a.datapoints.length;i++){var o=a.datapoints[i];n.rows.push([o[1],a.target,o[0]])}}},u.timeseries_to_columns={description:"Time series to columns",getColumns:function(){return[]},transform:function(t,e,n){n.columns.push({text:"Time",type:"date"});for(var r={},a=0;a<t.length;a++){var i=t[a];n.columns.push({text:i.target});for(var o=0;o<i.datapoints.length;o++){var s=i.datapoints[o],l=s[1].toString();r[l]?r[l][a]=s[0]:(r[l]={time:s[1]},r[l][a]=s[0])}}for(var u in r){for(var c=r[u],p=[c.time],a=0;a<t.length;a++){var d=c[a];p.push(d)}n.rows.push(p)}}},u.timeseries_aggregations={description:"Time series aggregations",getColumns:function(){return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Current",value:"current"},{text:"Count",value:"count"}]},transform:function(t,e,n){var r,a;for(n.columns.push({text:"Metric"}),r=0;r<e.columns.length;r++)n.columns.push({text:e.columns[r].text});for(r=0;r<t.length;r++){var i=new s.a({datapoints:t[r].datapoints,alias:t[r].target});i.getFlotPairs("connected");var o=[i.alias];for(a=0;a<e.columns.length;a++)o.push(i.stats[e.columns[a].value]);n.rows.push(o)}}},u.annotations={description:"Annotations",getColumns:function(){return[]},transform:function(t,e,n){if(n.columns.push({text:"Time",type:"date"}),n.columns.push({text:"Title"}),n.columns.push({text:"Text"}),n.columns.push({text:"Tags"}),t&&t.annotations&&0!==t.annotations.length)for(var r=0;r<t.annotations.length;r++){var a=t.annotations[r];n.rows.push([a.time,a.title,a.text,a.tags])}}},u.table={description:"Table",getColumns:function(t){if(!t||0===t.length)return[];if(1===t.length)return t[0].columns.slice();var e={};return t.reduce(function(t,n){return n.columns.forEach(function(n){var r=n.text;void 0===e[r]&&(e[r]=t.length,t.push(n))}),t},[])},transform:function(t,e,n){function r(t,e,n){for(var r=!1,a=0;a<t.length;a++)if(void 0!==e[a]&&void 0!==n[a]){if(e[a]!==n[a])return!1}else void 0!==e[a]&&void 0!==n[a]||(r=!0);return r}if(t&&0!==t.length){var a=i.a.findIndex(t,function(t){return"table"!==t.type});if(a>-1)throw{message:"Result of query #"+String.fromCharCode(65+a)+" is not in table format, try using another transform."};if(1===t.length)return n.columns=t[0].columns.slice(),void(n.rows=t[0].rows.slice());var o={},s=t.reduce(function(t,e){return e.columns.forEach(function(e){var n=e.text;void 0===o[n]&&(o[n]=t.length,t.push(e))}),t},[]),l=t.map(function(t){return t.columns.map(function(t){return o[t.text]})}),u=t.reduce(function(t,e,n){var r=l[n];return e.rows.forEach(function(e){var n=[];r.forEach(function(t,r){n[t]=e[r]}),t.push(n)}),t},[]),c={},p=u.reduce(function(t,e,n){if(!c[n]){for(var a=n+1;a<u.length;){var o=i.a.findIndex(u,function(t){return r(s,e,t)},a);if(!(o>-1))break;for(var l=u[o],p=0;p<s.length;p++)void 0===e[p]&&void 0!==l[p]&&(e[p]=l[p]);c[o]=l,a=o+1}t.push(e)}return t},[]);n.columns=s,n.rows=p}}},u.json={description:"JSON Data",getColumns:function(t){if(!t||0===t.length)return[];for(var e={},n=0;n<t.length;n++){var r=t[n];if("docs"===r.type)for(var a=Math.min(r.datapoints.length,100),s=0;s<a;s++){var l=r.datapoints[s],u=Object(o.default)(l,null);for(var c in u)e[c]=!0}}return i.a.map(e,function(t,e){return{text:e,value:e}})},transform:function(t,e,n){for(var r,a,s,l=0,u=e.columns;l<u.length;l++){var c=u[l],p={text:c.text};t.length>0&&t[0].filterable&&(p.filterable=!0),n.columns.push(p)}for(0===n.columns.length&&n.columns.push({text:"JSON"}),r=0;r<t.length;r++){var d=t[r];for(a=0;a<d.datapoints.length;a++){var h=d.datapoints[a],f=[];if(i.a.isObject(h)&&e.columns.length>0){var m=Object(o.default)(h,null);for(s=0;s<e.columns.length;s++)f.push(m[e.columns[s].value])}else f.push(JSON.stringify(h));n.rows.push(f)}}}}},1495:function(t,e,n){"use strict";e.isArrayLike=function(t){return t&&"number"==typeof t.length}},1496:function(t,e,n){"use strict";function r(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}e.isPromise=r},1497:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(511),i=n(1498),o=n(1472),s=n(1641),l=function(t){function e(e,n){t.call(this),this.array=e,this.scheduler=n,n||1!==e.length||(this._isScalar=!0,this.value=e[0])}return r(e,t),e.create=function(t,n){return new e(t,n)},e.of=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];var r=t[t.length-1];s.isScheduler(r)?t.pop():r=null;var a=t.length;return a>1?new e(t,r):1===a?new i.ScalarObservable(t[0],r):new o.EmptyObservable(r)},e.dispatch=function(t){var e=t.array,n=t.index,r=t.count,a=t.subscriber;if(n>=r)return void a.complete();a.next(e[n]),a.closed||(t.index=n+1,this.schedule(t))},e.prototype._subscribe=function(t){var n=this.array,r=n.length,a=this.scheduler;if(a)return a.schedule(e.dispatch,0,{array:n,index:0,count:r,subscriber:t});for(var i=0;i<r&&!t.closed;i++)t.next(n[i]);t.complete()},e}(a.Observable);e.ArrayObservable=l},1498:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(511),i=function(t){function e(e,n){t.call(this),this.value=e,this.scheduler=n,this._isScalar=!0,n&&(this._isScalar=!1)}return r(e,t),e.create=function(t,n){return new e(t,n)},e.dispatch=function(t){var e=t.done,n=t.value,r=t.subscriber;if(e)return void r.complete();r.next(n),r.closed||(t.done=!0,this.schedule(t))},e.prototype._subscribe=function(t){var n=this.value,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{done:!1,value:n,subscriber:t});t.next(n),t.closed||t.complete()},e}(a.Observable);e.ScalarObservable=i},1499:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(t){this.backendSrv=t}return t.prototype.load=function(t,e,n){return t.navModel={main:{icon:"fa fa-folder-open",id:"manage-folder",subTitle:"Manage folder dashboards & permissions",url:"",text:"",breadcrumbs:[{title:"Dashboards",url:"dashboards"}],children:[{active:"manage-folder-dashboards"===n,icon:"fa fa-fw fa-th-large",id:"manage-folder-dashboards",text:"Dashboards",url:"dashboards"},{active:"manage-folder-permissions"===n,icon:"fa fa-fw fa-lock",id:"manage-folder-permissions",text:"Permissions",url:"dashboards/permissions"},{active:"manage-folder-settings"===n,icon:"fa fa-fw fa-cog",id:"manage-folder-settings",text:"Settings",url:"dashboards/settings"}]}},this.backendSrv.getFolderByUid(e).then(function(e){t.folderId=e.id;var n=e.title,r=e.url;t.navModel.main.text=n;var a=t.navModel.main.children.find(function(t){return"manage-folder-dashboards"===t.id});if(a.url=r,e.canAdmin){t.navModel.main.children.find(function(t){return"manage-folder-permissions"===t.id}).url=r+"/permissions";t.navModel.main.children.find(function(t){return"manage-folder-settings"===t.id}).url=r+"/settings"}else t.navModel.main.children=[a];return e})},t}()},1500:function(t,e,n){"use strict";var r=n(22),a=n(3),i=n(514),o=n.n(i),s=n(4),l=n.n(s),u=function(){function t(t,e,n,a){this.$scope=t,this.backendSrv=e,this.navModel=n.getNav("cfg","users",0),this.get(),this.externalUserMngLinkUrl=r.a.externalUserMngLinkUrl,this.externalUserMngLinkName=r.a.externalUserMngLinkName,this.canInvite=!r.a.disableLoginForm&&!r.a.externalUserMngLinkName,r.a.externalUserMngInfo&&(this.externalUserMngInfo=new o.a({linkTarget:"__blank"}).render(r.a.externalUserMngInfo))}return t.$inject=["$scope","backendSrv","navModelSrv","$sce"],t.prototype.get=function(){var t=this;this.backendSrv.get("/api/org/users").then(function(e){t.users=e,t.unfiltered=e}),this.backendSrv.get("/api/org/invites").then(function(e){t.pendingInvites=e})},t.prototype.onQueryUpdated=function(){var t=new RegExp(this.searchQuery,"ig");this.users=l.a.filter(this.unfiltered,function(e){return t.test(e.email)||t.test(e.login)})},t.prototype.updateOrgUser=function(t){this.backendSrv.patch("/api/org/users/"+t.userId,t)},t.prototype.removeUser=function(t){var e=this;this.$scope.appEvent("confirm-modal",{title:"Delete",text:"Are you sure you want to delete user "+t.login+"?",yesText:"Delete",icon:"fa-warning",onConfirm:function(){e.removeUserConfirmed(t)}})},t.prototype.removeUserConfirmed=function(t){this.backendSrv.delete("/api/org/users/"+t.userId).then(this.get.bind(this))},t.prototype.revokeInvite=function(t,e){e.stopPropagation(),this.backendSrv.patch("/api/org/invites/"+t.code+"/revoke").then(this.get.bind(this))},t.prototype.copyInviteToClipboard=function(t){t.stopPropagation()},t.prototype.getInviteUrl=function(t){return t.url},t}();a.a.controller("OrgUsersCtrl",u)},1501:function(t,e,n){"use strict";function r(){return{scope:{panel:"="},restrict:"E",controller:"PanelLinksEditorCtrl",templateUrl:"public/app/features/panellinks/module.html",link:function(){}}}var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=(n(1474),function(){function t(t,e){t.panel.links=t.panel.links||[],t.addLink=function(){t.panel.links.push({type:"dashboard"})},t.searchDashboards=function(t,n){e.search({query:t}).then(function(t){var e=s.a.map(t,function(t){return t.title});n(e)})},t.dashboardChanged=function(t){e.search({query:t.dashboard}).then(function(e){var n=s.a.find(e,{title:t.dashboard});n&&(t.dashUri=n.uri,t.title=n.title)})},t.deleteLink=function(e){t.panel.links=s.a.without(t.panel.links,e)}}return t.$inject=["$scope","backendSrv"],t}());i.a.module("grafana.directives").directive("panelLinksEditor",r).controller("PanelLinksEditorCtrl",l)},1502:function(t,e,n){"use strict";function r(){return{scope:{links:"="},restrict:"E",controller:"DashLinksContainerCtrl",template:'<dash-link ng-repeat="link in generatedLinks" link="link"></dash-link>',link:function(){}}}function a(t,e){return{restrict:"E",link:function(n,r){function a(){var t=e.getAnchorInfo(i);u.text(t.title),s.attr("href",t.href)}var i=n.link,o='<div class="gf-form"><a class="pointer gf-form-label" data-placement="bottom"'+(i.asDropdown?' ng-click="fillDropdown(link)" data-toggle="dropdown"':"")+"><i></i> <span></span></a>";i.asDropdown&&(o+='<ul class="dropdown-menu" role="menu"><li ng-repeat="dash in link.searchHits"><a href="{{dash.url}}" target="{{dash.target}}">{{dash.title}}</a></li></ul>'),o+="</div>",r.html(o),t(r.contents())(n);var s=r.find("a"),l=r.find("i"),u=r.find("span");r.find("a").tooltip({title:n.link.tooltip,html:!0,container:"body"}),l.attr("class","fa fa-fw "+n.link.icon),s.attr("target",n.link.target),i.asDropdown&&n.$last&&r.find(".dropdown-menu").addClass("pull-right"),a(),n.$on("refresh",a)}}}a.$inject=["$compile","linkSrv"];var i=n(21),o=n.n(i),s=n(4),l=n.n(s),u=n(1503),c=function(){function t(t,e,n,r,a,i){function o(e){return"dashboards"===e.type?e.tags?e.asDropdown?n.when([{title:e.title,tags:e.tags,keepTime:e.keepTime,includeVars:e.includeVars,target:e.targetBlank?"_blank":"_self",icon:"fa fa-bars",asDropdown:!0}]):t.searchDashboards(e,7):(console.log("Dashboard link missing tag"),n.when([])):"link"===e.type?n.when([{url:e.url,title:e.title,icon:u.a[e.icon],tooltip:e.tooltip,target:e.targetBlank?"_blank":"_self",keepTime:e.keepTime,includeVars:e.includeVars}]):n.when([])}function s(){var e=l.a.map(t.links,o);n.all(e).then(function(e){t.generatedLinks=l.a.flatten(e)})}var c=a.getCurrent().id;t.searchDashboards=function(t,e){return r.search({tag:t.tags,limit:e}).then(function(e){return l.a.reduce(e,function(e,n){return n.id!==c&&e.push({title:n.title,url:"dashboard/"+n.uri,target:t.target,icon:"fa fa-th-large",keepTime:t.keepTime,includeVars:t.includeVars}),e},[])})},t.fillDropdown=function(e){t.searchDashboards(e,100).then(function(t){l.a.each(t,function(t){t.url=i.getLinkUrl(t)}),e.searchHits=t})},s(),e.onAppEvent("dash-links-updated",s,t)}return t.$inject=["$scope","$rootScope","$q","backendSrv","dashboardSrv","linkSrv"],t}();o.a.module("grafana.directives").directive("dashLinksContainer",r),o.a.module("grafana.directives").directive("dashLink",a),o.a.module("grafana.directives").controller("DashLinksContainerCtrl",c)},1503:function(t,e,n){"use strict";function r(){return{restrict:"E",controller:u,templateUrl:"public/app/features/dashlinks/editor.html",bindToController:!0,controllerAs:"ctrl",scope:{dashboard:"="}}}n.d(e,"a",function(){return l});var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l={"external link":"fa-external-link",dashboard:"fa-th-large",question:"fa-question",info:"fa-info",bolt:"fa-bolt",doc:"fa-file-text-o",cloud:"fa-cloud"},u=function(){function t(t,e){this.iconMap=l,this.dashboard.links=this.dashboard.links||[],this.mode="list",t.$on("$destroy",function(){e.appEvent("dash-links-updated")})}return t.$inject=["$scope","$rootScope"],t.prototype.backToList=function(){this.mode="list"},t.prototype.setupNew=function(){this.mode="new",this.link={type:"dashboards",icon:"external link"}},t.prototype.addLink=function(){this.dashboard.links.push(this.link),this.mode="list"},t.prototype.editLink=function(t){this.link=t,this.mode="edit",console.log(this.link)},t.prototype.saveLink=function(){this.backToList()},t.prototype.moveLink=function(t,e){s.a.move(this.dashboard.links,t,t+e)},t.prototype.deleteLink=function(t){this.dashboard.links.splice(t,1),this.dashboard.updateSubmenuVisibility()},t}();i.a.module("grafana.directives").directive("dashLinksEditor",r)},1504:function(t,e,n){"use strict";var r=(n(1505),n(21)),a=n.n(r),i=n(4),o=n.n(i),s=n(3),l=n(1506),u=function(){function t(t,e,n,r,a){this.$rootScope=t,this.$q=e,this.datasourceSrv=n,this.backendSrv=r,this.timeSrv=a,t.onAppEvent("refresh",this.clearCache.bind(this),t),t.onAppEvent("dashboard-initialized",this.clearCache.bind(this),t)}return t.$inject=["$rootScope","$q","datasourceSrv","backendSrv","timeSrv"],t.prototype.clearCache=function(){this.globalAnnotationsPromise=null,this.alertStatesPromise=null},t.prototype.getAnnotations=function(t){var e=this;return this.$q.all([this.getGlobalAnnotations(t),this.getAlertStates(t)]).then(function(e){var n=o.a.flattenDeep(e[0]);return n=o.a.filter(n,function(e){return!e.panelId||"dashboard"!==e.source.type||e.panelId===t.panel.id}),n=Object(l.a)(n),n=Object(l.b)(n,t),{annotations:n,alertState:o.a.find(e[1],{panelId:t.panel.id})}}).catch(function(t){return!t.message&&t.data&&t.data.message&&(t.message=t.data.message),console.log("AnnotationSrv.query error",t),e.$rootScope.appEvent("alert-error",["Annotation Query Failed",t.message||t]),[]})},t.prototype.getAlertStates=function(t){return t.dashboard.id?t.panel&&!t.panel.alert?this.$q.when([]):"now"!==t.range.raw.to?this.$q.when([]):this.alertStatesPromise?this.alertStatesPromise:(this.alertStatesPromise=this.backendSrv.get("/api/alerts/states-for-dashboard",{dashboardId:t.dashboard.id}),this.alertStatesPromise):this.$q.when([])},t.prototype.getGlobalAnnotations=function(t){var e=this,n=t.dashboard;if(this.globalAnnotationsPromise)return this.globalAnnotationsPromise;for(var r=this.timeSrv.timeRange(),i=[],o=this,s=0,l=n.annotations.list;s<l.length;s++){var u=l[s],c=function(t){return t.enable?t.snapshotData?{value:o.translateQueryResult(t,t.snapshotData)}:void i.push(o.datasourceSrv.get(t.datasource).then(function(e){return e.annotationQuery({range:r,rangeRaw:r.raw,annotation:t,dashboard:n})}).then(function(r){return n.snapshot&&(t.snapshotData=a.a.copy(r)),e.translateQueryResult(t,r)})):"continue"}(u);if("object"==typeof c)return c.value}return this.globalAnnotationsPromise=this.$q.all(i),this.globalAnnotationsPromise},t.prototype.saveAnnotationEvent=function(t){return this.globalAnnotationsPromise=null,this.backendSrv.post("/api/annotations",t)},t.prototype.updateAnnotationEvent=function(t){return this.globalAnnotationsPromise=null,this.backendSrv.put("/api/annotations/"+t.id,t)},t.prototype.deleteAnnotationEvent=function(t){this.globalAnnotationsPromise=null;var e="/api/annotations/"+t.id;return t.isRegion&&(e="/api/annotations/region/"+t.regionId),this.backendSrv.delete(e)},t.prototype.translateQueryResult=function(t,e){t.snapshotData&&(t=a.a.copy(t),delete t.snapshotData);for(var n=0,r=e;n<r.length;n++){r[n].source=t}return e},t}();s.a.service("annotationsSrv",u)},1505:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(16),l=n.n(s),u=n(3),c=function(){function t(t,e){this.datasourceSrv=e,this.annotationDefaults={name:"",datasource:null,iconColor:"rgba(255, 96, 96, 1)",enable:!0,showIn:0,hide:!1},this.showOptions=[{text:"All Panels",value:0},{text:"Specific Panels",value:1}],t.ctrl=this,this.mode="list",this.datasources=e.getAnnotationSources(),this.annotations=t.dashboard.annotations.list,this.reset(),this.onColorChange=this.onColorChange.bind(this)}return t.$inject=["$scope","datasourceSrv"],t.prototype.datasourceChanged=function(){var t=this;return this.datasourceSrv.get(this.currentAnnotation.datasource).then(function(e){t.currentDatasource=e})},t.prototype.edit=function(t){this.currentAnnotation=t,this.currentAnnotation.showIn=this.currentAnnotation.showIn||0,this.currentIsNew=!1,this.datasourceChanged(),this.mode="edit",l()(".tooltip.in").remove()},t.prototype.reset=function(){this.currentAnnotation=a.a.copy(this.annotationDefaults),this.currentAnnotation.datasource=this.datasources[0].name,this.currentIsNew=!0,this.datasourceChanged()},t.prototype.update=function(){this.reset(),this.mode="list"},t.prototype.setupNew=function(){this.mode="new",this.reset()},t.prototype.backToList=function(){this.mode="list"},t.prototype.add=function(){this.annotations.push(this.currentAnnotation),this.reset(),this.mode="list"},t.prototype.removeAnnotation=function(t){var e=o.a.indexOf(this.annotations,t);this.annotations.splice(e,1)},t.prototype.onColorChange=function(t){this.currentAnnotation.iconColor=t},t}();u.a.controller("AnnotationsEditorCtrl",c)},1506:function(t,e,n){"use strict";function r(t,e){var n=u.a.partition(t,"regionId"),r=n[0],i=n[1],o=a(r,e.range);return t=u.a.concat(o,i)}function a(t,e){var n=u.a.filter(t,function(t){return t.regionId}),r=u.a.groupBy(n,"regionId");return r=u.a.compact(u.a.map(r,function(t){var n=u.a.head(t);return t&&t.length>1?(n.timeEnd=t[1].time,n.isRegion=!0,n):t&&t.length?(n.time&&n.timeEnd||(i(n)?n.timeEnd=e.to.valueOf()-1:(n.timeEnd=n.time,n.time=e.from.valueOf()+1),n.isRegion=!0),n):void 0}))}function i(t){return t.id&&t.id===t.regionId}function o(t){var e=[],n=u.a.partition(t,"id"),r=u.a.groupBy(n[0],"id");return e=u.a.map(r,function(t){return t.length>1&&!u.a.every(t,s)?u.a.find(t,function(t){return"panel-alert"!==t.eventType}):u.a.head(t)}),e=u.a.concat(e,n[1])}function s(t){return"panel-alert"===t.eventType}e.b=r,e.a=o;var l=n(4),u=n.n(l)},1507:function(t,e,n){"use strict";function r(t){if(t&&o.a.isNumber(t)){var e=Number(t);return l()(e)}return t}function a(){return{restrict:"E",controller:c,bindToController:!0,controllerAs:"ctrl",templateUrl:"public/app/features/annotations/partials/event_editor.html",scope:{panelCtrl:"=",event:"=",close:"&"}}}var i=n(4),o=n.n(i),s=n(1),l=n.n(s),u=n(225),c=function(){function t(t){this.annotationsSrv=t,this.event.panelId=this.panelCtrl.panel.id,this.event.dashboardId=this.panelCtrl.dashboard.id,this.event.time=r(this.event.time),this.event.isRegion&&(this.event.timeEnd=r(this.event.timeEnd)),this.timeFormated=this.panelCtrl.dashboard.formatDate(this.event.time)}return t.$inject=["annotationsSrv"],t.prototype.save=function(){var t=this;if(this.form.$valid){var e=o.a.cloneDeep(this.event);if(e.time=e.time.valueOf(),e.timeEnd=0,e.isRegion&&(e.timeEnd=this.event.timeEnd.valueOf(),e.timeEnd<e.time))return void console.log("invalid time");e.id?this.annotationsSrv.updateAnnotationEvent(e).then(function(){t.panelCtrl.refresh(),t.close()}).catch(function(){t.panelCtrl.refresh(),t.close()}):this.annotationsSrv.saveAnnotationEvent(e).then(function(){t.panelCtrl.refresh(),t.close()}).catch(function(){t.panelCtrl.refresh(),t.close()})}},t.prototype.delete=function(){var t=this;return this.annotationsSrv.deleteAnnotationEvent(this.event).then(function(){t.panelCtrl.refresh(),t.close()}).catch(function(){t.panelCtrl.refresh(),t.close()})},t}();u.d.directive("eventEditor",a)},1508:function(t,e,n){"use strict";function r(t){return s.a.filter(t,"isRegion")}function a(t,e){var n,r=e.grid.markings,a=h.b;s.a.each(t,function(t){n=t.source?t.source.iconColor||a:a,n=i(n,h.e),r.push({xaxis:{from:t.min,to:t.timeEnd},color:n})})}function i(t,e){var n=p()(t);return n.isValid()?(n.setAlpha(e),n.toRgbString()):t}n.d(e,"a",function(){return f});var o=n(4),s=n.n(o),l=n(1),u=n.n(l),c=n(146),p=n.n(c),d=n(1476),h=n(108),f=function(){function t(t){this.panelCtrl=t}return t.prototype.editorClosed=function(){this.event=null,this.editorOpen=!1,this.panelCtrl.render()},t.prototype.editorOpened=function(){this.editorOpen=!0},t.prototype.updateTime=function(t){this.event||(this.event=new d.a,this.event.dashboardId=this.panelCtrl.dashboard.id,this.event.panelId=this.panelCtrl.panel.id),this.event.time=u()(t.from),this.event.isRegion=!1,t.to&&(this.event.timeEnd=u()(t.to),this.event.isRegion=!0),this.panelCtrl.render()},t.prototype.editEvent=function(t,e){this.event=t,this.panelCtrl.render()},t.prototype.addFlotEvents=function(t,e){if(this.event||0!==t.length){var n={$__alerting:{color:h.a,position:"BOTTOM",markerSize:5},$__ok:{color:h.d,position:"BOTTOM",markerSize:5},$__no_data:{color:h.c,position:"BOTTOM",markerSize:5},$__editing:{color:h.b,position:"BOTTOM",markerSize:5}};if(this.event)t=this.event.isRegion?[{isRegion:!0,min:this.event.time.valueOf(),timeEnd:this.event.timeEnd.valueOf(),text:this.event.text,eventType:"$__editing",editModel:this.event}]:[{min:this.event.time.valueOf(),text:this.event.text,editModel:this.event,eventType:"$__editing"}];else for(var i=0;i<t.length;i++){var o=t[i];o.min=o.time,o.max=o.time,o.eventType=o.source.name,o.newState?o.eventType="$__"+o.newState:n[o.source.name]||(n[o.source.name]={color:o.source.iconColor,position:"BOTTOM",markerSize:5})}a(r(t),e);e.grid.eventSectionHeight=7,e.xaxis.eventSectionHeight=20,e.events={levels:s.a.keys(n).length+1,data:t,types:n,manager:this}}},t}()},1509:function(t,e,n){"use strict";function r(t,e,n,r){function a(e){try{return t(e)}catch(t){return console.log("Could not sanitize annotation string, html escaping instead"),i.a.escape(e)}}return{restrict:"E",scope:{event:"=",onEdit:"&"},link:function(t,n){var o=t.event,l=o.title,c=o.text,p=e.getCurrent(),d='<div class="graph-annotation">',h="";if(o.alertId){var f=u.a.getStateDisplayModel(o.newState);h=f.stateClass,l='<i class="icon-gf '+f.iconClass+'"></i> '+f.text,c=u.a.getAlertAnnotationInfo(o),o.text&&(c=c+"<br />"+o.text)}else l&&(c=l+"<br />"+(i.a.isString(c)?c:""),l="");var m='<div class="graph-annotation__header">';o.login&&(m+='<div class="graph-annotation__user" bs-tooltip="\'Created by '+o.login+'\'"><img src="'+o.avatarUrl+'" /></div>'),m+='\n          <span class="graph-annotation__title '+h+'">'+a(l)+'</span>\n          <span class="graph-annotation__time">'+p.formatDate(o.min)+"</span>\n      ",o.id&&p.meta.canEdit&&(m+='\n          <span class="pointer graph-annotation__edit-icon" ng-click="onEdit()">\n            <i class="fa fa-pencil-square"></i>\n          </span>\n        '),m+="</div>",d+=m,d+='<div class="graph-annotation__body">',c&&(d+="<div>"+a(c.replace(/\n/g,"<br>"))+"</div>");var g=o.tags;g&&g.length&&(t.tags=g,d+='<span class="label label-tag small" ng-repeat="tag in tags" tag-color-from-name="tag">{{tag}}</span><br/>'),d+="</div>",d+="</div>",s()(d).appendTo(n),r(n.contents())(t)}}}r.$inject=["$sanitize","dashboardSrv","contextSrv","$compile"];var a=n(4),i=n.n(a),o=n(16),s=n.n(o),l=n(3),u=n(518);l.a.directive("annotationTooltip",r)},1510:function(t,e,n){"use strict";var r=(n(1511),n(3)),a=n(1477);n(1512),n(1513),n(1514),n(1515),n(1516),n(1517),n(1518);r.a.factory("templateSrv",function(){return a.a})},1511:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(3),o=n(1465),s=n(17),l=function(){function t(t,e,n,r){t.variableTypes=o.c,t.ctrl={},t.namePattern=/^(?!__).*$/,t._=a.a,t.optionsLimit=20,t.refreshOptions=[{value:0,text:"Never"},{value:1,text:"On Dashboard Load"},{value:2,text:"On Time Range Change"}],t.sortOptions=[{value:0,text:"Disabled"},{value:1,text:"Alphabetical (asc)"},{value:2,text:"Alphabetical (desc)"},{value:3,text:"Numerical (asc)"},{value:4,text:"Numerical (desc)"},{value:5,text:"Alphabetical (case-insensitive, asc)"},{value:6,text:"Alphabetical (case-insensitive, desc)"}],t.hideOptions=[{value:0,text:""},{value:1,text:"Label"},{value:2,text:"Variable"}],t.init=function(){t.mode="list",t.variables=n.variables,t.reset(),t.$watch("mode",function(e){"new"===e&&t.reset()})},t.setMode=function(e){t.mode=e},t.add=function(){t.isValid()&&(n.addVariable(t.current),t.update())},t.isValid=function(){if(!t.ctrl.form.$valid)return!1;if(!t.current.name.match(/^\w+$/))return s.a.emit("alert-warning",["Validation","Only word and digit characters are allowed in variable names"]),!1;var e=a.a.find(t.variables,{name:t.current.name});return e&&e!==t.current?(s.a.emit("alert-warning",["Validation","Variable with the same name already exists"]),!1):"query"!==t.current.type||!t.current.query.match(new RegExp("\\$"+t.current.name+"(/| |$)"))||(s.a.emit("alert-warning",["Validation","Query cannot contain a reference to itself. Variable: $"+t.current.name]),!1)},t.validate=function(){t.infoText="","adhoc"===t.current.type&&null!==t.current.datasource&&(t.infoText="Adhoc filters are applied automatically to all queries that target this datasource",e.get(t.current.datasource).then(function(e){e.getTagKeys||(t.infoText="This datasource does not support adhoc filters yet.")}))},t.runQuery=function(){return t.optionsLimit=20,n.updateOptions(t.current).catch(function(t){t.data&&t.data.message&&(t.message=t.data.message),s.a.emit("alert-error",["Templating","Template variables could not be initialized: "+t.message])})},t.edit=function(e){t.current=e,t.currentIsNew=!1,t.mode="edit",t.validate()},t.duplicate=function(e){var r=a.a.cloneDeep(e.getSaveModel());t.current=n.createVariableFromModel(r),t.current.name="copy_of_"+e.name,n.addVariable(t.current)},t.update=function(){t.isValid()&&t.runQuery().then(function(){t.reset(),t.mode="list",r.updateTemplateData()})},t.reset=function(){t.currentIsNew=!0,t.current=n.createVariableFromModel({type:"query"}),t.datasources=a.a.filter(e.getMetricSources(),function(t){return!t.meta.mixed&&null!==t.value}),t.datasourceTypes=a()(t.datasources).uniqBy("meta.id").map(function(t){return{text:t.meta.name,value:t.meta.id}}).value()},t.typeChanged=function(){var e=t.current;t.current=n.createVariableFromModel({type:t.current.type}),t.current.name=e.name,t.current.hide=e.hide,t.current.label=e.label;var r=a.a.indexOf(this.variables,e);-1!==r&&(this.variables[r]=t.current),t.validate()},t.removeVariable=function(t){n.removeVariable(t)},t.showMoreOptions=function(){t.optionsLimit+=20}}return t.$inject=["$scope","datasourceSrv","variableSrv","templateSrv"],t}();i.a.controller("VariableEditorCtrl",l)},1512:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(3),l=n(1465),u=function(){function t(t,e,n,r,a){this.$rootScope=t,this.$q=e,this.$location=n,this.$injector=r,this.templateSrv=a,t.$on("refresh",this.onDashboardRefresh.bind(this),t),t.$on("template-variable-value-updated",this.updateUrlParamsWithCurrentVariables.bind(this),t)}return t.$inject=["$rootScope","$q","$location","$injector","templateSrv"],t.prototype.init=function(t){var e=this;this.dashboard=t,this.variables=t.templating.list=t.templating.list.map(this.createVariableFromModel.bind(this)),this.templateSrv.init(this.variables);for(var n=0,r=this.variables;n<r.length;n++){r[n].initLock=this.$q.defer()}var a=this.$location.search();return this.$q.all(this.variables.map(function(t){return e.processVariable(t,a)})).then(function(){e.templateSrv.updateTemplateData()})},t.prototype.onDashboardRefresh=function(){var t=this,e=this.variables.filter(function(t){return 2===t.refresh}).map(function(e){var n=e.options.slice();return e.updateOptions().then(function(){a.a.toJson(n)!==a.a.toJson(e.options)&&t.$rootScope.$emit("template-variable-value-updated")})});return this.$q.all(e)},t.prototype.processVariable=function(t,e){for(var n=this,r=[],a=0,i=this.variables;a<i.length;a++){var o=i[a];t.dependsOn(o)&&r.push(o.initLock.promise)}return this.$q.all(r).then(function(){var n=e["var-"+t.name];return void 0!==n?t.setValueFromUrl(n).then(t.initLock.resolve):1===t.refresh||2===t.refresh?t.updateOptions().then(t.initLock.resolve):void t.initLock.resolve()}).finally(function(){n.templateSrv.variableInitialized(t),delete t.initLock})},t.prototype.createVariableFromModel=function(t){var e=l.c[t.type].ctor;if(!e)throw{message:"Unable to find variable constructor for "+t.type};return this.$injector.instantiate(e,{model:t})},t.prototype.addVariable=function(t){this.variables.push(t),this.templateSrv.updateTemplateData(),this.dashboard.updateSubmenuVisibility()},t.prototype.removeVariable=function(t){var e=o.a.indexOf(this.variables,t);this.variables.splice(e,1),this.templateSrv.updateTemplateData(),this.dashboard.updateSubmenuVisibility()},t.prototype.updateOptions=function(t){return t.updateOptions()},t.prototype.variableUpdated=function(t,e){var n=this;if(t.initLock)return this.$q.when();var r=o.a.map(this.variables,function(e){if(e!==t)return e.dependsOn(t)?n.updateOptions(e):void 0});return this.$q.all(r).then(function(){e&&(n.$rootScope.$emit("template-variable-value-updated"),n.$rootScope.$broadcast("refresh"))})},t.prototype.selectOptionsForCurrentValue=function(t){var e,n,r,a,i=[];for(e=0;e<t.options.length;e++)if(a=t.options[e],a.selected=!1,o.a.isArray(t.current.value))for(n=0;n<t.current.value.length;n++)r=t.current.value[n],a.value===r&&(a.selected=!0,i.push(a));else a.value===t.current.value&&(a.selected=!0,i.push(a));return i},t.prototype.validateVariableSelectionState=function(t){if(t.current||(t.current={}),o.a.isArray(t.current.value)){var e=this.selectOptionsForCurrentValue(t);return e=0===e.length?t.options[0]:{value:o.a.map(e,function(t){return t.value}),text:o.a.map(e,function(t){return t.text}).join(" + ")},t.setValue(e)}var n=o.a.find(t.options,{text:t.current.text});return n?t.setValue(n):t.options.length?t.setValue(t.options[0]):Promise.resolve()},t.prototype.setOptionFromUrl=function(t,e){var n=this.$q.when();return t.refresh&&(n=t.updateOptions()),n.then(function(){var n=o.a.find(t.options,function(t){return t.text===e||t.value===e});return n=n||{text:e,value:e},t.setValue(n)})},t.prototype.setOptionAsCurrent=function(t,e){return t.current=o.a.cloneDeep(e),o.a.isArray(t.current.text)&&(t.current.text=t.current.text.join(" + ")),this.selectOptionsForCurrentValue(t),this.variableUpdated(t)},t.prototype.updateUrlParamsWithCurrentVariables=function(){var t=this.$location.search();o.a.each(t,function(e,n){0===n.indexOf("var-")&&delete t[n]}),this.templateSrv.fillVariableValuesForUrl(t),this.$location.search(t)},t.prototype.setAdhocFilter=function(t){var e=o.a.find(this.variables,{type:"adhoc",datasource:t.datasource});e||(e=this.createVariableFromModel({name:"Filters",type:"adhoc",datasource:t.datasource}),this.addVariable(e));var n=e.filters,r=o.a.find(n,{key:t.key,value:t.value});r||(r={key:t.key,value:t.value},n.push(r)),r.operator=t.operator,this.variableUpdated(e,!0)},t}();s.a.service("variableSrv",u)},1513:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(224),o=n(1465),s=function(){function t(t,e,n,r){this.model=t,this.timeSrv=e,this.templateSrv=n,this.variableSrv=r,this.defaults={type:"interval",name:"",hide:0,label:"",refresh:2,options:[],current:{},query:"1m,10m,30m,1h,6h,12h,1d,7d,14d,30d",auto:!1,auto_min:"10s",auto_count:30},Object(o.a)(this,t,this.defaults),this.refresh=2}return t.$inject=["model","timeSrv","templateSrv","variableSrv"],t.prototype.getSaveModel=function(){return Object(o.a)(this.model,this,this.defaults),this.model},t.prototype.setValue=function(t){return this.updateAutoValue(),this.variableSrv.setOptionAsCurrent(this,t)},t.prototype.updateAutoValue=function(){if(this.auto){this.options.length&&"auto"!==this.options[0].text&&this.options.unshift({text:"auto",value:"$__auto_interval_"+this.name});var t=i.a.calculateInterval(this.timeSrv.timeRange(),this.auto_count,this.auto_min);this.templateSrv.setGrafanaVariable("$__auto_interval_"+this.name,t.interval),this.templateSrv.setGrafanaVariable("$__auto_interval",t.interval)}},t.prototype.updateOptions=function(){return this.options=a.a.map(this.query.match(/(["'])(.*?)\1|\w+/g),function(t){return t=t.replace(/["']+/g,""),{text:t.trim(),value:t.trim()}}),this.updateAutoValue(),this.variableSrv.validateVariableSelectionState(this)},t.prototype.dependsOn=function(t){return!1},t.prototype.setValueFromUrl=function(t){return this.updateAutoValue(),this.variableSrv.setOptionFromUrl(this,t)},t.prototype.getValueForUrl=function(){return this.current.value},t}();o.c.interval={name:"Interval",ctor:s,description:"Define a timespan interval (ex 1m, 1h, 1d)"}},1514:function(t,e,n){"use strict";function r(){return{text:"None",value:"",isNone:!0}}var a=n(4),i=n.n(a),o=n(224),s=n(1465),l=function(){function t(t,e,n,r,a){this.model=t,this.datasourceSrv=e,this.templateSrv=n,this.variableSrv=r,this.timeSrv=a,this.defaults={type:"query",label:null,query:"",regex:"",sort:0,datasource:null,refresh:0,hide:0,name:"",multi:!1,includeAll:!1,allValue:null,options:[],current:{},tags:[],useTags:!1,tagsQuery:"",tagValuesQuery:""},Object(s.a)(this,t,this.defaults)}return t.$inject=["model","datasourceSrv","templateSrv","variableSrv","timeSrv"],t.prototype.getSaveModel=function(){return Object(s.a)(this.model,this,this.defaults),0!==this.refresh&&(this.model.options=[]),this.model},t.prototype.setValue=function(t){return this.variableSrv.setOptionAsCurrent(this,t)},t.prototype.setValueFromUrl=function(t){return this.variableSrv.setOptionFromUrl(this,t)},t.prototype.getValueForUrl=function(){return"All"===this.current.text?"All":this.current.value},t.prototype.updateOptions=function(){return this.datasourceSrv.get(this.datasource).then(this.updateOptionsFromMetricFindQuery.bind(this)).then(this.updateTags.bind(this)).then(this.variableSrv.validateVariableSelectionState.bind(this.variableSrv,this))},t.prototype.updateTags=function(t){var e=this;return this.useTags?this.metricFindQuery(t,this.tagsQuery).then(function(n){e.tags=[];for(var r=0;r<n.length;r++)e.tags.push(n[r].text);return t}):(delete this.tags,t)},t.prototype.getValuesForTag=function(t){var e=this;return this.datasourceSrv.get(this.datasource).then(function(n){var r=e.tagValuesQuery.replace("$tag",t);return e.metricFindQuery(n,r).then(function(t){return i.a.map(t,function(t){return t.text})})})},t.prototype.updateOptionsFromMetricFindQuery=function(t){var e=this;return this.metricFindQuery(t,this.query).then(function(n){return e.options=e.metricNamesToVariableValues(n),e.includeAll&&e.addAllOption(),e.options.length||e.options.push(r()),t})},t.prototype.metricFindQuery=function(t,e){var n={range:void 0,variable:this};return 2===this.refresh&&(n.range=this.timeSrv.timeRange()),t.metricFindQuery(e,n)},t.prototype.addAllOption=function(){this.options.unshift({text:"All",value:"$__all"})},t.prototype.metricNamesToVariableValues=function(t){var e,n,r,a;for(n=[],this.regex&&(e=o.a.stringToJsRegex(this.templateSrv.replace(this.regex,{},"regex"))),r=0;r<t.length;r++){var s=t[r],l=void 0===s.text||null===s.text?s.value:s.text,u=void 0===s.value||null===s.value?s.text:s.value;if(i.a.isNumber(u)&&(u=u.toString()),i.a.isNumber(l)&&(l=l.toString()),e){if(!(a=e.exec(u)))continue;a.length>1&&(u=a[1],l=a[1])}n.push({text:l,value:u})}return n=i.a.uniqBy(n,"value"),this.sortVariableValues(n,this.sort)},t.prototype.sortVariableValues=function(t,e){if(0===e)return t;var n=Math.ceil(e/2),r=e%2==0;return 1===n?t=i.a.sortBy(t,"text"):2===n?t=i.a.sortBy(t,function(t){var e=t.text.match(/.*?(\d+).*/);return!e||e.length<2?-1:parseInt(e[1],10)}):3===n&&(t=i.a.sortBy(t,function(t){return i.a.toLower(t.text)})),r&&(t=t.reverse()),t},t.prototype.dependsOn=function(t){return Object(s.b)(this.query,this.datasource,t.name)},t}();s.c.query={name:"Query",ctor:l,description:"Variable values are fetched from a datasource query",supportsMulti:!0}},1515:function(t,e,n){"use strict";var r=n(224),a=n(1465),i=function(){function t(t,e,n,r){this.model=t,this.datasourceSrv=e,this.variableSrv=n,this.templateSrv=r,this.defaults={type:"datasource",name:"",hide:0,label:"",current:{},regex:"",options:[],query:"",refresh:1},Object(a.a)(this,t,this.defaults),this.refresh=1}return t.$inject=["model","datasourceSrv","variableSrv","templateSrv"],t.prototype.getSaveModel=function(){return Object(a.a)(this.model,this,this.defaults),this.model.options=[],this.model},t.prototype.setValue=function(t){return this.variableSrv.setOptionAsCurrent(this,t)},t.prototype.updateOptions=function(){var t,e=[],n=this.datasourceSrv.getMetricSources({skipVariables:!0});this.regex&&(t=this.templateSrv.replace(this.regex,null,"regex"),t=r.a.stringToJsRegex(t));for(var a=0;a<n.length;a++){var i=n[a];i.meta.id===this.query&&(t&&!t.exec(i.name)||e.push({text:i.name,value:i.name}))}return 0===e.length&&e.push({text:"No data sources found",value:""}),this.options=e,this.variableSrv.validateVariableSelectionState(this)},t.prototype.dependsOn=function(t){return!!this.regex&&Object(a.b)(this.regex,t.name)},t.prototype.setValueFromUrl=function(t){return this.variableSrv.setOptionFromUrl(this,t)},t.prototype.getValueForUrl=function(){return this.current.value},t}();a.c.datasource={name:"Datasource",ctor:i,description:"Enabled you to dynamically switch the datasource for multiple panels"}},1516:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(1465),o=function(){function t(t,e){this.model=t,this.variableSrv=e,this.defaults={type:"custom",name:"",label:"",hide:0,options:[],current:{},query:"",includeAll:!1,multi:!1,allValue:null},Object(i.a)(this,t,this.defaults)}return t.$inject=["model","variableSrv"],t.prototype.setValue=function(t){return this.variableSrv.setOptionAsCurrent(this,t)},t.prototype.getSaveModel=function(){return Object(i.a)(this.model,this,this.defaults),this.model},t.prototype.updateOptions=function(){return this.options=a.a.map(this.query.split(/[,]+/),function(t){return{text:t.trim(),value:t.trim()}}),this.includeAll&&this.addAllOption(),this.variableSrv.validateVariableSelectionState(this)},t.prototype.addAllOption=function(){this.options.unshift({text:"All",value:"$__all"})},t.prototype.dependsOn=function(t){return!1},t.prototype.setValueFromUrl=function(t){return this.variableSrv.setOptionFromUrl(this,t)},t.prototype.getValueForUrl=function(){return"All"===this.current.text?"All":this.current.value},t}();i.c.custom={name:"Custom",ctor:o,description:"Define variable values manually",supportsMulti:!0}},1517:function(t,e,n){"use strict";var r=n(1465),a=function(){function t(t,e){this.model=t,this.variableSrv=e,this.defaults={type:"constant",name:"",hide:2,label:"",query:"",current:{},options:[]},Object(r.a)(this,t,this.defaults)}return t.$inject=["model","variableSrv"],t.prototype.getSaveModel=function(){return Object(r.a)(this.model,this,this.defaults),this.model},t.prototype.setValue=function(t){this.variableSrv.setOptionAsCurrent(this,t)},t.prototype.updateOptions=function(){return this.options=[{text:this.query.trim(),value:this.query.trim()}],this.setValue(this.options[0]),Promise.resolve()},t.prototype.dependsOn=function(t){return!1},t.prototype.setValueFromUrl=function(t){return this.variableSrv.setOptionFromUrl(this,t)},t.prototype.getValueForUrl=function(){return this.current.value},t}();r.c.constant={name:"Constant",ctor:a,description:"Define a hidden constant variable, useful for metric prefixes in dashboards you want to share"}},1518:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(1465),o=function(){function t(t){this.model=t,this.defaults={type:"adhoc",name:"",label:"",hide:0,datasource:null,filters:[]},Object(i.a)(this,t,this.defaults)}return t.$inject=["model"],t.prototype.setValue=function(t){return Promise.resolve()},t.prototype.getSaveModel=function(){return Object(i.a)(this.model,this,this.defaults),this.model},t.prototype.updateOptions=function(){return Promise.resolve()},t.prototype.dependsOn=function(t){return!1},t.prototype.setValueFromUrl=function(t){var e=this;return a.a.isArray(t)||(t=[t]),this.filters=t.map(function(t){var n=t.split("|").map(function(t){return e.unescapeDelimiter(t)});return{key:n[0],operator:n[1],value:n[2]}}),Promise.resolve()},t.prototype.getValueForUrl=function(){var t=this;return this.filters.map(function(e){return[e.key,e.operator,e.value].map(function(e){return t.escapeDelimiter(e)}).join("|")})},t.prototype.escapeDelimiter=function(t){return t.replace(/\|/g,"__gfp__")},t.prototype.unescapeDelimiter=function(t){return t.replace(/__gfp__/g,"|")},t.prototype.setFilters=function(t){this.filters=t},t}();i.c.adhoc={name:"Ad hoc filters",ctor:o,description:"Add key/value filters on the fly"}},1519:function(t,e,n){"use strict";n(1520),n(1521),n(1522),n(1523),n(1524),n(1525),n(1526),n(1527),n(1656)},1520:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(514),l=n.n(s),u=function(){function t(t,e,n,r,a,i){this.$scope=t,this.$rootScope=e,this.backendSrv=n,this.$sce=r,this.$routeParams=a,this.pluginId=a.pluginId,this.preUpdateHook=function(){return Promise.resolve()},this.postUpdateHook=function(){return Promise.resolve()},this.init()}return t.$inject=["$scope","$rootScope","backendSrv","$sce","$routeParams","navModelSrv"],t.prototype.setNavModel=function(t){var e="readme";if(this.navModel={main:{img:t.info.logos.large,subTitle:t.info.author.name,url:"",text:t.name,breadcrumbs:[{title:"Plugins",url:"plugins"}],children:[{icon:"fa fa-fw fa-file-text-o",id:"readme",text:"Readme",url:"plugins/"+this.model.id+"/edit?tab=readme"}]}},"app"===t.type){this.navModel.main.children.push({icon:"gicon gicon-cog",id:"config",text:"Config",url:"plugins/"+this.model.id+"/edit?tab=config"});o.a.find(t.includes,{type:"dashboard"})&&this.navModel.main.children.push({icon:"gicon gicon-dashboard",id:"dashboards",text:"Dashboards",url:"plugins/"+this.model.id+"/edit?tab=dashboards"}),e="config"}this.tab=this.$routeParams.tab||e;for(var n=0,r=this.navModel.main.children;n<r.length;n++){var a=r[n];a.id===this.tab&&(a.active=!0)}},t.prototype.init=function(){var t=this;return this.backendSrv.get("/api/plugins/"+this.pluginId+"/settings").then(function(e){return t.model=e,t.pluginIcon=t.getPluginIcon(t.model.type),t.model.dependencies.plugins.forEach(function(e){e.icon=t.getPluginIcon(e.type)}),t.includes=o.a.map(e.includes,function(e){return e.icon=t.getPluginIcon(e.type),e}),t.setNavModel(t.model),t.initReadme()})},t.prototype.initReadme=function(){var t=this;return this.backendSrv.get("/api/plugins/"+this.pluginId+"/markdown/readme").then(function(e){var n=new l.a;t.readmeHtml=t.$sce.trustAsHtml(n.render(e))})},t.prototype.getPluginIcon=function(t){switch(t){case"datasource":return"icon-gf icon-gf-datasources";case"panel":return"icon-gf icon-gf-panel";case"app":return"icon-gf icon-gf-apps";case"page":return"icon-gf icon-gf-endpoint-tiny";case"dashboard":return"icon-gf icon-gf-dashboard";default:return"icon-gf icon-gf-apps"}},t.prototype.update=function(){var t=this;this.preUpdateHook().then(function(){var e=o.a.extend({enabled:t.model.enabled,pinned:t.model.pinned,jsonData:t.model.jsonData,secureJsonData:t.model.secureJsonData},{});return t.backendSrv.post("/api/plugins/"+t.pluginId+"/settings",e)}).then(this.postUpdateHook).then(function(t){window.location.href=window.location.href})},t.prototype.importDashboards=function(){return Promise.resolve()},t.prototype.setPreUpdateHook=function(t){this.preUpdateHook=t},t.prototype.setPostUpdateHook=function(t){this.postUpdateHook=t},t.prototype.updateAvailable=function(){var t=this.$scope.$new(!0);t.plugin=this.model,this.$rootScope.appEvent("show-modal",{src:"public/app/features/plugins/partials/update_instructions.html",scope:t})},t.prototype.enable=function(){this.model.enabled=!0,this.model.pinned=!0,this.update()},t.prototype.disable=function(){this.model.enabled=!1,this.model.pinned=!1,this.update()},t}();a.a.module("grafana.controllers").controller("PluginEditCtrl",u)},1521:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s={},l=function(){function t(t,e,n,r){this.backendSrv=t,this.$routeParams=e,this.$rootScope=n,this.navModelSrv=r,this.pluginId=e.pluginId,s[this.pluginId]?this.initPage(s[this.pluginId]):this.loadPluginInfo()}return t.$inject=["backendSrv","$routeParams","$rootScope","navModelSrv"],t.prototype.initPage=function(t){if(this.appModel=t,this.page=o.a.find(t.includes,{slug:this.$routeParams.slug}),s[this.pluginId]=t,!this.page)return this.$rootScope.appEvent("alert-error",["App Page Not Found",""]),void(this.navModel=this.navModelSrv.getNotFoundNav());var e=this.navModelSrv.getNav("plugin-page-"+t.id);this.navModel={main:{img:t.info.logos.large,subTitle:t.name,url:"",text:this.page.name,breadcrumbs:[{title:t.name,url:e.main.url}]}}},t.prototype.loadPluginInfo=function(){var t=this;this.backendSrv.get("/api/plugins/"+this.pluginId+"/settings").then(function(e){t.initPage(e)})},t}();a.a.module("grafana.controllers").controller("AppPageCtrl",l)},1522:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=function(){function t(t,e,n){var r=this;this.backendSrv=t,this.tabIndex=0,this.navModel=n.getNav("cfg","plugins",0),this.backendSrv.get("api/plugins",{embedded:0}).then(function(t){r.plugins=t,r.allPlugins=t})}return t.$inject=["backendSrv","$location","navModelSrv"],t.prototype.onQueryUpdated=function(){var t=new RegExp(this.searchQuery,"ig");this.plugins=o.a.filter(this.allPlugins,function(e){return t.test(e.name)||t.test(e.type)})},t}();a.a.module("grafana.controllers").controller("PluginListCtrl",s)},1523:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/plugins/import_list/import_list.html",controller:l,bindToController:!0,controllerAs:"ctrl",scope:{plugin:"=",datasource:"="}}}var a=n(4),i=n.n(a),o=n(3),s=n(17),l=function(){function t(t,e,n){var r=this;this.backendSrv=e,this.$rootScope=n,this.dashboards=[],e.get("/api/plugins/"+this.plugin.id+"/dashboards").then(function(t){r.dashboards=t}),s.a.on("dashboard-list-import-all",this.importAll.bind(this),t)}return t.$inject=["$scope","backendSrv","$rootScope"],t.prototype.importAll=function(t){return this.importNext(0).then(function(){t.resolve("All dashboards imported")}).catch(function(e){t.reject(e)})},t.prototype.importNext=function(t){var e=this;return this.import(this.dashboards[t],!0).then(function(){return t+1<e.dashboards.length?new Promise(function(n){setTimeout(function(){e.importNext(t+1).then(function(){n()})},500)}):Promise.resolve()})},t.prototype.import=function(t,e){var n=this,r={pluginId:this.plugin.id,path:t.path,overwrite:e,inputs:[]};return this.datasource&&r.inputs.push({name:"*",type:"datasource",pluginId:this.datasource.type,value:this.datasource.name}),this.backendSrv.post("/api/dashboards/import",r).then(function(e){n.$rootScope.appEvent("alert-success",["Dashboard Imported",t.title]),i.a.extend(t,e)})},t.prototype.remove=function(t){var e=this;this.backendSrv.delete("/api/dashboards/"+t.importedUri).then(function(){e.$rootScope.appEvent("alert-success",["Dashboard Deleted",t.title]),t.imported=!1})},t}();o.a.directive("dashboardImportList",r)},1524:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(56),o=n(22),s=n(225),l=n(88),u=[],c={name:"",type:"graphite",url:"",access:"proxy",jsonData:{},secureJsonFields:{}},p=!1,d=function(){function t(t,e,n,r,a){var o=this;this.$q=t,this.backendSrv=e,this.$routeParams=n,this.$location=r,this.datasourceSrv=a,null===l.b.nav.main&&l.b.nav.load("cfg","datasources"),this.navModel=Object(i.toJS)(l.b.nav),this.datasources=[],this.loadDatasourceTypes().then(function(){o.$routeParams.id?o.getDatasourceById(o.$routeParams.id):o.initNewDatasourceModel()})}return t.$inject=["$q","backendSrv","$routeParams","$location","datasourceSrv"],t.prototype.initNewDatasourceModel=function(){this.isNew=!0,this.current=a.a.cloneDeep(c),this.$location.search().gettingstarted&&(this.gettingStarted=!0,this.current.isDefault=!0),this.typeChanged()},t.prototype.loadDatasourceTypes=function(){var t=this;return u.length>0?(this.types=u,this.$q.when(null)):this.backendSrv.get("/api/plugins",{enabled:1,type:"datasource"}).then(function(e){u=e,t.types=e})},t.prototype.getDatasourceById=function(t){var e=this;this.backendSrv.get("/api/datasources/"+t).then(function(t){return e.isNew=!1,e.current=t,p&&(p=!1,e.testDatasource()),e.typeChanged()})},t.prototype.userChangedType=function(){this.current=a.a.defaults({id:this.current.id,name:this.current.name,isDefault:this.current.isDefault,type:this.current.type},a.a.cloneDeep(c)),this.typeChanged()},t.prototype.updateNav=function(){l.b.nav.initDatasourceEditNav(this.current,this.datasourceMeta,"datasource-settings"),this.navModel=Object(i.toJS)(l.b.nav)},t.prototype.typeChanged=function(){var t=this;return this.backendSrv.get("/api/plugins/"+this.current.type+"/settings").then(function(e){t.datasourceMeta=e,t.updateNav()})},t.prototype.updateFrontendSettings=function(){var t=this;return this.backendSrv.get("/api/frontend/settings").then(function(e){o.a.datasources=e.datasources,o.a.defaultDatasource=e.defaultDatasource,t.datasourceSrv.init()})},t.prototype.testDatasource=function(){var t=this;this.datasourceSrv.get(this.current.name).then(function(e){e.testDatasource&&(t.testing={done:!1,status:"error"},t.backendSrv.withNoBackendCache(function(){return e.testDatasource().then(function(e){t.testing.message=e.message,t.testing.status=e.status}).catch(function(e){e.statusText?t.testing.message="HTTP Error "+e.statusText:t.testing.message=e.message})}).finally(function(){t.testing.done=!0}))})},t.prototype.saveChanges=function(){var t=this;if(this.editForm.$valid&&!this.current.readOnly)return this.current.id?this.backendSrv.put("/api/datasources/"+this.current.id,this.current).then(function(e){t.current=e.datasource,t.updateNav(),t.updateFrontendSettings().then(function(){t.testDatasource()})}):this.backendSrv.post("/api/datasources",this.current).then(function(e){t.current=e.datasource,t.updateFrontendSettings(),p=!0,t.$location.path("datasources/edit/"+e.id)})},t.prototype.confirmDelete=function(){var t=this;this.backendSrv.delete("/api/datasources/"+this.current.id).then(function(){t.$location.path("datasources")})},t.prototype.delete=function(t){var e=this;s.b.emit("confirm-modal",{title:"Delete",text:"Are you sure you want to delete this datasource?",yesText:"Delete",icon:"fa-trash",onConfirm:function(){e.confirmDelete()}})},t}();s.d.controller("DataSourceEditCtrl",d),s.d.directive("datasourceHttpSettings",function(){return{scope:{current:"=",suggestUrl:"@"},templateUrl:"public/app/features/plugins/partials/ds_http_settings.html",link:{pre:function(t,e,n){t.getSuggestUrls=function(){return[t.suggestUrl]}}}}})},1525:function(t,e,n){"use strict";var r=n(56),a=n(225),i=n(88),o=function(){function t(t,e){this.backendSrv=t,this.$routeParams=e,null===i.b.nav.main&&i.b.nav.load("cfg","datasources"),this.navModel=Object(r.toJS)(i.b.nav),this.$routeParams.id&&this.getDatasourceById(this.$routeParams.id)}return t.$inject=["backendSrv","$routeParams"],t.prototype.getDatasourceById=function(t){var e=this;this.backendSrv.get("/api/datasources/"+t).then(function(t){e.current=t}).then(this.getPluginInfo.bind(this))},t.prototype.updateNav=function(){i.b.nav.initDatasourceEditNav(this.current,this.datasourceMeta,"datasource-dashboards"),this.navModel=Object(r.toJS)(i.b.nav)},t.prototype.getPluginInfo=function(){var t=this;return this.backendSrv.get("/api/plugins/"+this.current.type+"/settings").then(function(e){t.datasourceMeta=e,t.updateNav()})},t}();a.d.controller("DataSourceDashboardsCtrl",o)},1526:function(t,e,n){"use strict";var r=n(3),a=n(4),i=n.n(a),o=function(){function t(t,e,n,r){var a=this;this.$scope=t,this.backendSrv=e,this.datasourceSrv=n,this.navModelSrv=r,this.navModel=this.navModelSrv.getNav("cfg","datasources",0),e.get("/api/datasources").then(function(t){a.datasources=t,a.unfiltered=t})}return t.$inject=["$scope","backendSrv","datasourceSrv","navModelSrv"],t.prototype.onQueryUpdated=function(){var t=new RegExp(this.searchQuery,"ig");this.datasources=i.a.filter(this.unfiltered,function(e){return t.test(e.name)||t.test(e.type)})},t.prototype.removeDataSourceConfirmed=function(t){var e=this;this.backendSrv.delete("/api/datasources/"+t.id).then(function(){e.$scope.appEvent("alert-success",["Datasource deleted",""])},function(){e.$scope.appEvent("alert-error",["Unable to delete datasource",""])}).then(function(){e.backendSrv.get("/api/datasources").then(function(t){e.datasources=t}),e.backendSrv.get("/api/frontend/settings").then(function(t){e.datasourceSrv.init(t.datasources)})})},t.prototype.removeDataSource=function(t){var e=this;this.$scope.appEvent("confirm-modal",{title:"Delete",text:"Are you sure you want to delete datasource "+t.name+"?",yesText:"Delete",icon:"fa-trash",onConfirm:function(){e.removeDataSourceConfirmed(t)}})},t}();r.a.controller("DataSourcesCtrl",o)},1527:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(3),o=n(22),s=n(1470),l=function(){function t(t,e,n,r){this.$q=t,this.$injector=e,this.templateSrv=r,this.init()}return t.$inject=["$q","$injector","$rootScope","templateSrv"],t.prototype.init=function(){this.datasources={}},t.prototype.get=function(t){return t?(t=this.templateSrv.replace(t),"default"===t?this.get(o.a.defaultDatasource):this.datasources[t]?this.$q.when(this.datasources[t]):this.loadDatasource(t)):this.get(o.a.defaultDatasource)},t.prototype.loadDatasource=function(t){var e=this,n=o.a.datasources[t];if(!n)return this.$q.reject({message:"Datasource named "+t+" was not found"});var r=this.$q.defer(),a=n.meta;return Object(s.a)(a.module).then(function(i){if(e.datasources[t])return void r.resolve(e.datasources[t]);if(!i.Datasource)throw new Error("Plugin module is missing Datasource constructor");var o=e.$injector.instantiate(i.Datasource,{instanceSettings:n});o.meta=a,o.name=t,e.datasources[t]=o,r.resolve(o)}).catch(function(t){this.$rootScope.appEvent("alert-error",[n.name+" plugin failed",t.toString()])}),r.promise},t.prototype.getAll=function(){return o.a.datasources},t.prototype.getAnnotationSources=function(){var t=[];return this.addDataSourceVariables(t),a.a.each(o.a.datasources,function(e){e.meta&&e.meta.annotations&&t.push(e)}),t},t.prototype.getMetricSources=function(t){var e=[];return a.a.each(o.a.datasources,function(t,n){t.meta&&t.meta.metrics&&(e.push({value:n,name:n,meta:t.meta}),n===o.a.defaultDatasource&&e.push({value:null,name:"default",meta:t.meta}))}),t&&t.skipVariables||this.addDataSourceVariables(e),e.sort(function(t,e){return"mixed"===t.meta.id||"grafana"===t.meta.id?1:"mixed"===e.meta.id||"grafana"===e.meta.id?-1:t.name.toLowerCase()>e.name.toLowerCase()?1:t.name.toLowerCase()<e.name.toLowerCase()?-1:0}),e},t.prototype.addDataSourceVariables=function(t){for(var e=0;e<this.templateSrv.variables.length;e++){var n=this.templateSrv.variables[e];if("datasource"===n.type){var r=n.current.value;"default"===r&&(r=o.a.defaultDatasource);var a=o.a.datasources[r];a&&t.push({name:"$"+n.name,value:"$"+n.name,meta:a.meta})}}},t}();i.a.service("datasourceSrv",l)},1528:function(t,e,n){(function(e,r,a,i){!function(){"use strict";function o(t){return fe?Symbol():"@@"+t}function s(t,e){ce||(e=e.replace(de?/file:\/\/\//g:/file:\/\//g,""));var n,r=(t.message||t)+"\n  "+e;n=ve&&t.fileName?new Error(r,t.fileName,t.lineNumber):new Error(r);var a=t.originalErr?t.originalErr.stack:t.stack;return n.stack=pe?r+"\n  "+a:a,n.originalErr=t.originalErr||t,n}function l(t,e){throw new RangeError('Unable to resolve "'+t+'" to '+e)}function u(t,e){t=t.trim();var n=e&&e.substr(0,e.indexOf(":")+1),r=t[0],a=t[1];if("/"===r&&"/"===a)return n||l(t,e),n+t;if("."===r&&("/"===a||"."===a&&("/"===t[2]||2===t.length&&(t+="/"))||1===t.length&&(t+="/"))||"/"===r){var i,o=!n||"/"!==e[n.length];if(o?(void 0===e&&l(t,e),i=e):i="/"===e[n.length+1]?"file:"!==n?(i=e.substr(n.length+2)).substr(i.indexOf("/")+1):e.substr(8):e.substr(n.length+1),"/"===r){if(!o)return e.substr(0,e.length-i.length-1)+t;l(t,e)}for(var s=i.substr(0,i.lastIndexOf("/")+1)+t,u=[],c=-1,p=0;p<s.length;p++)if(-1===c)if("."!==s[p])c=p;else{if("."!==s[p+1]||"/"!==s[p+2]&&p+2!==s.length){if("/"!==s[p+1]&&p+1!==s.length){c=p;continue}p+=1}else u.pop(),p+=2;o&&0===u.length&&l(t,e)}else"/"===s[p]&&(u.push(s.substring(c,p+1)),c=-1);return-1!==c&&u.push(s.substr(c)),e.substr(0,e.length-i.length)+u.join("")}return-1!==t.indexOf(":")?pe&&":"===t[1]&&"\\"===t[2]&&t[0].match(/[a-z]/i)?"file:///"+t.replace(/\\/g,"/"):t:void 0}function c(t){if(t.values)return t.values();if("undefined"==typeof Symbol||!Symbol.iterator)throw new Error("Symbol.iterator not supported in this browser");var e={};return e[Symbol.iterator]=function(){var e=Object.keys(t),n=0;return{next:function(){return n<e.length?{value:t[e[n++]],done:!1}:{value:void 0,done:!0}}}},e}function p(){this.registry=new f}function d(t){if(!(t instanceof m))throw new TypeError("Module instantiation did not return a valid namespace object.");return t}function h(t){if(void 0===t)throw new RangeError("No resolution found.");return t}function f(){this[we]={}}function m(t){Object.defineProperty(this,ke,{value:t}),Object.keys(t).forEach(g,this)}function g(t){Object.defineProperty(this,t,{enumerable:!0,get:function(){return this[ke][t]}})}function v(){p.call(this);var t=this.registry.delete;this.registry.delete=function(n){var r=t.call(this,n);return e.hasOwnProperty(n)&&!e[n].linkRecord&&(delete e[n],r=!0),r};var e={};this[_e]={lastRegister:void 0,records:e},this.trace=!1}function y(t,e,n){return t.records[e]={key:e,registration:n,module:void 0,importerSetters:void 0,loadError:void 0,evalError:void 0,linkRecord:{instantiatePromise:void 0,dependencies:void 0,execute:void 0,executingRequire:!1,moduleObj:void 0,setters:void 0,depsInstantiatePromise:void 0,dependencyInstantiations:void 0}}}function b(t,e,n,r,a){var i=r[e];if(i)return Promise.resolve(i);var o=a.records[e];return o&&!o.module?o.loadError?Promise.reject(o.loadError):S(t,o,o.linkRecord,r,a):t.resolve(e,n).then(function(e){if(i=r[e])return i;if((o=a.records[e])&&!o.module||(o=y(a,e,o&&o.registration)),o.loadError)return Promise.reject(o.loadError);var n=o.linkRecord;return n?S(t,o,n,r,a):o})}function x(t,e,n){return function(){var t=n.lastRegister;return t?(n.lastRegister=void 0,e.registration=t,!0):!!e.registration}}function S(t,e,n,r,a){return n.instantiatePromise||(n.instantiatePromise=(e.registration?Promise.resolve():Promise.resolve().then(function(){return a.lastRegister=void 0,t[Ce](e.key,t[Ce].length>1&&x(t,e,a))})).then(function(i){if(void 0!==i){if(!(i instanceof m))throw new TypeError("Instantiate did not return a valid Module object.");return delete a.records[e.key],t.trace&&k(t,e,n),r[e.key]=i}var o=e.registration;if(e.registration=void 0,!o)throw new TypeError("Module instantiation did not call an anonymous or correctly named System.register.");return n.dependencies=o[0],e.importerSetters=[],n.moduleObj={},o[2]?(n.moduleObj.default=n.moduleObj.__useDefault={},n.executingRequire=o[1],n.execute=o[2]):_(t,e,n,o[1]),e}).catch(function(t){throw e.linkRecord=void 0,e.loadError=e.loadError||s(t,"Instantiating "+e.key)}))}function w(t,e,n,r,a,i){return t.resolve(e,n).then(function(n){i&&(i[e]=n);var o=a.records[n],s=r[n];if(s&&(!o||o.module&&s!==o.module))return s;if(o&&o.loadError)throw o.loadError;(!o||!s&&o.module)&&(o=y(a,n,o&&o.registration));var l=o.linkRecord;return l?S(t,o,l,r,a):o})}function k(t,e,n){t.loads=t.loads||{},t.loads[e.key]={key:e.key,deps:n.dependencies,dynamicDeps:[],depMap:n.depMap||{}}}function _(t,e,n,r){var a=n.moduleObj,i=e.importerSetters,o=!1,s=r.call(he,function(t,e){if("object"==typeof t){var n=!1;for(var r in t)e=t[r],"__useDefault"===r||r in a&&a[r]===e||(n=!0,a[r]=e);if(!1===n)return e}else{if((o||t in a)&&a[t]===e)return e;a[t]=e}for(var s=0;s<i.length;s++)i[s](a);return e},new M(t,e.key));n.setters=s.setters,n.execute=s.execute,s.exports&&(n.moduleObj=a=s.exports,o=!0)}function C(t,e,n,r,a){if(n.depsInstantiatePromise)return n.depsInstantiatePromise;for(var i=Array(n.dependencies.length),o=0;o<n.dependencies.length;o++)i[o]=w(t,n.dependencies[o],e.key,r,a,t.trace&&n.depMap||(n.depMap={}));var l=Promise.all(i).then(function(t){if(n.dependencyInstantiations=t,n.setters)for(var r=0;r<t.length;r++){var a=n.setters[r];if(a){var i=t[r];if(i instanceof m)a(i);else{if(i.loadError)throw i.loadError;a(i.module||i.linkRecord.moduleObj),i.importerSetters&&i.importerSetters.push(a)}}}return e});return t.trace&&(l=l.then(function(){return k(t,e,n),e})),(l=l.catch(function(t){throw n.depsInstantiatePromise=void 0,s(t,"Loading "+e.key)})).catch(function(){}),n.depsInstantiatePromise=l}function T(t,e,n,r,a){return new Promise(function(n,i){function o(e){var n=e.linkRecord;n&&-1===l.indexOf(e)&&(l.push(e),u++,C(t,e,n,r,a).then(s,i))}function s(t){u--;var e=t.linkRecord;if(e)for(var r=0;r<e.dependencies.length;r++){var a=e.dependencyInstantiations[r];a instanceof m||o(a)}0===u&&n()}var l=[],u=0;o(e)})}function M(t,e){this.loader=t,this.key=this.id=e,this.meta={url:e}}function P(t,e,n,r,a,i){if(e.module)return e.module;if(e.evalError)throw e.evalError;if(i&&-1!==i.indexOf(e))return e.linkRecord.moduleObj;var o=E(t,e,n,r,a,n.setters?[]:i||[]);if(o)throw o;return e.module}function O(t,e,n,r,a,i,o){return function(s){for(var l=0;l<n.length;l++)if(n[l]===s){var u,c=r[l];return u=c instanceof m?c:P(t,c,c.linkRecord,a,i,o),"__useDefault"in u?u.__useDefault:u}throw new Error("Module "+s+" not declared as a System.registerDynamic dependency of "+e)}}function E(t,e,n,r,a,i){i.push(e);var o;if(n.setters)for(var l,u,c=0;c<n.dependencies.length;c++)if(!((l=n.dependencyInstantiations[c])instanceof m)&&((u=l.linkRecord)&&-1===i.indexOf(l)&&(o=l.evalError?l.evalError:E(t,l,u,r,a,u.setters?i:[])),o))return e.linkRecord=void 0,e.evalError=s(o,"Evaluating "+e.key),e.evalError;if(n.execute)if(n.setters)o=$(n.execute);else{var p={id:e.key},d=n.moduleObj;Object.defineProperty(p,"exports",{configurable:!0,set:function(t){d.default=d.__useDefault=t},get:function(){return d.__useDefault}});var h=O(t,e.key,n.dependencies,n.dependencyInstantiations,r,a,i);if(!n.executingRequire)for(c=0;c<n.dependencies.length;c++)h(n.dependencies[c]);o=A(n.execute,h,d.default,p),p.exports!==d.__useDefault&&(d.default=d.__useDefault=p.exports);var f=d.default;if(f&&f.__esModule)for(var g in f)Object.hasOwnProperty.call(f,g)&&(d[g]=f[g])}if(e.linkRecord=void 0,o)return e.evalError=s(o,"Evaluating "+e.key);if(r[e.key]=e.module=new m(n.moduleObj),!n.setters){if(e.importerSetters)for(c=0;c<e.importerSetters.length;c++)e.importerSetters[c](e.module);e.importerSetters=void 0}}function $(t){try{t.call(Te)}catch(t){return t}}function A(t,e,n,r){try{var a=t.call(he,e,n,r);void 0!==a&&(r.exports=a)}catch(t){return t}}function D(){}function I(t){return t instanceof m?t:new m(t&&t.__esModule?t:{default:t,__useDefault:t})}function F(t){return void 0===Me&&(Me="undefined"!=typeof Symbol&&!!Symbol.toStringTag),t instanceof m||Me&&"[object Module]"==Object.prototype.toString.call(t)}function q(t,e){(e||this.warnings&&"undefined"!=typeof console&&console.warn)&&console.warn(t)}function R(t,e,n){var r=new Uint8Array(e);return 0===r[0]&&97===r[1]&&115===r[2]?WebAssembly.compile(e).then(function(e){var r=[],a=[],i={};return WebAssembly.Module.imports&&WebAssembly.Module.imports(e).forEach(function(t){var e=t.module;a.push(function(t){i[e]=t}),-1===r.indexOf(e)&&r.push(e)}),t.register(r,function(t){return{setters:a,execute:function(){t(new WebAssembly.Instance(e,i).exports)}}}),n(),!0}):Promise.resolve(!1)}function j(t,e){if("."===t[0])throw new Error("Node module "+t+" can't be loaded as it is not a package require.");if(!Pe){var n=this._nodeRequire("module"),r=decodeURI(e.substr(de?8:7));(Pe=new n(r)).paths=n._nodeModulePaths(r)}return Pe.require(t)}function N(t,e){for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function L(t,e){for(var n in e)Object.hasOwnProperty.call(e,n)&&void 0===t[n]&&(t[n]=e[n]);return t}function U(t,e,n){for(var r in e)if(Object.hasOwnProperty.call(e,r)){var a=e[r];void 0===t[r]?t[r]=a:a instanceof Array&&t[r]instanceof Array?t[r]=[].concat(n?a:t[r]).concat(n?t[r]:a):"object"==typeof a&&null!==a&&"object"==typeof t[r]?t[r]=(n?L:N)(N({},t[r]),a):n||(t[r]=a)}}function V(t){if(Ie||Fe){var e=document.createElement("link");Ie?(e.rel="preload",e.as="script"):e.rel="prefetch",e.href=t,document.head.appendChild(e)}else(new Image).src=t}function B(t,e,n){try{importScripts(t)}catch(t){n(t)}e()}function z(t,e,n,r,a){function i(){r(),s()}function o(e){s(),a(new Error("Fetching "+t))}function s(){for(var t=0;t<qe.length;t++)if(qe[t].err===o){qe.splice(t,1);break}l.removeEventListener("load",i,!1),l.removeEventListener("error",o,!1),document.head.removeChild(l)}if(t=t.replace(/#/g,"%23"),De)return B(t,r,a);var l=document.createElement("script");l.type="text/javascript",l.charset="utf-8",l.async=!0,e&&(l.crossOrigin=e),n&&(l.integrity=n),l.addEventListener("load",i,!1),l.addEventListener("error",o,!1),l.src=t,document.head.appendChild(l)}function Q(t,e){for(var n=t.split(".");n.length;)e=e[n.shift()];return e}function H(t,e,n){var r=W(e,n);if(r){var a=e[r]+n.substr(r.length),i=u(a,ue);return void 0!==i?i:t+a}return-1!==n.indexOf(":")?n:t+n}function Y(t){var e=this.name;if(e.substr(0,t.length)===t&&(e.length===t.length||"/"===e[t.length]||"/"===t[t.length-1]||":"===t[t.length-1])){var n=t.split("/").length;n>this.len&&(this.match=t,this.len=n)}}function W(t,e){if(Object.hasOwnProperty.call(t,e))return e;var n={name:e,match:void 0,len:0};return Object.keys(t).forEach(Y,n),n.match}function G(t,e,n,r){if("file:///"===t.substr(0,8)){if(Ue)return K(t,e,n,r);throw new Error("Unable to fetch file URLs in this environment.")}t=t.replace(/#/g,"%23");var a={headers:{Accept:"application/x-es-module, */*"}};return n&&(a.integrity=n),e&&("string"==typeof e&&(a.headers.Authorization=e),a.credentials="include"),fetch(t,a).then(function(t){if(t.ok)return r?t.arrayBuffer():t.text();throw new Error("Fetch error: "+t.status+" "+t.statusText)})}function K(t,e,n,r){return new Promise(function(n,a){function i(){n(r?s.response:s.responseText)}function o(){a(new Error("XHR error: "+(s.status?" ("+s.status+(s.statusText?" "+s.statusText:"")+")":"")+" loading "+t))}t=t.replace(/#/g,"%23");var s=new XMLHttpRequest;r&&(s.responseType="arraybuffer"),s.onreadystatechange=function(){4===s.readyState&&(0==s.status?s.response?i():(s.addEventListener("error",o),s.addEventListener("load",i)):200===s.status?i():o())},s.open("GET",t,!0),s.setRequestHeader&&(s.setRequestHeader("Accept","application/x-es-module, */*"),e&&("string"==typeof e&&s.setRequestHeader("Authorization",e),s.withCredentials=!0)),s.send(null)})}function J(t,e,r,a){return"file:///"!=t.substr(0,8)?Promise.reject(new Error('Unable to fetch "'+t+'". Only file URLs of the form file:/// supported running in Node.')):(je=je||n(1533),t=de?t.replace(/\//g,"\\").substr(8):t.substr(7),new Promise(function(e,n){je.readFile(t,function(t,r){if(t)return n(t);if(a)e(r);else{var i=r+"";"\ufeff"===i[0]&&(i=i.substr(1)),e(i)}})}))}function X(){throw new Error("No fetch method is defined for this environment.")}function Z(){return{pluginKey:void 0,pluginArgument:void 0,pluginModule:void 0,packageKey:void 0,packageConfig:void 0,load:void 0}}function tt(t,e,n){var r=Z();if(n){var a;e.pluginFirst?-1!==(a=n.lastIndexOf("!"))&&(r.pluginArgument=r.pluginKey=n.substr(0,a)):-1!==(a=n.indexOf("!"))&&(r.pluginArgument=r.pluginKey=n.substr(a+1)),r.packageKey=W(e.packages,n),r.packageKey&&(r.packageConfig=e.packages[r.packageKey])}return r}function et(t,e){var n=this[$e],r=Z(),a=tt(this,n,e),i=this;return Promise.resolve().then(function(){var n=t.lastIndexOf("#?");if(-1===n)return Promise.resolve(t);var r=St.call(i,t.substr(n+2));return wt.call(i,r,e,!0).then(function(e){return e?t.substr(0,n):"@empty"})}).then(function(t){var o=ut(n.pluginFirst,t);return o?(r.pluginKey=o.plugin,Promise.all([ot.call(i,n,o.argument,a&&a.pluginArgument||e,r,a,!0),i.resolve(o.plugin,e)]).then(function(t){if(r.pluginArgument=t[0],r.pluginKey=t[1],r.pluginArgument===r.pluginKey)throw new Error("Plugin "+r.pluginArgument+" cannot load itself, make sure it is excluded from any wildcard meta configuration via a custom loader: false rule.");return ct(n.pluginFirst,t[0],t[1])})):ot.call(i,n,t,a&&a.pluginArgument||e,r,a,!1)}).then(function(t){return kt.call(i,t,e,a)}).then(function(t){return lt.call(i,n,t,r),r.pluginKey||!r.load.loader?t:i.resolve(r.load.loader,t).then(function(e){return r.pluginKey=e,r.pluginArgument=t,t})}).then(function(t){return i[Ae][t]=r,t})}function nt(t,e){var n=ut(t.pluginFirst,e);if(n){var r=nt.call(this,t,n.plugin);return ct(t.pluginFirst,at.call(this,t,n.argument,void 0,!1,!1),r)}return at.call(this,t,e,void 0,!1,!1)}function rt(t,e){var n=this[$e],r=Z(),a=a||tt(this,n,e),i=ut(n.pluginFirst,t);return i?(r.pluginKey=rt.call(this,i.plugin,e),ct(n.pluginFirst,it.call(this,n,i.argument,a.pluginArgument||e,r,a,!!r.pluginKey),r.pluginKey)):it.call(this,n,t,a.pluginArgument||e,r,a,!!r.pluginKey)}function at(t,e,n,r,a){var i=u(e,n||ue);if(i)return H(t.baseURL,t.paths,i);if(r){var o=W(t.map,e);if(o&&(e=t.map[o]+e.substr(o.length),i=u(e,ue)))return H(t.baseURL,t.paths,i)}if(this.registry.has(e))return e;if("@node/"===e.substr(0,6))return e;var s=a&&"/"!==e[e.length-1],l=H(t.baseURL,t.paths,s?e+"/":e);return s?l.substr(0,l.length-1):l}function it(t,e,n,r,a,i){if(a&&a.packageConfig&&"."!==e[0]){var o=a.packageConfig.map,s=o&&W(o,e);if(s&&"string"==typeof o[s]){var l=ft(this,t,a.packageConfig,a.packageKey,s,e,r,i);if(l)return l}}var u=at.call(this,t,e,n,!0,!0),c=yt(t,u);if(r.packageKey=c&&c.packageKey||W(t.packages,u),!r.packageKey)return u;if(-1!==t.packageConfigKeys.indexOf(u))return r.packageKey=void 0,u;r.packageConfig=t.packages[r.packageKey]||(t.packages[r.packageKey]=Ot());var p=u.substr(r.packageKey.length+1);return dt(this,t,r.packageConfig,r.packageKey,p,r,i)}function ot(t,e,n,r,a,i){var o=this;return Oe.then(function(){if(a&&a.packageConfig&&"./"!==e.substr(0,2)){var n=a.packageConfig.map,s=n&&W(n,e);if(s)return gt(o,t,a.packageConfig,a.packageKey,s,e,r,i)}return Oe}).then(function(a){if(a)return a;var s=at.call(o,t,e,n,!0,!0),l=yt(t,s);return r.packageKey=l&&l.packageKey||W(t.packages,s),r.packageKey?-1!==t.packageConfigKeys.indexOf(s)?(r.packageKey=void 0,r.load=st(),r.load.format="json",r.load.loader="",Promise.resolve(s)):(r.packageConfig=t.packages[r.packageKey]||(t.packages[r.packageKey]=Ot()),(l&&!r.packageConfig.configured?bt(o,t,l.configPath,r):Oe).then(function(){var e=s.substr(r.packageKey.length+1);return mt(o,t,r.packageConfig,r.packageKey,e,r,i)})):Promise.resolve(s)})}function st(){return{extension:"",deps:void 0,format:void 0,loader:void 0,scriptLoad:void 0,globals:void 0,nonce:void 0,integrity:void 0,sourceMap:void 0,exports:void 0,encapsulateGlobal:!1,crossOrigin:void 0,cjsRequireDetection:!0,cjsDeferDepsExecute:!1,esModule:!1}}function lt(t,e,n){n.load=n.load||st();var r,a=0;for(var i in t.meta)if(-1!==(r=i.indexOf("*"))&&i.substr(0,r)===e.substr(0,r)&&i.substr(r+1)===e.substr(e.length-i.length+r+1)){var o=i.split("/").length;o>a&&(a=o),U(n.load,t.meta[i],a!==o)}if(t.meta[e]&&U(n.load,t.meta[e],!1),n.packageKey){var s=e.substr(n.packageKey.length+1),l={};n.packageConfig.meta&&(a=0,xt(n.packageConfig.meta,s,function(t,e,n){n>a&&(a=n),U(l,e,n&&a>n)}),U(n.load,l,!1)),!n.packageConfig.format||n.pluginKey||n.load.loader||(n.load.format=n.load.format||n.packageConfig.format)}}function ut(t,e){var n,r,a=t?e.indexOf("!"):e.lastIndexOf("!");if(-1!==a)return t?(n=e.substr(a+1),r=e.substr(0,a)):(n=e.substr(0,a),r=e.substr(a+1)||n.substr(n.lastIndexOf(".")+1)),{argument:n,plugin:r}}function ct(t,e,n){return t?n+"!"+e:e+"!"+n}function pt(t,e,n,r,a){if(!r||!e.defaultExtension||"/"===r[r.length-1]||a)return r;var i=!1;if(e.meta&&xt(e.meta,r,function(t,e,n){if(0===n||t.lastIndexOf("*")!==t.length-1)return i=!0}),!i&&t.meta&&xt(t.meta,n+"/"+r,function(t,e,n){if(0===n||t.lastIndexOf("*")!==t.length-1)return i=!0}),i)return r;var o="."+e.defaultExtension;return r.substr(r.length-o.length)!==o?r+o:r}function dt(t,e,n,r,a,i,o){if(!a){if(!n.main)return r;a="./"===n.main.substr(0,2)?n.main.substr(2):n.main}if(n.map){var s="./"+a,l=W(n.map,s);if(l||(s="./"+pt(e,n,r,a,o))!="./"+a&&(l=W(n.map,s)),l){var u=ft(t,e,n,r,l,s,i,o);if(u)return u}}return r+"/"+pt(e,n,r,a,o)}function ht(t,e,n){return!(e.substr(0,t.length)===t&&n.length>t.length)}function ft(t,e,n,r,a,i,o,s){"/"===i[i.length-1]&&(i=i.substr(0,i.length-1));var l=n.map[a];if("object"==typeof l)throw new Error("Synchronous conditional normalization not supported sync normalizing "+a+" in "+r);if(ht(a,l,i)&&"string"==typeof l)return it.call(t,e,l+i.substr(a.length),r+"/",o,o,s)}function mt(t,e,n,r,a,i,o){if(!a){if(!n.main)return Promise.resolve(r);a="./"===n.main.substr(0,2)?n.main.substr(2):n.main}var s,l;return n.map&&(s="./"+a,(l=W(n.map,s))||(s="./"+pt(e,n,r,a,o))!="./"+a&&(l=W(n.map,s))),(l?gt(t,e,n,r,l,s,i,o):Oe).then(function(t){return t?Promise.resolve(t):Promise.resolve(r+"/"+pt(e,n,r,a,o))})}function gt(t,e,n,r,a,i,o,s){"/"===i[i.length-1]&&(i=i.substr(0,i.length-1));var l=n.map[a];if("string"==typeof l)return ht(a,l,i)?ot.call(t,e,l+i.substr(a.length),r+"/",o,o,s).then(function(e){return kt.call(t,e,r+"/",o)}):Oe;var u=[],c=[];for(var p in l){var d=St(p);c.push({condition:d,map:l[p]}),u.push(v.prototype.import.call(t,d.module,r))}return Promise.all(u).then(function(t){for(var e=0;e<c.length;e++){var n=c[e].condition,r=Q(n.prop,"__useDefault"in t[e]?t[e].__useDefault:t[e]);if(!n.negate&&r||n.negate&&!r)return c[e].map}}).then(function(n){if(n)return ht(a,n,i)?ot.call(t,e,n+i.substr(a.length),r+"/",o,o,s).then(function(e){return kt.call(t,e,r+"/",o)}):Oe})}function vt(t){var e=t.lastIndexOf("*"),n=Math.max(e+1,t.lastIndexOf("/"));return{length:n,regEx:new RegExp("^("+t.substr(0,n).replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,"[^\\/]+")+")(\\/|$)"),wildcard:-1!==e}}function yt(t,e){for(var n,r,a=!1,i=0;i<t.packageConfigPaths.length;i++){var o=t.packageConfigPaths[i],s=Be[o]||(Be[o]=vt(o));if(!(e.length<s.length)){var l=e.match(s.regEx);!l||n&&(a&&s.wildcard||!(n.length<l[1].length))||(n=l[1],a=!s.wildcard,r=n+o.substr(s.length))}}if(n)return{packageKey:n,configPath:r}}function bt(t,e,n,r,a){var i=t.pluginLoader||t;return-1===e.packageConfigKeys.indexOf(n)&&e.packageConfigKeys.push(n),i.import(n).then(function(t){Et(r.packageConfig,t,r.packageKey,!0,e),r.packageConfig.configured=!0}).catch(function(t){throw s(t,"Unable to fetch package configuration file "+n)})}function xt(t,e,n){var r;for(var a in t){var i="./"===a.substr(0,2)?"./":"";if(i&&(a=a.substr(2)),-1!==(r=a.indexOf("*"))&&a.substr(0,r)===e.substr(0,r)&&a.substr(r+1)===e.substr(e.length-a.length+r+1)&&n(a,t[i+a],a.split("/").length))return}var o=t[e]&&Object.hasOwnProperty.call(t,e)?t[e]:t["./"+e];o&&n(o,o,0)}function St(t){var e,n,r,a=t.lastIndexOf("|");return-1!==a?(e=t.substr(a+1),n=t.substr(0,a),"~"===e[0]&&(r=!0,e=e.substr(1))):(r="~"===t[0],e="default",n=t.substr(r),-1!==ze.indexOf(n)&&(e=n,n=null)),{module:n||"@system-env",prop:e,negate:r}}function wt(t,e,n){return v.prototype.import.call(this,t.module,e).then(function(e){var r=Q(t.prop,e);if(n&&"boolean"!=typeof r)throw new TypeError("Condition did not resolve to a boolean.");return t.negate?!r:r})}function kt(t,e,n){var r=t.match(Qe);if(!r)return Promise.resolve(t);var a=St.call(this,r[0].substr(2,r[0].length-3));return wt.call(this,a,e,!1).then(function(n){if("string"!=typeof n)throw new TypeError("The condition value for "+t+" doesn't resolve to a string.");if(-1!==n.indexOf("/"))throw new TypeError("Unabled to interpolate conditional "+t+(e?" in "+e:"")+"\n\tThe condition value "+n+' cannot contain a "/" separator.');return t.replace(Qe,n)})}function _t(t,e,n){for(var r=0;r<He.length;r++){var a=He[r];e[a]&&En[a.substr(0,a.length-6)]&&n(e[a])}}function Ct(t,e){var n={};for(var r in t){var a=t[r];e>1?a instanceof Array?n[r]=[].concat(a):"object"==typeof a?n[r]=Ct(a,e-1):"packageConfig"!==r&&(n[r]=a):n[r]=a}return n}function Tt(t,e){var n=t[e];return n instanceof Array?t[e].concat([]):"object"==typeof n?Ct(n,3):t[e]}function Mt(t){if(t){if(-1!==$n.indexOf(t))return Tt(this[$e],t);throw new Error('"'+t+'" is not a valid configuration name. Must be one of '+$n.join(", ")+".")}for(var e={},n=0;n<$n.length;n++){var r=$n[n],a=Tt(this[$e],r);void 0!==a&&(e[r]=a)}return e}function Pt(t,e){var n=this,r=this[$e];if("warnings"in t&&(r.warnings=t.warnings),"wasm"in t&&(r.wasm="undefined"!=typeof WebAssembly&&t.wasm),("production"in t||"build"in t)&&se.call(n,!!t.production,!!(t.build||En&&En.build)),!e){var a;_t(n,t,function(t){a=a||t.baseURL}),(a=a||t.baseURL)&&(r.baseURL=u(a,ue)||u("./"+a,ue),"/"!==r.baseURL[r.baseURL.length-1]&&(r.baseURL+="/")),t.paths&&N(r.paths,t.paths),_t(n,t,function(t){t.paths&&N(r.paths,t.paths)});for(var i in r.paths)-1!==r.paths[i].indexOf("*")&&(q.call(r,"Path config "+i+" -> "+r.paths[i]+" is no longer supported as wildcards are deprecated."),delete r.paths[i])}if(t.defaultJSExtensions&&q.call(r,"The defaultJSExtensions configuration option is deprecated.\n  Use packages defaultExtension instead.",!0),"boolean"==typeof t.pluginFirst&&(r.pluginFirst=t.pluginFirst),t.map)for(var i in t.map){var o=t.map[i];if("string"==typeof o){var s=at.call(n,r,o,void 0,!1,!1);"/"===s[s.length-1]&&":"!==i[i.length-1]&&"/"!==i[i.length-1]&&(s=s.substr(0,s.length-1)),r.map[i]=s}else{g=(g=at.call(n,r,"/"!==i[i.length-1]?i+"/":i,void 0,!0,!0)).substr(0,g.length-1);var l=r.packages[g];l||((l=r.packages[g]=Ot()).defaultExtension=""),Et(l,{map:o},g,!1,r)}}if(t.packageConfigPaths){for(var c=[],p=0;p<t.packageConfigPaths.length;p++){var d=t.packageConfigPaths[p],h=Math.max(d.lastIndexOf("*")+1,d.lastIndexOf("/")),f=at.call(n,r,d.substr(0,h),void 0,!1,!1);c[p]=f+d.substr(h)}r.packageConfigPaths=c}if(t.bundles)for(var i in t.bundles){for(var m=[],p=0;p<t.bundles[i].length;p++)m.push(n.normalizeSync(t.bundles[i][p]));r.bundles[i]=m}if(t.packages)for(var i in t.packages){if(i.match(/^([^\/]+:)?\/\/$/))throw new TypeError('"'+i+'" is not a valid package name.');var g=at.call(n,r,"/"!==i[i.length-1]?i+"/":i,void 0,!0,!0);g=g.substr(0,g.length-1),Et(r.packages[g]=r.packages[g]||Ot(),t.packages[i],g,!1,r)}if(t.depCache)for(var i in t.depCache)r.depCache[n.normalizeSync(i)]=[].concat(t.depCache[i]);if(t.meta)for(var i in t.meta)if("*"===i[0])N(r.meta[i]=r.meta[i]||{},t.meta[i]);else{var v=at.call(n,r,i,void 0,!0,!0);N(r.meta[v]=r.meta[v]||{},t.meta[i])}"transpiler"in t&&(r.transpiler=t.transpiler);for(var y in t)-1===$n.indexOf(y)&&-1===He.indexOf(y)&&(n[y]=t[y]);_t(n,t,function(t){n.config(t,!0)})}function Ot(){return{defaultExtension:void 0,main:void 0,format:void 0,meta:void 0,map:void 0,packageConfig:void 0,configured:!1}}function Et(t,e,n,r,a){for(var i in e)"main"===i||"format"===i||"defaultExtension"===i||"configured"===i?r&&void 0!==t[i]||(t[i]=e[i]):"map"===i?(r?L:N)(t.map=t.map||{},e.map):"meta"===i?(r?L:N)(t.meta=t.meta||{},e.meta):Object.hasOwnProperty.call(e,i)&&q.call(a,'"'+i+'" is not a valid package configuration option in package '+n);return void 0===t.defaultExtension&&(t.defaultExtension="js"),void 0===t.main&&t.map&&t.map["."]?(t.main=t.map["."],delete t.map["."]):"object"==typeof t.main&&(t.map=t.map||{},t.map["./@main"]=t.main,t.main.default=t.main.default||"./",t.main="@main"),t}function $t(t){return Ye?Xe+new e(t).toString("base64"):"undefined"!=typeof btoa?Xe+btoa(unescape(encodeURIComponent(t))):""}function At(t,e,n,r){var a=t.lastIndexOf("\n");if(e){if("object"!=typeof e)throw new TypeError("load.metadata.sourceMap must be set to an object.");e=JSON.stringify(e)}return(r?"(function(System, SystemJS) {":"")+t+(r?"\n})(System, System);":"")+("\n//# sourceURL="!=t.substr(a,15)?"\n//# sourceURL="+n+(e?"!transpiled":""):"")+(e&&$t(e)||"")}function Dt(t,e,n,r,a){We||(We=document.head||document.body||document.documentElement);var i=document.createElement("script");i.text=At(e,n,r,!1);var o,s=window.onerror;if(window.onerror=function(t){o=addToError(t,"Evaluating "+r),s&&s.apply(this,arguments)},It(t),a&&i.setAttribute("nonce",a),We.appendChild(i),We.removeChild(i),Ft(),window.onerror=s,o)return o}function It(t){0==Ze++&&(Je=he.System),he.System=he.SystemJS=t}function Ft(){0==--Ze&&(he.System=he.SystemJS=Je)}function qt(t,e,n,r,a,i,o){if(e){if(i&&tn)return Dt(t,e,n,r,i);try{It(t),!Ge&&t._nodeRequire&&(Ge=t._nodeRequire("vm"),Ke=Ge.runInThisContext("typeof System !== 'undefined' && System")===t),Ke?Ge.runInThisContext(At(e,n,r,!o),{filename:r+(n?"!transpiled":"")}):(0,eval)(At(e,n,r,!o)),Ft()}catch(t){return Ft(),t}}}function Rt(t){return"file:///"===t.substr(0,8)?t.substr(7+!!de):en&&t.substr(0,en.length)===en?t.substr(en.length):t}function jt(t,e){return Rt(this.normalizeSync(t,e))}function Nt(t){var e,n=t.lastIndexOf("!"),r=(e=-1!==n?t.substr(0,n):t).split("/");return r.pop(),r=r.join("/"),{filename:Rt(e),dirname:Rt(r)}}function Lt(t){function e(t,e){for(var n=0;n<t.length;n++)if(t[n][0]<e.index&&t[n][1]>e.index)return!0;return!1}Le.lastIndex=ln.lastIndex=un.lastIndex=0;var n,r=[],a=[],i=[];if(t.length/t.split("\n").length<200){for(;n=un.exec(t);)a.push([n.index,n.index+n[0].length]);for(;n=ln.exec(t);)e(a,n)||i.push([n.index+n[1].length,n.index+n[0].length-1])}for(;n=Le.exec(t);)if(!e(a,n)&&!e(i,n)){var o=n[1].substr(1,n[1].length-2);if(o.match(/"|'/))continue;r.push(o)}return r}function Ut(t){if(-1===cn.indexOf(t)){try{var e=he[t]}catch(e){cn.push(t)}this(t,e)}}function Vt(t){if("string"==typeof t)return Q(t,he);if(!(t instanceof Array))throw new Error("Global exports must be a string or array.");for(var e={},n=0;n<t.length;n++)e[t[n].split(".").pop()]=Q(t[n],he);return e}function Bt(t,e,n,r){var a=he.define;he.define=void 0;var i;if(n){i={};for(var o in n)i[o]=he[o],he[o]=n[o]}return e||(rn={},Object.keys(he).forEach(Ut,function(t,e){rn[t]=e})),function(){var t,n=e?Vt(e):{},o=!!e;if(e&&!r||Object.keys(he).forEach(Ut,function(a,i){rn[a]!==i&&void 0!==i&&(r&&(he[a]=void 0),e||(n[a]=i,void 0!==t?o||t===i||(o=!0):t=i))}),n=o?n:t,i)for(var s in i)he[s]=i[s];return he.define=a,n}}function zt(t,e){var n=((t=t.replace(ln,"")).match(hn)[1].split(",")[e]||"require").replace(fn,""),r=mn[n]||(mn[n]=new RegExp(pn+n+dn,"g"));r.lastIndex=0;for(var a,i=[];a=r.exec(t);)i.push(a[2]||a[3]);return i}function Qt(t){return function(e,n,r){t(e,n,r),"object"!=typeof(n=r.exports)&&"function"!=typeof n||"__esModule"in n||Object.defineProperty(r.exports,"__esModule",{value:!0})}}function Ht(t,e){on=t,vn=e,an=void 0,gn=!1}function Yt(t){an?t.registerDynamic(on?an[0].concat(on):an[0],!1,vn?Qt(an[1]):an[1]):gn&&t.registerDynamic([],!1,D)}function Wt(t,e){!t.load.esModule||"object"!=typeof e&&"function"!=typeof e||"__esModule"in e||Object.defineProperty(e,"__esModule",{value:!0})}function Gt(t,e){var n=this,r=this[$e];return(Jt(r,this,t)||Oe).then(function(){if(!e()){var a=n[Ae][t];if("@node/"===t.substr(0,6)){if(!n._nodeRequire)throw new TypeError("Error loading "+t+". Can only load node core modules in Node.");return n.registerDynamic([],!1,function(){return j.call(n,t.substr(6),n.baseURL)}),void e()}return a.load.scriptLoad?!a.load.pluginKey&&yn||(a.load.scriptLoad=!1,q.call(r,'scriptLoad not supported for "'+t+'"')):!1!==a.load.scriptLoad&&!a.load.pluginKey&&yn&&(a.load.deps||a.load.globals||!("system"===a.load.format||"register"===a.load.format||"global"===a.load.format&&a.load.exports)||(a.load.scriptLoad=!0)),a.load.scriptLoad?new Promise(function(r,i){if("amd"===a.load.format&&he.define!==n.amdDefine)throw new Error("Loading AMD with scriptLoad requires setting the global `"+xn+".define = SystemJS.amdDefine`");z(t,a.load.crossOrigin,a.load.integrity,function(){if(!e()){a.load.format="global";var t=a.load.exports&&Vt(a.load.exports);n.registerDynamic([],!1,function(){return Wt(a,t),t}),e()}r()},i)}):Kt(n,t,a).then(function(){return Xt(n,t,a,e,r.wasm)})}}).then(function(e){return delete n[Ae][t],e})}function Kt(t,e,n){return n.pluginKey?t.import(n.pluginKey).then(function(t){n.pluginModule=t,n.pluginLoad={name:e,address:n.pluginArgument,source:void 0,metadata:n.load},n.load.deps=n.load.deps||[]}):Oe}function Jt(t,e,n){var r=t.depCache[n];if(r)for(o=0;o<r.length;o++)e.normalize(r[o],n).then(V);else{var a=!1;for(var i in t.bundles){for(var o=0;o<t.bundles[i].length;o++){var s=t.bundles[i][o];if(s===n){a=!0;break}if(-1!==s.indexOf("*")){var l=s.split("*");if(2!==l.length){t.bundles[i].splice(o--,1);continue}if(n.substr(0,l[0].length)===l[0]&&n.substr(n.length-l[1].length,l[1].length)===l[1]){a=!0;break}}}if(a)return e.import(i)}}}function Xt(t,e,n,r,a){return n.load.exports&&!n.load.format&&(n.load.format="global"),Oe.then(function(){if(n.pluginModule&&n.pluginModule.locate)return Promise.resolve(n.pluginModule.locate.call(t,n.pluginLoad)).then(function(t){t&&(n.pluginLoad.address=t)})}).then(function(){return n.pluginModule?(a=!1,n.pluginModule.fetch?n.pluginModule.fetch.call(t,n.pluginLoad,function(t){return Ve(t.address,n.load.authorization,n.load.integrity,!1)}):Ve(n.pluginLoad.address,n.load.authorization,n.load.integrity,!1)):Ve(e,n.load.authorization,n.load.integrity,a)}).then(function(i){return a&&"string"!=typeof i?R(t,i,r).then(function(a){if(!a){var o=ce?new TextDecoder("utf-8").decode(new Uint8Array(i)):i.toString();return Zt(t,e,o,n,r)}}):Zt(t,e,i,n,r)})}function Zt(t,e,n,r,a){return Promise.resolve(n).then(function(e){return"detect"===r.load.format&&(r.load.format=void 0),ie(e,r),r.pluginModule?(r.pluginLoad.source=e,r.pluginModule.translate?Promise.resolve(r.pluginModule.translate.call(t,r.pluginLoad,r.traceOpts)).then(function(t){if(r.load.sourceMap){if("object"!=typeof r.load.sourceMap)throw new Error("metadata.load.sourceMap must be set to an object.");ne(r.pluginLoad.address,r.load.sourceMap)}return"string"==typeof t?t:r.pluginLoad.source}):e):e}).then(function(n){return r.load.format||'"bundle"'!==n.substring(0,8)?"register"===r.load.format||!r.load.format&&te(n)?(r.load.format="register",n):"esm"===r.load.format||!r.load.format&&n.match(Sn)?(r.load.format="esm",re(t,n,e,r,a)):n:(r.load.format="system",n)}).then(function(e){if("string"!=typeof e||!r.pluginModule||!r.pluginModule.instantiate)return e;var n=!1;return r.pluginLoad.source=e,Promise.resolve(r.pluginModule.instantiate.call(t,r.pluginLoad,function(t){if(e=t.source,r.load=t.metadata,n)throw new Error("Instantiate must only be called once.");n=!0})).then(function(t){return n?e:I(t)})}).then(function(n){if("string"!=typeof n)return n;r.load.format||(r.load.format=ee(n));var i=!1;switch(r.load.format){case"esm":case"register":case"system":if(l=qt(t,n,r.load.sourceMap,e,r.load.integrity,r.load.nonce,!1))throw l;if(!a())return Ee;return;case"json":var o=JSON.parse(n);return t.newModule({default:o,__useDefault:o});case"amd":var s=he.define;he.define=t.amdDefine,Ht(r.load.deps,r.load.esModule);var l=qt(t,n,r.load.sourceMap,e,r.load.integrity,r.load.nonce,!1);if((i=a())||(Yt(t),i=a()),he.define=s,l)throw l;break;case"cjs":var u=r.load.deps,c=(r.load.deps||[]).concat(r.load.cjsRequireDetection?Lt(n):[]);for(var p in r.load.globals)r.load.globals[p]&&c.push(r.load.globals[p]);t.registerDynamic(c,!0,function(a,i,o){if(a.resolve=function(e){return jt.call(t,e,o.id)},o.paths=[],o.require=a,!r.load.cjsDeferDepsExecute&&u)for(var s=0;s<u.length;s++)a(u[s]);var l=Nt(o.id),c={exports:i,args:[a,i,o,l.filename,l.dirname,he,he]},p="(function (require, exports, module, __filename, __dirname, global, GLOBAL";if(r.load.globals)for(var d in r.load.globals)c.args.push(a(r.load.globals[d])),p+=", "+d;var h=he.define;he.define=void 0,he.__cjsWrapper=c,n=p+") {"+n.replace(Cn,"")+"\n}).apply(__cjsWrapper.exports, __cjsWrapper.args);";var f=qt(t,n,r.load.sourceMap,e,r.load.integrity,r.load.nonce,!1);if(f)throw f;Wt(r,i),he.__cjsWrapper=void 0,he.define=h}),i=a();break;case"global":c=r.load.deps||[];for(var p in r.load.globals){var d=r.load.globals[p];d&&c.push(d)}t.registerDynamic(c,!1,function(a,i,o){var s;if(r.load.globals){s={};for(var l in r.load.globals)r.load.globals[l]&&(s[l]=a(r.load.globals[l]))}var u=r.load.exports;u&&(n+="\n"+xn+'["'+u+'"] = '+u+";");var c=Bt(o.id,u,s,r.load.encapsulateGlobal),p=qt(t,n,r.load.sourceMap,e,r.load.integrity,r.load.nonce,!0);if(p)throw p;var d=c();return Wt(r,d),d}),i=a();break;default:throw new TypeError('Unknown module format "'+r.load.format+'" for "'+e+'".'+("es6"===r.load.format?' Use "esm" instead here.':""))}if(!i)throw new Error("Module "+e+" detected as "+r.load.format+" but didn't execute correctly.")})}function te(t){var e=t.match(wn);return e&&"System.register"===t.substr(e[0].length,15)}function ee(t){return t.match(kn)?"amd":(_n.lastIndex=0,Le.lastIndex=0,Le.exec(t)||_n.exec(t)?"cjs":"global")}function ne(t,e){var n=t.split("!")[0];e.file&&e.file!=t||(e.file=n+"!transpiled"),(!e.sources||e.sources.length<=1&&(!e.sources[0]||e.sources[0]===t))&&(e.sources=[n])}function re(t,e,n,r,a){if(!t.transpiler)throw new TypeError("Unable to dynamically transpile ES module\n   A loader plugin needs to be configured via `SystemJS.config({ transpiler: 'transpiler-module' })`.");if(r.load.deps){for(var i="",o=0;o<r.load.deps.length;o++)i+='import "'+r.load.deps[o]+'"; ';e=i+e}return t.import.call(t,t.transpiler).then(function(a){if(!(a=a.__useDefault||a).translate)throw new Error(t.transpiler+" is not a valid transpiler plugin.");return a===r.pluginModule?e:("string"==typeof r.load.sourceMap&&(r.load.sourceMap=JSON.parse(r.load.sourceMap)),r.pluginLoad=r.pluginLoad||{name:n,address:n,source:e,metadata:r.load},r.load.deps=r.load.deps||[],Promise.resolve(a.translate.call(t,r.pluginLoad,r.traceOpts)).then(function(t){var e=r.load.sourceMap;return e&&"object"==typeof e&&ne(n,e),"esm"===r.load.format&&te(t)&&(r.load.format="register"),t}))},function(t){throw s(t,"Unable to load transpiler to transpile "+n)})}function ae(t,e,n){for(var r,a=e.split(".");a.length>1;)t=t[r=a.shift()]=t[r]||{};void 0===t[r=a.shift()]&&(t[r]=n)}function ie(t,e){var n=t.match(Tn);if(n)for(var r=n[0].match(Mn),a=0;a<r.length;a++){var i=r[a],o=i.length,s=i.substr(0,1);if(";"==i.substr(o-1,1)&&o--,'"'==s||"'"==s){var l=i.substr(1,i.length-3),u=l.substr(0,l.indexOf(" "));if(u){var c=l.substr(u.length+1,l.length-u.length-1);"deps"===u&&(u="deps[]"),"[]"===u.substr(u.length-2,2)?(u=u.substr(0,u.length-2),e.load[u]=e.load[u]||[],e.load[u].push(c)):"use"!==u&&ae(e.load,u,c)}else e.load[l]=!0}}}function oe(){v.call(this),this._loader={},this[Ae]={},this[$e]={baseURL:ue,paths:{},packageConfigPaths:[],packageConfigKeys:[],map:{},packages:{},depCache:{},meta:{},bundles:{},production:!1,transpiler:void 0,loadedBundles:{},warnings:!1,pluginFirst:!1,wasm:!1},this.scriptSrc=bn,this._nodeRequire=sn,this.registry.set("@empty",Ee),se.call(this,!1,!1),nn(this)}function se(t,e){this[$e].production=t,this.registry.set("@system-env",En=this.newModule({browser:ce,node:!!this._nodeRequire,production:!e&&t,dev:e||!t,build:e,default:!0}))}function le(t,e){q.call(t[$e],"SystemJS."+e+" is deprecated for SystemJS.registry."+e)}var ue,ce="undefined"!=typeof window&&"undefined"!=typeof document,pe=void 0!==r&&r.versions&&r.versions.node,de=void 0!==r&&"string"==typeof r.platform&&r.platform.match(/^win/),he="undefined"!=typeof self?self:a,fe="undefined"!=typeof Symbol;if("undefined"!=typeof document&&document.getElementsByTagName){if(!(ue=document.baseURI)){var me=document.getElementsByTagName("base");ue=me[0]&&me[0].href||window.location.href}}else"undefined"!=typeof location&&(ue=location.href);if(ue){var ge=(ue=ue.split("#")[0].split("?")[0]).lastIndexOf("/");-1!==ge&&(ue=ue.substr(0,ge+1))}else{if(void 0===r||!r.cwd)throw new TypeError("No environment baseURI");ue="file://"+(de?"/":"")+r.cwd(),de&&(ue=ue.replace(/\\/g,"/"))}"/"!==ue[ue.length-1]&&(ue+="/");var ve="_"==new Error(0,"_").fileName,ye=Promise.resolve();p.prototype.constructor=p,p.prototype.import=function(t,e){if("string"!=typeof t)throw new TypeError("Loader import method must be passed a module key string");var n=this;return ye.then(function(){return n[xe](t,e)}).then(d).catch(function(n){throw s(n,"Loading "+t+(e?" from "+e:""))})};var be=p.resolve=o("resolve"),xe=p.resolveInstantiate=o("resolveInstantiate");p.prototype[xe]=function(t,e){var n=this;return n.resolve(t,e).then(function(t){return n.registry.get(t)})},p.prototype.resolve=function(t,e){var n=this;return ye.then(function(){return n[be](t,e)}).then(h).catch(function(n){throw s(n,"Resolving "+t+(e?" to "+e:""))})};var Se="undefined"!=typeof Symbol&&Symbol.iterator,we=o("registry");Se&&(f.prototype[Symbol.iterator]=function(){return this.entries()[Symbol.iterator]()},f.prototype.entries=function(){var t=this[we];return c(Object.keys(t).map(function(e){return[e,t[e]]}))}),f.prototype.keys=function(){return c(Object.keys(this[we]))},f.prototype.values=function(){var t=this[we];return c(Object.keys(t).map(function(e){return t[e]}))},f.prototype.get=function(t){return this[we][t]},f.prototype.set=function(t,e){if(!(e instanceof m))throw new Error("Registry must be set with an instance of Module Namespace");return this[we][t]=e,this},f.prototype.has=function(t){return Object.hasOwnProperty.call(this[we],t)},f.prototype.delete=function(t){return!!Object.hasOwnProperty.call(this[we],t)&&(delete this[we][t],!0)};var ke=o("baseObject");m.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(m.prototype,Symbol.toStringTag,{value:"Module"});var _e=o("register-internal");v.prototype=Object.create(p.prototype),v.prototype.constructor=v;var Ce=v.instantiate=o("instantiate");v.prototype[v.resolve=p.resolve]=function(t,e){return u(t,e||ue)},v.prototype[Ce]=function(t,e){},v.prototype[p.resolveInstantiate]=function(t,e){var n=this,r=this[_e],a=this.registry[we];return b(n,t,e,a,r).then(function(t){if(t instanceof m)return t;var e=t.linkRecord;if(!e){if(t.module)return t.module;throw t.evalError}return T(n,t,e,a,r).then(function(){return P(n,t,e,a,r,void 0)})})},v.prototype.register=function(t,e,n){var r=this[_e];void 0===n?r.lastRegister=[t,e,void 0]:(r.records[t]||y(r,t,void 0)).registration=[e,n,void 0]},v.prototype.registerDynamic=function(t,e,n,r){var a=this[_e];"string"!=typeof t?a.lastRegister=[t,e,n]:(a.records[t]||y(a,t,void 0)).registration=[e,n,r]},M.prototype.import=function(t){return this.loader.trace&&this.loader.loads[this.key].dynamicDeps.push(t),this.loader.import(t,this.key)};var Te={};Object.freeze&&Object.freeze(Te);var Me,Pe,Oe=Promise.resolve(),Ee=new m({}),$e=o("loader-config"),Ae=o("metadata"),De="undefined"==typeof window&&"undefined"!=typeof self&&"undefined"!=typeof importScripts,Ie=!1,Fe=!1;if(ce&&function(){var t=document.createElement("link").relList;if(t&&t.supports){Fe=!0;try{Ie=t.supports("preload")}catch(t){}}}(),ce){var qe=[],Re=window.onerror;window.onerror=function(t,e){for(var n=0;n<qe.length;n++)if(qe[n].src===e)return void qe[n].err(t);Re&&Re.apply(this,arguments)}}var je,Ne,Le=/(?:^\uFEFF?|[^$_a-zA-Z\xA0-\uFFFF."'])require\s*\(\s*("[^"\\]*(?:\\.[^"\\]*)*"|'[^'\\]*(?:\\.[^'\\]*)*'|`[^`\\]*(?:\\.[^`\\]*)*`)\s*\)/g,Ue="undefined"!=typeof XMLHttpRequest,Ve=Ne="undefined"!=typeof self&&void 0!==self.fetch?G:Ue?K:void 0!==r?J:X,Be={},ze=["browser","node","dev","build","production","default"],Qe=/#\{[^\}]+\}/,He=["browserConfig","nodeConfig","devConfig","buildConfig","productionConfig"],Ye=void 0!==e;try{Ye&&"YQ=="!==new e("a").toString("base64")&&(Ye=!1)}catch(o){Ye=!1}var We,Ge,Ke,Je,Xe="\n//# sourceMappingURL=data:application/json;base64,",Ze=0,tn=!1;ce&&"undefined"!=typeof document&&document.getElementsByTagName&&(window.chrome&&window.chrome.extension||navigator.userAgent.match(/^Node\.js/)||(tn=!0));var en,nn=function(t){function e(n,r,a,i){if("object"==typeof n&&!(n instanceof Array))return e.apply(null,Array.prototype.splice.call(arguments,1,arguments.length-1));if("string"==typeof n&&"function"==typeof r&&(n=[n]),!(n instanceof Array)){if("string"==typeof n){var o=t.decanonicalize(n,i),s=t.get(o);if(!s)throw new Error('Module not already loaded loading "'+n+'" as '+o+(i?' from "'+i+'".':"."));return"__useDefault"in s?s.__useDefault:s}throw new TypeError("Invalid require")}for(var l=[],u=0;u<n.length;u++)l.push(t.import(n[u],i));Promise.all(l).then(function(t){r&&r.apply(null,t)},a)}function n(n,r,a){function i(n,i,u){for(var c=[],p=0;p<r.length;p++)c.push(n(r[p]));if(u.uri=u.id,u.config=D,-1!==l&&c.splice(l,0,u),-1!==s&&c.splice(s,0,i),-1!==o){var d=function(r,a,i){return"string"==typeof r&&"function"!=typeof a?n(r):e.call(t,r,a,i,u.id)};d.toUrl=function(e){return t.normalizeSync(e,u.id)},c.splice(o,0,d)}var h=he.require;he.require=e;var f=a.apply(-1===s?he:i,c);he.require=h,void 0!==f&&(u.exports=f)}"string"!=typeof n&&(a=r,r=n,n=null),r instanceof Array||(a=r,r=["require","exports","module"].splice(0,a.length)),"function"!=typeof a&&(a=function(t){return function(){return t}}(a)),n||on&&(r=r.concat(on),on=void 0);var o,s,l;-1!==(o=r.indexOf("require"))&&(r.splice(o,1),n||(r=r.concat(zt(a.toString(),o)))),-1!==(s=r.indexOf("exports"))&&r.splice(s,1),-1!==(l=r.indexOf("module"))&&r.splice(l,1),n?(t.registerDynamic(n,r,!1,i),an?(an=void 0,gn=!0):gn||(an=[r,i])):t.registerDynamic(r,!1,vn?Qt(i):i)}t.set("@@cjs-helpers",t.newModule({requireResolve:jt.bind(t),getPathVars:Nt})),t.set("@@global-helpers",t.newModule({prepareGlobal:Bt})),n.amd={},t.amdDefine=n,t.amdRequire=e};"undefined"!=typeof window&&"undefined"!=typeof document&&window.location&&(en=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""));var rn,an,on,sn,ln=/(^|[^\\])(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,un=/("[^"\\\n\r]*(\\.[^"\\\n\r]*)*"|'[^'\\\n\r]*(\\.[^'\\\n\r]*)*')/g,cn=["_g","sessionStorage","localStorage","clipboardData","frames","frameElement","external","mozAnimationStartTime","webkitStorageInfo","webkitIndexedDB","mozInnerScreenY","mozInnerScreenX"],pn="(?:^|[^$_a-zA-Z\\xA0-\\uFFFF.])",dn="\\s*\\(\\s*(\"([^\"]+)\"|'([^']+)')\\s*\\)",hn=/\(([^\)]*)\)/,fn=/^\s+|\s+$/g,mn={},gn=!1,vn=!1,yn=(ce||De)&&"undefined"!=typeof navigator&&navigator.userAgent&&!navigator.userAgent.match(/MSIE (9|10).0/);void 0===r||r.browser||(sn=void 0);var bn,xn="undefined"!=typeof self?"self":"global",Sn=/(^\s*|[}\);\n]\s*)(import\s*(['"]|(\*\s+as\s+)?(?!type)([^"'\(\)\n; ]+)\s*from\s*['"]|\{)|export\s+\*\s+from\s+["']|export\s*(\{|default|function|class|var|const|let|async\s+function))/,wn=/^(\s*\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*|\s*"[^"]+"\s*;?|\s*'[^']+'\s*;?)*\s*/,kn=/(?:^\uFEFF?|[^$_a-zA-Z\xA0-\uFFFF.])define\s*\(\s*("[^"]+"\s*,\s*|'[^']+'\s*,\s*)?\s*(\[(\s*(("[^"]+"|'[^']+')\s*,|\/\/.*\r?\n|\/\*(.|\s)*?\*\/))*(\s*("[^"]+"|'[^']+')\s*,?)?(\s*(\/\/.*\r?\n|\/\*(.|\s)*?\*\/))*\s*\]|function\s*|{|[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*\))/,_n=/(?:^\uFEFF?|[^$_a-zA-Z\xA0-\uFFFF.])(exports\s*(\[['"]|\.)|module(\.exports|\['exports'\]|\["exports"\])\s*(\[['"]|[=,\.]))/,Cn=/^\#\!.*/,Tn=/^(\s*\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*|\s*"[^"]+"\s*;?|\s*'[^']+'\s*;?)+/,Mn=/\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\/\/[^\n]*|"[^"]+"\s*;?|'[^']+'\s*;?/g;if("undefined"==typeof Promise)throw new Error("SystemJS needs a Promise polyfill.");if("undefined"!=typeof document){var Pn=document.getElementsByTagName("script"),On=Pn[Pn.length-1];document.currentScript&&(On.defer||On.async)&&(On=document.currentScript),bn=On&&On.src}else if("undefined"!=typeof importScripts)try{throw new Error("_")}catch(o){o.stack.replace(/(?:at|@).*(http.+):[\d]+:[\d]+/,function(t,e){bn=e})}else void 0!==i&&(bn=i);var En;oe.prototype=Object.create(v.prototype),oe.prototype.constructor=oe,oe.prototype[oe.resolve=v.resolve]=oe.prototype.normalize=et,oe.prototype.load=function(t,e){return q.call(this[$e],"System.load is deprecated."),this.import(t,e)},oe.prototype.decanonicalize=oe.prototype.normalizeSync=oe.prototype.resolveSync=rt,oe.prototype[oe.instantiate=v.instantiate]=Gt,oe.prototype.config=Pt,oe.prototype.getConfig=Mt,oe.prototype.global=he,oe.prototype.import=function(){return v.prototype.import.apply(this,arguments).then(function(t){return"__useDefault"in t?t.__useDefault:t})};for(var $n=["baseURL","map","paths","packages","packageConfigPaths","depCache","meta","bundles","transpiler","warnings","pluginFirst","production","wasm"],An="undefined"!=typeof Proxy,Dn=0;Dn<$n.length;Dn++)!function(t){Object.defineProperty(oe.prototype,t,{get:function(){var e=Tt(this[$e],t);return An&&"object"==typeof e&&(e=new Proxy(e,{set:function(e,n){throw new Error("Cannot set SystemJS."+t+'["'+n+'"] directly. Use SystemJS.config({ '+t+': { "'+n+'": ... } }) rather.')}})),e},set:function(e){throw new Error("Setting `SystemJS."+t+"` directly is no longer supported. Use `SystemJS.config({ "+t+": ... })`.")}})}($n[Dn]);oe.prototype.delete=function(t){return le(this,"delete"),this.registry.delete(t)},oe.prototype.get=function(t){return le(this,"get"),this.registry.get(t)},oe.prototype.has=function(t){return le(this,"has"),this.registry.has(t)},oe.prototype.set=function(t,e){return le(this,"set"),this.registry.set(t,e)},oe.prototype.newModule=function(t){return new m(t)},oe.prototype.isModule=F,oe.prototype.register=function(t,e,n){return"string"==typeof t&&(t=nt.call(this,this[$e],t)),v.prototype.register.call(this,t,e,n)},oe.prototype.registerDynamic=function(t,e,n,r){return"string"==typeof t&&(t=nt.call(this,this[$e],t)),v.prototype.registerDynamic.call(this,t,e,n,r)},oe.prototype.version="0.20.19 Dev";var In=new oe;(ce||De)&&(he.SystemJS=he.System=In),void 0!==t&&t.exports&&(t.exports=In)}()}).call(e,n(1529).Buffer,n(526),n(33),"/index.js")},1529:function(t,e,n){"use strict";(function(t){function r(){return i.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(r()<e)throw new RangeError("Invalid typed array length");return i.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=i.prototype):(null===t&&(t=new i(e)),t.length=e),t}function i(t,e,n){if(!(i.TYPED_ARRAY_SUPPORT||this instanceof i))return new i(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return o(this,t,e,n)}function o(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?d(t,e,n,r):"string"==typeof e?c(t,e,n):h(t,e)}function s(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e,n,r){return s(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}function u(t,e){if(s(e),t=a(t,e<0?0:0|f(e)),!i.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function c(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!i.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(e,n);t=a(t,r);var o=t.write(e,n);return o!==r&&(t=t.slice(0,o)),t}function p(t,e){var n=e.length<0?0:0|f(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function d(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),i.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=i.prototype):t=p(t,e),t}function h(t,e){if(i.isBuffer(e)){var n=0|f(e.length);return t=a(t,n),0===t.length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||G(e.length)?a(t,0):p(t,e);if("Buffer"===e.type&&X(e.data))return p(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function f(t){if(t>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|t}function m(t){return+t!=t&&(t=0),i.alloc(+t)}function g(t,e){if(i.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(t).length;default:if(r)return z(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return A(this,e,n);case"utf8":case"utf-8":return P(this,e,n);case"ascii":return E(this,e,n);case"latin1":case"binary":return $(this,e,n);case"base64":return M(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function y(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function b(t,e,n,r,a){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(a)return-1;n=t.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof e&&(e=i.from(e,r)),i.isBuffer(e))return 0===e.length?-1:x(t,e,n,r,a);if("number"==typeof e)return e&=255,i.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):x(t,[e],n,r,a);throw new TypeError("val must be string, number or Buffer")}function x(t,e,n,r,a){function i(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,s=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,s/=2,l/=2,n/=2}var u;if(a){var c=-1;for(u=n;u<s;u++)if(i(t,u)===i(e,-1===c?0:u-c)){if(-1===c&&(c=u),u-c+1===l)return c*o}else-1!==c&&(u-=u-c),c=-1}else for(n+l>s&&(n=s-l),u=n;u>=0;u--){for(var p=!0,d=0;d<l;d++)if(i(t,u+d)!==i(e,d)){p=!1;break}if(p)return u}return-1}function S(t,e,n,r){n=Number(n)||0;var a=t.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[n+o]=s}return o}function w(t,e,n,r){return W(z(e,t.length-n),t,n,r)}function k(t,e,n,r){return W(Q(e),t,n,r)}function _(t,e,n,r){return k(t,e,n,r)}function C(t,e,n,r){return W(Y(e),t,n,r)}function T(t,e,n,r){return W(H(e,t.length-n),t,n,r)}function M(t,e,n){return 0===e&&n===t.length?K.fromByteArray(t):K.fromByteArray(t.slice(e,n))}function P(t,e,n){n=Math.min(t.length,n);for(var r=[],a=e;a<n;){var i=t[a],o=null,s=i>239?4:i>223?3:i>191?2:1;if(a+s<=n){var l,u,c,p;switch(s){case 1:i<128&&(o=i);break;case 2:l=t[a+1],128==(192&l)&&(p=(31&i)<<6|63&l)>127&&(o=p);break;case 3:l=t[a+1],u=t[a+2],128==(192&l)&&128==(192&u)&&(p=(15&i)<<12|(63&l)<<6|63&u)>2047&&(p<55296||p>57343)&&(o=p);break;case 4:l=t[a+1],u=t[a+2],c=t[a+3],128==(192&l)&&128==(192&u)&&128==(192&c)&&(p=(15&i)<<18|(63&l)<<12|(63&u)<<6|63&c)>65535&&p<1114112&&(o=p)}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),a+=s}return O(r)}function O(t){var e=t.length;if(e<=Z)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=Z));return n}function E(t,e,n){var r="";n=Math.min(t.length,n);for(var a=e;a<n;++a)r+=String.fromCharCode(127&t[a]);return r}function $(t,e,n){var r="";n=Math.min(t.length,n);for(var a=e;a<n;++a)r+=String.fromCharCode(t[a]);return r}function A(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=e;i<n;++i)a+=B(t[i]);return a}function D(t,e,n){for(var r=t.slice(e,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function I(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function F(t,e,n,r,a,o){if(!i.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>a||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function q(t,e,n,r){e<0&&(e=65535+e+1);for(var a=0,i=Math.min(t.length-n,2);a<i;++a)t[n+a]=(e&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function R(t,e,n,r){e<0&&(e=4294967295+e+1);for(var a=0,i=Math.min(t.length-n,4);a<i;++a)t[n+a]=e>>>8*(r?a:3-a)&255}function j(t,e,n,r,a,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(t,e,n,r,a){return a||j(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(t,e,n,r,23,4),n+4}function L(t,e,n,r,a){return a||j(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(t,e,n,r,52,8),n+8}function U(t){if(t=V(t).replace(tt,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function V(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function z(t,e){e=e||1/0;for(var n,r=t.length,a=null,i=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(e-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function Q(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function H(t,e){for(var n,r,a,i=[],o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,a=n%256,i.push(a),i.push(r);return i}function Y(t){return K.toByteArray(U(t))}function W(t,e,n,r){for(var a=0;a<r&&!(a+n>=e.length||a>=t.length);++a)e[a+n]=t[a];return a}function G(t){return t!==t}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var K=n(1530),J=n(1531),X=n(1532);e.Buffer=i,e.SlowBuffer=m,e.INSPECT_MAX_BYTES=50,i.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=r(),i.poolSize=8192,i._augment=function(t){return t.__proto__=i.prototype,t},i.from=function(t,e,n){return o(null,t,e,n)},i.TYPED_ARRAY_SUPPORT&&(i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0})),i.alloc=function(t,e,n){return l(null,t,e,n)},i.allocUnsafe=function(t){return u(null,t)},i.allocUnsafeSlow=function(t){return u(null,t)},i.isBuffer=function(t){return!(null==t||!t._isBuffer)},i.compare=function(t,e){if(!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,a=0,o=Math.min(n,r);a<o;++a)if(t[a]!==e[a]){n=t[a],r=e[a];break}return n<r?-1:r<n?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!X(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return i.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=i.allocUnsafe(e),a=0;for(n=0;n<t.length;++n){var o=t[n];if(!i.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},i.byteLength=g,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},i.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},i.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},i.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):v.apply(this,arguments)},i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===i.compare(this,t)},i.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},i.prototype.compare=function(t,e,n,r,a){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),e<0||n>t.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&e>=n)return 0;if(r>=a)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,a>>>=0,this===t)return 0;for(var o=a-r,s=n-e,l=Math.min(o,s),u=this.slice(r,a),c=t.slice(e,n),p=0;p<l;++p)if(u[p]!==c[p]){o=u[p],s=c[p];break}return o<s?-1:s<o?1:0},i.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},i.prototype.indexOf=function(t,e,n){return b(this,t,e,n,!0)},i.prototype.lastIndexOf=function(t,e,n){return b(this,t,e,n,!1)},i.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-e;if((void 0===n||n>a)&&(n=a),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return S(this,t,e,n);case"utf8":case"utf-8":return w(this,t,e,n);case"ascii":return k(this,t,e,n);case"latin1":case"binary":return _(this,t,e,n);case"base64":return C(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;i.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);var r;if(i.TYPED_ARRAY_SUPPORT)r=this.subarray(t,e),r.__proto__=i.prototype;else{var a=e-t;r=new i(a,void 0);for(var o=0;o<a;++o)r[o]=this[o+t]}return r},i.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||I(t,e,this.length);for(var r=this[t],a=1,i=0;++i<e&&(a*=256);)r+=this[t+i]*a;return r},i.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||I(t,e,this.length);for(var r=this[t+--e],a=1;e>0&&(a*=256);)r+=this[t+--e]*a;return r},i.prototype.readUInt8=function(t,e){return e||I(t,1,this.length),this[t]},i.prototype.readUInt16LE=function(t,e){return e||I(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUInt16BE=function(t,e){return e||I(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUInt32LE=function(t,e){return e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUInt32BE=function(t,e){return e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||I(t,e,this.length);for(var r=this[t],a=1,i=0;++i<e&&(a*=256);)r+=this[t+i]*a;return a*=128,r>=a&&(r-=Math.pow(2,8*e)),r},i.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||I(t,e,this.length);for(var r=e,a=1,i=this[t+--r];r>0&&(a*=256);)i+=this[t+--r]*a;return a*=128,i>=a&&(i-=Math.pow(2,8*e)),i},i.prototype.readInt8=function(t,e){return e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){e||I(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt16BE=function(t,e){e||I(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt32LE=function(t,e){return e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,e){return e||I(t,4,this.length),J.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,e){return e||I(t,4,this.length),J.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,e){return e||I(t,8,this.length),J.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,e){return e||I(t,8,this.length),J.read(this,t,!1,52,8)},i.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){F(this,t,e,n,Math.pow(2,8*n)-1,0)}var a=1,i=0;for(this[e]=255&t;++i<n&&(a*=256);)this[e+i]=t/a&255;return e+n},i.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){F(this,t,e,n,Math.pow(2,8*n)-1,0)}var a=n-1,i=1;for(this[e+a]=255&t;--a>=0&&(i*=256);)this[e+a]=t/i&255;return e+n},i.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,1,255,0),i.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},i.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):q(this,t,e,!0),e+2},i.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,65535,0),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):q(this,t,e,!1),e+2},i.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):R(this,t,e,!0),e+4},i.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,4294967295,0),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},i.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var a=Math.pow(2,8*n-1);F(this,t,e,n,a-1,-a)}var i=0,o=1,s=0;for(this[e]=255&t;++i<n&&(o*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/o>>0)-s&255;return e+n},i.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var a=Math.pow(2,8*n-1);F(this,t,e,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/o>>0)-s&255;return e+n},i.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,1,127,-128),i.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},i.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):q(this,t,e,!0),e+2},i.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,2,32767,-32768),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):q(this,t,e,!1),e+2},i.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,2147483647,-2147483648),i.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):R(this,t,e,!0),e+4},i.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||F(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),i.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):R(this,t,e,!1),e+4},i.prototype.writeFloatLE=function(t,e,n){return N(this,t,e,!0,n)},i.prototype.writeFloatBE=function(t,e,n){return N(this,t,e,!1,n)},i.prototype.writeDoubleLE=function(t,e,n){return L(this,t,e,!0,n)},i.prototype.writeDoubleBE=function(t,e,n){return L(this,t,e,!1,n)},i.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var a,o=r-n;if(this===t&&n<e&&e<r)for(a=o-1;a>=0;--a)t[a+e]=this[a+n];else if(o<1e3||!i.TYPED_ARRAY_SUPPORT)for(a=0;a<o;++a)t[a+e]=this[a+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},i.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var a=t.charCodeAt(0);a<256&&(t=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0);var o;if("number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=i.isBuffer(t)?t:z(new i(t,r).toString()),l=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%l]}return this};var tt=/[^+\/0-9A-Za-z-_]/g}).call(e,n(33))},1530:function(t,e,n){"use strict";function r(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function a(t){return 3*t.length/4-r(t)}function i(t){var e,n,a,i,o,s=t.length;i=r(t),o=new p(3*s/4-i),n=i>0?s-4:s;var l=0;for(e=0;e<n;e+=4)a=c[t.charCodeAt(e)]<<18|c[t.charCodeAt(e+1)]<<12|c[t.charCodeAt(e+2)]<<6|c[t.charCodeAt(e+3)],o[l++]=a>>16&255,o[l++]=a>>8&255,o[l++]=255&a;return 2===i?(a=c[t.charCodeAt(e)]<<2|c[t.charCodeAt(e+1)]>>4,o[l++]=255&a):1===i&&(a=c[t.charCodeAt(e)]<<10|c[t.charCodeAt(e+1)]<<4|c[t.charCodeAt(e+2)]>>2,o[l++]=a>>8&255,o[l++]=255&a),o}function o(t){return u[t>>18&63]+u[t>>12&63]+u[t>>6&63]+u[63&t]}function s(t,e,n){for(var r,a=[],i=e;i<n;i+=3)r=(t[i]<<16)+(t[i+1]<<8)+t[i+2],a.push(o(r));return a.join("")}function l(t){for(var e,n=t.length,r=n%3,a="",i=[],o=0,l=n-r;o<l;o+=16383)i.push(s(t,o,o+16383>l?l:o+16383));return 1===r?(e=t[n-1],a+=u[e>>2],a+=u[e<<4&63],a+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],a+=u[e>>10],a+=u[e>>4&63],a+=u[e<<2&63],a+="="),i.push(a),i.join("")}e.byteLength=a,e.toByteArray=i,e.fromByteArray=l;for(var u=[],c=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,f=d.length;h<f;++h)u[h]=d[h],c[d.charCodeAt(h)]=h;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},1531:function(t,e){e.read=function(t,e,n,r,a){var i,o,s=8*a-r-1,l=(1<<s)-1,u=l>>1,c=-7,p=n?a-1:0,d=n?-1:1,h=t[e+p];for(p+=d,i=h&(1<<-c)-1,h>>=-c,c+=s;c>0;i=256*i+t[e+p],p+=d,c-=8);for(o=i&(1<<-c)-1,i>>=-c,c+=r;c>0;o=256*o+t[e+p],p+=d,c-=8);if(0===i)i=1-u;else{if(i===l)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),i-=u}return(h?-1:1)*o*Math.pow(2,i-r)},e.write=function(t,e,n,r,a,i){var o,s,l,u=8*i-a-1,c=(1<<u)-1,p=c>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),e+=o+p>=1?d/l:d*Math.pow(2,1-p),e*l>=2&&(o++,l/=2),o+p>=c?(s=0,o=c):o+p>=1?(s=(e*l-1)*Math.pow(2,a),o+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,a),o=0));a>=8;t[n+h]=255&s,h+=f,s/=256,a-=8);for(o=o<<a|s,u+=a;u>0;t[n+h]=255&o,h+=f,o/=256,u-=8);t[n+h-f]|=128*m}},1532:function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},1533:function(t,e){},1534:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var r=n(22),a=n(16),i=n.n(a),o=n(4),s=n.n(o),l=n(224),u=n(1468),c=n(519),p=n(512),d=n(1535),h=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.editorTabIndex=1,r.$q=n.get("$q"),r.datasourceSrv=n.get("datasourceSrv"),r.timeSrv=n.get("timeSrv"),r.templateSrv=n.get("templateSrv"),r.scope=e,r.panel.datasource=r.panel.datasource||null,r.panel.targets||(r.panel.targets=[{}]),r.events.on("refresh",r.onMetricsPanelRefresh.bind(r)),r.events.on("init-edit-mode",r.onInitMetricsPanelEditMode.bind(r)),r.events.on("panel-teardown",r.onPanelTearDown.bind(r)),r}return h(e,t),e.prototype.onPanelTearDown=function(){this.dataSubscription&&(this.dataSubscription.unsubscribe(),this.dataSubscription=null)},e.prototype.onInitMetricsPanelEditMode=function(){this.addEditorTab("Metrics",d.a),this.addEditorTab("Time range","public/app/features/panel/partials/panelTime.html")},e.prototype.onMetricsPanelRefresh=function(){var t=this;if(!this.otherPanelInFullscreenMode()){if(this.panel.snapshotData){this.updateTimeRange();var e=this.panel.snapshotData;return s.a.isArray(e)||(e=e.data),this.$timeout(function(){t.events.emit("data-snapshot-load",e)})}this.dataStream||(delete this.error,this.loading=!0,this.setTimeQueryStart(),this.datasourceSrv.get(this.panel.datasource).then(this.updateTimeRange.bind(this)).then(this.issueQueries.bind(this)).then(this.handleQueryResult.bind(this)).catch(function(e){if(e.cancelled)return void console.log("Panel request cancelled",e);t.loading=!1,t.error=e.message||"Request Error",t.inspector={error:e},e.data&&(e.data.message&&(t.error=e.data.message),e.data.error&&(t.error=e.data.error)),t.events.emit("data-error",e),console.log("Panel data error:",e)}))}},e.prototype.setTimeQueryStart=function(){this.timing.queryStart=(new Date).getTime()},e.prototype.setTimeQueryEnd=function(){this.timing.queryEnd=(new Date).getTime()},e.prototype.updateTimeRange=function(t){return this.datasource=t||this.datasource,this.range=this.timeSrv.timeRange(),this.applyPanelTimeOverrides(),this.panel.maxDataPoints?this.resolution=this.panel.maxDataPoints:this.resolution=Math.ceil(i()(window).width()*(this.panel.gridPos.w/24)),this.calculateInterval(),this.datasource},e.prototype.calculateInterval=function(){var t=this.panel.interval;t?t=this.templateSrv.replace(t,this.panel.scopedVars):this.datasource&&this.datasource.interval&&(t=this.datasource.interval);var e=l.a.calculateInterval(this.range,this.resolution,t);this.interval=e.interval,this.intervalMs=e.intervalMs},e.prototype.applyPanelTimeOverrides=function(){if(this.timeInfo="",this.panel.timeFrom){var t=this.templateSrv.replace(this.panel.timeFrom,this.panel.scopedVars),e=c.a(t);if(e.invalid)return void(this.timeInfo="invalid time override");if(s.a.isString(this.range.raw.from)){var n=p.parse(e.from);this.timeInfo=e.display,this.range.from=n,this.range.to=p.parse(e.to),this.range.raw.from=e.from,this.range.raw.to=e.to}}if(this.panel.timeShift){var r=this.templateSrv.replace(this.panel.timeShift,this.panel.scopedVars);if(c.a(r).invalid)return void(this.timeInfo="invalid timeshift");var a="-"+r;this.timeInfo+=" timeshift "+a,this.range.from=p.parseDateMath(a,this.range.from,!1),this.range.to=p.parseDateMath(a,this.range.to,!0),this.range.raw={from:this.range.from,to:this.range.to}}this.panel.hideTimeOverride&&(this.timeInfo="")},e.prototype.issueQueries=function(t){if(this.datasource=t,!this.panel.targets||0===this.panel.targets.length)return this.$q.when([]);var e=Object.assign({},this.panel.scopedVars,{__interval:{text:this.interval,value:this.interval},__interval_ms:{text:this.intervalMs,value:this.intervalMs}}),n={timezone:this.dashboard.getTimezone(),panelId:this.panel.id,dashboardId:this.dashboard.id,range:this.range,rangeRaw:this.range.raw,interval:this.interval,intervalMs:this.intervalMs,targets:this.panel.targets,maxDataPoints:this.resolution,scopedVars:e,cacheTimeout:this.panel.cacheTimeout};return t.query(n)},e.prototype.handleQueryResult=function(t){if(this.setTimeQueryEnd(),this.loading=!1,t&&t.subscribe)return void this.handleDataStream(t);this.dashboard.snapshot&&(this.panel.snapshotData=t.data),t&&t.data||(console.log("Data source query result invalid, missing data field:",t),t={data:[]}),this.events.emit("data-received",t.data)},e.prototype.handleDataStream=function(t){var e=this;if(this.dataStream)return void console.log("two stream observables!");this.dataStream=t,this.dataSubscription=t.subscribe({next:function(t){console.log("dataSubject next!"),t.range&&(e.range=t.range),e.events.emit("data-received",t.data)},error:function(t){e.events.emit("data-error",t),console.log("panel: observer got error")},complete:function(){console.log("panel: observer got complete"),e.dataStream=null}})},e.prototype.setDatasource=function(t){var e=this;t.meta.mixed?s.a.each(this.panel.targets,function(t){t.datasource=e.panel.datasource,t.datasource||(t.datasource=r.a.defaultDatasource)}):this.datasource&&this.datasource.meta.mixed&&s.a.each(this.panel.targets,function(t){delete t.datasource}),this.panel.datasource=t.value,this.datasourceName=t.name,this.datasource=null,this.refresh()},e.prototype.addQuery=function(t){t.refId=this.dashboard.getNextQueryLetter(this.panel),this.panel.targets.push(t),this.nextRefId=this.dashboard.getNextQueryLetter(this.panel)},e.prototype.removeQuery=function(t){var e=s.a.indexOf(this.panel.targets,t);this.panel.targets.splice(e,1),this.nextRefId=this.dashboard.getNextQueryLetter(this.panel),this.refresh()},e.prototype.moveQuery=function(t,e){var n=s.a.indexOf(this.panel.targets,t);s.a.move(this.panel.targets,n,n+e)},e}(u.a)},1535:function(t,e,n){"use strict";function r(){return{restrict:"E",scope:!0,templateUrl:"public/app/features/panel/partials/metrics_tab.html",controller:o}}e.a=r;var a=n(514),i=n.n(a),o=function(){function t(t,e,n,r){this.$sce=e,this.backendSrv=r,this.panelCtrl=t.ctrl,t.ctrl=this,this.panel=this.panelCtrl.panel,this.dashboard=this.panelCtrl.dashboard,this.datasources=n.getMetricSources(),this.panelDsValue=this.panelCtrl.panel.datasource;for(var a=0,i=this.datasources;a<i.length;a++){var o=i[a];o.value===this.panelDsValue&&(this.datasourceInstance=o)}this.addQueryDropdown={text:"Add Query",value:null,fake:!0},this.panelCtrl.nextRefId=this.dashboard.getNextQueryLetter(this.panel),this.updateDatasourceOptions()}return t.$inject=["$scope","$sce","datasourceSrv","backendSrv"],t.prototype.updateDatasourceOptions=function(){this.datasourceInstance&&(this.hasQueryHelp=this.datasourceInstance.meta.hasQueryHelp,this.queryOptions=this.datasourceInstance.meta.queryOptions)},t.prototype.getOptions=function(t){return Promise.resolve(this.datasources.filter(function(e){return t||!e.meta.builtIn}).map(function(t){return{value:t.value,text:t.name,datasource:t}}))},t.prototype.datasourceChanged=function(t){t&&(this.datasourceInstance=t.datasource,this.panelCtrl.setDatasource(t.datasource),this.updateDatasourceOptions())},t.prototype.addMixedQuery=function(t){t&&(this.panelCtrl.addQuery({isNew:!0,datasource:t.datasource.name}),this.addQueryDropdown={text:"Add Query",value:null,fake:!0})},t.prototype.addQuery=function(){this.panelCtrl.addQuery({isNew:!0})},t.prototype.toggleHelp=function(){var t=this;this.optionsOpen=!1,this.queryTroubleshooterOpen=!1,this.helpOpen=!this.helpOpen,this.backendSrv.get("/api/plugins/"+this.datasourceInstance.meta.id+"/markdown/query_help").then(function(e){var n=new i.a;t.helpHtml=t.$sce.trustAsHtml(n.render(e))})},t.prototype.toggleOptions=function(){this.helpOpen=!1,this.queryTroubleshooterOpen=!1,this.optionsOpen=!this.optionsOpen},t.prototype.toggleQueryTroubleshooter=function(){this.helpOpen=!1,this.optionsOpen=!1,this.queryTroubleshooterOpen=!this.queryTroubleshooterOpen},t}()},1536:function(t,e,n){"use strict";function r(){return{restrict:"E",scope:!0,templateUrl:"public/app/features/alerting/partials/alert_tab.html",controller:p}}e.a=r;var a=n(4),i=n.n(a),o=n(1537),s=n(520),l=n(518),u=n(22),c=n(17),p=function(){function t(t,e,n,r,a,i){this.$scope=t,this.backendSrv=e,this.dashboardSrv=n,this.uiSegmentSrv=r,this.$q=a,this.datasourceSrv=i,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.$scope.ctrl=this,this.subTabIndex=0,this.evalFunctions=l.a.evalFunctions,this.evalOperators=l.a.evalOperators,this.conditionTypes=l.a.conditionTypes,this.noDataModes=l.a.noDataModes,this.executionErrorModes=l.a.executionErrorModes,this.appSubUrl=u.a.appSubUrl}return t.$inject=["$scope","backendSrv","dashboardSrv","uiSegmentSrv","$q","datasourceSrv"],t.prototype.$onInit=function(){var t=this;this.addNotificationSegment=this.uiSegmentSrv.newPlusButton();var e=this.graphThresholdChanged.bind(this);return this.panelCtrl.events.on("threshold-changed",e),this.$scope.$on("$destroy",function(){t.panelCtrl.events.off("threshold-changed",e),t.panelCtrl.editingThresholds=!1,t.panelCtrl.render()}),this.notifications=[],this.alertNotifications=[],this.alertHistory=[],this.backendSrv.get("/api/alert-notifications").then(function(e){t.notifications=e,t.initModel(),t.validateModel()})},t.prototype.getAlertHistory=function(){var t=this;this.backendSrv.get("/api/annotations?dashboardId="+this.panelCtrl.dashboard.id+"&panelId="+this.panel.id+"&limit=50&type=alert").then(function(e){t.alertHistory=i.a.map(e,function(e){return e.time=t.dashboardSrv.getCurrent().formatDate(e.time,"MMM D, YYYY HH:mm:ss"),e.stateModel=l.a.getStateDisplayModel(e.newState),e.info=l.a.getAlertAnnotationInfo(e),e})})},t.prototype.getNotificationIcon=function(t){switch(t){case"email":return"fa fa-envelope";case"slack":return"fa fa-slack";case"victorops":return"fa fa-pagelines";case"webhook":return"fa fa-cubes";case"pagerduty":return"fa fa-bullhorn";case"opsgenie":return"fa fa-bell";case"hipchat":return"fa fa-mail-forward";case"pushover":return"fa fa-mobile";case"kafka":return"fa fa-random";case"teams":return"fa fa-windows"}return"fa fa-bell"},t.prototype.getNotifications=function(){var t=this;return Promise.resolve(this.notifications.map(function(e){return t.uiSegmentSrv.newSegment(e.name)}))},t.prototype.changeTabIndex=function(t){this.subTabIndex=t,2===this.subTabIndex&&this.getAlertHistory()},t.prototype.notificationAdded=function(){var t=i.a.find(this.notifications,{name:this.addNotificationSegment.value});t&&(this.alertNotifications.push({name:t.name,iconClass:this.getNotificationIcon(t.type),isDefault:!1}),this.alert.notifications.push({id:t.id}),this.addNotificationSegment.value=this.uiSegmentSrv.newPlusButton().value,this.addNotificationSegment.html=this.uiSegmentSrv.newPlusButton().html)},t.prototype.removeNotification=function(t){this.alert.notifications.splice(t,1),this.alertNotifications.splice(t,1)},t.prototype.initModel=function(){var t=this,e=this.alert=this.panel.alert;if(e){e.conditions=e.conditions||[],0===e.conditions.length&&e.conditions.push(this.buildDefaultCondition()),e.noDataState=e.noDataState||"no_data",e.executionErrorState=e.executionErrorState||"alerting",e.frequency=e.frequency||"60s",e.handler=e.handler||1,e.notifications=e.notifications||[];var n=this.panel.title+" alert";e.name=e.name||n,this.conditionModels=i.a.reduce(e.conditions,function(e,n){return e.push(t.buildConditionModel(n)),e},[]),o.a.alertToGraphThresholds(this.panel);for(var r=0,a=e.notifications;r<a.length;r++){var s=a[r],l=i.a.find(this.notifications,{id:s.id});l&&!1===l.isDefault&&(l.iconClass=this.getNotificationIcon(l.type),this.alertNotifications.push(l))}for(var u=0,c=this.notifications;u<c.length;u++){var p=c[u];p.isDefault&&(p.iconClass=this.getNotificationIcon(p.type),p.bgColor="#00678b",this.alertNotifications.push(p))}this.panelCtrl.editingThresholds=!0,this.panelCtrl.render()}},t.prototype.graphThresholdChanged=function(t){for(var e=0,n=this.alert.conditions;e<n.length;e++){var r=n[e];if("query"===r.type){r.evaluator.params[t.handleIndex]=t.threshold.value,this.evaluatorParamsChanged();break}}},t.prototype.buildDefaultCondition=function(){return{type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}},t.prototype.validateModel=function(){var t=this;if(this.alert)for(var e,n=null,r=0,a=this.alert.conditions;r<a.length;r++){var i=a[r];if("query"===i.type){for(var o=0,s=this.panel.targets;o<s.length;o++){var l=s[o];if(e||(e=l),i.query.params[0]===l.refId){n=l;break}}n||(e?(i.query.params[0]=e.refId,n=e):this.error="Could not find any metric queries");var u=n.datasource||this.panel.datasource;this.datasourceSrv.get(u).then(function(e){e.meta.alerting?e.targetContainsTemplate(n)?t.error="Template variables are not supported in alert queries":t.error="":t.error="The datasource does not support alerting queries"})}}},t.prototype.buildConditionModel=function(t){var e={source:t,type:t.type};return e.queryPart=new s.a(t.query,l.a.alertQueryDef),e.reducerPart=l.a.createReducerPart(t.reducer),e.evaluator=t.evaluator,e.operator=t.operator,e},t.prototype.handleQueryPartEvent=function(t,e){var n=this;switch(e.name){case"action-remove-part":break;case"get-part-actions":return this.$q.when([]);case"part-param-changed":this.validateModel();case"get-param-options":var r=this.panel.targets.map(function(t){return n.uiSegmentSrv.newSegment({value:t.refId})});return this.$q.when(r)}},t.prototype.handleReducerPartEvent=function(t,e){switch(e.name){case"action":t.source.reducer.type=e.action.value,t.reducerPart=l.a.createReducerPart(t.source.reducer);break;case"get-part-actions":for(var n=[],r=0,a=l.a.reducerTypes;r<a.length;r++){var i=a[r];i.value!==t.source.reducer.type&&n.push(i)}return this.$q.when(n)}},t.prototype.addCondition=function(t){var e=this.buildDefaultCondition();this.alert.conditions.push(e),this.conditionModels.push(this.buildConditionModel(e))},t.prototype.removeCondition=function(t){this.alert.conditions.splice(t,1),this.conditionModels.splice(t,1)},t.prototype.delete=function(){var t=this;c.a.emit("confirm-modal",{title:"Delete Alert",text:"Are you sure you want to delete this alert rule?",text2:"You need to save dashboard for the delete to take effect",icon:"fa-trash",yesText:"Delete",onConfirm:function(){delete t.panel.alert,t.alert=null,t.panel.thresholds=[],t.conditionModels=[],t.panelCtrl.alertState=null,t.panelCtrl.render()}})},t.prototype.enable=function(){this.panel.alert={},this.initModel()},t.prototype.evaluatorParamsChanged=function(){o.a.alertToGraphThresholds(this.panel),this.panelCtrl.render()},t.prototype.evaluatorTypeChanged=function(t){switch(t.type){case"lt":case"gt":t.params=[t.params[0]];break;case"within_range":case"outside_range":t.params=[t.params[0],t.params[1]];break;case"no_value":t.params=[]}this.evaluatorParamsChanged()},t.prototype.clearHistory=function(){var t=this;c.a.emit("confirm-modal",{title:"Delete Alert History",text:"Are you sure you want to remove all history & annotations for this alert?",icon:"fa-trash",yesText:"Yes",onConfirm:function(){t.backendSrv.post("/api/annotations/mass-delete",{dashboardId:t.panelCtrl.dashboard.id,panelId:t.panel.id}).then(function(e){t.alertHistory=[],t.panelCtrl.refresh()})}})},t.prototype.test=function(){var t=this;this.testing=!0,this.testResult=!1;var e={dashboard:this.dashboardSrv.getCurrent().getSaveModelClone(),panelId:this.panelCtrl.panel.id};return this.backendSrv.post("/api/alerts/test",e).then(function(e){t.testResult=e,t.testing=!1})},t}()},1537:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(){}return t.alertToGraphThresholds=function(t){for(var e=0;e<t.alert.conditions.length;e++){var n=t.alert.conditions[e];if("query"===n.type){var r=n.evaluator,a=t.thresholds=[];switch(r.type){case"gt":var i=r.params[0];a.push({value:i,op:"gt"});break;case"lt":var i=r.params[0];a.push({value:i,op:"lt"});break;case"outside_range":var o=r.params[0],s=r.params[1];o>s?(a.push({value:o,op:"gt"}),a.push({value:s,op:"lt"})):(a.push({value:o,op:"lt"}),a.push({value:s,op:"gt"}));break;case"within_range":var o=r.params[0],s=r.params[1];o>s?(a.push({value:o,op:"lt"}),a.push({value:s,op:"gt"})):(a.push({value:o,op:"gt"}),a.push({value:s,op:"lt"}))}break}}for(var l=0,u=t.thresholds;l<u.length;l++){var c=u[l];c.fill=!0,c.line=!0,c.colorMode="critical"}return!0},t}()},1538:function(t,e,n){"use strict";var r=n(1539),a=n(1549),i=n(1553),o=n(1562),s=n(1566),l=n(1568),u=n(1573),c=n(1575),p=n(1579),d=n(1583),h=n(1592),f=n(1596),m=n(1597),g=n(1610),v=n(1611),y=n(1612),b=n(1613),x=n(1620),S=n(1624),w=n(1626),k=n(1627),_=n(1628),C={"app/plugins/datasource/graphite/module":r,"app/plugins/datasource/cloudwatch/module":a,"app/plugins/datasource/elasticsearch/module":i,"app/plugins/datasource/opentsdb/module":o,"app/plugins/datasource/grafana/module":s,"app/plugins/datasource/influxdb/module":l,"app/plugins/datasource/mixed/module":u,"app/plugins/datasource/mysql/module":c,"app/plugins/datasource/postgres/module":p,"app/plugins/datasource/mssql/module":h,"app/plugins/datasource/prometheus/module":d,"app/plugins/app/testdata/module":k,"app/plugins/app/testdata/datasource/module":_,"app/plugins/panel/text/module":f,"app/plugins/panel/graph/module":m,"app/plugins/panel/dashlist/module":g,"app/plugins/panel/pluginlist/module":v,"app/plugins/panel/alertlist/module":y,"app/plugins/panel/heatmap/module":b,"app/plugins/panel/table/module":x,"app/plugins/panel/singlestat/module":S,"app/plugins/panel/gettingstarted/module":w};e.a=C},1539:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AnnotationsQueryCtrl",function(){return o});var r=n(1540),a=n(1542),i=n(1548);n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a}),n.d(e,"ConfigCtrl",function(){return i.a});var o=function(){function t(){}return t.templateUrl="partials/annotations.editor.html",t}()},1540:function(t,e,n){"use strict";function r(t,e,n,r){var o=this;this.basicAuth=t.basicAuth,this.url=t.url,this.name=t.name,this.graphiteVersion=t.jsonData.graphiteVersion||"0.9",this.supportsTags=a(this.graphiteVersion),this.cacheTimeout=t.cacheTimeout,this.withCredentials=t.withCredentials,this.render_method=t.render_method||"POST",this.funcDefs=null,this.funcDefsPromise=null,this.getQueryOptionsInfo=function(){return{maxDataPoints:!0,cacheTimeout:!0,links:[{text:"Help",url:"http://docs.grafana.org/features/datasources/graphite/#using-graphite-in-grafana"}]}},this.query=function(t){var n={from:this.translateTime(t.rangeRaw.from,!1),until:this.translateTime(t.rangeRaw.to,!0),targets:t.targets,format:t.format,cacheTimeout:t.cacheTimeout||this.cacheTimeout,maxDataPoints:t.maxDataPoints},r=this.buildGraphiteParams(n,t.scopedVars);if(0===r.length)return e.when({data:[]});var a={method:"POST",url:"/render",data:r.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded","X-Dashboard-Id":t.dashboardId,"X-Panel-Id":t.panelId}};return t.panelId&&(a.requestId=this.name+".panelId."+t.panelId),this.doGraphiteRequest(a).then(this.convertDataPointsToMs)},this.convertDataPointsToMs=function(t){if(!t||!t.data)return[];for(var e=0;e<t.data.length;e++)for(var n=t.data[e],r=0;r<n.datapoints.length;r++)n.datapoints[r][1]*=1e3;return t},this.parseTags=function(t){var e=[];return e=t.split(","),1===e.length&&(e=t.split(" "),""===e[0]&&(e=[])),e},this.annotationQuery=function(t){var e=this;if(t.annotation.target){var n=r.replace(t.annotation.target,{},"glob"),a={rangeRaw:t.rangeRaw,targets:[{target:n}],format:"json",maxDataPoints:100};return this.query(a).then(function(e){for(var n=[],r=0;r<e.data.length;r++)for(var a=e.data[r],i=0;i<a.datapoints.length;i++){var o=a.datapoints[i];o[0]&&n.push({annotation:t.annotation,time:o[1],title:a.target})}return n})}var i=r.replace(t.annotation.tags);return this.events({range:t.rangeRaw,tags:i}).then(function(n){for(var r=[],a=0;a<n.data.length;a++){var i=n.data[a],o=i.tags;s.a.isString(i.tags)&&(o=e.parseTags(i.tags)),r.push({annotation:t.annotation,time:1e3*i.when,title:i.what,tags:o,text:i.data})}return r})},this.events=function(t){try{var n="";return t.tags&&(n="&tags="+t.tags),this.doGraphiteRequest({method:"GET",url:"/events/get_data?from="+this.translateTime(t.range.from,!1)+"&until="+this.translateTime(t.range.to,!0)+n})}catch(t){return e.reject(t)}},this.targetContainsTemplate=function(t){return r.variableExists(t.target)},this.translateTime=function(t,e){if(s.a.isString(t)){if("now"===t)return"now";if(t.indexOf("now-")>=0&&-1===t.indexOf("/"))return t=t.substring(3),t=t.replace("m","min"),t=t.replace("M","mon");t=l.parse(t,e)}return e?t.get("s")&&t.add(1,"m"):!1===e&&t.get("s")&&t.subtract(1,"m"),t.unix()},this.metricFindQuery=function(t,e){var n=e||{},a=r.replace(t),i=a.match(/^tag_values\(([^,]+)((, *[^,]+)*)\)$/);if(i){for(var o=[],l=/, *([^,]+)/g,u=void 0;null!==(u=l.exec(i[2]));)o.push(u[1]);return n.limit=1e4,this.getTagValuesAutoComplete(o,i[1],void 0,n)}if(i=a.match(/^tags\(([^,]*)((, *[^,]+)*)\)$/)){var o=[];if(i[1]){o.push(i[1]);for(var l=/, *([^,]+)/g,u=void 0;null!==(u=l.exec(i[2]));)o.push(u[1])}return n.limit=1e4,this.getTagsAutoComplete(o,void 0,n)}var c={method:"GET",url:"/metrics/find",params:{query:a},requestId:n.requestId};return n.range&&(c.params.from=this.translateTime(n.range.from,!1),c.params.until=this.translateTime(n.range.to,!0)),this.doGraphiteRequest(c).then(function(t){return s.a.map(t.data,function(t){return{text:t.text,expandable:!!t.expandable}})})},this.getTags=function(t){var e=t||{},n={method:"GET",url:"/tags",requestId:e.requestId};return e.range&&(n.params.from=this.translateTime(e.range.from,!1),n.params.until=this.translateTime(e.range.to,!0)),this.doGraphiteRequest(n).then(function(t){return s.a.map(t.data,function(t){return{text:t.tag,id:t.id}})})},this.getTagValues=function(t,e){var n=e||{},a={method:"GET",url:"/tags/"+r.replace(t),requestId:n.requestId};return n.range&&(a.params.from=this.translateTime(n.range.from,!1),a.params.until=this.translateTime(n.range.to,!0)),this.doGraphiteRequest(a).then(function(t){return t.data&&t.data.values?s.a.map(t.data.values,function(t){return{text:t.value,id:t.id}}):[]})},this.getTagsAutoComplete=function(t,e,n){var a=n||{},i={method:"GET",url:"/tags/autoComplete/tags",params:{expr:s.a.map(t,function(t){return r.replace((t||"").trim())})},requestId:a.requestId};return e&&(i.params.tagPrefix=e),a.limit&&(i.params.limit=a.limit),a.range&&(i.params.from=o.translateTime(a.range.from,!1),i.params.until=o.translateTime(a.range.to,!0)),o.doGraphiteRequest(i).then(function(t){return t.data?s.a.map(t.data,function(t){return{text:t}}):[]})},this.getTagValuesAutoComplete=function(t,e,n,a){var i=a||{},l={method:"GET",url:"/tags/autoComplete/values",params:{expr:s.a.map(t,function(t){return r.replace((t||"").trim())}),tag:r.replace((e||"").trim())},requestId:i.requestId};return n&&(l.params.valuePrefix=n),i.limit&&(l.params.limit=i.limit),i.range&&(l.params.from=o.translateTime(i.range.from,!1),l.params.until=o.translateTime(i.range.to,!0)),o.doGraphiteRequest(l).then(function(t){return t.data?s.a.map(t.data,function(t){return{text:t}}):[]})},this.getVersion=function(t){var e=t||{},n={method:"GET",url:"/version",requestId:e.requestId};return this.doGraphiteRequest(n).then(function(t){if(t.data){return new u.a(t.data).isValid()?t.data:""}return""}).catch(function(){return""})},this.createFuncInstance=function(t,e){return c.a.createFuncInstance(t,e,this.funcDefs)},this.getFuncDef=function(t){return c.a.getFuncDef(t,this.funcDefs)},this.waitForFuncDefsLoaded=function(){return this.getFuncDefs()},this.getFuncDefs=function(){var t=this;if(null!==this.funcDefsPromise)return this.funcDefsPromise;if(!i(this.graphiteVersion))return this.funcDefs=c.a.getFuncDefs(this.graphiteVersion),this.funcDefsPromise=Promise.resolve(this.funcDefs),this.funcDefsPromise;var e={method:"GET",url:"/functions"};return this.funcDefsPromise=this.doGraphiteRequest(e).then(function(e){return 200!==e.status||"object"!=typeof e.data?t.funcDefs=c.a.getFuncDefs(t.graphiteVersion):t.funcDefs=c.a.parseFuncDefs(e.data),t.funcDefs}).catch(function(e){return console.log("Fetching graphite functions error",e),t.funcDefs=c.a.getFuncDefs(t.graphiteVersion),t.funcDefs}),this.funcDefsPromise},this.testDatasource=function(){return this.metricFindQuery("*").then(function(){return{status:"success",message:"Data source is working"}})},this.doGraphiteRequest=function(t){return(this.basicAuth||this.withCredentials)&&(t.withCredentials=!0),this.basicAuth&&(t.headers=t.headers||{},t.headers.Authorization=this.basicAuth),t.url=this.url+t.url,t.inspect={type:"graphite"},n.datasourceRequest(t)},this._seriesRefLetters="ABCDEFGHIJKLMNOPQRSTUVWXYZ",this.buildGraphiteParams=function(t,e){function n(t){return t.replace("m","min").replace("M","mon")}function a(t,e){return p[e]||t}var i,o,l,u=["from","until","rawData","format","maxDataPoints","cacheTimeout"],c=[],p={},d=/\#([A-Z])/g,h=/'(\d+)m'/gi,f=!1;for(t.format="json",l=0;l<t.targets.length;l++)i=t.targets[l],i.target&&(i.refId||(i.refId=this._seriesRefLetters[l]),o=r.replace(i.target,e),o=o.replace(h,n),p[i.refId]=o);for(l=0;l<t.targets.length;l++)i=t.targets[l],i.target&&(o=p[i.refId],o=o.replace(d,a),p[i.refId]=o,i.hide||(f=!0,c.push("target="+encodeURIComponent(o))));return s.a.each(t,function(t,e){-1!==s.a.indexOf(u,e)&&t&&c.push(e+"="+encodeURIComponent(t))}),f?c:[]}}function a(t){return Object(u.b)(t,"1.1")}function i(t){return Object(u.b)(t,"1.1")}r.$inject=["instanceSettings","$q","backendSrv","templateSrv"],e.a=r;var o=n(4),s=n.n(o),l=n(512),u=n(1481),c=n(1541)},1541:function(t,e,n){"use strict";function r(t){t.params=t.params||[],t.defaultParams=t.defaultParams||[],d[t.name]=t,t.shortName&&(d[t.shortName]=t)}function a(t,e){return!t.version||Object(p.b)(e,t.version)}function i(t,e,n){return c.a.isString(t)&&(t=o(t,n)),new f(t,e)}function o(t,e){if(!(e||d)[t])throw{message:"Method not found "+t};return(e||d)[t]}function s(t,e){var n={};return c.a.forEach(e||d,function(e){a(e,t)&&(n[e.name]=c.a.assign({},e,{params:c.a.filter(e.params,function(e){return a(e,t)})}))}),n}function l(t){var e={};return c.a.forEach(t||{},function(t,n){if("Graph"!==t.group){var r=t.description;r&&(r=r.replace(/:py:func:`(.+)( <[^>]*>)?`/g,"``$1``").replace(/.. seealso:: /g,"See also: ").replace(/.. code-block *:: *none/g,".. code-block::"));var a={name:t.name,description:r,category:t.group,params:[],defaultParams:[],fake:!1};/^seriesLists?$/.test(c.a.get(t,"params[0].type",""))?t.params[0].multiple?t.params[0].required=!1:t.params.shift():a.fake=!0,c.a.forEach(t.params,function(t){var e={name:t.name,type:"string",optional:!t.required,multiple:!!t.multiple,options:void 0};void 0!==t.default?a.defaultParams.push(c.a.toString(t.default)):t.suggestions?a.defaultParams.push(c.a.toString(t.suggestions[0])):a.defaultParams.push(""),"boolean"===t.type?(e.type="boolean",e.options=["true","false"]):"integer"===t.type?e.type="int":"float"===t.type?e.type="float":"node"===t.type?(e.type="node",e.options=["0","1","2","3","4","5","6","7","8","9","10","11","12"]):"nodeOrTag"===t.type?(e.type="node_or_tag",e.options=["name","0","1","2","3","4","5","6","7","8","9","10","11","12"]):"intOrInterval"===t.type?e.type="int_or_interval":"seriesList"===t.type&&(e.type="value_or_series"),t.options?e.options=c.a.map(t.options,c.a.toString):t.suggestions&&(e.options=c.a.map(t.suggestions,c.a.toString)),a.params.push(e)}),e[n]=a}}),e}var u=n(4),c=n.n(u),p=n(1481),d={},h=[{name:"other",type:"value_or_series",optional:!0,multiple:!0}];r({name:"scaleToSeconds",category:"Transform",params:[{name:"seconds",type:"int"}],defaultParams:[1]}),r({name:"perSecond",category:"Transform",params:[{name:"max value",type:"int",optional:!0}],defaultParams:[]}),r({name:"holtWintersForecast",category:"Calculate"}),r({name:"holtWintersConfidenceBands",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),r({name:"holtWintersAberration",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),r({name:"nPercentile",category:"Calculate",params:[{name:"Nth percentile",type:"int"}],defaultParams:[95]}),r({name:"diffSeries",params:h,defaultParams:["#A"],category:"Combine"}),r({name:"stddevSeries",params:h,defaultParams:[""],category:"Combine"}),r({name:"divideSeries",params:h,defaultParams:["#A"],category:"Combine"}),r({name:"multiplySeries",params:h,defaultParams:["#A"],category:"Combine"}),r({name:"asPercent",params:h,defaultParams:["#A"],category:"Combine"}),r({name:"group",params:h,defaultParams:["#A","#B"],category:"Combine"}),r({name:"sumSeries",shortName:"sum",category:"Combine",params:h,defaultParams:[""]}),r({name:"averageSeries",shortName:"avg",category:"Combine",params:h,defaultParams:[""]}),r({name:"rangeOfSeries",category:"Combine"}),r({name:"percentileOfSeries",category:"Combine",params:[{name:"n",type:"int"},{name:"interpolate",type:"boolean",options:["true","false"]}],defaultParams:[95,"false"]}),r({name:"sumSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),r({name:"maxSeries",shortName:"max",category:"Combine"}),r({name:"minSeries",shortName:"min",category:"Combine"}),r({name:"averageSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),r({name:"alias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:["alias"]}),r({name:"aliasSub",category:"Alias",params:[{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:["","\\1"]}),r({name:"consolidateBy",category:"Special",params:[{name:"function",type:"string",options:["sum","average","min","max"]}],defaultParams:["max"]}),r({name:"cumulative",category:"Special",params:[],defaultParams:[]}),r({name:"groupByNode",category:"Combine",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]},{name:"function",type:"string",options:["sum","avg","maxSeries"]}],defaultParams:[3,"sum"]}),r({name:"aliasByNode",category:"Alias",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[3]}),r({name:"substr",category:"Special",params:[{name:"start",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]},{name:"stop",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:[0,0]}),r({name:"sortByName",category:"Sorting",params:[{name:"natural",type:"boolean",options:["true","false"],optional:!0}],defaultParams:["false"]}),r({name:"sortByMaxima",category:"Sorting"}),r({name:"sortByMinima",category:"Sorting"}),r({name:"sortByTotal",category:"Sorting"}),r({name:"aliasByMetric",category:"Alias"}),r({name:"randomWalk",fake:!0,category:"Special",params:[{name:"name",type:"string"}],defaultParams:["randomWalk"]}),r({name:"countSeries",category:"Combine"}),r({name:"constantLine",category:"Special",params:[{name:"value",type:"int"}],defaultParams:[10]}),r({name:"cactiStyle",category:"Special"}),r({name:"keepLastValue",category:"Transform",params:[{name:"n",type:"int"}],defaultParams:[100]}),r({name:"changed",category:"Special",params:[],defaultParams:[]}),r({name:"scale",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[1]}),r({name:"offset",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[10]}),r({name:"transformNull",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[0]}),r({name:"integral",category:"Transform"}),r({name:"derivative",category:"Transform"}),r({name:"nonNegativeDerivative",category:"Transform",params:[{name:"max value or 0",type:"int",optional:!0}],defaultParams:[""]}),r({name:"timeShift",category:"Transform",params:[{name:"amount",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"]}),r({name:"timeStack",category:"Transform",params:[{name:"timeShiftUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]},{name:"timeShiftStart",type:"int"},{name:"timeShiftEnd",type:"int"}],defaultParams:["1d",0,7]}),r({name:"summarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]},{name:"alignToFrom",type:"boolean",optional:!0,options:["false","true"]}],defaultParams:["1h","sum","false"]}),r({name:"smartSummarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["1h","sum"]}),r({name:"absolute",category:"Transform"}),r({name:"hitcount",category:"Transform",params:[{name:"interval",type:"string"}],defaultParams:["10s"]}),r({name:"log",category:"Transform",params:[{name:"base",type:"int"}],defaultParams:["10"]}),r({name:"averageAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),r({name:"averageBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),r({name:"currentAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),r({name:"currentBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),r({name:"maximumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),r({name:"maximumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),r({name:"minimumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),r({name:"minimumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),r({name:"limit",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[5]}),r({name:"mostDeviant",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[10]}),r({name:"exclude",category:"Filter Series",params:[{name:"exclude",type:"string"}],defaultParams:["exclude"]}),r({name:"highestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),r({name:"highestMax",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),r({name:"lowestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),r({name:"movingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10]}),r({name:"movingMedian",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:["5"]}),r({name:"stdev",category:"Calculate",params:[{name:"n",type:"int"},{name:"tolerance",type:"int"}],defaultParams:[5,.1]}),r({name:"highestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),r({name:"lowestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),r({name:"removeAbovePercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),r({name:"removeAboveValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),r({name:"removeBelowPercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),r({name:"removeBelowValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),r({name:"useSeriesAbove",category:"Filter Series",params:[{name:"value",type:"int"},{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:[0,"search","replace"]}),r({name:"aggregateLine",category:"Calculate",params:[{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["avg"],version:"1.0"}),r({name:"averageOutsidePercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),r({name:"delay",category:"Transform",params:[{name:"steps",type:"int"}],defaultParams:[1],version:"1.0"}),r({name:"exponentialMovingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),r({name:"fallbackSeries",category:"Special",params:[{name:"fallback",type:"string"}],defaultParams:["constantLine(0)"],version:"1.0"}),r({name:"grep",category:"Filter Series",params:[{name:"grep",type:"string"}],defaultParams:["grep"],version:"1.0"}),r({name:"groupByNodes",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:["sum",3],version:"1.0"}),r({name:"integralByInterval",category:"Transform",params:[{name:"intervalUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"],version:"1.0"}),r({name:"interpolate",category:"Transform",params:[{name:"limit",type:"int",optional:!0}],defaultParams:[],version:"1.0"}),r({name:"invert",category:"Transform",version:"1.0"}),r({name:"isNonNull",category:"Combine",version:"1.0"}),r({name:"linearRegression",category:"Calculate",params:[{name:"startSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0},{name:"endSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:[],version:"1.0"}),r({name:"mapSeries",shortName:"map",params:[{name:"node",type:"int"}],defaultParams:[3],category:"Combine",version:"1.0"}),r({name:"movingMin",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),r({name:"movingMax",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),r({name:"movingSum",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),r({name:"multiplySeriesWithWildcards",category:"Combine",params:[{name:"position",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[2],version:"1.0"}),r({name:"offsetToZero",category:"Transform",version:"1.0"}),r({name:"pow",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[10],version:"1.0"}),r({name:"powSeries",category:"Transform",params:h,defaultParams:[""],version:"1.0"}),r({name:"reduceSeries",shortName:"reduce",params:[{name:"function",type:"string",options:["asPercent","diffSeries","divideSeries"]},{name:"reduceNode",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]},{name:"reduceMatchers",type:"string",multiple:!0}],defaultParams:["asPercent",2,"used_bytes"],category:"Combine",version:"1.0"}),r({name:"removeBetweenPercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),r({name:"removeEmptySeries",category:"Filter Series",version:"1.0"}),r({name:"squareRoot",category:"Transform",version:"1.0"}),r({name:"timeSlice",category:"Transform",params:[{name:"startSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"]},{name:"endSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:["-1h"],version:"1.0"}),r({name:"weightedAverage",category:"Combine",params:[{name:"other",type:"value_or_series",optional:!0},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:["#A",4],version:"1.0"}),r({name:"seriesByTag",category:"Special",params:[{name:"tagExpression",type:"string",multiple:!0}],version:"1.1"}),r({name:"groupByTags",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"tag",type:"string",multiple:!0}],defaultParams:["sum","tag"],version:"1.1"}),r({name:"aliasByTags",category:"Alias",params:[{name:"tag",type:"string",multiple:!0}],defaultParams:["tag"],version:"1.1"});var f=function(){function t(t,e){this.def=t,this.params=[],e&&e.withDefaultParams&&(this.params=t.defaultParams.slice(0)),this.updateText()}return t.prototype.render=function(t){for(var e=this.def.name+"(",n=c.a.map(this.params,function(t,e){var n;return e<this.def.params.length?n=this.def.params[e].type:c.a.get(c.a.last(this.def.params),"multiple")&&(n=c.a.get(c.a.last(this.def.params),"type")),"value_or_series"===n?t:"boolean"===n&&c.a.includes(["true","false"],t)?t:c.a.includes(["int","float","int_or_interval","node_or_tag","node"],n)&&c.a.isFinite(+t)?c.a.toString(+t):"'"+t+"'"}.bind(this));""===n[n.length-1];)n.pop();return t&&n.unshift(t),e+n.join(", ")+")"},t.prototype._hasMultipleParamsInString=function(t,e){return-1!==t.indexOf(",")&&(!(!this.def.params[e+1]||!this.def.params[e+1].optional)||!!(e+1>=this.def.params.length&&c.a.get(c.a.last(this.def.params),"multiple")))},t.prototype.updateParam=function(t,e){if(this._hasMultipleParamsInString(t,e))return void c.a.each(t.split(","),function(t,n){this.updateParam(t.trim(),e+n)}.bind(this));""===t&&(e>=this.def.params.length||this.def.params[e].optional)?this.params.splice(e,1):this.params[e]=t,this.updateText()},t.prototype.updateText=function(){if(0===this.params.length)return void(this.text=this.def.name+"()");var t=this.def.name+"(";t+=this.params.join(", "),t+=")",this.text=t},t}();e.a={createFuncInstance:i,getFuncDef:o,getFuncDefs:s,parseFuncDefs:l}},1542:function(t,e,n){"use strict";function r(t){return o.a.map(t,function(t){return{text:t,value:t}})}function a(t){return t.replace(d,"")}n.d(e,"a",function(){return h});var i=(n(1543),n(1544),n(4)),o=n.n(i),s=n(1545),l=n(1464),u=n(17),c=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=["=","!=","=~","!=~"],d="tag: ",h=function(t){function e(e,n,r,a,i){var o=t.call(this,e,n)||this;return o.uiSegmentSrv=r,o.templateSrv=a,o.supportsTags=o.datasource.supportsTags,o.paused=!1,o.target.target=o.target.target||"",o.datasource.waitForFuncDefsLoaded().then(function(){o.queryModel=new s.a(o.datasource,o.target,a),o.buildSegments()}),o.removeTagValue="-- remove tag --",o}return c(e,t),e.$inject=["$scope","$injector","uiSegmentSrv","templateSrv","$timeout"],e.prototype.parseTarget=function(){this.queryModel.parseTarget(),this.buildSegments()},e.prototype.toggleEditorMode=function(){this.target.textEditor=!this.target.textEditor,this.parseTarget()},e.prototype.buildSegments=function(){var t=this;this.segments=o.a.map(this.queryModel.segments,function(e){return t.uiSegmentSrv.newSegment(e)});var e=this.queryModel.checkOtherSegmentsIndex||0;this.checkOtherSegments(e),this.queryModel.seriesByTagUsed&&this.fixTagSegments()},e.prototype.addSelectMetricSegment=function(){this.queryModel.addSelectMetricSegment(),this.segments.push(this.uiSegmentSrv.newSelectMetric())},e.prototype.checkOtherSegments=function(t){var e=this;if(1!==this.queryModel.segments.length||"series-ref"!==this.queryModel.segments[0].type){if(0===t)return void this.addSelectMetricSegment();var n=this.queryModel.getSegmentPathUpTo(t+1);return""===n?Promise.resolve():this.datasource.metricFindQuery(n).then(function(r){if(0===r.length)""!==n&&(e.queryModel.segments=e.queryModel.segments.splice(0,t),e.segments=e.segments.splice(0,t),e.addSelectMetricSegment());else if(r[0].expandable){if(e.segments.length!==t)return e.checkOtherSegments(t+1);e.addSelectMetricSegment()}}).catch(function(t){u.a.emit("alert-error",["Error",t])})}},e.prototype.setSegmentFocus=function(t){o.a.each(this.segments,function(e,n){e.focus=t===n})},e.prototype.getAltSegments=function(t,e){var n=this,r=e&&e.length>0?"*"+e+"*":"*";t>0&&(r=this.queryModel.getSegmentPathUpTo(t)+"."+r);var a={range:this.panelCtrl.range,requestId:"get-alt-segments"};return this.datasource.metricFindQuery(r,a).then(function(r){var a=o.a.map(r,function(t){return n.uiSegmentSrv.newSegment({value:t.text,expandable:t.expandable})});return t>0&&0===a.length?a:(0===t&&o.a.eachRight(n.panelCtrl.panel.targets,function(t){t.refId!==n.queryModel.target.refId&&a.unshift(n.uiSegmentSrv.newSegment({type:"series-ref",value:"#"+t.refId,expandable:!1}))}),o.a.eachRight(n.templateSrv.variables,function(t){a.unshift(n.uiSegmentSrv.newSegment({type:"template",value:"$"+t.name,expandable:!0}))}),a.unshift(n.uiSegmentSrv.newSegment("*")),n.supportsTags&&0===t?(n.removeTaggedEntry(a),n.addAltTagSegments(e,a)):a)}).catch(function(t){return[]})},e.prototype.addAltTagSegments=function(t,e){return this.getTagsAsSegments(t).then(function(t){return t=o.a.map(t,function(t){return t.value=d+t.value,t}),e.concat.apply(e,t)})},e.prototype.removeTaggedEntry=function(t){t=o.a.remove(t,function(t){return"_tagged"===t.value})},e.prototype.segmentValueChanged=function(t,e){var n=this;if(this.error=null,this.queryModel.updateSegmentValue(t,e),this.queryModel.functions.length>0&&this.queryModel.functions[0].def.fake&&(this.queryModel.functions=[]),"tag"===t.type){var r=a(t.value);return this.pause(),void this.addSeriesByTagFunc(r)}if(t.expandable)return this.checkOtherSegments(e+1).then(function(){n.setSegmentFocus(e+1),n.targetChanged()});this.spliceSegments(e+1),this.setSegmentFocus(e+1),this.targetChanged()},e.prototype.spliceSegments=function(t){this.segments=this.segments.splice(0,t),this.queryModel.segments=this.queryModel.segments.splice(0,t)},e.prototype.emptySegments=function(){this.queryModel.segments=[],this.segments=[]},e.prototype.targetTextChanged=function(){this.updateModelTarget(),this.refresh()},e.prototype.updateModelTarget=function(){this.queryModel.updateModelTarget(this.panelCtrl.panel.targets)},e.prototype.targetChanged=function(){if(!this.queryModel.error){var t=this.queryModel.target.target;this.updateModelTarget(),this.queryModel.target===t||this.paused||this.panelCtrl.refresh()}},e.prototype.addFunction=function(t){var e=this.datasource.createFuncInstance(t,{withDefaultParams:!0});e.added=!0,this.queryModel.addFunction(e),this.smartlyHandleNewAliasByNode(e),1===this.segments.length&&this.segments[0].fake&&this.emptySegments(),!e.params.length&&e.added&&this.targetChanged(),"seriesByTag"===e.def.name&&this.parseTarget()},e.prototype.removeFunction=function(t){this.queryModel.removeFunction(t),this.targetChanged()},e.prototype.addSeriesByTagFunc=function(t){var e=this.datasource.createFuncInstance("seriesByTag",{withDefaultParams:!1}),n=t+"=";e.params=[n],this.queryModel.addFunction(e),e.added=!0,this.emptySegments(),this.targetChanged(),this.parseTarget()},e.prototype.smartlyHandleNewAliasByNode=function(t){if("aliasByNode"===t.def.name)for(var e=0;e<this.segments.length;e++)if(this.segments[e].value.indexOf("*")>=0)return t.params[0]=e,t.added=!1,void this.targetChanged()},e.prototype.getAllTags=function(){var t=this;return this.datasource.getTags().then(function(e){var n=o.a.map(e,"text");return n.splice(0,0,t.removeTagValue),r(n)})},e.prototype.getTags=function(t,e){var n=this,a=this.queryModel.renderTagExpressions(t);return this.datasource.getTagsAutoComplete(a,e).then(function(t){var e=o.a.map(t,"text");return e.splice(0,0,n.removeTagValue),r(e)})},e.prototype.getTagsAsSegments=function(t){var e=this,n=this.queryModel.renderTagExpressions();return this.datasource.getTagsAutoComplete(n,t).then(function(t){return o.a.map(t,function(t){return e.uiSegmentSrv.newSegment({value:t.text,type:"tag",expandable:!1})})})},e.prototype.getTagOperators=function(){return r(p)},e.prototype.getAllTagValues=function(t){var e=t.key;return this.datasource.getTagValues(e).then(function(t){return r(o.a.map(t,"text"))})},e.prototype.getTagValues=function(t,e,n){var a=this,i=this.queryModel.renderTagExpressions(e),s=t.key;return this.datasource.getTagValuesAutoComplete(i,s,n).then(function(t){var e=o.a.map(t,"text");return o.a.eachRight(a.templateSrv.variables,function(t){e.push("${"+t.name+":regex}")}),r(e)})},e.prototype.tagChanged=function(t,e){this.queryModel.updateTag(t,e),this.targetChanged()},e.prototype.addNewTag=function(t){var e=t.value,n={key:e,operator:"=",value:""};this.queryModel.addTag(n),this.targetChanged(),this.fixTagSegments()},e.prototype.removeTag=function(t){this.queryModel.removeTag(t),this.targetChanged()},e.prototype.fixTagSegments=function(){this.addTagSegments=[this.uiSegmentSrv.newPlusButton()]},e.prototype.showDelimiter=function(t){return t!==this.queryModel.tags.length-1},e.prototype.pause=function(){this.paused=!0},e.prototype.unpause=function(){this.paused=!1,this.panelCtrl.refresh()},e.templateUrl="partials/query.editor.html",e}(l.QueryCtrl)},1543:function(t,e,n){"use strict";function r(t){return{link:function(e,n){var r=e.ctrl,i=c()('<input type="text" class="gf-form-input" spellcheck="false" style="display:none"></input>'),o=c()('<a class="gf-form-label query-part dropdown-toggle" tabindex="1" gf-dropdown="functionMenu" data-toggle="dropdown"><i class="fa fa-plus"></i></a>');i.appendTo(n),o.appendTo(n),r.datasource.getFuncDefs().then(function(s){var u=l.a.map(s,"name").sort();e.functionMenu=a(s),i.attr("data-provide","typeahead"),i.typeahead({source:u,minLength:1,items:10,updater:function(t){var n=r.datasource.getFuncDef(t);return n||(t=t.toLowerCase(),n=l.a.find(u,function(e){return 0===e.toLowerCase().indexOf(t)}))?(e.$apply(function(){r.addFunction(n)}),i.trigger("blur"),""):""}}),o.click(function(){o.hide(),i.show(),i.focus()}),i.keyup(function(){n.toggleClass("open",""===i.val())}),i.blur(function(){setTimeout(function(){i.val(""),i.hide(),o.show(),n.removeClass("open")},200)}),t(n.contents())(e)});var s,u=function(){s&&(s.destroy(),s=null)};c()(n).on("mouseenter","ul.dropdown-menu li",function(){u();var t;try{t=r.datasource.getFuncDef(c()("a",this).text())}catch(t){}if(t&&t.description){var e=t.description;e.length>500&&(e=e.substring(0,497)+"...");var n=document.createElement("div");n.innerHTML="<h4>"+t.name+"</h4>"+d()(e),s=new f.a({target:this,content:n,classes:"drop-popover",openOn:"always",tetherOptions:{attachment:"bottom left",targetAttachment:"bottom right"}})}}).on("mouseout","ul.dropdown-menu li",function(){u()}),e.$on("$destroy",u)}}}function a(t){var e={};return l.a.forEach(t,function(t){t.category&&(e[t.category]||(e[t.category]=[]),e[t.category].push({text:t.name,click:"ctrl.addFunction('"+t.name+"')"}))}),l.a.sortBy(l.a.map(e,function(t,e){return{text:e,submenu:l.a.sortBy(t,"text")}}),"text")}r.$inject=["$compile"];var i=n(21),o=n.n(i),s=n(4),l=n.n(s),u=n(16),c=n.n(u),p=n(525),d=n.n(p),h=n(87),f=n.n(h);o.a.module("grafana.directives").directive("graphiteAddFunc",r)},1544:function(t,e,n){"use strict";function r(t,e,n){return{restrict:"A",link:function(r,a){function i(t){var e=u()(this),n=e.prev(".comma"),r=e.next();r.val(C.params[t]),n.removeClass("query-part__last"),e.hide(),r.show(),r.focus(),r.select();var a=r.data("typeahead");a&&(r.val(""),a.lookup())}function o(){M!==C.params.length&&(T||(T=!0,setTimeout(function(){S(),T=!1},200)))}function l(t){return t<C.def.params.length?C.def.params[t]:s.a.last(C.def.params).multiple?s.a.assign({},s.a.last(C.def.params),{optional:!0}):{}}function c(t,n){var a=u()(t);clearTimeout(P),P=null;var i=a.prev(),s=i.prev(".comma"),c=a.val();(""!==c||l(n).optional)&&(C.updateParam(c,n),i.html(c?e.highlightVariablesAsHtml(c):"&nbsp;")),o(),r.$apply(function(){_.targetChanged()}),i.hasClass("query-part__last")&&""===c?s.addClass("query-part__last"):i.removeClass("query-part__last"),a.hide(),i.show()}function d(t){var e=this;P=setTimeout(function(){c(e,t)},200)}function h(t,e){13===e.which&&u()(this).blur()}function f(){this.style.width=8*(3+this.value.length)+"px"}function m(t,e){t.attr("data-provide","typeahead");var n=l(e).options;"int"===l(e).type&&(n=s.a.map(n,function(t){return t.toString()})),t.typeahead({source:n,minLength:0,items:20,updater:function(n){return t.val(n),c(t[0],e),n}}),t.data("typeahead").lookup=function(){return this.query=this.$element.val()||"",this.process(this.source)}}function g(){var t=a.closest(".tight-form");if(a.hasClass("show-function-controls"))return a.removeClass("show-function-controls"),t.removeClass("has-open-function"),void k.hide();a.addClass("show-function-controls"),t.addClass("has-open-function"),k.show()}function v(){k.appendTo(a),w.appendTo(a);for(var n=s.a.clone(C.def.params),o=s.a.last(C.def.params);C.params.length>=n.length&&o&&o.multiple;)n.push(s.a.assign({},o,{optional:!0}));s.a.each(n,function(t,n){if(t.optional&&C.params.length<n)return!1;var r=e.highlightVariablesAsHtml(C.params[n]),o=n>=C.params.length-1&&t.optional&&!r;o&&t.multiple&&(r="+"),n>0&&u()('<span class="comma'+(o?" query-part__last":"")+'">, </span>').appendTo(a);var l=u()('<a ng-click="" class="graphite-func-param-link'+(o?" query-part__last":"")+'">'+(r||"&nbsp;")+"</a>"),c=u()('<input type="text" style="display:none" class="input-small tight-form-func-param"></input>');return c.attr("placeholder",t.name),M++,l.appendTo(a),c.appendTo(a),c.blur(s.a.partial(d,n)),c.keyup(f),c.keypress(s.a.partial(h,n)),l.click(s.a.partial(i,n)),t.options&&m(c,n),!0}),u()("<span>)</span>").appendTo(a),t(a.contents())(r)}function y(){r.func.added&&(r.func.added=!1,setTimeout(function(){a.find(".graphite-func-param-link").first().click()},10))}function b(){w.click(g)}function x(){k.click(function(t){var e=u()(t.target);if(e.hasClass("fa-remove"))return g(),void r.$apply(function(){_.removeFunction(r.func)});if(e.hasClass("fa-arrow-left"))return void r.$apply(function(){s.a.move(_.queryModel.functions,r.$index,r.$index-1),_.targetChanged()});if(e.hasClass("fa-arrow-right"))return void r.$apply(function(){s.a.move(_.queryModel.functions,r.$index,r.$index+1),_.targetChanged()});if(e.hasClass("fa-question-circle")){var a=_.datasource.getFuncDef(C.def.name);return void(a&&a.description?n.show({element:t.target,position:"bottom left",classNames:"drop-popover drop-function-def",template:'\n                  <div style="overflow:auto;max-height:30rem;">\n                    <h4> '+a.name+" </h4>\n                    "+p()(a.description)+"\n                  </div>",openOn:"click"}):window.open("http://graphite.readthedocs.org/en/latest/functions.html#graphite.render.functions."+C.def.name,"_blank"))}})}function S(){a.children().remove(),v(),y(),b(),x()}var w=u()('<a ng-click="">{{func.def.name}}</a><span>(</span>'),k=u()('\n    <div class="tight-form-func-controls">\n      <span class="pointer fa fa-arrow-left"></span>\n      <span class="pointer fa fa-question-circle"></span>\n      <span class="pointer fa fa-remove" ></span>\n      <span class="pointer fa fa-arrow-right"></span>\n    </div>'),_=r.ctrl,C=r.func,T=!1,M=0,P=null;S()}}}r.$inject=["$compile","templateSrv","popoverSrv"];var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=n(16),u=n.n(l),c=n(525),p=n.n(c);i.a.module("grafana.directives").directive("graphiteFuncEditor",r)},1545:function(t,e,n){"use strict";function r(t,e){return e.render(t)}function a(t){return t.key+t.operator+t.value}var i=n(4),o=n.n(i),s=n(1546),l=function(){function t(t,e,n,r){this.datasource=t,this.target=e,this.parseTarget(),this.removeTagValue="-- remove tag --"}return t.$inject=["datasource","target","templateSrv","scopedVars"],t.prototype.parseTarget=function(){if(this.functions=[],this.segments=[],this.tags=[],this.error=null,!this.target.textEditor){var t=new s.a(this.target.target),e=t.getAst();if(null===e)return void(this.checkOtherSegmentsIndex=0);if("error"===e.type)return this.error=e.message+" at position: "+e.pos,void(this.target.textEditor=!0);try{this.parseTargetRecursive(e,null)}catch(t){console.log("error parsing target:",t.message),this.error=t.message,this.target.textEditor=!0}this.checkOtherSegmentsIndex=this.segments.length-1,this.checkForSeriesByTag()}},t.prototype.checkForSeriesByTag=function(){var t=o.a.find(this.functions,function(t){return"seriesByTag"===t.def.name});if(t){this.seriesByTagUsed=!0,t.hidden=!0;var e=this.splitSeriesByTagParams(t);this.tags=e}},t.prototype.getSegmentPathUpTo=function(t){var e=this.segments.slice(0,t);return o.a.reduce(e,function(t,e){return t?t+"."+e.value:e.value},"")},t.prototype.parseTargetRecursive=function(t,e){var n=this;if(null===t)return null;switch(t.type){case"function":var r=this.datasource.createFuncInstance(t.name,{withDefaultParams:!1});o.a.each(t.params,function(t){n.parseTargetRecursive(t,r)}),r.updateText(),this.functions.push(r);break;case"series-ref":this.segments.length>0?this.addFunctionParameter(e,t.value):this.segments.push(t);break;case"bool":case"string":case"number":this.addFunctionParameter(e,t.value);break;case"metric":this.segments.length>0?this.addFunctionParameter(e,o.a.join(o.a.map(t.segments,"value"),".")):this.segments=t.segments}},t.prototype.updateSegmentValue=function(t,e){this.segments[e].value=t.value},t.prototype.addSelectMetricSegment=function(){this.segments.push({value:"select metric"})},t.prototype.addFunction=function(t){this.functions.push(t),this.moveAliasFuncLast()},t.prototype.moveAliasFuncLast=function(){var t=o.a.find(this.functions,function(t){return t.def.name.startsWith("alias")});t&&(this.functions=o.a.without(this.functions,t),this.functions.push(t))},t.prototype.addFunctionParameter=function(t,e){if(t.params.length>=t.def.params.length&&!o.a.get(o.a.last(t.def.params),"multiple",!1))throw{message:"too many parameters for function "+t.def.name};t.params.push(e)},t.prototype.removeFunction=function(t){this.functions=o.a.without(this.functions,t)},t.prototype.updateModelTarget=function(t){if(!this.target.textEditor){var e=this.getSegmentPathUpTo(this.segments.length).replace(/\.select metric$/,"");this.target.target=o.a.reduce(this.functions,r,e)}this.updateRenderedTarget(this.target,t);for(var n=0,a=t||[];n<a.length;n++){var i=a[n];i.refId!==this.target.refId&&this.updateRenderedTarget(i,t)}},t.prototype.updateRenderedTarget=function(t,e){function n(t,e){var n=0;o.a.each(t,function(t,r){if(r!==e){var i=a.exec(t.target),o=i&&i.length?i.length-1:0;n+=o}}),t[e].refCount=n}var r=o.a.keyBy(e,"refId");delete r[t.refId];var a=/\#([A-Z])/g,i=t.target;for(o.a.each(r,function(t,e){n(r,e)});i.match(a);){var s=i.replace(a,function(t,e){var n=r[e];return n?(0===n.refCount&&delete r[e],n.refCount--,n.target):t});if(s===i)break;i=s}delete t.targetFull,t.target!==i&&(t.targetFull=i)},t.prototype.splitSeriesByTagParams=function(t){var e=/([^\!=~]+)(\!?=~?)(.*)/;return o.a.flatten(o.a.map(t.params,function(t){var n=e.exec(t);if(n){var r=n.slice(1);if(3===r.length)return{key:r[0],operator:r[1],value:r[2]}}return[]}))},t.prototype.getSeriesByTagFuncIndex=function(){return o.a.findIndex(this.functions,function(t){return"seriesByTag"===t.def.name})},t.prototype.getSeriesByTagFunc=function(){var t=this.getSeriesByTagFuncIndex();return t>=0?this.functions[t]:void 0},t.prototype.addTag=function(t){var e=a(t);this.getSeriesByTagFunc().params.push(e),this.tags.push(t)},t.prototype.removeTag=function(t){this.getSeriesByTagFunc().params.splice(t,1),this.tags.splice(t,1)},t.prototype.updateTag=function(t,e){if(this.error=null,t.key===this.removeTagValue)return void this.removeTag(e);var n=a(t);this.getSeriesByTagFunc().params[e]=n,this.tags[e]=t},t.prototype.renderTagExpressions=function(t){return void 0===t&&(t=-1),o.a.compact(o.a.map(this.tags,function(e,n){if(n!==t)return e.key+e.operator+e.value}))},t}();e.a=l},1546:function(t,e,n){"use strict";function r(t){this.expression=t,this.lexer=new a.a(t),this.tokens=this.lexer.tokenize(),this.index=0}e.a=r;var a=n(1547);r.prototype={getAst:function(){return this.start()},start:function(){try{return this.functionCall()||this.metricExpression()}catch(t){return{type:"error",message:t.message,pos:t.pos}}},curlyBraceSegment:function(){if(this.match("identifier","{")||this.match("{")){for(var t="";!this.match("")&&!this.match("}");)t+=this.consumeToken().value;return this.match("}")||this.errorMark("Expected closing '}'"),t+=this.consumeToken().value,this.match("identifier")&&(t+=this.consumeToken().value),{type:"segment",value:t}}return null},metricSegment:function(){var t=this.curlyBraceSegment();if(t)return t;if(this.match("identifier")||this.match("number")){var e=this.consumeToken().value.split(".");return 2===e.length&&(this.tokens.splice(this.index,0,{type:"."}),this.tokens.splice(this.index+1,0,{type:"number",value:e[1]})),{type:"segment",value:e[0]}}this.match("templateStart")||this.errorMark("Expected metric identifier"),this.consumeToken(),this.match("identifier")||this.errorMark("Expected identifier after templateStart");var n={type:"template",value:this.consumeToken().value};return this.match("templateEnd")||this.errorMark("Expected templateEnd"),this.consumeToken(),n},metricExpression:function(){if(!(this.match("templateStart")||this.match("identifier")||this.match("number")||this.match("{")))return null;var t={type:"metric",segments:[]};for(t.segments.push(this.metricSegment());this.match(".");){this.consumeToken();var e=this.metricSegment();e||this.errorMark("Expected metric identifier"),t.segments.push(e)}return t},functionCall:function(){if(!this.match("identifier","("))return null;var t={type:"function",name:this.consumeToken().value};return this.consumeToken(),t.params=this.functionParameters(),this.match(")")||this.errorMark("Expected closing parenthesis"),this.consumeToken(),t},boolExpression:function(){return this.match("bool")?{type:"bool",value:"true"===this.consumeToken().value}:null},functionParameters:function(){if(this.match(")")||this.match(""))return[];var t=this.functionCall()||this.numericLiteral()||this.seriesRefExpression()||this.boolExpression()||this.metricExpression()||this.stringLiteral();return this.match(",")?(this.consumeToken(),[t].concat(this.functionParameters())):[t]},seriesRefExpression:function(){return this.match("identifier")&&this.tokens[this.index].value.match(/\#[A-Z]/)?{type:"series-ref",value:this.consumeToken().value}:null},numericLiteral:function(){return this.match("number")?{type:"number",value:parseFloat(this.consumeToken().value)}:null},stringLiteral:function(){if(!this.match("string"))return null;var t=this.consumeToken();if(t.isUnclosed)throw{message:"Unclosed string parameter",pos:t.pos};return{type:"string",value:t.value}},errorMark:function(t){var e=this.tokens[this.index];throw{message:t+" instead found "+(e?e.type:"end of string"),pos:e?e.pos:this.lexer.char}},consumeToken:function(){return this.index++,this.tokens[this.index-1]},matchToken:function(t,e){var n=this.tokens[this.index+e];return void 0===n&&""===t||n&&n.type===t},match:function(t,e){return this.matchToken(t,0)&&(!e||this.matchToken(e,1))}}},1547:function(t,e,n){"use strict";function r(t){this.input=t,this.char=1,this.from=1}e.a=r;for(var a=n(4),i=n.n(a),o=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4304,4346,4348,4348,4352,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7104,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11520,11557,11568,11621,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,13312,19893,19893,19968,19968,40907,40907,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42897,42912,42921,43002,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,44032,55203,55203,55216,55238,55243,55291,63744,64045,64048,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500,65536,65547,65549,65574,65576,65594,65596,65597,65599,65613,65616,65629,65664,65786,65856,65908,66176,66204,66208,66256,66304,66334,66352,66378,66432,66461,66464,66499,66504,66511,66513,66517,66560,66717,67584,67589,67592,67592,67594,67637,67639,67640,67644,67644,67647,67669,67840,67861,67872,67897,68096,68096,68112,68115,68117,68119,68121,68147,68192,68220,68352,68405,68416,68437,68448,68466,68608,68680,69635,69687,69763,69807,73728,74606,74752,74850,77824,78894,92160,92728,110592,110593,119808,119892,119894,119964,119966,119967,119970,119970,119973,119974,119977,119980,119982,119993,119995,119995,119997,120003,120005,120069,120071,120074,120077,120084,120086,120092,120094,120121,120123,120126,120128,120132,120134,120134,120138,120144,120146,120485,120488,120512,120514,120538,120540,120570,120572,120596,120598,120628,120630,120654,120656,120686,120688,120712,120714,120744,120746,120770,120772,120779,131072,131072,173782,173782,173824,173824,177972,177972,177984,177984,178205,178205,194560,195101],s=[],l=0;l<128;l++)s[l]=l>=48&&l<=57||36===l||126===l||124===l||l>=65&&l<=90||95===l||45===l||42===l||58===l||91===l||93===l||63===l||37===l||35===l||61===l||l>=97&&l<=122;var u=s;r.prototype={peek:function(t){return this.input.charAt(t||0)},skip:function(t){t=t||1,this.char+=t,this.input=this.input.slice(t)},tokenize:function(){for(var t,e=[];t=this.next();)e.push(t);return e},next:function(){if(this.from=this.char,/\s/.test(this.peek())){for(;/\s/.test(this.peek());)this.from+=1,this.skip();if(""===this.peek())return null}var t=this.scanStringLiteral();return t||(t=this.scanPunctuator()||this.scanNumericLiteral()||this.scanIdentifier()||this.scanTemplateSequence(),t?(this.skip(t.value.length),t):null)},scanTemplateSequence:function(){return"["===this.peek()&&"["===this.peek(1)?{type:"templateStart",value:"[[",pos:this.char}:"]"===this.peek()&&"]"===this.peek(1)?{type:"templateEnd",value:"[[",pos:this.char}:null},scanIdentifier:function(){function t(t){for(var e=0;e<o.length;){if(t<o[e++])return!1;if(t<=o[e++])return!0}return!1}function e(t){return/^[0-9a-fA-F]$/.test(t)}var n,r,a="",l=0,c=i.a.bind(function(){if(l+=1,"u"!==this.peek(l))return null;var n,r=this.peek(l+1),a=this.peek(l+2),i=this.peek(l+3),o=this.peek(l+4);return e(r)&&e(a)&&e(i)&&e(o)?(n=parseInt(r+a+i+o,16),t(n)?(l+=5,"\\u"+r+a+i+o):null):null},this),p=i.a.bind(function(){var e=this.peek(l),n=e.charCodeAt(0);return"*"===e?(l+=1,e):92===n?c():n<128?s[n]?(l+=1,e):null:t(n)?(l+=1,e):null},this),d=i.a.bind(function(){var e=this.peek(l),n=e.charCodeAt(0);return 92===n?c():n<128?u[n]?(l+=1,e):null:t(n)?(l+=1,e):null},this);if(null===(r=p()))return null;for(a=r;null!==(r=d());)a+=r;switch(a){case"true":case"false":n="bool";break;default:n="identifier"}return{type:n,value:a,pos:this.char}},scanNumericLiteral:function(){function t(t){return/^[0-9]$/.test(t)}function e(t){return/^[0-7]$/.test(t)}function n(t){return"$"===t||"_"===t||"\\"===t||t>="a"&&t<="z"||t>="A"&&t<="Z"}var r,a=0,i="",o=this.input.length,s=this.peek(a);if("-"===s&&(i+=s,a+=1,s=this.peek(a)),"."!==s&&!t(s))return null;if("."!==s){if(i+=this.peek(a),a+=1,s=this.peek(a),"0"===i){if("x"===s||"X"===s){for(a+=1,i+=s;a<o&&(s=this.peek(a),function(t){return/^[0-9a-fA-F]$/.test(t)}(s));)i+=s,a+=1;return i.length<=2?{type:"number",value:i,isMalformed:!0,pos:this.char}:a<o&&(s=this.peek(a),n(s))?null:{type:"number",value:i,base:16,isMalformed:!1,pos:this.char}}if(e(s)){for(a+=1,i+=s,r=!1;a<o;){if(s=this.peek(a),t(s)&&(r=!0),!e(s)){if(!this.isPunctuator(s))return null;break}i+=s,a+=1}return a<o&&(s=this.peek(a),n(s))?null:{type:"number",value:i,base:8,isMalformed:r}}t(s)&&(a+=1,i+=s)}for(;a<o&&(s=this.peek(a),t(s));)i+=s,a+=1}if("."===s)for(i+=s,a+=1;a<o&&(s=this.peek(a),t(s));)i+=s,a+=1;if("e"===s||"E"===s){if(i+=s,a+=1,s=this.peek(a),"+"!==s&&"-"!==s||(i+=this.peek(a),a+=1),s=this.peek(a),!t(s))return null;for(i+=s,a+=1;a<o&&(s=this.peek(a),t(s));)i+=s,a+=1}return a<o&&(s=this.peek(a),!this.isPunctuator(s))?null:{type:"number",value:i,base:10,pos:this.char,isMalformed:!isFinite(+i)}},isPunctuator:function(t){switch(t){case".":case"(":case")":case",":case"{":case"}":return!0}return!1},scanPunctuator:function(){var t=this.peek();return this.isPunctuator(t)?{type:t,value:t,pos:this.char}:null},scanStringLiteral:function(){var t=this.peek();if('"'!==t&&"'"!==t)return null;var e="";for(this.skip();this.peek()!==t;){if(""===this.peek())return{type:"string",value:e,isUnclosed:!0,quote:t,pos:this.char};e+=this.peek(),this.skip(1)}return this.skip(),{type:"string",value:e,isUnclosed:!1,quote:t,pos:this.char}}}},1548:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(t,e){this.graphiteVersions=[{name:"0.9.x",value:"0.9"},{name:"1.0.x",value:"1.0"},{name:"1.1.x",value:"1.1"}],this.datasourceSrv=e,this.current.jsonData=this.current.jsonData||{},this.current.jsonData.graphiteVersion=this.current.jsonData.graphiteVersion||"0.9",this.autoDetectGraphiteVersion()}return t.$inject=["$scope","datasourceSrv"],t.prototype.autoDetectGraphiteVersion=function(){var t=this;this.current.id&&this.datasourceSrv.loadDatasource(this.current.name).then(function(t){return t.getVersion()}).then(function(e){t.graphiteVersions.push({name:e,value:e}),t.current.jsonData.graphiteVersion=e})},t.templateUrl="public/app/plugins/datasource/graphite/partials/config.html",t}()},1549:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AnnotationsQueryCtrl",function(){return o});var r=(n(1482),n(1550)),a=n(1551),i=n(1552);n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a}),n.d(e,"ConfigCtrl",function(){return i.a});var o=function(){function t(){}return t.templateUrl="partials/annotations.editor.html",t}()},1550:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(512),l=n(224),u=n(1465),c=function(){function t(t,e,n,r,a){this.$q=e,this.backendSrv=n,this.templateSrv=r,this.timeSrv=a,this.type="cloudwatch",this.name=t.name,this.supportMetrics=!0,this.proxyUrl=t.url,this.defaultRegion=t.jsonData.defaultRegion,this.instanceSettings=t,this.standardStatistics=["Average","Maximum","Minimum","Sum","SampleCount"]}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","timeSrv"],t.prototype.query=function(t){var e=this;t=a.a.copy(t),t.targets=this.expandTemplateVariable(t.targets,t.scopedVars,this.templateSrv);var n=o.a.filter(t.targets,function(t){return!(!0===t.hide||!t.region||!t.namespace||!t.metricName||o.a.isEmpty(t.statistics))}).map(function(n){return n.region=e.templateSrv.replace(e.getActualRegion(n.region),t.scopedVars),n.namespace=e.templateSrv.replace(n.namespace,t.scopedVars),n.metricName=e.templateSrv.replace(n.metricName,t.scopedVars),n.dimensions=e.convertDimensionFormat(n.dimensions,t.scopedVars),n.period=String(e.getPeriod(n,t)),o.a.extend({refId:n.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.instanceSettings.id,type:"timeSeriesQuery"},n)});if(o.a.isEmpty(n)){var r=this.$q.defer();return r.resolve({data:[]}),r.promise}var i={from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:n};return this.performTimeSeriesQuery(i)},t.prototype.getPeriod=function(t,e,n){var r=this.convertToCloudWatchTime(e.range.from,!1),a=this.convertToCloudWatchTime(e.range.to,!0);n=Math.round((n||Date.now())/1e3);var i,o=a-r,s=60;return t.period?i=/^\d+$/.test(t.period)?parseInt(t.period,10):l.a.interval_to_seconds(this.templateSrv.replace(t.period,e.scopedVars)):s=i=n-r<=1296e3?"AWS/EC2"===t.namespace?300:60:n-r<=5443200?300:3600,i<1&&(i=1),!t.highResolution&&o/i>=1440&&(i=Math.ceil(o/1440/s)*s),i},t.prototype.performTimeSeriesQuery=function(t){return this.awsRequest("/api/tsdb/query",t).then(function(t){var e=[];return t.results&&o.a.forEach(t.results,function(t){o.a.forEach(t.series,function(t){e.push({target:t.name,datapoints:t.points})})}),{data:e}})},t.prototype.transformSuggestDataFromTable=function(t){return o.a.map(t.results.metricFindQuery.tables[0].rows,function(t){return{text:t[0],value:t[1]}})},t.prototype.doMetricQueryRequest=function(t,e){var n=this,r=this.timeSrv.timeRange();return this.awsRequest("/api/tsdb/query",{from:r.from.valueOf().toString(),to:r.to.valueOf().toString(),queries:[o.a.extend({refId:"metricFindQuery",intervalMs:1,maxDataPoints:1,datasourceId:this.instanceSettings.id,type:"metricFindQuery",subtype:t},e)]}).then(function(t){return n.transformSuggestDataFromTable(t)})},t.prototype.getRegions=function(){return this.doMetricQueryRequest("regions",null)},t.prototype.getNamespaces=function(){return this.doMetricQueryRequest("namespaces",null)},t.prototype.getMetrics=function(t,e){return this.doMetricQueryRequest("metrics",{region:this.templateSrv.replace(this.getActualRegion(e)),namespace:this.templateSrv.replace(t)})},t.prototype.getDimensionKeys=function(t,e){return this.doMetricQueryRequest("dimension_keys",{region:this.templateSrv.replace(this.getActualRegion(e)),namespace:this.templateSrv.replace(t)})},t.prototype.getDimensionValues=function(t,e,n,r,a){return this.doMetricQueryRequest("dimension_values",{region:this.templateSrv.replace(this.getActualRegion(t)),namespace:this.templateSrv.replace(e),metricName:this.templateSrv.replace(n),dimensionKey:this.templateSrv.replace(r),dimensions:this.convertDimensionFormat(a,{})})},t.prototype.getEbsVolumeIds=function(t,e){return this.doMetricQueryRequest("ebs_volume_ids",{region:this.templateSrv.replace(this.getActualRegion(t)),instanceId:this.templateSrv.replace(e)})},t.prototype.getEc2InstanceAttribute=function(t,e,n){return this.doMetricQueryRequest("ec2_instance_attribute",{region:this.templateSrv.replace(this.getActualRegion(t)),attributeName:this.templateSrv.replace(e),filters:n})},t.prototype.metricFindQuery=function(t){var e,n,r,a;if(t.match(/^regions\(\)/))return this.getRegions();if(t.match(/^namespaces\(\)/))return this.getNamespaces();var i=t.match(/^metrics\(([^\)]+?)(,\s?([^,]+?))?\)/);if(i)return n=i[1],e=i[3],this.getMetrics(n,e);var o=t.match(/^dimension_keys\(([^\)]+?)(,\s?([^,]+?))?\)/);if(o)return n=o[1],e=o[3],this.getDimensionKeys(n,e);var s=t.match(/^dimension_values\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)(,\s?(.+))?\)/);if(s){e=s[1],n=s[2],r=s[3];var l=s[4];return a={},s[6]&&(a=JSON.parse(this.templateSrv.replace(s[6]))),this.getDimensionValues(e,n,r,l,a)}var u=t.match(/^ebs_volume_ids\(([^,]+?),\s?([^,]+?)\)/);if(u){e=u[1];var c=u[2];return this.getEbsVolumeIds(e,c)}var p=t.match(/^ec2_instance_attribute\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/);if(p){e=p[1];var d=p[2];return a=JSON.parse(this.templateSrv.replace(p[3])),this.getEc2InstanceAttribute(e,d,a)}return this.$q.when([])},t.prototype.annotationQuery=function(t){var e=this,n=t.annotation,r=o.a.map(n.statistics,function(t){return e.templateSrv.replace(t)}),a=n.prefixMatching?"":"300",i=n.period||a;i=parseInt(i,10);var s={prefixMatching:n.prefixMatching,region:this.templateSrv.replace(this.getActualRegion(n.region)),namespace:this.templateSrv.replace(n.namespace),metricName:this.templateSrv.replace(n.metricName),dimensions:this.convertDimensionFormat(n.dimensions,{}),statistics:r,period:i,actionPrefix:n.actionPrefix||"",alarmNamePrefix:n.alarmNamePrefix||""};return this.awsRequest("/api/tsdb/query",{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[o.a.extend({refId:"annotationQuery",intervalMs:1,maxDataPoints:1,datasourceId:this.instanceSettings.id,type:"annotationQuery"},s)]}).then(function(t){return o.a.map(t.results.annotationQuery.tables[0].rows,function(t){return{annotation:n,time:Date.parse(t[0]),title:t[1],tags:[t[2]],text:t[3]}})})},t.prototype.targetContainsTemplate=function(t){var e=this;return this.templateSrv.variableExists(t.region)||this.templateSrv.variableExists(t.namespace)||this.templateSrv.variableExists(t.metricName)||o.a.find(t.dimensions,function(t,n){return e.templateSrv.variableExists(n)||e.templateSrv.variableExists(t)})},t.prototype.testDatasource=function(){var t=this.defaultRegion,e={};return this.getDimensionValues(t,"AWS/Billing","EstimatedCharges","ServiceName",e).then(function(){return{status:"success",message:"Data source is working"}},function(t){return{status:"error",message:t.message}})},t.prototype.awsRequest=function(t,e){var n={method:"POST",url:t,data:e};return this.backendSrv.datasourceRequest(n).then(function(t){return t.data})},t.prototype.getDefaultRegion=function(){return this.defaultRegion},t.prototype.getActualRegion=function(t){return"default"===t||o.a.isEmpty(t)?this.getDefaultRegion():t},t.prototype.getExpandedVariables=function(t,e,n,r){var i=o.a.find(n.options,{selected:!0,text:"All"});return o.a.chain(n.options).filter(function(t){return i?"All"!==t.text:t.selected}).map(function(i){var o=a.a.copy(t),s={};return s[n.name]=i,o.refId=t.refId+"_"+i.value,o.dimensions[e]=r.replace(o.dimensions[e],s),o}).value()},t.prototype.expandTemplateVariable=function(t,e,n){var r=this;return o.a.chain(t).map(function(t){var a=o.a.findKey(t.dimensions,function(t){return n.variableExists(t)&&!o.a.has(e,n.getVariableName(t))});if(a){var i=o.a.find(n.variables,function(e){return u.b(t.dimensions[a],e.name)&&e.multi}),s=o.a.find(n.variables,function(e){return u.b(t.dimensions[a],e.name)});return r.getExpandedVariables(t,a,i||s,n)}return[t]}).flatten().value()},t.prototype.convertToCloudWatchTime=function(t,e){return o.a.isString(t)&&(t=s.parse(t,e)),Math.round(t.valueOf()/1e3)},t.prototype.convertDimensionFormat=function(t,e){var n=this,r={};return o.a.each(t,function(t,a){r[n.templateSrv.replace(a,e)]=n.templateSrv.replace(t,e)}),r},t}();e.a=c},1551:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=(n(1482),n(1464)),a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.aliasSyntax="{{metric}} {{stat}} {{namespace}} {{region}} {{<dimension name>}}",r}return a(e,t),e.$inject=["$scope","$injector"],e.templateUrl="partials/query.editor.html",e}(r.QueryCtrl)},1552:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(t){this.accessKeyExist=!1,this.secretKeyExist=!1,this.authTypes=[{name:"Access & secret key",value:"keys"},{name:"Credentials file",value:"credentials"},{name:"ARN",value:"arn"}],this.indexPatternTypes=[{name:"No pattern",value:void 0},{name:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{name:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{name:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{name:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{name:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],this.current.jsonData.timeField=this.current.jsonData.timeField||"@timestamp",this.current.jsonData.authType=this.current.jsonData.authType||"credentials",this.accessKeyExist=this.current.secureJsonFields.accessKey,this.secretKeyExist=this.current.secureJsonFields.secretKey}return t.$inject=["$scope"],t.prototype.resetAccessKey=function(){this.accessKeyExist=!1},t.prototype.resetSecretKey=function(){this.secretKeyExist=!1},t.templateUrl="partials/config.html",t}()},1553:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"QueryOptionsCtrl",function(){return o}),n.d(e,"AnnotationsQueryCtrl",function(){return s});var r=n(1554),a=n(1558),i=n(1561);n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a}),n.d(e,"ConfigCtrl",function(){return i.a});var o=function(){function t(){}return t.templateUrl="partials/query.options.html",t}(),s=function(){function t(){}return t.templateUrl="partials/annotations.editor.html",t}()},1554:function(t,e,n){"use strict";n.d(e,"a",function(){return d});var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(1),l=n.n(s),u=n(1555),c=n(1556),p=n(1557),d=function(){function t(t,e,n,r,a){this.$q=e,this.backendSrv=n,this.templateSrv=r,this.timeSrv=a,this.basicAuth=t.basicAuth,this.withCredentials=t.withCredentials,this.url=t.url,this.name=t.name,this.index=t.index,this.timeField=t.jsonData.timeField,this.esVersion=t.jsonData.esVersion,this.indexPattern=new c.a(t.index,t.jsonData.interval),this.interval=t.jsonData.timeInterval,this.maxConcurrentShardRequests=t.jsonData.maxConcurrentShardRequests,this.queryBuilder=new u.a({timeField:this.timeField,esVersion:this.esVersion})}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","timeSrv"],t.prototype.request=function(t,e,n){var r={url:this.url+"/"+e,method:t,data:n};return(this.basicAuth||this.withCredentials)&&(r.withCredentials=!0),this.basicAuth&&(r.headers={Authorization:this.basicAuth}),this.backendSrv.datasourceRequest(r)},t.prototype.get=function(t){var e=this.timeSrv.timeRange(),n=this.indexPattern.getIndexList(e.from.valueOf(),e.to.valueOf());return o.a.isArray(n)&&n.length?this.request("GET",n[0]+t).then(function(t){return t.data.$$config=t.config,t.data}):this.request("GET",this.indexPattern.getIndexForToday()+t).then(function(t){return t.data.$$config=t.config,t.data})},t.prototype.post=function(t,e){return this.request("POST",t,e).then(function(t){return t.data.$$config=t.config,t.data}).catch(function(t){if(t.data&&t.data.error)throw{message:"Elasticsearch error: "+t.data.error.reason,error:t.data.error};throw t})},t.prototype.annotationQuery=function(t){var e=t.annotation,n=e.timeField||"@timestamp",r=e.query||"*",i=e.tagsField||"tags",s=e.textField||null,u={};u[n]={from:t.range.from.valueOf(),to:t.range.to.valueOf(),format:"epoch_millis"};var c=this.templateSrv.replace(r,{},"lucene"),p={bool:{filter:[{range:u},{query_string:{query:c}}]}},d={query:p,size:1e4};this.esVersion<5&&(d.fields=[n,"_source"]);var h={search_type:"query_then_fetch",ignore_unavailable:!0};e.index?h.index=e.index:h.index=this.indexPattern.getIndexList(t.range.from,t.range.to);var f=a.a.toJson(h)+"\n"+a.a.toJson(d)+"\n";return this.post("_msearch",f).then(function(t){for(var r=[],a=t.responses[0].hits.hits,u=function(t,e){if(e){for(var n=e.split("."),r=t,a=0;a<n.length;a++)if(!(r=r[n[a]]))return console.log("could not find field in annotation: ",e),"";return r}},c=0;c<a.length;c++){var p=a[c]._source,d=u(p,n);if(void 0!==a[c].fields){var h=a[c].fields;(o.a.isString(h[n])||o.a.isNumber(h[n]))&&(d=h[n])}var f={annotation:e,time:l.a.utc(d).valueOf(),text:u(p,s),tags:u(p,i)};if(e.titleField){var m=u(p,e.titleField);m&&(f.text=m+"\n"+f.text)}"string"==typeof f.tags&&(f.tags=f.tags.split(",")),r.push(f)}return r})},t.prototype.testDatasource=function(){return this.timeSrv.setTime({from:"now-1m",to:"now"},!0),this.getFields({type:"date"}).then(function(t){return o.a.find(t,{text:this.timeField})?{status:"success",message:"Index OK. Time field name OK."}:{status:"error",message:"No date field named "+this.timeField+" found"}}.bind(this),function(t){if(console.log(t),t.data&&t.data.error){var e=a.a.toJson(t.data.error);return t.data.error.reason&&(e=t.data.error.reason),{status:"error",message:e}}return{status:"error",message:t.status}})},t.prototype.getQueryHeader=function(t,e,n){var r={search_type:t,ignore_unavailable:!0,index:this.indexPattern.getIndexList(e,n)};return this.esVersion>=56&&(r.max_concurrent_shard_requests=this.maxConcurrentShardRequests),a.a.toJson(r)},t.prototype.query=function(t){for(var e,n="",r=[],i=this.templateSrv.getAdhocFilters(this.name),o=0;o<t.targets.length;o++)if(e=t.targets[o],!e.hide){var s=this.templateSrv.replace(e.query||"*",t.scopedVars,"lucene"),l=this.queryBuilder.build(e,i,s),u=a.a.toJson(l),c=0===l.size&&this.esVersion<5?"count":"query_then_fetch",d=this.getQueryHeader(c,t.range.from,t.range.to);n+=d+"\n",n+=u+"\n",r.push(e)}return 0===r.length?this.$q.when([]):(n=n.replace(/\$timeFrom/g,t.range.from.valueOf()),n=n.replace(/\$timeTo/g,t.range.to.valueOf()),n=this.templateSrv.replace(n,t.scopedVars),this.post("_msearch",n).then(function(t){return new p.a(r,t).getTimeSeries()}))},t.prototype.getFields=function(t){return this.get("/_mapping").then(function(e){function n(t,e,n){return"_"!==e[0]&&(!n.type||(n.type===t.type||n.type===a[t.type]))}function r(e){for(var a in e){var l=e[a];if(o.a.isObject(l.properties)&&(i.push(a),r(l.properties)),o.a.isObject(l.fields)&&(i.push(a),r(l.fields)),o.a.isString(l.type)){var u=i.concat(a).join(".");n(l,a,t)&&(s[u]={text:u,type:l.type})}}i.pop()}var a={float:"number",double:"number",integer:"number",long:"number",date:"date",string:"string",text:"string",scaled_float:"number",nested:"nested"},i=[],s={};for(var l in e){var u=e[l];if(u&&u.mappings){var c=u.mappings;for(var p in c){r(c[p].properties)}}}return o.a.map(s,function(t){return t})})},t.prototype.getTerms=function(t){var e=this.timeSrv.timeRange(),n=this.esVersion>=5?"query_then_fetch":"count",r=this.getQueryHeader(n,e.from,e.to),i=a.a.toJson(this.queryBuilder.getTermsQuery(t));return i=i.replace(/\$timeFrom/g,e.from.valueOf()),i=i.replace(/\$timeTo/g,e.to.valueOf()),i=r+"\n"+i+"\n",this.post("_msearch?search_type="+n,i).then(function(t){if(!t.responses[0].aggregations)return[];var e=t.responses[0].aggregations[1].buckets;return o.a.map(e,function(t){return{text:t.key_as_string||t.key,value:t.key}})})},t.prototype.metricFindQuery=function(t){return t=a.a.fromJson(t),t?"fields"===t.find?(t.field=this.templateSrv.replace(t.field,{},"lucene"),this.getFields(t)):"terms"===t.find?(t.query=this.templateSrv.replace(t.query||"*",{},"lucene"),this.getTerms(t)):void 0:this.$q.when([])},t.prototype.getTagKeys=function(){return this.getFields({})},t.prototype.getTagValues=function(t){return this.getTerms({field:t.key,query:"*"})},t}()},1555:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n(1467),a=function(){function t(t){this.timeField=t.timeField,this.esVersion=t.esVersion}return t.prototype.getRangeFilter=function(){var t={};return t[this.timeField]={gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"},t},t.prototype.buildTermsAgg=function(t,e,n){var r,a,i;if(e.terms={field:t.field},!t.settings)return e;if(e.terms.size=0===parseInt(t.settings.size,10)?500:parseInt(t.settings.size,10),void 0!==t.settings.orderBy&&(e.terms.order={},e.terms.order[t.settings.orderBy]=t.settings.order,r=parseInt(t.settings.orderBy,10),!isNaN(r)))for(i=0;i<n.metrics.length;i++)if(a=n.metrics[i],a.id===t.settings.orderBy){e.aggs={},e.aggs[a.id]={},e.aggs[a.id][a.type]={field:a.field};break}return void 0!==t.settings.min_doc_count&&(e.terms.min_doc_count=parseInt(t.settings.min_doc_count,10)),t.settings.missing&&(e.terms.missing=t.settings.missing),e},t.prototype.getDateHistogramAgg=function(t){var e={},n=t.settings||{};return e.interval=n.interval,e.field=this.timeField,e.min_doc_count=n.min_doc_count||0,e.extended_bounds={min:"$timeFrom",max:"$timeTo"},e.format="epoch_millis","auto"===e.interval&&(e.interval="$__interval"),n.missing&&(e.missing=n.missing),e},t.prototype.getHistogramAgg=function(t){var e={},n=t.settings||{};return e.interval=n.interval,e.field=t.field,e.min_doc_count=n.min_doc_count||0,n.missing&&(e.missing=n.missing),e},t.prototype.getFiltersAgg=function(t){for(var e={},n=0;n<t.settings.filters.length;n++){var r=t.settings.filters[n].query,a=t.settings.filters[n].label;a=""===a||void 0===a?r:a,e[a]={query_string:{query:r,analyze_wildcard:!0}}}return e},t.prototype.documentQuery=function(t,e){return t.size=e,t.sort={},t.sort[this.timeField]={order:"desc",unmapped_type:"boolean"},this.esVersion<5&&(t.fields=["*","_source"]),t.script_fields={},this.esVersion<5?t.fielddata_fields=[this.timeField]:t.docvalue_fields=[this.timeField],t},t.prototype.addAdhocFilters=function(t,e){if(e){var n,r,a,i;for(n=0;n<e.length;n++)switch(r=e[n],a={},a[r.key]=r.value,i={},i[r.key]={query:r.value},r.operator){case"=":t.query.bool.must||(t.query.bool.must=[]),t.query.bool.must.push({match_phrase:i});break;case"!=":t.query.bool.must_not||(t.query.bool.must_not=[]),t.query.bool.must_not.push({match_phrase:i});break;case"<":a[r.key]={lt:r.value},t.query.bool.filter.push({range:a});break;case">":a[r.key]={gt:r.value},t.query.bool.filter.push({range:a});break;case"=~":t.query.bool.filter.push({regexp:a});break;case"!~":t.query.bool.filter.push({bool:{must_not:{regexp:a}}})}}},t.prototype.build=function(t,e,n){t.metrics=t.metrics||[{type:"count",id:"1"}],t.bucketAggs=t.bucketAggs||[{type:"date_histogram",id:"2",settings:{interval:"auto"}}],t.timeField=this.timeField;var a,i,o,s={size:0,query:{bool:{filter:[{range:this.getRangeFilter()},{query_string:{analyze_wildcard:!0,query:n}}]}}};if(this.addAdhocFilters(s,e),0===t.bucketAggs.length){if(!(o=t.metrics[0])||"raw_document"!==o.type)throw{message:"Invalid query"};var l=o.settings&&o.settings.size||500;return this.documentQuery(s,l)}for(i=s,a=0;a<t.bucketAggs.length;a++){var u=t.bucketAggs[a],c={};switch(u.type){case"date_histogram":c.date_histogram=this.getDateHistogramAgg(u);break;case"histogram":c.histogram=this.getHistogramAgg(u);break;case"filters":c.filters={filters:this.getFiltersAgg(u)};break;case"terms":this.buildTermsAgg(u,c,t);break;case"geohash_grid":c.geohash_grid={field:u.field,precision:u.settings.precision}}i.aggs=i.aggs||{},i.aggs[u.id]=c,i=c}for(i.aggs={},a=0;a<t.metrics.length;a++)if(o=t.metrics[a],"count"!==o.type){var p={},d=null;if(r.l(o.type)){if(!o.pipelineAgg||!/^\d*$/.test(o.pipelineAgg))continue;d={buckets_path:o.pipelineAgg}}else d={field:o.field};for(var h in o.settings)o.settings.hasOwnProperty(h)&&null!==o.settings[h]&&(d[h]=o.settings[h]);p[o.type]=d,i.aggs[o.id]=p}return s},t.prototype.getTermsQuery=function(t){var e={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};t.query&&e.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:t.query}});var n=500;return t.size&&(n=t.size),e.aggs={1:{terms:{field:t.field,size:n,order:{_term:"asc"}}}},e},t}()},1556:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(1),a=n.n(r),i={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}},o=function(){function t(t,e){this.pattern=t,this.interval=e}return t.prototype.getIndexForToday=function(){return this.interval?a.a.utc().format(this.pattern):this.pattern},t.prototype.getIndexList=function(t,e){if(!this.interval)return this.pattern;for(var n=i[this.interval],r=a()(t).utc().startOf(n.startOf),o=a()(e).utc().startOf(n.startOf).valueOf(),s=[];r.valueOf()<=o;)s.push(r.format(this.pattern)),r.add(1,n.amount);return s},t}()},1557:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n(4),a=n.n(r),i=n(1467),o=n(1466),s=function(){function t(t,e){this.targets=t,this.response=e,this.targets=t,this.response=e}return t.prototype.processMetrics=function(t,e,n,r){var a,i,o,s,l,u;for(i=0;i<e.metrics.length;i++)if(a=e.metrics[i],!a.hide)switch(a.type){case"count":for(s={datapoints:[],metric:"count",props:r},o=0;o<t.buckets.length;o++)l=t.buckets[o],u=l.doc_count,s.datapoints.push([u,l.key]);n.push(s);break;case"percentiles":if(0===t.buckets.length)break;var c=t.buckets[0],p=c[a.id].values;for(var d in p){for(s={datapoints:[],metric:"p"+d,props:r,field:a.field},o=0;o<t.buckets.length;o++){l=t.buckets[o];var h=l[a.id].values;s.datapoints.push([h[d],l.key])}n.push(s)}break;case"extended_stats":for(var f in a.meta)if(a.meta[f]){for(s={datapoints:[],metric:f,props:r,field:a.field},o=0;o<t.buckets.length;o++){l=t.buckets[o];var m=l[a.id];m.std_deviation_bounds_upper=m.std_deviation_bounds.upper,m.std_deviation_bounds_lower=m.std_deviation_bounds.lower,s.datapoints.push([m[f],l.key])}n.push(s)}break;default:for(s={datapoints:[],metric:a.type,field:a.field,props:r},o=0;o<t.buckets.length;o++)l=t.buckets[o],void 0!==(u=l[a.id])&&(u.normalized_value?s.datapoints.push([u.normalized_value,l.key]):s.datapoints.push([u.value,l.key]));n.push(s)}},t.prototype.processAggregationDocs=function(t,e,n,r,i){if(0===r.columns.length){for(var o=0,s=a.a.keys(i);o<s.length;o++){var l=s[o];r.addColumn({text:l,filterable:!0})}r.addColumn({text:e.field,filterable:!0})}for(var u=function(t,e,n){r.addColumn({text:e}),t.push(n)},c=0,p=t.buckets;c<p.length;c++){for(var d=p[c],h=[],f=0,m=a.a.values(i);f<m.length;f++){var g=m[f];h.push(g)}h.push(d.key);for(var v=0,y=n.metrics;v<y.length;v++){var b=y[v];switch(b.type){case"count":u(h,this.getMetricName(b.type),d.doc_count);break;case"extended_stats":for(var x in b.meta)if(b.meta[x]){var S=d[b.id];S.std_deviation_bounds_upper=S.std_deviation_bounds.upper,S.std_deviation_bounds_lower=S.std_deviation_bounds.lower,u(h,this.getMetricName(x),S[x])}break;default:var w=this.getMetricName(b.type);a.a.filter(n.metrics,{type:b.type}).length>1&&(w+=" "+b.field),u(h,w,d[b.id].value)}}r.rows.push(h)}},t.prototype.processBuckets=function(t,e,n,r,i,o){var s,l,u,c,p=e.bucketAggs.length-1;for(c in t)if(l=a.a.find(e.bucketAggs,{id:c}),u=t[c],l)if(o===p)"date_histogram"===l.type?this.processMetrics(u,e,n,i):this.processAggregationDocs(u,l,e,r,i);else for(var d in u.buckets)s=u.buckets[d],i=a.a.clone(i),void 0!==s.key?i[l.field]=s.key:i.filter=d,s.key_as_string&&(i[l.field]=s.key_as_string),this.processBuckets(s,e,n,r,i,o+1)},t.prototype.getMetricName=function(t){var e=a.a.find(i.m,{value:t});return e||(e=a.a.find(i.e,{value:t})),e?e.text:t},t.prototype.getSeriesName=function(t,e,n){var r=this.getMetricName(t.metric);if(e.alias){var o=/\{\{([\s\S]+?)\}\}/g;return e.alias.replace(o,function(e,n,a){var i=n||a;return 0===i.indexOf("term ")?t.props[i.substring(5)]:void 0!==t.props[i]?t.props[i]:"metric"===i?r:"field"===i?t.field:e})}if(t.field&&i.l(t.metric)){var s=a.a.find(e.metrics,{id:t.field});s?r+=" "+i.b(s):r="Unset"}else t.field&&(r+=" "+t.field);if(0===a.a.keys(t.props).length)return r;var l="";for(var u in t.props)l+=t.props[u]+" ";return 1===n?l.trim():l.trim()+" "+r},t.prototype.nameSeries=function(t,e){for(var n=a.a.uniq(a.a.map(t,"metric")).length,r=0;r<t.length;r++){var i=t[r];i.target=this.getSeriesName(i,e,n)}},t.prototype.processHits=function(t,e){var n,r,a,i,o={target:"docs",type:"docs",datapoints:[],total:t.total,filterable:!0};for(i=0;i<t.hits.length;i++){if(r=t.hits[i],a={_id:r._id,_type:r._type,_index:r._index},r._source)for(n in r._source)a[n]=r._source[n];for(n in r.fields)a[n]=r.fields[n];o.datapoints.push(a)}e.push(o)},t.prototype.trimDatapoints=function(t,e){var n=a.a.find(e.bucketAggs,{type:"date_histogram"});if(n&&n.settings&&n.settings.trimEdges){var r=n.settings.trimEdges;for(var i in t){var o=t[i];o.datapoints.length>2*r&&(o.datapoints=o.datapoints.slice(r,o.datapoints.length-r))}}},t.prototype.getErrorFromElasticResponse=function(t,e){var n={};return n.data=JSON.stringify(e,null,4),e.root_cause&&e.root_cause.length>0&&e.root_cause[0].reason?n.message=e.root_cause[0].reason:n.message=e.reason||"Unkown elastic error response",t.$$config&&(n.config=t.$$config),n},t.prototype.getTimeSeries=function(){for(var t=[],e=0;e<this.response.responses.length;e++){var n=this.response.responses[e];if(n.error)throw this.getErrorFromElasticResponse(this.response,n.error);if(n.hits&&n.hits.hits.length>0&&this.processHits(n.hits,t),n.aggregations){var r=n.aggregations,a=this.targets[e],i=[],s=new o.a;this.processBuckets(r,a,i,s,{},0),this.trimDatapoints(i,a),this.nameSeries(i,a);for(var l=0;l<i.length;l++)t.push(i[l]);s.rows.length>0&&t.push(s)}}return{data:t}},t}()},1558:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=(n(1559),n(1560),n(21)),a=n.n(r),i=n(4),o=n.n(i),s=n(1467),l=n(1464),u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),c=function(t){function e(e,n,r,a){var i=t.call(this,e,n)||this;return i.$rootScope=r,i.uiSegmentSrv=a,i.esVersion=i.datasource.esVersion,i.queryUpdated(),i}return u(e,t),e.$inject=["$scope","$injector","$rootScope","uiSegmentSrv"],e.prototype.getFields=function(t){var e=a.a.toJson({find:"fields",type:t});return this.datasource.metricFindQuery(e).then(this.uiSegmentSrv.transformToSegments(!1)).catch(this.handleQueryError.bind(this))},e.prototype.queryUpdated=function(){var t=a.a.toJson(this.datasource.queryBuilder.build(this.target),!0);this.rawQueryOld&&t!==this.rawQueryOld&&this.refresh(),this.rawQueryOld=t,this.$rootScope.appEvent("elastic-query-updated")},e.prototype.getCollapsedText=function(){var t=this.target.metrics,e=this.target.bucketAggs,n=s.f(this.esVersion),r=s.a,a="";return this.target.query&&(a+="Query: "+this.target.query+", "),a+="Metrics: ",o.a.each(t,function(t,e){var r=o.a.find(n,{value:t.type});a+=r.text+"(",r.requiresField&&(a+=t.field),a+="), "}),o.a.each(e,function(t,e){0===e&&(a+=" Group by: ");var n=o.a.find(r,{value:t.type});a+=n.text+"(",n.requiresField&&(a+=t.field),a+="), "}),this.target.alias&&(a+="Alias: "+this.target.alias),a},e.prototype.handleQueryError=function(t){return this.error=t.message||"Failed to issue metric query",[]},e.templateUrl="partials/query.editor.html",e}(l.QueryCtrl)},1559:function(t,e,n){"use strict";function r(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/bucket_agg.html",controller:"ElasticBucketAggCtrl",restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&"}}}var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=n(1467),u=function(){function t(t,e,n,r){var a=t.target.bucketAggs;t.orderByOptions=[],t.getBucketAggTypes=function(){return l.a},t.getOrderOptions=function(){return l.o},t.getSizeOptions=function(){return l.p},r.onAppEvent("elastic-query-updated",function(){t.validateModel()},t),t.init=function(){t.agg=a[t.index],t.validateModel()},t.onChangeInternal=function(){t.onChange()},t.onTypeChanged=function(){switch(t.agg.settings={},t.showOptions=!1,t.agg.type){case"date_histogram":case"histogram":case"terms":delete t.agg.query,t.agg.field="select field";break;case"filters":delete t.agg.field,t.agg.query="*";break;case"geohash_grid":t.agg.settings.precision=3}t.validateModel(),t.onChange()},t.validateModel=function(){t.index=s.a.indexOf(a,t.agg),t.isFirst=0===t.index,t.bucketAggCount=a.length;var e="",n=t.agg.settings||{};switch(t.agg.type){case"terms":n.order=n.order||"desc",n.size=n.size||"10",n.min_doc_count=n.min_doc_count||1,n.orderBy=n.orderBy||"_term","0"!==n.size&&(e=l.c(n.order)+" "+n.size+", "),n.min_doc_count>0&&(e+="Min Doc Count: "+n.min_doc_count+", "),e+="Order by: "+l.d(n.orderBy,t.target),"0"===n.size&&(e+=" ("+n.order+")");break;case"filters":n.filters=n.filters||[{query:"*"}],e=s.a.reduce(n.filters,function(t,e,n){return t+="Q"+(n+1)+"  = "+e.query+" "},""),e.length>50&&(e=e.substr(0,50)+"..."),e="Filter Queries ("+n.filters.length+")";break;case"date_histogram":n.interval=n.interval||"auto",n.min_doc_count=n.min_doc_count||0,t.agg.field=t.target.timeField,e="Interval: "+n.interval,n.min_doc_count>0&&(e+=", Min Doc Count: "+n.min_doc_count),(void 0===n.trimEdges||n.trimEdges<0)&&(n.trimEdges=0),n.trimEdges&&n.trimEdges>0&&(e+=", Trim edges: "+n.trimEdges);break;case"histogram":n.interval=n.interval||1e3,n.min_doc_count=s.a.defaultTo(n.min_doc_count,1),e="Interval: "+n.interval,n.min_doc_count>0&&(e+=", Min Doc Count: "+n.min_doc_count);break;case"geohash_grid":n.precision=Math.max(Math.min(n.precision,7),1),e="Precision: "+n.precision}return t.settingsLinkText=e,t.agg.settings=n,!0},t.addFiltersQuery=function(){t.agg.settings.filters.push({query:"*"})},t.removeFiltersQuery=function(e){t.agg.settings.filters=s.a.without(t.agg.settings.filters,e)},t.toggleOptions=function(){t.showOptions=!t.showOptions},t.getOrderByOptions=function(){return l.h(t.target)},t.getFieldsInternal=function(){return"date_histogram"===t.agg.type?t.getFields({$fieldType:"date"}):t.getFields()},t.getIntervalOptions=function(){return n.when(e.transformToSegments(!0,"interval")(l.k))},t.addBucketAgg=function(){var e=a[a.length-1],n=a.length-1;e&&"date_histogram"===e.type&&(n-=1);var r=s.a.reduce(t.target.bucketAggs.concat(t.target.metrics),function(t,e){return parseInt(e.id)>t?parseInt(e.id):t},0);a.splice(n,0,{type:"terms",field:"select field",id:(r+1).toString(),fake:!0}),t.onChange()},t.removeBucketAgg=function(){a.splice(t.index,1),t.onChange()},t.init()}return t.$inject=["$scope","uiSegmentSrv","$q","$rootScope"],t}(),t=i.a.module("grafana.directives");t.directive("elasticBucketAgg",r),t.controller("ElasticBucketAggCtrl",u)},1560:function(t,e,n){"use strict";function r(){return{templateUrl:"public/app/plugins/datasource/elasticsearch/partials/metric_agg.html",controller:"ElasticMetricAggCtrl",restrict:"E",scope:{target:"=",index:"=",onChange:"&",getFields:"&",esVersion:"="}}}var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=n(1467),u=function(){function t(t,e,n,r){var a=t.target.metrics;t.metricAggTypes=l.f(t.esVersion),t.extendedStats=l.e,t.pipelineAggOptions=[],t.modelSettingsValues={},t.init=function(){t.agg=a[t.index],t.validateModel(),t.updatePipelineAggOptions()},t.updatePipelineAggOptions=function(){t.pipelineAggOptions=l.i(t.target)},r.onAppEvent("elastic-query-updated",function(){t.index=s.a.indexOf(a,t.agg),t.updatePipelineAggOptions(),t.validateModel()},t),t.validateModel=function(){if(t.isFirst=0===t.index,t.isSingle=1===a.length,t.settingsLinkText="",t.aggDef=s.a.find(t.metricAggTypes,{value:t.agg.type}),l.l(t.agg.type)){t.agg.pipelineAgg=t.agg.pipelineAgg||"select metric",t.agg.field=t.agg.pipelineAgg;var e=l.j(t.agg);e.length>0&&(s.a.each(e,function(e){t.agg.settings[e.text]=t.agg.settings[e.text]||e.default}),t.settingsLinkText="Options")}else t.agg.field||(t.agg.field="select field");switch(t.agg.type){case"cardinality":var n=t.agg.settings.precision_threshold||"";t.settingsLinkText="Precision threshold: "+n;break;case"percentiles":t.agg.settings.percents=t.agg.settings.percents||[25,50,75,95,99],t.settingsLinkText="Values: "+t.agg.settings.percents.join(",");break;case"extended_stats":0===s.a.keys(t.agg.meta).length&&(t.agg.meta.std_deviation_bounds_lower=!0,t.agg.meta.std_deviation_bounds_upper=!0);var r=s.a.reduce(t.agg.meta,function(e,n,r){if(n){var a=s.a.find(t.extendedStats,{value:r});e.push(a.text)}return e},[]);t.settingsLinkText="Stats: "+r.join(", ");break;case"moving_avg":t.movingAvgModelTypes=l.n,t.modelSettings=l.g(t.agg.settings.model,!0),t.updateMovingAvgModelSettings();break;case"raw_document":t.agg.settings.size=t.agg.settings.size||500,t.settingsLinkText="Size: "+t.agg.settings.size,t.target.metrics.splice(0,t.target.metrics.length,t.agg),t.target.bucketAggs=[]}if(t.aggDef.supportsInlineScript){var i=t.agg.inlineScript;i?t.agg.settings.script={inline:i}:delete t.agg.settings.script,""===t.settingsLinkText&&(t.settingsLinkText="Options")}},t.toggleOptions=function(){t.showOptions=!t.showOptions,t.updatePipelineAggOptions()},t.onChangeInternal=function(){t.onChange()},t.updateMovingAvgModelSettings=function(){for(var e=[],n=l.g(t.agg.settings.model,!1),r=0;r<n.length;r++)e.push(n[r].value);for(var a in t.agg.settings.settings)null!==t.agg.settings.settings[a]&&-1!==e.indexOf(a)||delete t.agg.settings.settings[a]},t.onChangeClearInternal=function(){delete t.agg.settings.minimize,t.onChange()},t.onTypeChange=function(){t.agg.settings={},t.agg.meta={},t.showOptions=!1,t.updatePipelineAggOptions(),t.onChange()},t.getFieldsInternal=function(){return"cardinality"===t.agg.type?t.getFields():t.getFields({$fieldType:"number"})},t.addMetricAgg=function(){var e=a.length,n=s.a.reduce(t.target.bucketAggs.concat(t.target.metrics),function(t,e){return parseInt(e.id)>t?parseInt(e.id):t},0);a.splice(e,0,{type:"count",field:"select field",id:(n+1).toString()}),t.onChange()},t.removeMetricAgg=function(){a.splice(t.index,1),t.onChange()},t.toggleShowMetric=function(){t.agg.hide=!t.agg.hide,t.agg.hide||delete t.agg.hide,t.onChange()},t.init()}return t.$inject=["$scope","uiSegmentSrv","$q","$rootScope"],t}(),t=i.a.module("grafana.directives");t.directive("elasticMetricAgg",r),t.controller("ElasticMetricAggCtrl",u)},1561:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(4),a=n.n(r),i=function(){function t(t){this.indexPatternTypes=[{name:"No pattern",value:void 0},{name:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{name:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{name:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{name:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{name:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],this.esVersions=[{name:"2.x",value:2},{name:"5.x",value:5},{name:"5.6+",value:56}],this.current.jsonData.timeField=this.current.jsonData.timeField||"@timestamp",this.current.jsonData.esVersion=this.current.jsonData.esVersion||5,this.current.jsonData.maxConcurrentShardRequests=this.current.jsonData.maxConcurrentShardRequests||256}return t.$inject=["$scope"],t.prototype.indexPatternTypeChanged=function(){var t=a.a.find(this.indexPatternTypes,{value:this.current.jsonData.interval});this.current.database=t.example||"es-index-name"},t.templateUrl="public/app/plugins/datasource/elasticsearch/partials/config.html",t}()},1562:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AnnotationsQueryCtrl",function(){return o});var r=n(1563),a=n(1564),i=n(1565);n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a}),n.d(e,"ConfigCtrl",function(){return i.a});var o=function(){function t(){}return t.templateUrl="partials/annotations.editor.html",t}()},1563:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(512),l=function(){function t(t,e,n,r){this.$q=e,this.backendSrv=n,this.templateSrv=r,this.type="opentsdb",this.url=t.url,this.name=t.name,this.withCredentials=t.withCredentials,this.basicAuth=t.basicAuth,t.jsonData=t.jsonData||{},this.tsdbVersion=t.jsonData.tsdbVersion||1,this.tsdbResolution=t.jsonData.tsdbResolution||1,this.supportMetrics=!0,this.tagKeys={},this.aggregatorsPromise=null,this.filterTypesPromise=null}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv"],t.prototype.query=function(t){var e=this.convertToTSDBTime(t.rangeRaw.from,!1),n=this.convertToTSDBTime(t.rangeRaw.to,!0),r=[];o.a.each(t.targets,function(e){e.metric&&r.push(this.convertTargetToQuery(e,t,this.tsdbVersion))}.bind(this));var a=o.a.compact(r);if(o.a.isEmpty(a)){var i=this.$q.defer();return i.resolve({data:[]}),i.promise}var s={};return o.a.each(a,function(t){t.filters&&t.filters.length>0?o.a.each(t.filters,function(t){s[t.tagk]=!0}):o.a.each(t.tags,function(t,e){s[e]=!0})}),t.targets=o.a.filter(t.targets,function(t){return!0!==t.hide}),this.performTimeSeriesQuery(a,e,n).then(function(e){var n=this.mapMetricsToTargets(e.data,t,this.tsdbVersion);return{data:o.a.map(e.data,function(e,r){return r=n[r],-1===r&&(r=0),this._saveTagKeys(e),this.transformMetricData(e,s,t.targets[r],t,this.tsdbResolution)}.bind(this))}}.bind(this))},t.prototype.annotationQuery=function(t){var e=this.convertToTSDBTime(t.rangeRaw.from,!1),n=this.convertToTSDBTime(t.rangeRaw.to,!0),r=[],a=[];r.push({aggregator:"sum",metric:t.annotation.target});var i=o.a.compact(r);return this.performTimeSeriesQuery(i,e,n).then(function(e){if(e.data[0]){var n=e.data[0].annotations;t.annotation.isGlobal&&(n=e.data[0].globalAnnotations),n&&o.a.each(n,function(e){var n={text:e.description,time:1e3*Math.floor(e.startTime),annotation:t.annotation};a.push(n)})}return a}.bind(this))},t.prototype.targetContainsTemplate=function(t){if(t.filters&&t.filters.length>0)for(var e=0;e<t.filters.length;e++)if(this.templateSrv.variableExists(t.filters[e].filter))return!0;if(t.tags&&Object.keys(t.tags).length>0)for(var n in t.tags)if(this.templateSrv.variableExists(t.tags[n]))return!0;return!1},t.prototype.performTimeSeriesQuery=function(t,e,n){var r=!1;2===this.tsdbResolution&&(r=!0);var a={start:e,queries:t,msResolution:r,globalAnnotations:!0};3===this.tsdbVersion&&(a.showQuery=!0),n&&(a.end=n);var i={method:"POST",url:this.url+"/api/query",data:a};return this._addCredentialOptions(i),this.backendSrv.datasourceRequest(i)},t.prototype.suggestTagKeys=function(t){return this.$q.when(this.tagKeys[t]||[])},t.prototype._saveTagKeys=function(t){var e=Object.keys(t.tags);o.a.each(t.aggregateTags,function(t){e.push(t)}),this.tagKeys[t.metric]=e},t.prototype._performSuggestQuery=function(t,e){return this._get("/api/suggest",{type:e,q:t,max:1e3}).then(function(t){return t.data})},t.prototype._performMetricKeyValueLookup=function(t,e){if(!t||!e)return this.$q.when([]);var n=e.split(",").map(function(t){return t.trim()}),r=n[0],a=r+"=*";n.length>1&&(a+=","+n.splice(1).join(","));var i=t+"{"+a+"}";return this._get("/api/search/lookup",{m:i,limit:3e3}).then(function(t){t=t.data.results;var e=[];return o.a.each(t,function(t){-1===e.indexOf(t.tags[r])&&e.push(t.tags[r])}),e})},t.prototype._performMetricKeyLookup=function(t){return t?this._get("/api/search/lookup",{m:t,limit:1e3}).then(function(t){t=t.data.results;var e=[];return o.a.each(t,function(t){o.a.each(t.tags,function(t,n){-1===e.indexOf(n)&&e.push(n)})}),e}):this.$q.when([])},t.prototype._get=function(t,e){var n={method:"GET",url:this.url+t,params:e};return this._addCredentialOptions(n),this.backendSrv.datasourceRequest(n)},t.prototype._addCredentialOptions=function(t){(this.basicAuth||this.withCredentials)&&(t.withCredentials=!0),this.basicAuth&&(t.headers={Authorization:this.basicAuth})},t.prototype.metricFindQuery=function(t){if(!t)return this.$q.when([]);var e;try{e=this.templateSrv.replace(t,{},"distributed")}catch(t){return this.$q.reject(t)}var n=function(t){return o.a.map(t,function(t){return{text:t}})},r=/metrics\((.*)\)/,a=/tag_names\((.*)\)/,i=/tag_values\((.*?),\s?(.*)\)/,s=/suggest_tagk\((.*)\)/,l=/suggest_tagv\((.*)\)/,u=e.match(r);if(u)return this._performSuggestQuery(u[1],"metrics").then(n);var c=e.match(a);if(c)return this._performMetricKeyLookup(c[1]).then(n);var p=e.match(i);if(p)return this._performMetricKeyValueLookup(p[1],p[2]).then(n);var d=e.match(s);if(d)return this._performSuggestQuery(d[1],"tagk").then(n);var h=e.match(l);return h?this._performSuggestQuery(h[1],"tagv").then(n):this.$q.when([])},t.prototype.testDatasource=function(){return this._performSuggestQuery("cpu","metrics").then(function(){return{status:"success",message:"Data source is working"}})},t.prototype.getAggregators=function(){return this.aggregatorsPromise?this.aggregatorsPromise:(this.aggregatorsPromise=this._get("/api/aggregators").then(function(t){return t.data&&o.a.isArray(t.data)?t.data.sort():[]}),this.aggregatorsPromise)},t.prototype.getFilterTypes=function(){return this.filterTypesPromise?this.filterTypesPromise:(this.filterTypesPromise=this._get("/api/config/filters").then(function(t){return t.data?Object.keys(t.data).sort():[]}),this.filterTypesPromise)},t.prototype.transformMetricData=function(t,e,n,r,a){var i=this.createMetricLabel(t,n,e,r),s=[];return o.a.each(t.dps,function(t,e){2===a?s.push([t,1*e]):s.push([t,1e3*e])}),{target:i,datapoints:s}},t.prototype.createMetricLabel=function(t,e,n,r){if(e.alias){var a=o.a.clone(r.scopedVars||{});return o.a.each(t.tags,function(t,e){a["tag_"+e]={value:t}}),this.templateSrv.replace(e.alias,a)}var i=t.metric,s=[];return o.a.isEmpty(t.tags)||o.a.each(o.a.toPairs(t.tags),function(t){o.a.has(n,t[0])&&s.push(t[0]+"="+t[1])}),o.a.isEmpty(s)||(i+="{"+s.join(", ")+"}"),i},t.prototype.convertTargetToQuery=function(t,e,n){if(!t.metric||t.hide)return null;var r={metric:this.templateSrv.replace(t.metric,e.scopedVars,"pipe"),aggregator:"avg"};if(t.aggregator&&(r.aggregator=this.templateSrv.replace(t.aggregator)),t.shouldComputeRate&&(r.rate=!0,r.rateOptions={counter:!!t.isCounter},t.counterMax&&t.counterMax.length&&(r.rateOptions.counterMax=parseInt(t.counterMax)),t.counterResetValue&&t.counterResetValue.length&&(r.rateOptions.resetValue=parseInt(t.counterResetValue)),n>=2&&(r.rateOptions.dropResets=!(r.rateOptions.counterMax||r.rateOptions.ResetValue&&0!==r.rateOptions.ResetValue))),!t.disableDownsampling){var i=this.templateSrv.replace(t.downsampleInterval||e.interval);i.match(/\.[0-9]+s/)&&(i=1e3*parseFloat(i)+"ms"),r.downsample=i+"-"+t.downsampleAggregator,t.downsampleFillPolicy&&"none"!==t.downsampleFillPolicy&&(r.downsample+="-"+t.downsampleFillPolicy)}if(t.filters&&t.filters.length>0){if(r.filters=a.a.copy(t.filters),r.filters)for(var o in r.filters)r.filters[o].filter=this.templateSrv.replace(r.filters[o].filter,e.scopedVars,"pipe")}else if(r.tags=a.a.copy(t.tags),r.tags)for(var s in r.tags)r.tags[s]=this.templateSrv.replace(r.tags[s],e.scopedVars,"pipe");return t.explicitTags&&(r.explicitTags=!0),r},t.prototype.mapMetricsToTargets=function(t,e,n){var r,a;return o.a.map(t,function(t){return 3===n?t.query.index:o.a.findIndex(e.targets,function(n){return n.filters&&n.filters.length>0?n.metric===t.metric:n.metric===t.metric&&o.a.every(n.tags,function(n,i){return r=this.templateSrv.replace(n,e.scopedVars,"pipe"),a=r.split("|"),o.a.includes(a,t.tags[i])||"*"===r})})})},t.prototype.convertToTSDBTime=function(t,e){return"now"===t?null:(t=s.parse(t,e),t.valueOf())},t}();e.a=l},1564:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(4),a=n.n(r),i=n(224),o=n(1464),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.errors=r.validateTarget(),r.aggregators=["avg","sum","min","max","dev","zimsum","mimmin","mimmax"],r.fillPolicies=["none","nan","null","zero"],r.filterTypes=["wildcard","iliteral_or","not_iliteral_or","not_literal_or","iwildcard","literal_or","regexp"],r.tsdbVersion=r.datasource.tsdbVersion,r.target.aggregator||(r.target.aggregator="sum"),r.target.downsampleAggregator||(r.target.downsampleAggregator="avg"),r.target.downsampleFillPolicy||(r.target.downsampleFillPolicy="none"),r.datasource.getAggregators().then(function(t){0!==t.length&&(r.aggregators=t)}),r.datasource.getFilterTypes().then(function(t){0!==t.length&&(r.filterTypes=t)}),r.suggestMetrics=function(t,e){r.datasource.metricFindQuery("metrics("+t+")").then(r.getTextValues).then(e)},r.suggestTagKeys=function(t,e){r.datasource.suggestTagKeys(r.target.metric).then(e)},r.suggestTagValues=function(t,e){r.datasource.metricFindQuery("suggest_tagv("+t+")").then(r.getTextValues).then(e)},r}return s(e,t),e.$inject=["$scope","$injector"],e.prototype.targetBlur=function(){this.errors=this.validateTarget(),this.refresh()},e.prototype.getTextValues=function(t){return a.a.map(t,function(t){return t.text})},e.prototype.addTag=function(){if(this.target.filters&&this.target.filters.length>0&&(this.errors.tags="Please remove filters to use tags, tags and filters are mutually exclusive."),!this.addTagMode)return void(this.addTagMode=!0);this.target.tags||(this.target.tags={}),this.errors=this.validateTarget(),this.errors.tags||(this.target.tags[this.target.currentTagKey]=this.target.currentTagValue,this.target.currentTagKey="",this.target.currentTagValue="",this.targetBlur()),this.addTagMode=!1},e.prototype.removeTag=function(t){delete this.target.tags[t],this.targetBlur()},e.prototype.editTag=function(t,e){this.removeTag(t),this.target.currentTagKey=t,this.target.currentTagValue=e,this.addTag()},e.prototype.closeAddTagMode=function(){this.addTagMode=!1},e.prototype.addFilter=function(){if(this.target.tags&&a.a.size(this.target.tags)>0&&(this.errors.filters="Please remove tags to use filters, tags and filters are mutually exclusive."),!this.addFilterMode)return void(this.addFilterMode=!0);if(this.target.filters||(this.target.filters=[]),this.target.currentFilterType||(this.target.currentFilterType="iliteral_or"),this.target.currentFilterGroupBy||(this.target.currentFilterGroupBy=!1),this.errors=this.validateTarget(),!this.errors.filters){var t={type:this.target.currentFilterType,tagk:this.target.currentFilterKey,filter:this.target.currentFilterValue,groupBy:this.target.currentFilterGroupBy};this.target.filters.push(t),this.target.currentFilterType="literal_or",this.target.currentFilterKey="",this.target.currentFilterValue="",this.target.currentFilterGroupBy=!1,this.targetBlur()}this.addFilterMode=!1},e.prototype.removeFilter=function(t){this.target.filters.splice(t,1),this.targetBlur()},e.prototype.editFilter=function(t,e){this.removeFilter(e),this.target.currentFilterKey=t.tagk,this.target.currentFilterValue=t.filter,this.target.currentFilterType=t.type,this.target.currentFilterGroupBy=t.groupBy,this.addFilter()},e.prototype.closeAddFilterMode=function(){this.addFilterMode=!1},e.prototype.validateTarget=function(){var t={};if(this.target.shouldDownsample)try{this.target.downsampleInterval?i.a.describe_interval(this.target.downsampleInterval):t.downsampleInterval="You must supply a downsample interval (e.g. '1m' or '1h')."}catch(e){t.downsampleInterval=e.message}return this.target.tags&&a.a.has(this.target.tags,this.target.currentTagKey)&&(t.tags="Duplicate tag key '"+this.target.currentTagKey+"'."),t},e.templateUrl="partials/query.editor.html",e}(o.QueryCtrl)},1565:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(t){this.tsdbVersions=[{name:"<=2.1",value:1},{name:"==2.2",value:2},{name:"==2.3",value:3}],this.tsdbResolutions=[{name:"second",value:1},{name:"millisecond",value:2}],this.current.jsonData=this.current.jsonData||{},this.current.jsonData.tsdbVersion=this.current.jsonData.tsdbVersion||1,this.current.jsonData.tsdbResolution=this.current.jsonData.tsdbResolution||1}return t.$inject=["$scope"],t.templateUrl="public/app/plugins/datasource/opentsdb/partials/config.html",t}()},1566:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"QueryCtrl",function(){return o}),n.d(e,"AnnotationsQueryCtrl",function(){return s});var r=n(1567),a=n(1464);n.d(e,"GrafanaDatasource",function(){return r.a}),n.d(e,"Datasource",function(){return r.a});var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.templateUrl="partials/query.editor.html",e}(a.QueryCtrl),s=function(){function t(){this.types=[{text:"Dashboard",value:"dashboard"},{text:"Tags",value:"tags"}],this.annotation.type=this.annotation.type||"tags",this.annotation.limit=this.annotation.limit||100}return t.templateUrl="partials/annotations.editor.html",t}()},1567:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(4),a=n.n(r),i=function(){function t(t,e){this.backendSrv=t,this.$q=e}return t.$inject=["backendSrv","$q"],t.prototype.query=function(t){return this.backendSrv.get("/api/tsdb/testdata/random-walk",{from:t.range.from.valueOf(),to:t.range.to.valueOf(),intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints}).then(function(t){var e=[];return t.results&&a.a.forEach(t.results,function(t){for(var n=0,r=t.series;n<r.length;n++){var a=r[n];e.push({target:a.name,datapoints:a.points})}}),{data:e}})},t.prototype.metricFindQuery=function(t){return this.$q.when({data:[]})},t.prototype.annotationQuery=function(t){var e={from:t.range.from.valueOf(),to:t.range.to.valueOf(),limit:t.annotation.limit,tags:t.annotation.tags};if("dashboard"===t.annotation.type){if(!t.dashboard.id)return this.$q.when([]);e.dashboardId=t.dashboard.id,delete e.tags}else if(!a.a.isArray(t.annotation.tags)||0===t.annotation.tags.length)return this.$q.when([]);return this.backendSrv.get("/api/annotations",e)},t}()},1568:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"ConfigCtrl",function(){return i}),n.d(e,"AnnotationsQueryCtrl",function(){return o});var r=n(1569),a=n(1572);n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a});var i=function(){function t(){}return t.templateUrl="partials/config.html",t}(),o=function(){function t(){}return t.templateUrl="partials/annotations.editor.html",t}()},1569:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(512),o=n(1570),s=n(1483),l=n(1571),u=n(1485),c=function(){function t(t,e,n,r){this.$q=e,this.backendSrv=n,this.templateSrv=r,this.type="influxdb",this.urls=a.a.map(t.url.split(","),function(t){return t.trim()}),this.username=t.username,this.password=t.password,this.name=t.name,this.database=t.database,this.basicAuth=t.basicAuth,this.withCredentials=t.withCredentials,this.interval=(t.jsonData||{}).timeInterval,this.supportAnnotations=!0,this.supportMetrics=!0,this.responseParser=new l.a}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv"],t.prototype.query=function(t){var e,n,r,i=this,l=this.getTimeFilter(t),u=t.scopedVars,c=a.a.cloneDeep(t.targets),p=[],d=a.a.map(c,function(t){return t.hide?"":(p.push(t),u.interval=u.__interval,e=new s.a(t,i.templateSrv,u),e.render(!0))}).reduce(function(t,e){return""!==e&&(t+=";"+e),t});if(""===d)return this.$q.when({data:[]});var h=this.templateSrv.getAdhocFilters(this.name);return h.length>0&&(l+=" AND "+e.renderAdhocFilters(h)),u.timeFilter={value:l},d=this.templateSrv.replace(d,u),this._seriesQuery(d,t).then(function(e){if(!e||!e.results)return[];var a=[];for(n=0;n<e.results.length;n++){var s=e.results[n];if(s&&s.series){var l=p[n],u=l.alias;u&&(u=i.templateSrv.replace(l.alias,t.scopedVars));var c=new o.a({series:e.results[n].series,alias:u});switch(l.resultFormat){case"table":a.push(c.getTable());break;default:var d=c.getTimeSeries();for(r=0;r<d.length;r++)a.push(d[r])}}}return{data:a}})},t.prototype.annotationQuery=function(t){if(!t.annotation.query)return this.$q.reject({message:"Query missing in annotation definition"});var e=this.getTimeFilter({rangeRaw:t.rangeRaw}),n=t.annotation.query.replace("$timeFilter",e);return n=this.templateSrv.replace(n,null,"regex"),this._seriesQuery(n,t).then(function(e){if(!e||!e.results||!e.results[0])throw{message:"No results in response from InfluxDB"};return new o.a({series:e.results[0].series,annotation:t.annotation}).getAnnotations()})},t.prototype.targetContainsTemplate=function(t){for(var e=0,n=t.groupBy;e<n.length;e++)for(var r=n[e],a=0,i=r.params;a<i.length;a++){var o=i[a];if(this.templateSrv.variableExists(o))return!0}for(var s in t.tags)if(this.templateSrv.variableExists(t.tags[s].value))return!0;return!1},t.prototype.metricFindQuery=function(t,e){var n=this.templateSrv.replace(t,null,"regex");return this._seriesQuery(n,e).then(a.a.curry(this.responseParser.parse)(t))},t.prototype.getTagKeys=function(t){var e=new u.a({measurement:"",tags:[]},this.database),n=e.buildExploreQuery("TAG_KEYS");return this.metricFindQuery(n,t)},t.prototype.getTagValues=function(t){var e=new u.a({measurement:"",tags:[]},this.database),n=e.buildExploreQuery("TAG_VALUES",t.key);return this.metricFindQuery(n,t)},t.prototype._seriesQuery=function(t,e){return t?this._influxRequest("GET","/query",{q:t,epoch:"ms"},e):this.$q.when({results:[]})},t.prototype.serializeParams=function(t){return t?a.a.reduce(t,function(t,e,n){return null===e||void 0===e?t:(t.push(encodeURIComponent(n)+"="+encodeURIComponent(e)),t)},[]).join("&"):""},t.prototype.testDatasource=function(){var t=new u.a({measurement:"",tags:[]},this.database),e=t.buildExploreQuery("RETENTION POLICIES");return this._seriesQuery(e).then(function(t){var e=a.a.get(t,"results[0].error");return e?{status:"error",message:e}:{status:"success",message:"Data source is working"}}).catch(function(t){return{status:"error",message:t.message}})},t.prototype._influxRequest=function(t,e,n,r){var i=this.urls.shift();this.urls.push(i);var o={};this.username&&(o.u=this.username,o.p=this.password),r&&r.database?o.db=r.database:this.database&&(o.db=this.database),"GET"===t&&(a.a.extend(o,n),n=null);var s={method:t,url:i+e,params:o,data:n,precision:"ms",inspect:{type:"influxdb"},paramSerializer:this.serializeParams};return s.headers=s.headers||{},(this.basicAuth||this.withCredentials)&&(s.withCredentials=!0),this.basicAuth&&(s.headers.Authorization=this.basicAuth),this.backendSrv.datasourceRequest(s).then(function(t){return t.data},function(t){if(0!==t.status||t.status>=300)throw t.data&&t.data.error?{message:"InfluxDB Error: "+t.data.error,data:t.data,config:t.config}:{message:"Network Error: "+t.statusText+"("+t.status+")",data:t.data,config:t.config}})},t.prototype.getTimeFilter=function(t){var e=this.getInfluxTime(t.rangeRaw.from,!1),n=this.getInfluxTime(t.rangeRaw.to,!0),r="ms"===e[e.length-1];return"now()"!==n||r?"time >= "+e+" and time <= "+n:"time >= "+e},t.prototype.getInfluxTime=function(t,e){if(a.a.isString(t)){if("now"===t)return"now()";var n=/^now-(\d+)([d|h|m|s])$/.exec(t);if(n){return"now() - "+parseInt(n[1])+n[2]}t=i.parse(t,e)}return t.valueOf()+"ms"},t}();e.a=c},1570:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(1466),o=function(){function t(t){this.series=t.series,this.alias=t.alias,this.annotation=t.annotation}return t.prototype.getTimeSeries=function(){var t,e,n=this,r=[];return 0===this.series.length?r:(a.a.each(this.series,function(i){var o=i.columns.length,s=a.a.map(i.tags,function(t,e){return e+": "+t});for(e=1;e<o;e++){var l=i.name,u=i.columns[e];"value"!==u&&(l=l+"."+u),n.alias?l=n._getSeriesName(i,e):i.tags&&(l=l+" {"+s.join(", ")+"}");var c=[];if(i.values)for(t=0;t<i.values.length;t++)c[t]=[i.values[t][e],i.values[t][0]];r.push({target:l,datapoints:c})}}),r)},t.prototype._getSeriesName=function(t,e){var n=/\$(\w+)|\[\[([\s\S]+?)\]\]/g,r=t.name.split(".");return this.alias.replace(n,function(n,a,i){var o=a||i,s=parseInt(o,10);if("m"===o||"measurement"===o)return t.name;if("col"===o)return t.columns[e];if(!isNaN(s))return r[s];if(0!==o.indexOf("tag_"))return n;var l=o.replace("tag_","");return t.tags?t.tags[l]:n})},t.prototype.getAnnotations=function(){var t=this,e=[];return a.a.each(this.series,function(n){var r=null,i=null,o=[],s=null;a.a.each(n.columns,function(e,n){if("time"===e)return void(i=n);if("sequence_number"!==e)return r||(r=n),e===t.annotation.titleColumn?void(r=n):a.a.includes((t.annotation.tagsColumn||"").replace(" ","").split(","),e)?void o.push(n):e===t.annotation.textColumn?void(s=n):void 0}),a.a.each(n.values,function(n){var l={annotation:t.annotation,time:+new Date(n[i]),title:n[r],tags:a.a.flatten(o.filter(function(t){return n[t]}).map(function(t){return n[t].split(",")})),text:n[s]};e.push(l)})}),e},t.prototype.getTable=function(){var t,e,n=new i.a;return 0===this.series.length?n:(a.a.each(this.series,function(r,i){if(0===i)for(e=0,"time"===r.columns[0]&&(n.columns.push({text:"Time",type:"time"}),e++),a.a.each(a.a.keys(r.tags),function(t){n.columns.push({text:t})});e<r.columns.length;e++)n.columns.push({text:r.columns[e]});if(r.values)for(t=0;t<r.values.length;t++){var o=r.values[t],s=[o[0]];if(r.tags)for(var l in r.tags)r.tags.hasOwnProperty(l)&&s.push(r.tags[l]);for(e=1;e<o.length;e++)s.push(o[e]);n.rows.push(s)}}),n)},t}();e.a=o},1571:function(t,e,n){"use strict";function r(t,e){t[e]=e}var a=n(4),i=n.n(a),o=function(){function t(){}return t.prototype.parse=function(t,e){if(!e||0===e.results.length)return[];var n=e.results[0];if(!n.series)return[];var a=t.toLowerCase().indexOf("show tag values")>=0,o={};return i.a.each(n.series,function(t){i.a.each(t.values,function(t){i.a.isArray(t)?a?r(o,t[1]||t[0]):r(o,t[0]):r(o,t)})}),i.a.map(o,function(t){return{text:t}})},t}();e.a=o},1572:function(t,e,n){"use strict";n.d(e,"a",function(){return d});var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(1485),l=n(1483),u=n(1484),c=n(1464),p=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(t){function e(e,n,r,a,i){var o=t.call(this,e,n)||this;o.templateSrv=r,o.$q=a,o.uiSegmentSrv=i,o.target=o.target,o.queryModel=new l.a(o.target,r,o.panel.scopedVars),o.queryBuilder=new s.a(o.target,o.datasource.database),o.groupBySegment=o.uiSegmentSrv.newPlusButton(),o.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],o.policySegment=i.newSegment(o.target.policy),o.target.measurement?o.measurementSegment=i.newSegment(o.target.measurement):o.measurementSegment=i.newSelectMeasurement(),o.tagSegments=[];for(var u=0,c=o.target.tags;u<c.length;u++){var p=c[u];p.operator||(/^\/.*\/$/.test(p.value)?p.operator="=~":p.operator="="),p.condition&&o.tagSegments.push(i.newCondition(p.condition)),o.tagSegments.push(i.newKey(p.key)),o.tagSegments.push(i.newOperator(p.operator)),o.tagSegments.push(i.newKeyValue(p.value))}return o.fixTagSegments(),o.buildSelectMenu(),o.removeTagFilterSegment=i.newSegment({fake:!0,value:"-- remove tag filter --"}),o}return p(e,t),e.$inject=["$scope","$injector","templateSrv","$q","uiSegmentSrv"],e.prototype.removeOrderByTime=function(){this.target.orderByTime="ASC"},e.prototype.buildSelectMenu=function(){var t=u.a.getCategories();this.selectMenu=o.a.reduce(t,function(t,e,n){var r={text:n,submenu:e.map(function(t){return{text:t.type,value:t.type}})};return t.push(r),t},[])},e.prototype.getGroupByOptions=function(){var t=this,e=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(e).then(function(e){var n=[];t.queryModel.hasFill()||n.push(t.uiSegmentSrv.newSegment({value:"fill(null)"})),t.target.limit||n.push(t.uiSegmentSrv.newSegment({value:"LIMIT"})),t.target.slimit||n.push(t.uiSegmentSrv.newSegment({value:"SLIMIT"})),"ASC"===t.target.orderByTime&&n.push(t.uiSegmentSrv.newSegment({value:"ORDER BY time DESC"})),t.queryModel.hasGroupByTime()||n.push(t.uiSegmentSrv.newSegment({value:"time($interval)"}));for(var r=0,a=e;r<a.length;r++){var i=a[r];n.push(t.uiSegmentSrv.newSegment({value:"tag("+i.text+")"}))}return n}).catch(this.handleQueryError.bind(this))},e.prototype.groupByAction=function(){switch(this.groupBySegment.value){case"LIMIT":this.target.limit=10;break;case"SLIMIT":this.target.slimit=10;break;case"ORDER BY time DESC":this.target.orderByTime="DESC";break;default:this.queryModel.addGroupBy(this.groupBySegment.value)}var t=this.uiSegmentSrv.newPlusButton();this.groupBySegment.value=t.value,this.groupBySegment.html=t.html,this.panelCtrl.refresh()},e.prototype.addSelectPart=function(t,e,n){this.queryModel.addSelectPart(t,n.value),this.panelCtrl.refresh()},e.prototype.handleSelectPartEvent=function(t,e,n){switch(n.name){case"get-param-options":var r=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(r).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeSelectPart(t,e),this.panelCtrl.refresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},e.prototype.handleGroupByPartEvent=function(t,e,n){switch(n.name){case"get-param-options":var r=this.queryBuilder.buildExploreQuery("TAG_KEYS");return this.datasource.metricFindQuery(r).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this));case"part-param-changed":this.panelCtrl.refresh();break;case"action":this.queryModel.removeGroupByPart(t,e),this.panelCtrl.refresh();break;case"get-part-actions":return this.$q.when([{text:"Remove",value:"remove-part"}])}},e.prototype.fixTagSegments=function(){var t=this.tagSegments.length,e=this.tagSegments[Math.max(t-1,0)];e&&"plus-button"===e.type||this.tagSegments.push(this.uiSegmentSrv.newPlusButton())},e.prototype.measurementChanged=function(){this.target.measurement=this.measurementSegment.value,this.panelCtrl.refresh()},e.prototype.getPolicySegments=function(){var t=this.queryBuilder.buildExploreQuery("RETENTION POLICIES");return this.datasource.metricFindQuery(t).then(this.transformToSegments(!1)).catch(this.handleQueryError.bind(this))},e.prototype.policyChanged=function(){this.target.policy=this.policySegment.value,this.panelCtrl.refresh()},e.prototype.toggleEditorMode=function(){try{this.target.query=this.queryModel.render(!1)}catch(t){console.log("query render error")}this.target.rawQuery=!this.target.rawQuery},e.prototype.getMeasurements=function(t){var e=this.queryBuilder.buildExploreQuery("MEASUREMENTS",void 0,t);return this.datasource.metricFindQuery(e).then(this.transformToSegments(!0)).catch(this.handleQueryError.bind(this))},e.prototype.handleQueryError=function(t){return this.error=t.message||"Failed to issue metric query",[]},e.prototype.transformToSegments=function(t){var e=this;return function(n){var r=o.a.map(n,function(t){return e.uiSegmentSrv.newSegment({value:t.text,expandable:t.expandable})});if(t)for(var a=0,i=e.templateSrv.variables;a<i.length;a++){var s=i[a];r.unshift(e.uiSegmentSrv.newSegment({type:"value",value:"/^$"+s.name+"$/",expandable:!0}))}return r}},e.prototype.getTagsOrValues=function(t,e){var n=this;if("condition"===t.type)return this.$q.when([this.uiSegmentSrv.newSegment("AND"),this.uiSegmentSrv.newSegment("OR")]);if("operator"===t.type){return/^\/.*\/$/.test(this.tagSegments[e+1].value)?this.$q.when(this.uiSegmentSrv.newOperators(["=~","!~"])):this.$q.when(this.uiSegmentSrv.newOperators(["=","!=","<>","<",">"]))}var r,i;return"key"===t.type||"plus-button"===t.type?(r=this.queryBuilder.buildExploreQuery("TAG_KEYS"),i=!1):"value"===t.type&&(r=this.queryBuilder.buildExploreQuery("TAG_VALUES",this.tagSegments[e-2].value),i=!0),this.datasource.metricFindQuery(r).then(this.transformToSegments(i)).then(function(e){return"key"===t.type&&e.splice(0,0,a.a.copy(n.removeTagFilterSegment)),e}).catch(this.handleQueryError.bind(this))},e.prototype.getFieldSegments=function(){var t=this.queryBuilder.buildExploreQuery("FIELDS");return this.datasource.metricFindQuery(t).then(this.transformToSegments(!1)).catch(this.handleQueryError)},e.prototype.tagSegmentUpdated=function(t,e){this.tagSegments[e]=t,t.value===this.removeTagFilterSegment.value?(this.tagSegments.splice(e,3),0===this.tagSegments.length?this.tagSegments.push(this.uiSegmentSrv.newPlusButton()):this.tagSegments.length>2&&(this.tagSegments.splice(Math.max(e-1,0),1),"plus-button"!==this.tagSegments[this.tagSegments.length-1].type&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton()))):("plus-button"===t.type&&(e>2&&this.tagSegments.splice(e,0,this.uiSegmentSrv.newCondition("AND")),this.tagSegments.push(this.uiSegmentSrv.newOperator("=")),this.tagSegments.push(this.uiSegmentSrv.newFake("select tag value","value","query-segment-value")),t.type="key",t.cssClass="query-segment-key"),e+1===this.tagSegments.length&&this.tagSegments.push(this.uiSegmentSrv.newPlusButton())),this.rebuildTargetTagConditions()},e.prototype.rebuildTargetTagConditions=function(){var t=this,e=[],n=0,r="";o.a.each(this.tagSegments,function(a,i){"key"===a.type?(0===e.length&&e.push({}),e[n].key=a.value):"value"===a.type?(r=t.getTagValueOperator(a.value,e[n].operator),r&&(t.tagSegments[i-1]=t.uiSegmentSrv.newOperator(r),e[n].operator=r),e[n].value=a.value):"condition"===a.type?(e.push({condition:a.value}),n+=1):"operator"===a.type&&(e[n].operator=a.value)}),this.target.tags=e,this.panelCtrl.refresh()},e.prototype.getTagValueOperator=function(t,e){return"=~"!==e&&"!~"!==e&&/^\/.*\/$/.test(t)?"=~":"=~"!==e&&"!~"!==e||!/^(?!\/.*\/$)/.test(t)?null:"="},e.prototype.getCollapsedText=function(){return this.queryModel.render(!1)},e.templateUrl="partials/query.editor.html",e}(c.QueryCtrl)},1573:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1574);n.d(e,"MixedDatasource",function(){return r.a}),n.d(e,"Datasource",function(){return r.a})},1574:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=function(){function t(t,e){this.$q=t,this.datasourceSrv=e}return t.$inject=["$q","datasourceSrv"],t.prototype.query=function(t){var e=this,n=o.a.groupBy(t.targets,"datasource"),r=o.a.map(n,function(n){var r=n[0].datasource;return"-- Mixed --"===r?e.$q([]):e.datasourceSrv.get(r).then(function(e){var r=a.a.copy(t);return r.targets=n,e.query(r)})});return this.$q.all(r).then(function(t){return{data:o.a.flatten(o.a.map(t,"data"))}})},t}()},1575:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"ConfigCtrl",function(){return i}),n.d(e,"AnnotationsQueryCtrl",function(){return s});var r=n(1576),a=n(1578);n.d(e,"MysqlDatasource",function(){return r.a}),n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a});var i=function(){function t(){}return t.templateUrl="partials/config.html",t}(),o="SELECT\n    UNIX_TIMESTAMP(<time_column>) as time_sec,\n    <text_column> as text,\n    <tags_column> as tags\n  FROM <table name>\n  WHERE $__timeFilter(time_column)\n  ORDER BY <time_column> ASC\n  LIMIT 100\n  ",s=function(){function t(){this.annotation.rawQuery=this.annotation.rawQuery||o}return t.templateUrl="partials/annotations.editor.html",t}()},1576:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(4),a=n.n(r),i=n(1577),o=function(){function t(t,e,n,r){this.backendSrv=e,this.$q=n,this.templateSrv=r,this.name=t.name,this.id=t.id,this.responseParser=new i.a(this.$q)}return t.$inject=["instanceSettings","backendSrv","$q","templateSrv"],t.prototype.interpolateVariable=function(t,e){return"string"==typeof t?e.multi||e.includeAll?"'"+t+"'":t:"number"==typeof t?t:a.a.map(t,function(e){return"number"==typeof t?t:"'"+e+"'"}).join(",")},t.prototype.query=function(t){var e=this,n=a.a.filter(t.targets,function(t){return!0!==t.hide}).map(function(n){return{refId:n.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.id,rawSql:e.templateSrv.replace(n.rawSql,t.scopedVars,e.interpolateVariable),format:n.format}});return 0===n.length?this.$q.when({data:[]}):this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:n}}).then(this.responseParser.processQueryResult)},t.prototype.annotationQuery=function(t){var e=this;if(!t.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var n={refId:t.annotation.name,datasourceId:this.id,rawSql:this.templateSrv.replace(t.annotation.rawQuery,t.scopedVars,this.interpolateVariable),format:"table"};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[n]}}).then(function(n){return e.responseParser.transformAnnotationResponse(t,n)})},t.prototype.metricFindQuery=function(t,e){var n=this,r="tempvar";e&&e.variable&&e.variable.name&&(r=e.variable.name);var a={refId:r,datasourceId:this.id,rawSql:this.templateSrv.replace(t,{},this.interpolateVariable),format:"table"},i={queries:[a]};return e&&e.range&&e.range.from&&(i.from=e.range.from.valueOf().toString()),e&&e.range&&e.range.to&&(i.to=e.range.to.valueOf().toString()),this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:i}).then(function(t){return n.responseParser.parseMetricFindQueryResult(r,t)})},t.prototype.testDatasource=function(){return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:"5m",to:"now",queries:[{refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:this.id,rawSql:"SELECT 1",format:"table"}]}}).then(function(t){return{status:"success",message:"Database Connection OK"}}).catch(function(t){return console.log(t),t.data&&t.data.message?{status:"error",message:t.data.message}:{status:"error",message:t.status}})},t}()},1577:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=function(){function t(t){this.$q=t}return t.prototype.processQueryResult=function(t){var e=[];if(!t.data.results)return{data:e};for(var n in t.data.results){var r=t.data.results[n];if(r.series)for(var a=0,i=r.series;a<i.length;a++){var o=i[a];e.push({target:o.name,datapoints:o.points,refId:r.refId,meta:r.meta})}if(r.tables)for(var s=0,l=r.tables;s<l.length;s++){var u=l[s];u.type="table",u.refId=r.refId,u.meta=r.meta,e.push(u)}}return{data:e}},t.prototype.parseMetricFindQueryResult=function(t,e){if(!e||0===e.data.length||0===e.data.results[t].meta.rowCount)return[];var n=e.data.results[t].tables[0].columns,r=e.data.results[t].tables[0].rows,a=this.findColIndex(n,"__text"),i=this.findColIndex(n,"__value");return 2===n.length&&-1!==a&&-1!==i?this.transformToKeyValueList(r,a,i):this.transformToSimpleList(r)},t.prototype.transformToKeyValueList=function(t,e,n){for(var r=[],a=0;a<t.length;a++)this.containsKey(r,t[a][e])||r.push({text:t[a][e],value:t[a][n]});return r},t.prototype.transformToSimpleList=function(t){for(var e=[],n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++){var i=t[n][r];-1===e.indexOf(i)&&e.push(i)}return a.a.map(e,function(t){return{text:t}})},t.prototype.findColIndex=function(t,e){for(var n=0;n<t.length;n++)if(t[n].text===e)return n;return-1},t.prototype.containsKey=function(t,e){for(var n=0;n<t.length;n++)if(t[n].text===e)return!0;return!1},t.prototype.transformAnnotationResponse=function(t,e){for(var n=e.data.results[t.annotation.name].tables[0],r=-1,a=-1,i=-1,o=0;o<n.columns.length;o++)if("time_sec"===n.columns[o].text||"time"===n.columns[o].text)r=o;else{if("title"===n.columns[o].text)return this.$q.reject({message:"The title column for annotations is deprecated, now only a column named text is returned"});"text"===n.columns[o].text?a=o:"tags"===n.columns[o].text&&(i=o)}if(-1===r)return this.$q.reject({message:"Missing mandatory time column (with time_sec column alias) in annotation query."});for(var s=[],o=0;o<n.rows.length;o++){var l=n.rows[o];s.push({annotation:t.annotation,time:Math.floor(l[r]),text:l[a]?l[a].toString():"",tags:l[i]?l[i].trim().split(/\s*,\s*/):[]})}return s},t}();e.a=i},1578:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(4),a=n.n(r),i=n(1464),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s="SELECT\n  UNIX_TIMESTAMP(<time_column>) as time_sec,\n  <value column> as value,\n  <series name column> as metric\nFROM <table name>\nWHERE $__timeFilter(time_column)\nORDER BY <time_column> ASC\n",l=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.target.format=r.target.format||"time_series",r.target.alias="",r.formats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],r.target.rawSql||("table"===r.panelCtrl.panel.type?(r.target.format="table",r.target.rawSql="SELECT 1"):r.target.rawSql=s),r.panelCtrl.events.on("data-received",r.onDataReceived.bind(r),e),r.panelCtrl.events.on("data-error",r.onDataError.bind(r),e),r}return o(e,t),e.$inject=["$scope","$injector"],e.prototype.onDataReceived=function(t){this.lastQueryMeta=null,this.lastQueryError=null;var e=a.a.find(t,{refId:this.target.refId});e&&(this.lastQueryMeta=e.meta)},e.prototype.onDataError=function(t){if(t.data&&t.data.results){var e=t.data.results[this.target.refId];e&&(this.lastQueryMeta=e.meta,this.lastQueryError=e.error)}},e.templateUrl="partials/query.editor.html",e}(i.QueryCtrl)},1579:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"ConfigCtrl",function(){return i}),n.d(e,"AnnotationsQueryCtrl",function(){return s});var r=n(1580),a=n(1582);n.d(e,"PostgresDatasource",function(){return r.a}),n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a});var i=function(){function t(t){this.current.jsonData.sslmode=this.current.jsonData.sslmode||"verify-full"}return t.$inject=["$scope"],t.templateUrl="partials/config.html",t}(),o="SELECT\n  extract(epoch from time_column) AS time,\n  text_column as text,\n  tags_column as tags\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",s=function(){function t(){this.annotation.rawQuery=this.annotation.rawQuery||o}return t.templateUrl="partials/annotations.editor.html",t}()},1580:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(4),a=n.n(r),i=n(1581),o=function(){function t(t,e,n,r){this.backendSrv=e,this.$q=n,this.templateSrv=r,this.name=t.name,this.id=t.id,this.responseParser=new i.a(this.$q)}return t.$inject=["instanceSettings","backendSrv","$q","templateSrv"],t.prototype.interpolateVariable=function(t,e){return"string"==typeof t?e.multi||e.includeAll?"'"+t+"'":t:"number"==typeof t?t:a.a.map(t,function(t){return"'"+t+"'"}).join(",")},t.prototype.query=function(t){var e=this,n=a.a.filter(t.targets,function(t){return!0!==t.hide}).map(function(n){return{refId:n.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.id,rawSql:e.templateSrv.replace(n.rawSql,t.scopedVars,e.interpolateVariable),format:n.format}});return 0===n.length?this.$q.when({data:[]}):this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:n}}).then(this.responseParser.processQueryResult)},t.prototype.annotationQuery=function(t){var e=this;if(!t.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var n={refId:t.annotation.name,datasourceId:this.id,rawSql:this.templateSrv.replace(t.annotation.rawQuery,t.scopedVars,this.interpolateVariable),format:"table"};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[n]}}).then(function(n){return e.responseParser.transformAnnotationResponse(t,n)})},t.prototype.metricFindQuery=function(t,e){var n=this,r="tempvar";e&&e.variable&&e.variable.name&&(r=e.variable.name);var a={refId:r,datasourceId:this.id,rawSql:this.templateSrv.replace(t,{},this.interpolateVariable),format:"table"},i={queries:[a]};return e&&e.range&&e.range.from&&(i.from=e.range.from.valueOf().toString()),e&&e.range&&e.range.to&&(i.to=e.range.to.valueOf().toString()),this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:i}).then(function(t){return n.responseParser.parseMetricFindQueryResult(r,t)})},t.prototype.testDatasource=function(){return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:"5m",to:"now",queries:[{refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:this.id,rawSql:"SELECT 1",format:"table"}]}}).then(function(t){return{status:"success",message:"Database Connection OK"}}).catch(function(t){return console.log(t),t.data&&t.data.message?{status:"error",message:t.data.message}:{status:"error",message:t.status}})},t}()},1581:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=function(){function t(t){this.$q=t}return t.prototype.processQueryResult=function(t){var e=[];if(!t.data.results)return{data:e};for(var n in t.data.results){var r=t.data.results[n];if(r.series)for(var a=0,i=r.series;a<i.length;a++){var o=i[a];e.push({target:o.name,datapoints:o.points,refId:r.refId,meta:r.meta})}if(r.tables)for(var s=0,l=r.tables;s<l.length;s++){var u=l[s];u.type="table",u.refId=r.refId,u.meta=r.meta,e.push(u)}}return{data:e}},t.prototype.parseMetricFindQueryResult=function(t,e){if(!e||0===e.data.length||0===e.data.results[t].meta.rowCount)return[];var n=e.data.results[t].tables[0].columns,r=e.data.results[t].tables[0].rows,a=this.findColIndex(n,"__text"),i=this.findColIndex(n,"__value");return 2===n.length&&-1!==a&&-1!==i?this.transformToKeyValueList(r,a,i):this.transformToSimpleList(r)},t.prototype.transformToKeyValueList=function(t,e,n){for(var r=[],a=0;a<t.length;a++)this.containsKey(r,t[a][e])||r.push({text:t[a][e],value:t[a][n]});return r},t.prototype.transformToSimpleList=function(t){for(var e=[],n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++){var i=t[n][r];-1===e.indexOf(i)&&e.push(i)}return a.a.map(e,function(t){return{text:t}})},t.prototype.findColIndex=function(t,e){for(var n=0;n<t.length;n++)if(t[n].text===e)return n;return-1},t.prototype.containsKey=function(t,e){for(var n=0;n<t.length;n++)if(t[n].text===e)return!0;return!1},t.prototype.transformAnnotationResponse=function(t,e){for(var n=e.data.results[t.annotation.name].tables[0],r=-1,a=-1,i=-1,o=0;o<n.columns.length;o++)"time"===n.columns[o].text?r=o:"text"===n.columns[o].text?a=o:"tags"===n.columns[o].text&&(i=o);if(-1===r)return this.$q.reject({message:"Missing mandatory time column in annotation query."});for(var s=[],o=0;o<n.rows.length;o++){var l=n.rows[o];s.push({annotation:t.annotation,time:Math.floor(l[r]),title:l[-1],text:l[a],tags:l[i]?l[i].trim().split(/\s*,\s*/):[]})}return s},t}();e.a=i},1582:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(4),a=n.n(r),i=n(1464),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s="SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",l=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.target.format=r.target.format||"time_series",r.target.alias="",r.formats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],r.target.rawSql||("table"===r.panelCtrl.panel.type?(r.target.format="table",r.target.rawSql="SELECT 1"):r.target.rawSql=s),r.panelCtrl.events.on("data-received",r.onDataReceived.bind(r),e),r.panelCtrl.events.on("data-error",r.onDataError.bind(r),e),r}return o(e,t),e.$inject=["$scope","$injector"],e.prototype.onDataReceived=function(t){this.lastQueryMeta=null,this.lastQueryError=null;var e=a.a.find(t,{refId:this.target.refId});e&&(this.lastQueryMeta=e.meta)},e.prototype.onDataError=function(t){if(t.data&&t.data.results){var e=t.data.results[this.target.refId];e&&(this.lastQueryMeta=e.meta,this.lastQueryError=e.error)}},e.templateUrl="partials/query.editor.html",e}(i.QueryCtrl)},1583:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AnnotationsQueryCtrl",function(){return o});var r=n(1584),a=n(1587),i=n(1591);n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a}),n.d(e,"ConfigCtrl",function(){return i.a});var o=function(){function t(){}return t.templateUrl="partials/annotations.editor.html",t}()},1584:function(t,e,n){"use strict";function r(t){return t.replace(/'/g,"\\\\'")}function a(t){return r(t.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()]/g,"\\\\$&"))}n.d(e,"a",function(){return f});var i=n(4),o=n.n(i),s=n(16),l=n.n(s),u=n(224),c=n(512),p=n(1585),d=n(1586),h=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},f=function(){function t(t,e,n,r,a){this.$q=e,this.backendSrv=n,this.templateSrv=r,this.timeSrv=a,this.type="prometheus",this.editorSrc="app/features/prometheus/partials/query.editor.html",this.name=t.name,this.supportMetrics=!0,this.url=t.url,this.directUrl=t.directUrl,this.basicAuth=t.basicAuth,this.withCredentials=t.withCredentials,this.interval=t.jsonData.timeInterval||"15s",this.httpMethod=t.jsonData.httpMethod||"GET",this.resultTransformer=new d.a(r)}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","timeSrv"],t.prototype._request=function(t,e,n){var n=h({url:this.url+t,method:this.httpMethod},n);return"GET"===n.method?o.a.isEmpty(e)||(n.url=n.url+"?"+o.a.map(e,function(t,e){return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&")):(n.headers={"Content-Type":"application/x-www-form-urlencoded"},n.transformRequest=function(t){return l.a.param(t)},n.data=e),(this.basicAuth||this.withCredentials)&&(n.withCredentials=!0),this.basicAuth&&(n.headers={Authorization:this.basicAuth}),this.backendSrv.datasourceRequest(n)},t.prototype.metadataRequest=function(t){return this._request(t,null,{method:"GET",silent:!0})},t.prototype.interpolateQueryExpr=function(t,e,n){return e.multi||e.includeAll?"string"==typeof t?a(t):o.a.map(t,a).join("|"):r(t)},t.prototype.targetContainsTemplate=function(t){return this.templateSrv.variableExists(t.expr)},t.prototype.query=function(t){var e=this,n=this.getPrometheusTime(t.range.from,!1),r=this.getPrometheusTime(t.range.to,!0),a=Math.ceil(r-n),i=[],s=[];t=o.a.clone(t);for(var l=0,u=t.targets;l<u.length;l++){var c=u[l];c.expr&&!c.hide&&(s.push(c),i.push(this.createQuery(c,t,a)))}if(o.a.isEmpty(i))return this.$q.when({data:[]});var p=o.a.map(i,function(t){return t.instant?e.performInstantQuery(t,r):e.performTimeSeriesQuery(t,n,r)});return this.$q.all(p).then(function(t){var a=[];return o.a.each(t,function(o,l){if("error"===o.status)throw o.error;var u={format:s[l].format,step:i[l].step,legendFormat:s[l].legendFormat,start:n,end:r,responseListLength:t.length,responseIndex:l};e.resultTransformer.transform(a,o,u)}),{data:a}})},t.prototype.createQuery=function(t,e,n){var r={};r.instant=t.instant;var a=u.a.interval_to_seconds(e.interval),i=u.a.interval_to_seconds(this.templateSrv.replace(t.interval,e.scopedVars)||e.interval),o=t.intervalFactor||1,s=this.adjustInterval(a,i,n,o),l=e.scopedVars;return a!==s&&(a=s,l=Object.assign({},e.scopedVars,{__interval:{text:a+"s",value:a+"s"},__interval_ms:{text:1e3*a,value:1e3*a}})),r.step=a,r.expr=this.templateSrv.replace(t.expr,l,this.interpolateQueryExpr),r.requestId=e.panelId+t.refId,r},t.prototype.adjustInterval=function(t,e,n,r){return 0!==t&&n/r/t>11e3&&(t=Math.ceil(n/r/11e3)),Math.max(t*r,e,1)},t.prototype.performTimeSeriesQuery=function(t,e,n){if(e>n)throw{message:"Invalid time range"};var r={query:t.expr,start:e,end:n,step:t.step};return this._request("/api/v1/query_range",r,{requestId:t.requestId})},t.prototype.performInstantQuery=function(t,e){var n={query:t.expr,time:e};return this._request("/api/v1/query",n,{requestId:t.requestId})},t.prototype.performSuggestQuery=function(t,e){var n=this;void 0===e&&(e=!1);return e&&this.metricsNameCache&&this.metricsNameCache.expire>Date.now()?this.$q.when(o.a.filter(this.metricsNameCache.data,function(e){return 1!==e.indexOf(t)})):this.metadataRequest("/api/v1/label/__name__/values").then(function(e){return n.metricsNameCache={data:e.data.data,expire:Date.now()+6e4},o.a.filter(e.data.data,function(e){return 1!==e.indexOf(t)})})},t.prototype.metricFindQuery=function(t){if(!t)return this.$q.when([]);var e=this.templateSrv.replace(t,{},this.interpolateQueryExpr);return new p.a(this,e,this.timeSrv).process()},t.prototype.annotationQuery=function(t){var e=t.annotation,n=e.expr||"",r=e.tagKeys||"",a=e.titleFormat||"",i=e.textFormat||"";if(!n)return this.$q.when([]);var s=this.templateSrv.replace(n,{},this.interpolateQueryExpr),l="60s";e.step&&(l=this.templateSrv.replace(e.step));var c=this.getPrometheusTime(t.range.from,!1),p=this.getPrometheusTime(t.range.to,!0),d={expr:s,step:this.adjustInterval(u.a.interval_to_seconds(l),0,Math.ceil(p-c),1)+"s"},h=this;return this.performTimeSeriesQuery(d,c,p).then(function(t){var n=[];return r=r.split(","),o.a.each(t.data.data.result,function(t){for(var s=o.a.chain(t.metric).filter(function(t,e){return o.a.includes(r,e)}).value(),l=0,u=t.values;l<u.length;l++){var c=u[l];if("1"===c[1]){var p={annotation:e,time:1e3*Math.floor(parseFloat(c[0])),title:h.resultTransformer.renderTemplate(a,t.metric),tags:s,text:h.resultTransformer.renderTemplate(i,t.metric)};n.push(p)}}}),n})},t.prototype.testDatasource=function(){var t=(new Date).getTime();return this.performInstantQuery({expr:"1+1"},t/1e3).then(function(t){return"success"===t.data.status?{status:"success",message:"Data source is working"}:{status:"error",message:t.error}})},t.prototype.getPrometheusTime=function(t,e){return o.a.isString(t)&&(t=c.parse(t,e)),Math.ceil(t.valueOf()/1e3)},t.prototype.getOriginalMetricName=function(t){return this.resultTransformer.getOriginalMetricName(t)},t}()},1585:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=function(){function t(t,e,n){this.datasource=t,this.query=e,this.range=n.timeRange()}return t.prototype.process=function(){var t=/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]+)\)\s*$/,e=/^metrics\((.+)\)\s*$/,n=/^query_result\((.+)\)\s*$/,r=this.query.match(t);if(r)return r[1]?this.labelValuesQuery(r[2],r[1]):this.labelValuesQuery(r[2],null);var a=this.query.match(e);if(a)return this.metricNameQuery(a[1]);var i=this.query.match(n);return i?this.queryResultQuery(i[1]):this.metricNameAndLabelsQuery(this.query)},t.prototype.labelValuesQuery=function(t,e){var n;if(e){var r=this.datasource.getPrometheusTime(this.range.from,!1),i=this.datasource.getPrometheusTime(this.range.to,!0);return n="/api/v1/series?match[]="+encodeURIComponent(e)+"&start="+r+"&end="+i,this.datasource.metadataRequest(n).then(function(e){var n=a.a.map(e.data.data,function(e){return e[t]||""}).filter(function(t){return""!==t});return a.a.uniq(n).map(function(t){return{text:t,expandable:!0}})})}return n="/api/v1/label/"+t+"/values",this.datasource.metadataRequest(n).then(function(t){return a.a.map(t.data.data,function(t){return{text:t}})})},t.prototype.metricNameQuery=function(t){return this.datasource.metadataRequest("/api/v1/label/__name__/values").then(function(e){return a.a.chain(e.data.data).filter(function(e){return new RegExp(t).test(e)}).map(function(t){return{text:t,expandable:!0}}).value()})},t.prototype.queryResultQuery=function(t){var e=this.datasource.getPrometheusTime(this.range.to,!0);return this.datasource.performInstantQuery({expr:t},e).then(function(t){return a.a.map(t.data.data.result,function(t){var e=t.metric.__name__||"";return delete t.metric.__name__,e+="{"+a.a.map(t.metric,function(t,e){return e+'="'+t+'"'}).join(",")+"}",e+=" "+t.value[1]+" "+1e3*t.value[0],{text:e,expandable:!0}})})},t.prototype.metricNameAndLabelsQuery=function(t){var e=this.datasource.getPrometheusTime(this.range.from,!1),n=this.datasource.getPrometheusTime(this.range.to,!0),r="/api/v1/series?match[]="+encodeURIComponent(t)+"&start="+e+"&end="+n,i=this;return this.datasource.metadataRequest(r).then(function(t){return a.a.map(t.data.data,function(t){return{text:i.datasource.getOriginalMetricName(t),expandable:!0}})})},t}();e.a=i},1586:function(t,e,n){"use strict";function r(t,e){var n,r;try{n=a(t.metric.le),r=a(e.metric.le)}catch(t){return console.log(t),0}return n>r?1:n<r?-1:0}function a(t){return"+Inf"===t?1/0:Number(t)}n.d(e,"a",function(){return l});var i=n(4),o=n.n(i),s=n(1466),l=function(){function t(t){this.templateSrv=t}return t.prototype.transform=function(t,e,n){var a=e.data.data.result;if("table"===n.format)t.push(this.transformMetricDataToTable(a,n.responseListLength,n.responseIndex));else if("heatmap"===n.format){var i=[];a.sort(r);for(var o=0,s=a;o<s.length;o++){var l=s[o];i.push(this.transformMetricData(l,n,n.start,n.end))}i=this.transformToHistogramOverTime(i),t.push.apply(t,i)}else for(var u=0,c=a;u<c.length;u++){var l=c[u];"matrix"===e.data.data.resultType?t.push(this.transformMetricData(l,n,n.start,n.end)):"vector"===e.data.data.resultType&&t.push(this.transformInstantMetricData(l,n))}},t.prototype.transformMetricData=function(t,e,n,r){var a=[],i=null;i=this.createMetricLabel(t.metric,e);for(var s=1e3*parseInt(e.step),l=1e3*n,u=0,c=t.values;u<c.length;u++){var p=c[u],d=parseFloat(p[1]);o.a.isNaN(d)&&(d=null);for(var h=1e3*parseFloat(p[0]),f=l;f<h;f+=s)a.push([null,f]);l=h+s,a.push([d,h])}for(var m=1e3*r,f=l;f<=m;f+=s)a.push([null,f]);return{target:i,datapoints:a}},t.prototype.transformMetricDataToTable=function(t,e,n){var r,a,i=new s.a,l={};if(0===t.length)return i;o.a.each(t,function(t){for(var e in t.metric)l.hasOwnProperty(e)||(l[e]=1)});var u=o.a.keys(l).sort();i.columns.push({text:"Time",type:"time"}),o.a.each(u,function(t,e){l[t]=e+1,i.columns.push({text:t})});var c=e>1?"Value #"+String.fromCharCode(65+n):"Value";return i.columns.push({text:c}),o.a.each(t,function(t){if(t.value&&(t.values=[t.value]),t.values)for(r=0;r<t.values.length;r++){var e=t.values[r],n=[1e3*e[0]];if(t.metric)for(a=0;a<u.length;a++){var o=u[a];t.metric.hasOwnProperty(o)?n.push(t.metric[o]):n.push("")}n.push(parseFloat(e[1])),i.rows.push(n)}}),i},t.prototype.transformInstantMetricData=function(t,e){var n=[],r=null;return r=this.createMetricLabel(t.metric,e),n.push([parseFloat(t.value[1]),1e3*t.value[0]]),{target:r,datapoints:n}},t.prototype.createMetricLabel=function(t,e){return o.a.isUndefined(e)||o.a.isEmpty(e.legendFormat)?this.getOriginalMetricName(t):this.renderTemplate(this.templateSrv.replace(e.legendFormat),t)||"{}"},t.prototype.renderTemplate=function(t,e){var n=/\{\{\s*(.+?)\s*\}\}/g;return t.replace(n,function(t,n){return e[n]?e[n]:n})},t.prototype.getOriginalMetricName=function(t){var e=t.__name__||"";return delete t.__name__,e+"{"+o.a.map(o.a.toPairs(t),function(t){return t[0]+'="'+t[1]+'"'}).join(",")+"}"},t.prototype.transformToHistogramOverTime=function(t){for(var e=t.length-1;e>0;e--)for(var n=t[e].datapoints,r=t[e-1].datapoints,a=0;a<n.length;a++)n[a][0]-=r[a][0];return t},t}()},1587:function(t,e,n){"use strict";n.d(e,"a",function(){return d});var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(1464),l=n(1588),u=n(1589),c=(n.n(u),n(1590)),p=(n.n(c),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),d=function(t){function e(e,n,r){var a=t.call(this,e,n)||this;a.templateSrv=r;var i=a.target;return i.expr=i.expr||"",i.intervalFactor=i.intervalFactor||1,i.format=i.format||a.getDefaultFormat(),a.metric="",a.resolutions=o.a.map([1,2,3,4,5,10],function(t){return{factor:t,label:"1/"+t}}),a.formats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"},{text:"Heatmap",value:"heatmap"}],a.instant=!1,a.updateLink(),a}return p(e,t),e.$inject=["$scope","$injector","templateSrv"],e.prototype.getCompleter=function(t){return new l.a(this.datasource,this.templateSrv)},e.prototype.getDefaultFormat=function(){return"table"===this.panelCtrl.panel.type?"table":"heatmap"===this.panelCtrl.panel.type?"heatmap":"time_series"},e.prototype.refreshMetricData=function(){o.a.isEqual(this.oldTarget,this.target)||(this.oldTarget=a.a.copy(this.target),this.panelCtrl.refresh(),this.updateLink())},e.prototype.updateLink=function(){var t=this.panelCtrl.range;if(t){var e=Math.ceil((t.to.valueOf()-t.from.valueOf())/1e3),n=t.to.utc().format("YYYY-MM-DD HH:mm"),r={"g0.expr":this.templateSrv.replace(this.target.expr,this.panelCtrl.panel.scopedVars,this.datasource.interpolateQueryExpr),"g0.range_input":e+"s","g0.end_input":n,"g0.step_input":this.target.step,"g0.stacked":this.panelCtrl.panel.stack?1:0,"g0.tab":0},a=o.a.map(r,function(t,e){return e+"="+encodeURIComponent(t)}).join("&");this.linkToPrometheus=this.datasource.directUrl+"/graph?"+a}},e.prototype.getCollapsedText=function(){return this.target.expr},e.templateUrl="partials/query.editor.html",e}(s.QueryCtrl)},1588:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(4),a=n.n(r),i=function(){function t(t,e){this.datasource=t,this.templateSrv=e,this.identifierRegexps=[/\[/,/[a-zA-Z0-9_:]/],this.labelQueryCache={},this.labelNameCache={},this.labelValueCache={},this.templateVariableCompletions=this.templateSrv.variables.map(function(t){return{caption:"$"+t.name,value:"$"+t.name,meta:"variable",score:Number.MAX_VALUE}})}return t.prototype.getCompletions=function(t,e,n,r,a){var i=this,o=function(t,e){return e=e.concat(i.templateVariableCompletions),a(t,e)},s=e.getTokenAt(n.row,n.column);switch(s.type){case"entity.name.tag.label-matcher":return void this.getCompletionsForLabelMatcherName(e,n).then(function(t){o(null,t)});case"string.quoted.label-matcher":return void this.getCompletionsForLabelMatcherValue(e,n).then(function(t){o(null,t)});case"entity.name.tag.label-list-matcher":return void this.getCompletionsForBinaryOperator(e,n).then(function(t){o(null,t)})}if("paren.lparen"===s.type&&"["===s.value){for(var l=[],u=0,c=["s","m","h"];u<c.length;u++)for(var p=c[u],d=0,h=[1,5,10,30];d<h.length;d++){var f=h[d];l.push({caption:f+p,value:"["+f+p,meta:"range vector"})}return l.unshift({caption:"$__interval_ms",value:"[$__interval_ms",meta:"range vector"}),l.unshift({caption:"$__interval",value:"[$__interval",meta:"range vector"}),void o(null,l)}var m=r;return this.datasource.performSuggestQuery(m,!0).then(function(t){o(null,t.map(function(t){var e=t;return"("===r&&(e="("+t),{caption:t,value:e,meta:"metric"}}))})},t.prototype.getCompletionsForLabelMatcherName=function(t,e){var n=this,r=this.findMetricName(t,e.row,e.column);return r?this.labelNameCache[r]?Promise.resolve(this.labelNameCache[r]):this.getLabelNameAndValueForExpression(r,"metricName").then(function(t){var e=n.transformToCompletions(a.a.uniq(a.a.flatten(t.map(function(t){return Object.keys(t.metric)}))),"label name");return n.labelNameCache[r]=e,Promise.resolve(e)}):Promise.resolve(this.transformToCompletions(["__name__","instance","job"],"label name"))},t.prototype.getCompletionsForLabelMatcherValue=function(t,e){var n=this,r=this.findMetricName(t,e.row,e.column);if(!r)return Promise.resolve([]);var i=this.findToken(t,e.row,e.column,"entity.name.tag.label-matcher",null,"paren.lparen.label-matcher");if(!i)return Promise.resolve([]);var o=i.value;return this.labelValueCache[r]&&this.labelValueCache[r][o]?Promise.resolve(this.labelValueCache[r][o]):this.getLabelNameAndValueForExpression(r,"metricName").then(function(t){var e=n.transformToCompletions(a.a.uniq(t.map(function(t){return t.metric[o]})),"label value");return n.labelValueCache[r]=n.labelValueCache[r]||{},n.labelValueCache[r][o]=e,Promise.resolve(e)})},t.prototype.getCompletionsForBinaryOperator=function(t,e){var n=this,r=this.findToken(t,e.row,e.column,"keyword.control",null,"identifier");if(!r)return Promise.resolve([]);var i,o;switch(r.value){case"by":case"without":return(i=this.findToken(t,r.row,r.column,"paren.rparen",null,"identifier"))?(o=this.findExpressionMatchedParen(t,i.row,i.column),""===o?Promise.resolve([]):this.getLabelNameAndValueForExpression(o,"expression").then(function(t){var e=n.transformToCompletions(a.a.uniq(a.a.flatten(t.map(function(t){return Object.keys(t.metric)}))),"label name");return n.labelNameCache[o]=e,e})):Promise.resolve([]);case"on":case"ignoring":case"group_left":case"group_right":var s=this.findToken(t,r.row,r.column,"keyword.operator.binary",null,"identifier");if(!s)return Promise.resolve([]);if(i=this.findToken(t,s.row,s.column,"paren.rparen",null,"identifier"))return o=this.findExpressionMatchedParen(t,i.row,i.column),""===o?Promise.resolve([]):this.getLabelNameAndValueForExpression(o,"expression").then(function(t){var e=n.transformToCompletions(a.a.uniq(a.a.flatten(t.map(function(t){return Object.keys(t.metric)}))),"label name");return n.labelNameCache[o]=e,e});var l=this.findMetricName(t,s.row,s.column);return this.getLabelNameAndValueForExpression(l,"metricName").then(function(t){var e=n.transformToCompletions(a.a.uniq(a.a.flatten(t.map(function(t){return Object.keys(t.metric)}))),"label name");return n.labelNameCache[l]=e,Promise.resolve(e)})}return Promise.resolve([])},t.prototype.getLabelNameAndValueForExpression=function(t,e){var n=this;if(this.labelQueryCache[t])return Promise.resolve(this.labelQueryCache[t]);var r=t;if("metricName"===e){var a="=~";/[a-zA-Z_:][a-zA-Z0-9_:]*/.test(t)&&(a="="),r="{__name__"+a+'"'+t+'"}'}return this.datasource.performInstantQuery({expr:r},(new Date).getTime()/1e3).then(function(e){return n.labelQueryCache[t]=e.data.data.result,e.data.data.result})},t.prototype.transformToCompletions=function(t,e){return t.map(function(t){return{caption:t,value:t,meta:e,score:Number.MAX_VALUE}})},t.prototype.findMetricName=function(t,e,n){var r,a="",i=this.findToken(t,e,n,"entity.name.tag.label-matcher","__name__","paren.lparen.label-matcher");if(i){r=t.getTokens(i.row);var o=r[i.index+2];o&&"string.quoted.label-matcher"===o.type&&(a=o.value.slice(1,-1))}else{var s=this.findToken(t,e,n,"identifier",null,null);s&&(r=t.getTokens(s.row),a=s.value)}return a},t.prototype.findToken=function(t,e,n,r,i,o){for(var s,l,u=e;u>=0;u--){var c=void 0;if(s=t.getTokens(u),u===e)for(c=0,l=0;l<s.length;l++){var p=c+s[l].value.length;if(p>=n)break;c=p}else l=s.length-1,c=a.a.sum(s.map(function(t){return t.value.length}))-s[s.length-1].value.length;for(;l>=0;l--){if(s[l].type===o)return null;if(s[l].type===r&&(!i||s[l].value===i))return s[l].row=u,s[l].column=c,s[l].index=l,s[l];c-=s[l].value.length}}return null},t.prototype.findExpressionMatchedParen=function(t,e,n){for(var r,a,i=1,o=")",s=e;s>=0;s--){if(r=t.getTokens(s),s===e){var l=0;for(a=0;a<r.length&&!((l+=r[a].value.length)>=n);a++);}else a=r.length-1;for(;a>=0;a--)if(o=r[a].value+o,"paren.rparen"===r[a].type)i++;else if("paren.lparen"===r[a].type&&0===--i)return o}return o},t}()},1589:function(t,e){ace.define("ace/mode/prometheus_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(t,e,n){"use strict";var r=t("../lib/oop"),a=t("./text_highlight_rules").TextHighlightRules,i=function(){var t=this.createKeywordMapper({"support.function":"abs|absent|ceil|changes|clamp_max|clamp_min|count_scalar|day_of_month|day_of_week|days_in_month|delta|deriv|drop_common_labels|exp|floor|histogram_quantile|holt_winters|hour|idelta|increase|irate|label_replace|ln|log2|log10|minute|month|predict_linear|rate|resets|round|scalar|sort|sort_desc|sqrt|time|vector|year|avg_over_time|min_over_time|max_over_time|sum_over_time|count_over_time|quantile_over_time|stddev_over_time|stdvar_over_time",keyword:"count|count_values|min|max|avg|sum|stddev|stdvar|bottomk|topk|quantile","constant.language":"true|false|null|__name__|job"},"identifier",!0);this.$rules={start:[{token:"string",regex:/"(?:[^"\\]|\\.)*?"/},{token:"string",regex:"'.*?'"},{token:"constant.numeric",regex:"[-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language",regex:"\\d+[smhdwy]"},{token:"keyword.operator.binary",regex:"\\+|\\-|\\*|\\/|%|\\^|==|!=|<=|>=|<|>|and|or|unless"},{token:"keyword.other",regex:"keep_common|offset|bool"},{token:"keyword.control",regex:"by|without|on|ignoring|group_left|group_right",next:"start-label-list-matcher"},{token:"variable",regex:"\\$[A-Za-z0-9_]+"},{token:t,regex:"[a-zA-Z_:][a-zA-Z0-9_:]*"},{token:"paren.lparen",regex:"[[(]"},{token:"paren.lparen.label-matcher",regex:"{",next:"start-label-matcher"},{token:"paren.rparen",regex:"[\\])]"},{token:"paren.rparen.label-matcher",regex:"}"},{token:"text",regex:"\\s+"}],"start-label-matcher":[{token:"entity.name.tag.label-matcher",regex:"[a-zA-Z_][a-zA-Z0-9_]*"},{token:"keyword.operator.label-matcher",regex:"=~|=|!~|!="},{token:"string.quoted.label-matcher",regex:"\"[^\"]*\"|'[^']*'"},{token:"punctuation.operator.label-matcher",regex:","},{token:"paren.rparen.label-matcher",regex:"}",next:"start"}],"start-label-list-matcher":[{token:"paren.lparen.label-list-matcher",regex:"[(]"},{token:"entity.name.tag.label-list-matcher",regex:"[a-zA-Z_][a-zA-Z0-9_]*"},{token:"punctuation.operator.label-list-matcher",regex:","},{token:"paren.rparen.label-list-matcher",regex:"[)]",next:"start"}]},this.normalizeRules()};r.inherits(i,a),e.PrometheusHighlightRules=i}),ace.define("ace/mode/prometheus_completions",["require","exports","module","ace/token_iterator","ace/lib/lang"],function(t,e,n){"use strict";function r(t,e){e=e||60;for(var n=[],r=0,a=0,i=e,o="",s=0;s<t.length;s++)" "===t[s]?r=s:s>=i&&0!=r&&(o=t.slice(a,r),n.push(o),a=r+1,i=s+e,r=0);return o=t.slice(a),n.push(o),n.join("&nbsp<br>")}function a(t){return t=t.replace(/```(.+)```/,"<pre>$1</pre>"),t=t.replace(/`([^`]+)`/,"<code>$1</code>")}function i(t){var e=o.escapeHTML(t.docText);return e=a(r(e,40)),["<b>",o.escapeHTML(t.def),"</b>","<hr></hr>",e,"<br>&nbsp"].join("")}var o=t("../lib/lang"),s=["by","without","keep_common","offset","bool","and","or","unless","ignoring","on","group_left","group_right","count","count_values","min","max","avg","sum","stddev","stdvar","bottomk","topk","quantile"],l=s.map(function(t){return{caption:t,value:t,meta:"keyword",score:Number.MAX_VALUE}}),u=[{name:"abs()",value:"abs",def:"abs(v instant-vector)",docText:"Returns the input vector with all sample values converted to their absolute value."},{name:"absent()",value:"absent",def:"absent(v instant-vector)",docText:"Returns an empty vector if the vector passed to it has any elements and a 1-element vector with the value 1 if the vector passed to it has no elements. This is useful for alerting on when no time series exist for a given metric name and label combination."},{name:"ceil()",value:"ceil",def:"ceil(v instant-vector)",docText:"Rounds the sample values of all elements in `v` up to the nearest integer."},{name:"changes()",value:"changes",def:"changes(v range-vector)",docText:"For each input time series, `changes(v range-vector)` returns the number of times its value has changed within the provided time range as an instant vector."},{name:"clamp_max()",value:"clamp_max",def:"clamp_max(v instant-vector, max scalar)",docText:"Clamps the sample values of all elements in `v` to have an upper limit of `max`."},{name:"clamp_min()",value:"clamp_min",def:"clamp_min(v instant-vector, min scalar)",docText:"Clamps the sample values of all elements in `v` to have a lower limit of `min`."},{name:"count_scalar()",value:"count_scalar",def:"count_scalar(v instant-vector)",docText:"Returns the number of elements in a time series vector as a scalar. This is in contrast to the `count()` aggregation operator, which always returns a vector (an empty one if the input vector is empty) and allows grouping by labels via a `by` clause."},{name:"day_of_month()",value:"day_of_month",def:"day_of_month(v=vector(time()) instant-vector)",docText:"Returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31."},{name:"day_of_week()",value:"day_of_week",def:"day_of_week(v=vector(time()) instant-vector)",docText:"Returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc."},{name:"days_in_month()",value:"days_in_month",def:"days_in_month(v=vector(time()) instant-vector)",docText:"Returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31."},{name:"delta()",value:"delta",def:"delta(v range-vector)",docText:"Calculates the difference between the first and last value of each time series element in a range vector `v`, returning an instant vector with the given deltas and equivalent labels. The delta is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if the sample values are all integers."},{name:"deriv()",value:"deriv",def:"deriv(v range-vector)",docText:"Calculates the per-second derivative of the time series in a range vector `v`, using simple linear regression."},{name:"drop_common_labels()",value:"drop_common_labels",def:"drop_common_labels(instant-vector)",docText:"Drops all labels that have the same name and value across all series in the input vector."},{name:"exp()",value:"exp",def:"exp(v instant-vector)",docText:"Calculates the exponential function for all elements in `v`.\nSpecial cases are:\n* `Exp(+Inf) = +Inf` \n* `Exp(NaN) = NaN`"},{name:"floor()",value:"floor",def:"floor(v instant-vector)",docText:"Rounds the sample values of all elements in `v` down to the nearest integer."},{name:"histogram_quantile()",value:"histogram_quantile",def:"histogram_quantile( float, b instant-vector)",docText:"Calculates the -quantile (0    1) from the buckets `b` of a histogram. The samples in `b` are the counts of observations in each bucket. Each sample must have a label `le` where the label value denotes the inclusive upper bound of the bucket. (Samples without such a label are silently ignored.) The histogram metric type automatically provides time series with the `_bucket` suffix and the appropriate labels."},{name:"holt_winters()",value:"holt_winters",def:"holt_winters(v range-vector, sf scalar, tf scalar)",docText:"Produces a smoothed value for time series based on the range in `v`. The lower the smoothing factor `sf`, the more importance is given to old data. The higher the trend factor `tf`, the more trends in the data is considered. Both `sf` and `tf` must be between 0 and 1."},{name:"hour()",value:"hour",def:"hour(v=vector(time()) instant-vector)",docText:"Returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23."},{name:"idelta()",value:"idelta",def:"idelta(v range-vector)",docText:"Calculates the difference between the last two samples in the range vector `v`, returning an instant vector with the given deltas and equivalent labels."},{name:"increase()",value:"increase",def:"increase(v range-vector)",docText:"Calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments."},{name:"irate()",value:"irate",def:"irate(v range-vector)",docText:"Calculates the per-second instant rate of increase of the time series in the range vector. This is based on the last two data points. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for."},{name:"label_replace()",value:"label_replace",def:"label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)",docText:"For each timeseries in `v`, `label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)`  matches the regular expression `regex` against the label `src_label`.  If it matches, then the timeseries is returned with the label `dst_label` replaced by the expansion of `replacement`. `$1` is replaced with the first matching subgroup, `$2` with the second etc. If the regular expression doesn't match then the timeseries is returned unchanged."},{name:"ln()",value:"ln",def:"ln(v instant-vector)",docText:"calculates the natural logarithm for all elements in `v`.\nSpecial cases are:\n * `ln(+Inf) = +Inf`\n * `ln(0) = -Inf`\n * `ln(x < 0) = NaN`\n * `ln(NaN) = NaN`"},{name:"log2()",value:"log2",def:"log2(v instant-vector)",docText:"Calculates the binary logarithm for all elements in `v`. The special cases are equivalent to those in `ln`."},{name:"log10()",value:"log10",def:"log10(v instant-vector)",docText:"Calculates the decimal logarithm for all elements in `v`. The special cases are equivalent to those in `ln`."},{name:"minute()",value:"minute",def:"minute(v=vector(time()) instant-vector)",docText:"Returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59."},{name:"month()",value:"month",def:"month(v=vector(time()) instant-vector)",docText:"Returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc."},{name:"predict_linear()",value:"predict_linear",def:"predict_linear(v range-vector, t scalar)",docText:"Predicts the value of time series `t` seconds from now, based on the range vector `v`, using simple linear regression."},{name:"rate()",value:"rate",def:"rate(v range-vector)",docText:"Calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range's time period."},{name:"resets()",value:"resets",def:"resets(v range-vector)",docText:"For each input time series, `resets(v range-vector)` returns the number of counter resets within the provided time range as an instant vector. Any decrease in the value between two consecutive samples is interpreted as a counter reset."},{name:"round()",value:"round",def:"round(v instant-vector, to_nearest=1 scalar)",docText:"Rounds the sample values of all elements in `v` to the nearest integer. Ties are resolved by rounding up. The optional `to_nearest` argument allows specifying the nearest multiple to which the sample values should be rounded. This multiple may also be a fraction."},{name:"scalar()",value:"scalar",def:"scalar(v instant-vector)",docText:"Given a single-element input vector, `scalar(v instant-vector)` returns the sample value of that single element as a scalar. If the input vector does not have exactly one element, `scalar` will return `NaN`."},{name:"sort()",value:"sort",def:"sort(v instant-vector)",docText:"Returns vector elements sorted by their sample values, in ascending order."},{name:"sort_desc()",value:"sort_desc",def:"sort_desc(v instant-vector)",docText:"Returns vector elements sorted by their sample values, in descending order."},{name:"sqrt()",value:"sqrt",def:"sqrt(v instant-vector)",docText:"Calculates the square root of all elements in `v`."},{name:"time()",value:"time",def:"time()",docText:"Returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated."},{name:"vector()",value:"vector",def:"vector(s scalar)",docText:"Returns the scalar `s` as a vector with no labels."},{name:"year()",value:"year",def:"year(v=vector(time()) instant-vector)",docText:"Returns the year for each of the given times in UTC."},{name:"avg_over_time()",value:"avg_over_time",def:"avg_over_time(range-vector)",docText:"The average value of all points in the specified interval."},{name:"min_over_time()",value:"min_over_time",def:"min_over_time(range-vector)",docText:"The minimum value of all points in the specified interval."},{name:"max_over_time()",value:"max_over_time",def:"max_over_time(range-vector)",docText:"The maximum value of all points in the specified interval."},{name:"sum_over_time()",value:"sum_over_time",def:"sum_over_time(range-vector)",docText:"The sum of all values in the specified interval."},{name:"count_over_time()",value:"count_over_time",def:"count_over_time(range-vector)",docText:"The count of all values in the specified interval."},{name:"quantile_over_time()",value:"quantile_over_time",def:"quantile_over_time(scalar, range-vector)",docText:"The -quantile (0    1) of the values in the specified interval."},{name:"stddev_over_time()",value:"stddev_over_time",def:"stddev_over_time(range-vector)",docText:"The population standard deviation of the values in the specified interval."},{name:"stdvar_over_time()",value:"stdvar_over_time",def:"stdvar_over_time(range-vector)",docText:"The population standard variance of the values in the specified interval."}],c=u.map(function(t){return{caption:t.name,value:t.value,docHTML:i(t),meta:"function",score:Number.MAX_VALUE}}),p=function(){};(function(){this.getCompletions=function(t,e,n,r,a){var i=e.getTokenAt(n.row,n.column);if("entity.name.tag.label-matcher"===i.type||"string.quoted.label-matcher"===i.type||"entity.name.tag.label-list-matcher"===i.type)return a(null,[]);a(null,l.concat(c))}}).call(p.prototype),e.PrometheusCompletions=p}),ace.define("ace/mode/behaviour/prometheus",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/mode/behaviour/cstyle","ace/token_iterator"],function(t,e,n){"use strict";function r(t,e,n,r){var a=t.end.row-t.start.row;return{text:n+e+r,selection:[0,t.start.column+1,a,t.end.column+(a?0:1)]}}var a=t("../../lib/oop"),i=(t("../behaviour").Behaviour,t("./cstyle").CstyleBehaviour),o=(t("../../token_iterator").TokenIterator,function(){this.inherit(i),this.add("braces","insertion",function(t,e,n,a,o){if("{"==o){var s=n.getSelectionRange(),l=a.doc.getTextRange(s);if(""!==l&&n.getWrapBehavioursEnabled())return r(s,l,"{","}");if(i.isSaneInsertion(n,a))return{text:"{}",selection:[1,1]}}else if("}"==o){var u=n.getCursorPosition(),c=a.doc.getLine(u.row),p=c.substring(u.column,u.column+1);if("}"==p){var d=a.$findOpeningBracket("}",{column:u.column+1,row:u.row});if(null!==d&&i.isAutoInsertedClosing(u,c,o))return{text:"",selection:[1,1]}}}}),this.add("braces","deletion",function(t,e,n,r,a){var i=r.doc.getTextRange(a);if(!a.isMultiLine()&&"{"==i){if("}"==r.doc.getLine(a.start.row).substring(a.start.column+1,a.start.column+2))return a.end.column++,a}})});a.inherits(o,i),e.PrometheusBehaviour=o}),ace.define("ace/mode/prometheus",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/prometheus_highlight_rules"],function(t,e,n){"use strict";var r=t("../lib/oop"),a=t("./text").Mode,i=t("./prometheus_highlight_rules").PrometheusHighlightRules,o=t("./prometheus_completions").PrometheusCompletions,s=t("./behaviour/prometheus").PrometheusBehaviour,l=function(){this.HighlightRules=i,this.$behaviour=new s,this.$completer=new o,this.completer=this.$completer};r.inherits(l,a),function(){this.$id="ace/mode/prometheus"}.call(l.prototype),e.Mode=l})},1590:function(t,e){ace.define("ace/snippets/prometheus",["require","exports","module"],function(t,e,n){"use strict";e.snippets=[{content:"rate(${1:metric}[${2:range}])",name:"rate()",scope:"prometheus",tabTrigger:"r"}],e.scope="prometheus"})},1591:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(t){this.current.jsonData.httpMethod=this.current.jsonData.httpMethod||"GET"}return t.$inject=["$scope"],t.templateUrl="public/app/plugins/datasource/prometheus/partials/config.html",t}()},1592:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"ConfigCtrl",function(){return i}),n.d(e,"AnnotationsQueryCtrl",function(){return s});var r=n(1593),a=n(1595);n.d(e,"MssqlDatasource",function(){return r.a}),n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a});var i=function(){function t(){}return t.templateUrl="partials/config.html",t}(),o="SELECT\n    <time_column> as time,\n    <text_column> as text,\n    <tags_column> as tags\n  FROM\n    <table name>\n  WHERE\n    $__timeFilter(time_column)\n  ORDER BY\n    <time_column> ASC",s=function(){function t(){this.annotation.rawQuery=this.annotation.rawQuery||o}return t.templateUrl="partials/annotations.editor.html",t}()},1593:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(4),a=n.n(r),i=n(1594),o=function(){function t(t,e,n,r){this.backendSrv=e,this.$q=n,this.templateSrv=r,this.name=t.name,this.id=t.id,this.responseParser=new i.a(this.$q)}return t.$inject=["instanceSettings","backendSrv","$q","templateSrv"],t.prototype.interpolateVariable=function(t,e){return"string"==typeof t?e.multi||e.includeAll?"'"+t+"'":t:"number"==typeof t?t:a.a.map(t,function(e){return"number"==typeof t?t:"'"+e+"'"}).join(",")},t.prototype.query=function(t){var e=this,n=a.a.filter(t.targets,function(t){return!0!==t.hide}).map(function(n){return{refId:n.refId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,datasourceId:e.id,rawSql:e.templateSrv.replace(n.rawSql,t.scopedVars,e.interpolateVariable),format:n.format}});return 0===n.length?this.$q.when({data:[]}):this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:n}}).then(this.responseParser.processQueryResult)},t.prototype.annotationQuery=function(t){var e=this;if(!t.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var n={refId:t.annotation.name,datasourceId:this.id,rawSql:this.templateSrv.replace(t.annotation.rawQuery,t.scopedVars,this.interpolateVariable),format:"table"};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:[n]}}).then(function(n){return e.responseParser.transformAnnotationResponse(t,n)})},t.prototype.metricFindQuery=function(t,e){var n=this,r="tempvar";e&&e.variable&&e.variable.name&&(r=e.variable.name);var a={refId:r,datasourceId:this.id,rawSql:this.templateSrv.replace(t,{},this.interpolateVariable),format:"table"};return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{queries:[a]}}).then(function(t){return n.responseParser.parseMetricFindQueryResult(r,t)})},t.prototype.testDatasource=function(){return this.backendSrv.datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{from:"5m",to:"now",queries:[{refId:"A",intervalMs:1,maxDataPoints:1,datasourceId:this.id,rawSql:"SELECT 1",format:"table"}]}}).then(function(t){return{status:"success",message:"Database Connection OK"}}).catch(function(t){return console.log(t),t.data&&t.data.message?{status:"error",message:t.data.message}:{status:"error",message:t.status}})},t}()},1594:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=function(){function t(t){this.$q=t}return t.prototype.processQueryResult=function(t){var e=[];if(!t.data.results)return{data:e};for(var n in t.data.results){var r=t.data.results[n];if(r.series)for(var a=0,i=r.series;a<i.length;a++){var o=i[a];e.push({target:o.name,datapoints:o.points,refId:r.refId,meta:r.meta})}if(r.tables)for(var s=0,l=r.tables;s<l.length;s++){var u=l[s];u.type="table",u.refId=r.refId,u.meta=r.meta,e.push(u)}}return{data:e}},t.prototype.parseMetricFindQueryResult=function(t,e){if(!e||0===e.data.length||0===e.data.results[t].meta.rowCount)return[];var n=e.data.results[t].tables[0].columns,r=e.data.results[t].tables[0].rows,a=this.findColIndex(n,"__text"),i=this.findColIndex(n,"__value");return 2===n.length&&-1!==a&&-1!==i?this.transformToKeyValueList(r,a,i):this.transformToSimpleList(r)},t.prototype.transformToKeyValueList=function(t,e,n){for(var r=[],a=0;a<t.length;a++)this.containsKey(r,t[a][e])||r.push({text:t[a][e],value:t[a][n]});return r},t.prototype.transformToSimpleList=function(t){for(var e=[],n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++){var i=t[n][r];-1===e.indexOf(i)&&e.push(i)}return a.a.map(e,function(t){return{text:t}})},t.prototype.findColIndex=function(t,e){for(var n=0;n<t.length;n++)if(t[n].text===e)return n;return-1},t.prototype.containsKey=function(t,e){for(var n=0;n<t.length;n++)if(t[n].text===e)return!0;return!1},t.prototype.transformAnnotationResponse=function(t,e){for(var n=e.data.results[t.annotation.name].tables[0],r=-1,a=-1,i=-1,o=0;o<n.columns.length;o++)"time"===n.columns[o].text?r=o:"text"===n.columns[o].text?a=o:"tags"===n.columns[o].text&&(i=o);if(-1===r)return this.$q.reject({message:"Missing mandatory time column (with time column alias) in annotation query."});for(var s=[],o=0;o<n.rows.length;o++){var l=n.rows[o];s.push({annotation:t.annotation,time:Math.floor(l[r]),text:l[a],tags:l[i]?l[i].trim().split(/\s*,\s*/):[]})}return s},t}();e.a=i},1595:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(4),a=n.n(r),i=n(1464),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s="SELECT\n  $__timeEpoch(<time_column>),\n  <value column> as value,\n  <series name column> as metric\nFROM\n  <table name>\nWHERE\n  $__timeFilter(time_column)\nORDER BY\n  <time_column> ASC",l=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.target.format=r.target.format||"time_series",r.target.alias="",r.formats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],r.target.rawSql||("table"===r.panelCtrl.panel.type?(r.target.format="table",r.target.rawSql="SELECT 1"):r.target.rawSql=s),r.panelCtrl.events.on("data-received",r.onDataReceived.bind(r),e),r.panelCtrl.events.on("data-error",r.onDataError.bind(r),e),r}return o(e,t),e.$inject=["$scope","$injector"],e.prototype.onDataReceived=function(t){this.lastQueryMeta=null,this.lastQueryError=null;var e=a.a.find(t,{refId:this.target.refId});e&&(this.lastQueryMeta=e.meta)},e.prototype.onDataError=function(t){if(t.data&&t.data.results){var e=t.data.results[this.target.refId];e&&(this.lastQueryMeta=e.meta,this.lastQueryError=e.error)}},e.templateUrl="partials/query.editor.html",e}(i.QueryCtrl)},1596:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"TextPanelCtrl",function(){return u}),n.d(e,"PanelCtrl",function(){return u});var r=n(4),a=n.n(r),i=n(1464),o=n(514),s=n.n(o),l=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.templateSrv=r,o.$sce=i,o.panelDefaults={mode:"markdown",content:"# title"},a.a.defaults(o.panel,o.panelDefaults),o.events.on("init-edit-mode",o.onInitEditMode.bind(o)),o.events.on("refresh",o.onRefresh.bind(o)),o.events.on("render",o.onRender.bind(o)),e.$watch("ctrl.panel.content",a.a.throttle(function(){o.render()},1e3)),o}return l(e,t),e.$inject=["$scope","$injector","templateSrv","$sce"],e.prototype.onInitEditMode=function(){this.addEditorTab("Options","public/app/plugins/panel/text/editor.html"),this.editorTabIndex=1,"text"===this.panel.mode&&(this.panel.mode="markdown")},e.prototype.onRefresh=function(){this.render()},e.prototype.onRender=function(){"markdown"===this.panel.mode?this.renderMarkdown(this.panel.content):"html"===this.panel.mode&&this.updateContent(this.panel.content),this.renderingCompleted()},e.prototype.renderText=function(t){t=t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\n/g,"<br/>"),this.updateContent(t)},e.prototype.renderMarkdown=function(t){var e=this;this.remarkable||(this.remarkable=new s.a),this.$scope.$applyAsync(function(){e.updateContent(e.remarkable.render(t))})},e.prototype.updateContent=function(t){try{this.content=this.$sce.trustAsHtml(this.templateSrv.replace(t,this.panel.scopedVars))}catch(e){console.log("Text panel error: ",e),this.content=this.$sce.trustAsHtml(t)}},e.templateUrl="public/app/plugins/panel/text/module.html",e.scrollable=!0,e}(i.PanelCtrl)},1597:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"GraphCtrl",function(){return p}),n.d(e,"PanelCtrl",function(){return p});var r=(n(1598),n(1604),n(1605),n(1606),n(1607)),a=n(4),i=n.n(a),o=n(22),s=n(1464),l=n(1608),u=n(1609),c=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(t){function e(e,n,r){var a=t.call(this,e,n)||this;return a.annotationsSrv=r,a.hiddenSeries={},a.seriesList=[],a.dataList=[],a.annotations=[],a.colors=[],a.panelDefaults={datasource:null,renderer:"flot",yaxes:[{label:null,show:!0,logBase:1,min:null,max:null,format:"short"},{label:null,show:!0,logBase:1,min:null,max:null,format:"short"}],xaxis:{show:!0,mode:"time",name:null,values:[],buckets:null},yaxis:{align:!1,alignLevel:null},lines:!0,fill:1,linewidth:1,dashes:!1,dashLength:10,spaceLength:10,points:!1,pointradius:5,bars:!1,stack:!1,percentage:!1,legend:{show:!0,values:!1,min:!1,max:!1,current:!1,total:!1,avg:!1},nullPointMode:"null",steppedLine:!1,tooltip:{value_type:"individual",shared:!0,sort:0},timeFrom:null,timeShift:null,targets:[{}],aliasColors:{},seriesOverrides:[],thresholds:[]},i.a.defaults(a.panel,a.panelDefaults),i.a.defaults(a.panel.tooltip,a.panelDefaults.tooltip),i.a.defaults(a.panel.legend,a.panelDefaults.legend),i.a.defaults(a.panel.xaxis,a.panelDefaults.xaxis),a.processor=new l.a(a.panel),a.events.on("render",a.onRender.bind(a)),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-error",a.onDataError.bind(a)),a.events.on("data-snapshot-load",a.onDataSnapshotLoad.bind(a)),a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.events.on("init-panel-actions",a.onInitPanelActions.bind(a)),a}return c(e,t),e.$inject=["$scope","$injector","annotationsSrv"],e.prototype.onInitEditMode=function(){this.addEditorTab("Axes",u.a,2),this.addEditorTab("Legend","public/app/plugins/panel/graph/tab_legend.html",3),this.addEditorTab("Display","public/app/plugins/panel/graph/tab_display.html",4),o.a.alertingEnabled&&this.addEditorTab("Alert",s.alertTab,5),this.subTabIndex=0},e.prototype.onInitPanelActions=function(t){t.push({text:"Export CSV",click:"ctrl.exportCsv()"}),t.push({text:"Toggle legend",click:"ctrl.toggleLegend()"})},e.prototype.issueQueries=function(e){return this.annotationsPromise=this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}),t.prototype.issueQueries.call(this,e)},e.prototype.zoomOut=function(t){this.publishAppEvent("zoom-out",2)},e.prototype.onDataSnapshotLoad=function(t){this.annotationsPromise=this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}),this.onDataReceived(t)},e.prototype.onDataError=function(t){this.seriesList=[],this.annotations=[],this.render([])},e.prototype.onDataReceived=function(t){var e=this;if(this.dataList=t,this.seriesList=this.processor.getSeriesList({dataList:t,range:this.range}),this.dataWarning=null,0===this.seriesList.reduce(function(t,e){return t+e.datapoints.length},0))this.dataWarning={title:"No data points",tip:"No datapoints returned from data query"};else for(var n=0,r=this.seriesList;n<r.length;n++){var a=r[n];if(a.isOutsideRange){this.dataWarning={title:"Data points outside time range",tip:"Can be caused by timezone mismatch or missing time filter in query"};break}}this.annotationsPromise.then(function(t){e.loading=!1,e.alertState=t.alertState,e.annotations=t.annotations,e.render(e.seriesList)},function(){e.loading=!1,e.render(e.seriesList)})},e.prototype.onRender=function(){if(this.seriesList)for(var t=0,e=this.seriesList;t<e.length;t++){var n=e[t];n.applySeriesOverrides(this.panel.seriesOverrides),n.unit&&(this.panel.yaxes[n.yaxis-1].format=n.unit)}},e.prototype.changeSeriesColor=function(t,e){t.color=e,this.panel.aliasColors[t.alias]=t.color,this.render()},e.prototype.toggleSeries=function(t,e){e.ctrlKey||e.metaKey||e.shiftKey?this.hiddenSeries[t.alias]?delete this.hiddenSeries[t.alias]:this.hiddenSeries[t.alias]=!0:this.toggleSeriesExclusiveMode(t),this.render()},e.prototype.toggleSeriesExclusiveMode=function(t){var e=this,n=this.hiddenSeries;n[t.alias]&&delete n[t.alias],i.a.every(this.seriesList,function(e){return e.alias===t.alias||n[e.alias]})?i.a.each(this.seriesList,function(t){delete e.hiddenSeries[t.alias]}):i.a.each(this.seriesList,function(n){n.alias!==t.alias&&(e.hiddenSeries[n.alias]=!0)})},e.prototype.toggleAxis=function(t){var e=i.a.find(this.panel.seriesOverrides,{alias:t.alias});e||(e={alias:t.alias},this.panel.seriesOverrides.push(e)),t.yaxis=e.yaxis=2===t.yaxis?1:2,this.render()},e.prototype.addSeriesOverride=function(t){this.panel.seriesOverrides.push(t||{})},e.prototype.removeSeriesOverride=function(t){this.panel.seriesOverrides=i.a.without(this.panel.seriesOverrides,t),this.render()},e.prototype.toggleLegend=function(){this.panel.legend.show=!this.panel.legend.show,this.refresh()},e.prototype.legendValuesOptionChanged=function(){var t=this.panel.legend;t.values=t.min||t.max||t.avg||t.current||t.total,this.render()},e.prototype.exportCsv=function(){var t=this.$scope.$new(!0);t.seriesList=this.seriesList,this.publishAppEvent("show-modal",{templateHtml:'<export-data-modal data="seriesList"></export-data-modal>',scope:t,modalClass:"modal--narrow"})},e.template=r.a,e}(s.MetricsPanelCtrl)},1598:function(t,e,n){"use strict";function r(t,e,n){return{restrict:"A",template:"",link:function(e,n){function r(){return!R||0===z}function a(t){V.yaxes[0].label&&V.yaxes[0].show&&f()("<div class='axisLabel left-yaxis-label flot-temp-elem'></div>").text(V.yaxes[0].label).appendTo(n),V.yaxes[1].label&&V.yaxes[1].show&&f()("<div class='axisLabel right-yaxis-label flot-temp-elem'></div>").text(V.yaxes[1].label).appendTo(n),L.dataWarning&&f()('<div class="datapoints-warning flot-temp-elem">'+L.dataWarning.title+"</div>").appendTo(n),H.draw(t)}function i(t,e){var n=V.yaxes[0],r=V.yaxes[1];n.show&&n.label&&(e.left=20),r.show&&r.label&&(e.right=20);for(var a=t.getYAxes(),i=0;i<a.length;i++){var o=a[i],s=V.yaxes[i];o.options.max=null!==o.options.max?o.options.max:s.max,o.options.min=null!==o.options.min?o.options.min:s.min}}function o(t){var e=t.getYAxes(),n=V.yaxis.align||!1;if(e.length>1&&!0===n){var r=V.yaxis.alignLevel||0;Object(T.a)(e,parseFloat(r))}}function s(t){for(var e=Number.MAX_VALUE,n=0;n<t.length;n++)if(t[n].stats.timeStep){if(V.bars){if(t[n].bars&&!1===t[n].bars.show)continue}else if(void 0===t[n].bars||void 0===t[n].bars.show||!t[n].bars.show)continue;t[n].stats.timeStep<e&&(e=t[n].stats.timeStep)}return e}function l(){if(z=n.width(),!r()){H.prepare(n,R),V.dashes=!!V.lines&&V.dashes;var t=d(V);c(t,V),$(R,t),H.addFlotOptions(t,V),Q.addFlotEvents(B,t),N=h(R,V),p(t,!0)}}function u(t){for(var e=0;e<t.length;e++){var n=t[e];n.data=n.getFlotPairs(n.nullPointMode||V.nullPointMode),L.hiddenSeries[n.alias]&&(n.data=[],n.stack=!1)}}function c(t,e){switch(e.xaxis.mode){case"series":t.series.bars.barWidth=.7,t.series.bars.align="center";for(var n=0;n<R.length;n++){var r=R[n];r.data=[[n+1,r.stats[e.xaxis.values[0]]]]}P(t);break;case"histogram":var a=void 0;if(R.length){var i=g.a.min(g.a.map(R,function(t){return t.stats.min})),o=g.a.max(g.a.map(R,function(t){return t.stats.max})),l=e.xaxis.buckets||z/50;a=Object(x.tickStep)(i,o,l),t.series.bars.barWidth=.8*a,R=Object(C.a)(R,a,L.hiddenSeries,i,o)}else a=0;O(t,a);break;case"table":t.series.bars.barWidth=.7,t.series.bars.align="center",E(t);break;default:t.series.bars.barWidth=s(R)/1.5,v(t)}}function p(t,e){try{j=f.a.plot(n,N,t),L.renderError&&(delete L.error,delete L.inspector)}catch(t){console.log("flotcharts error",t),L.error=t.message||"Render Error",L.renderError=!0,L.inspector={error:t}}e&&L.renderingCompleted()}function d(t){var e="#c8c8c8";!0===M.a.bootData.user.lightTheme&&(e="#a1a1a1");var n=!!t.stack||null;return{hooks:{draw:[a],processOffset:[i],processRange:[o]},legend:{show:!1},series:{stackpercent:!!t.stack&&t.percentage,stack:t.percentage?null:n,lines:{show:t.lines,zero:!1,fill:m(t.fill),lineWidth:t.dashes?0:t.linewidth,steps:t.steppedLine},dashes:{show:t.dashes,lineWidth:t.linewidth,dashLength:[t.dashLength,t.spaceLength]},bars:{show:t.bars,fill:1,barWidth:1,zero:!1,lineWidth:0},points:{show:t.points,fill:1,fillColor:!1,radius:t.points?t.pointradius:2},shadowSize:0},yaxes:[],xaxis:{},grid:{minBorderMargin:0,markings:[],backgroundColor:null,borderWidth:0,hoverable:!0,clickable:!0,color:e,margin:{left:0,right:0},labelMarginX:0},selection:{mode:"x",color:"#666"},crosshair:{mode:"x"}}}function h(t,e){var n=e.legend.sort,r=e.legend.sortDesc,a=null!==n&&void 0!==n,i=null!==r&&void 0!==r,o=e.stack&&a&&i,s=!0===e.legend.sortDesc?-1:1;return o?g.a.sortBy(t,function(t){return t.stats[n]*s}):g.a.sortBy(t,function(t){return t.zindex})}function m(t){return V.percentage&&V.stack&&0===t?.001:t/10}function v(t){var e=z/100,n=g.a.isUndefined(L.range.from)?null:L.range.from.valueOf(),r=g.a.isUndefined(L.range.to)?null:L.range.to.valueOf();t.xaxis={timezone:U.getTimezone(),show:V.xaxis.show,mode:"time",min:n,max:r,label:"Datetime",ticks:e,timeformat:q(e,n,r)}}function P(t){var e=g.a.map(R,function(t,e){return[e+1,t.alias]});t.xaxis={timezone:U.getTimezone(),show:V.xaxis.show,mode:null,min:0,max:e.length+1,label:"Datetime",ticks:e}}function O(t,e){var n,r,a,i=z/50;if(R.length&&e){for(var o=[],s=0,l=R;s<l.length;s++)for(var u=l[s],c=0,p=u.data;c<p.length;c++){var d=p[c];o[d[0]]=!0}n=Object.keys(o).map(function(t){return Number(t)}),r=g.a.min(n),a=g.a.max(n);for(var h=e,f=Math.floor((a-r)/h);f>i;)h*=2,f=Math.ceil((a-r)/h);r=Math.floor(r/h)*h,a=Math.ceil(a/h)*h,n=[];for(var m=r;m<=a;m+=h)n.push(m)}else n=i/2,r=0,a=1;t.xaxis={timezone:U.getTimezone(),show:V.xaxis.show,mode:null,min:r,max:a,label:"Histogram",ticks:n},F(t.xaxis,"short")}function E(t){var e=g.a.map(R,function(t,e){return g.a.map(t.datapoints,function(n,r){return[e*t.datapoints.length+r+1,n[1]]})});e=g.a.flatten(e,!0),t.xaxis={timezone:U.getTimezone(),show:V.xaxis.show,mode:null,min:0,max:e.length+1,label:"Datetime",ticks:e}}function $(t,e){var n={position:"left",show:V.yaxes[0].show,index:1,logBase:V.yaxes[0].logBase||1,min:A(V.yaxes[0].min),max:A(V.yaxes[0].max),tickDecimals:V.yaxes[0].decimals};if(e.yaxes.push(n),g.a.find(t,{yaxis:2})){var r=g.a.clone(n);r.index=2,r.show=V.yaxes[1].show,r.logBase=V.yaxes[1].logBase||1,r.position="right",r.min=A(V.yaxes[1].min),r.max=A(V.yaxes[1].max),r.tickDecimals=V.yaxes[1].decimals,e.yaxes.push(r),D(e.yaxes[1],t),F(e.yaxes[1],V.percentage&&V.stack?"percent":V.yaxes[1].format)}D(e.yaxes[0],t),F(e.yaxes[0],V.percentage&&V.stack?"percent":V.yaxes[0].format)}function A(t){return null===t||void 0===t?null:g.a.toNumber(t)}function D(t,e){if(1!==t.logBase){var n=0===t.min;t.min<Number.MIN_VALUE&&(t.min=null),t.max<Number.MIN_VALUE&&(t.max=null);var r,a,i=t.max,o=t.min;for(a=0;a<e.length;a++)r=e[a],r.yaxis===t.index&&((!i||i<r.stats.max)&&(i=r.stats.max),(!o||o>r.stats.logmin)&&(o=r.stats.logmin));t.transform=function(e){return e<Number.MIN_VALUE?null:Math.log(e)/Math.log(t.logBase)},t.inverseTransform=function(e){return Math.pow(t.logBase,e)},i||o?i?o||(o=i*t.inverseTransform(-4)):i=o*t.inverseTransform(4):(i=t.inverseTransform(2),o=t.inverseTransform(-2)),o=t.min?t.inverseTransform(Math.ceil(t.transform(t.min))):t.min=t.inverseTransform(Math.floor(t.transform(o))),i=t.max?t.inverseTransform(Math.floor(t.transform(t.max))):t.max=t.inverseTransform(Math.ceil(t.transform(i))),!o||o<Number.MIN_VALUE||!i||i<Number.MIN_VALUE||(Number.isFinite(o)&&Number.isFinite(i)?(n&&(t.min=.1,o=1),t.ticks=I(o,i,t.logBase),n&&t.ticks.unshift(.1),t.ticks[t.ticks.length-1]>t.max&&(t.max=t.ticks[t.ticks.length-1])):(t.ticks=[1,2],delete t.min,delete t.max))}}function I(t,e,n){var r,a=[];for(r=t;r<=e;r*=n)a.push(r);var i=Math.ceil(L.height/25),o=a.length;if(o>i){var s=Math.ceil(o/i)*n;for(a=[],r=t;r<=e*s;r*=s)a.push(r)}return a}function F(t,e){t.tickFormatter=function(t,n){if(!b.a.valueFormats[e])throw new Error("Unit '"+e+"' is not supported");return b.a.valueFormats[e](t,n.tickDecimals,n.scaledDecimals)}}function q(t,e,n){if(e&&n&&t){var r=n-e,a=r/t/1e3;return a<=45?"%H:%M:%S":a<=7200||r<=864e5?"%H:%M":a<=8e4?"%m/%d %H:%M":a<=2419200||r<=31536e6?"%m/%d":"%Y-%m"}return"%H:%M"}var R,j,N,L=e.ctrl,U=L.dashboard,V=L.panel,B=[],z=0,Q=new _.a(L),H=new k.a(L),Y=new w.a(n,U,e,function(){return N});L.events.on("panel-teardown",function(){H=null,j&&(j.destroy(),j=null)}),L.events.on("render",function(t){(R=t||R)&&(B=L.annotations||[],u(R),Object(S.g)(R,V),L.events.emit("render-legend"))}),L.events.on("legend-rendering-complete",function(){l()}),S.b.on("graph-hover",function(t){U.sharedTooltipModeEnabled()&&j&&t.panel.id!==V.id&&!L.otherPanelInFullscreenMode()&&Y.show(t.pos)},e),S.b.on("graph-hover-clear",function(t,e){j&&Y.clear(j)},e),n.bind("plotselected",function(n,r){if("time"!==V.xaxis.mode)return void j.clearSelection();(r.ctrlKey||r.metaKey)&&U.meta.canEdit?setTimeout(function(){Q.updateTime(r.xaxis)},100):e.$apply(function(){t.setTime({from:y.a.utc(r.xaxis.from),to:y.a.utc(r.xaxis.to)})})}),n.bind("plotclick",function(t,e,n){if("time"===V.xaxis.mode&&(e.ctrlKey||e.metaKey)&&U.meta.canEdit){e.x!==e.x1||setTimeout(function(){Q.updateTime({from:e.x,to:null})},100)}}),e.$on("$destroy",function(){Y.destroy(),n.off(),n.remove()})}}}r.$inject=["timeSrv","popoverSrv","contextSrv"];var a=n(1469),i=(n.n(a),n(1486)),o=(n.n(i),n(1487)),s=(n.n(o),n(1488)),l=(n.n(s),n(1489)),u=(n.n(l),n(1490)),c=(n.n(u),n(1491)),p=(n.n(c),n(1492)),d=(n.n(p),n(1599)),h=(n.n(d),n(16)),f=n.n(h),m=n(4),g=n.n(m),v=n(1),y=n.n(v),b=n(224),x=n(516),S=n(225),w=n(1600),k=n(1601),_=n(1475),C=n(1602),T=n(1603),M=n(22);S.d.directive("grafanaGraph",r)},1599:function(t,e,n){var r,a;r=[n(16),n(4),n(21),n(87)],void 0!==(a=function(t,e,n,r){"use strict";function a(t,e,a){var i=n.element(document).injector(),o=document.createElement("div");o.innerHTML='<annotation-tooltip event="event" on-edit="onEdit()"></annotation-tooltip>',i.invoke(["$compile","$rootScope",function(n,i){var s=a.getOptions().events.manager,l=i.$new(!0);l.event=e,l.onEdit=function(){s.editEvent(e)},n(o)(l),l.$digest(),l.$destroy();var u=new r({target:t[0],content:o,position:"bottom center",classes:"drop-popover drop-popover--annotation",openOn:"hover",hoverCloseDelay:200,tetherOptions:{constraints:[{to:"window",pin:!0,attachment:"both"}]}});u.open(),u.on("close",function(){setTimeout(function(){u.destroy()})})}])}function i(t,e,a){var i=a.getOptions().events.manager;if(i.editorOpen)return void(s=t);i.editorOpened(),s=t,setTimeout(function(){var t=n.element(document).injector(),a=document.createElement("div");a.innerHTML='<event-editor panel-ctrl="panelCtrl" event="event" close="close()"></event-editor>',t.invoke(["$compile","$rootScope",function(t,n){var o,l=n.$new(!0);l.event=e,l.panelCtrl=i.panelCtrl,l.close=function(){o.close()},t(a)(l),l.$digest(),o=new r({target:s[0],content:a,position:"bottom center",classes:"drop-popover drop-popover--form",openOn:"click",tetherOptions:{constraints:[{to:"window",pin:!0,attachment:"both"}]}}),o.open(),i.editorOpened(),o.on("close",function(){setTimeout(function(){i.editorClosed(),l.$destroy(),o.destroy()})})}])},100)}function o(e){var n=this,r=new c(e);e.getEvents=function(){return r._events},e.hideEvents=function(){t.each(r._events,function(t,e){e.visual().getObject().hide()})},e.showEvents=function(){e.hideEvents(),t.each(r._events,function(t,e){e.hide()}),n.eventMarkers.drawEvents()},e.setEvents=function(t){r.eventsEnabled&&r.setupEvents(t)},e.hooks.processOptions.push(function(t,e){null!=e.events.data&&(r.eventsEnabled=!0)}),e.hooks.draw.push(function(t){var e=t.getOptions();r.eventsEnabled&&(r.getEvents().length<1?(r.setTypes(e.events.types),r.setupEvents(e.events.data)):r.updateEvents()),r.drawEvents()})}var s=null,l=function(t,e,n,r,a,i,o,s){var l=t,u=e,c=n,p=r,d={left:a,top:i},h=o,f=s;this.width=function(){return h},this.height=function(){return f},this.position=function(){return d},this.draw=function(){u(l)},this.clear=function(){c(l)},this.getObject=function(){return l},this.moveTo=function(t){d=t,p(l,d)}},u=function(t,e){var n=t,r=e,a=!1;this.visual=function(){return r},this.getOptions=function(){return n},this.getParent=function(){},this.isHidden=function(){return a},this.hide=function(){a=!0},this.unhide=function(){a=!1}},c=function(n){var r=[];this._types=[],this._plot=n,this.eventsEnabled=!1,this.getEvents=function(){return r},this.setTypes=function(t){return this._types=t},this.setupEvents=function(n){var a=this,i=e.partition(n,"isRegion"),o=i[0];n=i[1],t.each(n,function(t,e){var n=new u(e,a._buildDiv(e));r.push(n)}),t.each(o,function(t,e){var n=new u(e,a._buildRegDiv(e));r.push(n)}),r.sort(function(t,e){var n=t.getOptions(),r=e.getOptions();return n.min>r.min?1:n.min<r.min?-1:0})},this.drawEvents=function(){var e=this;t.each(r,function(t,n){e._insidePlot(n.getOptions().min)&&!n.isHidden()?n.visual().draw():n.visual().getObject().hide()})},this.updateEvents=function(){var e,n,a=this,i=this._plot.getPlotOffset(),o=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];t.each(r,function(t,r){n=i.top+a._plot.height()-r.visual().height(),e=o.p2c(r.getOptions().min)+i.left-r.visual().width()/2,r.visual().moveTo({top:n,left:e})})},this._clearEvents=function(){t.each(r,function(t,e){e.visual().clear()}),r=[]},this._buildDiv=function(e){var n,r,o,s,u,c,p,d,h=this,f=this._plot.getPlaceholder(),m=this._plot.getPlotOffset(),g=this._plot.getAxes(),v=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];g.yaxis&&g.yaxis.used&&g.yaxis,g.yaxis2&&g.yaxis2.used&&g.yaxis2;var y=e.eventType;o=null!==this._types&&this._types[y]&&this._types[y].color?this._types[y].color:"#666",s=null!==this._types&&this._types[y]&&this._types[y].markerSize?this._types[y].markerSize:8,u=null===this._types||!this._types[y]||void 0===this._types[y].markerShow||this._types[y].markerShow,d=null===this._types||!this._types[y]||void 0===this._types[y].markerTooltip||this._types[y].markerTooltip,c=null!=this._types&&this._types[y]&&this._types[y].lineStyle?this._types[y].lineStyle.toLowerCase():"dashed",p=null!=this._types&&this._types[y]&&void 0!==this._types[y].lineWidth?this._types[y].lineWidth:1;var b=v.options.eventSectionHeight||0;b/=3,n=m.top+this._plot.height()+b,r=v.p2c(e.min)+m.left;var x=t('<div class="events_line flot-temp-elem"></div>').css({position:"absolute",opacity:.8,left:r+"px",top:8,width:p+"px",height:this._plot.height()+.8*b,"border-left-width":p+"px","border-left-style":c,"border-left-color":o,color:o}).appendTo(f);if(u){var S=t('<div class="events_marker"></div>').css({position:"absolute",left:-s-Math.round(p/2)+"px","font-size":0,"line-height":0,width:0,height:0,"border-left":s+"px solid transparent","border-right":s+"px solid transparent"});S.appendTo(x),this._types[y]&&this._types[y].position&&"BOTTOM"===this._types[y].position.toUpperCase()?S.css({top:n-s-8+"px","border-top":"none","border-bottom":s+"px solid "+o}):S.css({top:"0px","border-top":s+"px solid "+o,"border-bottom":"none"}),S.data({event:e});var w=function(){a(S,t(this).data("event"),h._plot)};e.editModel&&i(S,e.editModel,h._plot);var k=function(){h._plot.clearSelection()};d&&(S.css({cursor:"help"}),S.hover(w,k))}return new l(x,function(t){t.show()},function(t){t.remove()},function(t,e){t.css({top:e.top,left:e.left})},r,n,x.width(),x.height())},this._buildRegDiv=function(n){var r,o,s,u,c,p,d,h=this,f=this._plot.getPlaceholder(),m=this._plot.getPlotOffset(),g=this._plot.getAxes(),v=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1];g.yaxis&&g.yaxis.used&&g.yaxis,g.yaxis2&&g.yaxis2.used&&g.yaxis2;var y=n.eventType;p=null!==this._types&&this._types[y]&&this._types[y].color?this._types[y].color:"#666",d=null===this._types||!this._types[y]||void 0===this._types[y].markerTooltip||this._types[y].markerTooltip,s=null!=this._types&&this._types[y]&&void 0!==this._types[y].lineWidth?this._types[y].lineWidth:1,c=null!=this._types&&this._types[y]&&this._types[y].lineStyle?this._types[y].lineStyle.toLowerCase():"dashed";r=m.top+this._plot.height()+2;var b=Math.min(n.min,n.timeEnd),x=Math.max(n.min,n.timeEnd);o=v.p2c(b)+m.left;var S=v.p2c(x)+m.left;u=S-o,e.each([o,S],function(e){t('<div class="events_line flot-temp-elem"></div>').css({position:"absolute",opacity:.8,left:e+"px",top:8,width:s+"px",height:h._plot.height()+2,"border-left-width":s+"px","border-left-style":c,"border-left-color":p,color:p}).appendTo(f)});var w=t('<div class="events_marker region_marker flot-temp-elem"></div>').css({position:"absolute",opacity:.5,left:o+"px",top:r,width:Math.round(u+s)+"px",height:"0.5rem","border-left-color":p,color:p,"background-color":p});w.appendTo(f),w.data({event:n});var k=function(){a(w,t(this).data("event"),h._plot)};n.editModel&&i(w,n.editModel,h._plot);var _=function(){h._plot.clearSelection()};return d&&(w.css({cursor:"help"}),w.hover(k,_)),new l(w,function(t){t.show()},function(t){t.remove()},function(t,e){t.css({top:e.top,left:e.left})},o,r,w.width(),w.height())},this._insidePlot=function(t){var e=this._plot.getXAxes()[this._plot.getOptions().events.xaxis-1],n=e.p2c(t);return n>0&&n<e.p2c(e.max)}},p={events:{data:null,types:null,xaxis:1,position:"BOTTOM"}};t.plot.plugins.push({init:o,options:p,name:"events",version:"0.2.5"})}.apply(e,r))&&(t.exports=a)},1600:function(t,e,n){"use strict";function r(t,e,n,r){var a=this,s=n.ctrl,l=s.panel,u=i()('<div class="graph-tooltip">');this.destroy=function(){u.remove()},this.findHoverIndexFromDataPoints=function(t,e,n){var r,a=e.datapoints.pointsize,i=n*a,o=e.datapoints.points.length;for(r=i;r<o;r+=a)if(!e.lines.steps&&null!=e.datapoints.points[i]&&null==e.datapoints.points[r]||e.datapoints.points[r]>t)return Math.max(r-a,0)/a;return r/a-1},this.findHoverIndexFromData=function(t,e){for(var n,r=0,a=e.data.length-1;;){if(r>a)return Math.max(a,0);if(n=Math.floor((r+a)/2),e.data[n][0]===t)return n;e.data[n][0]<t?r=n+1:a=n-1}},this.renderAndShow=function(t,e,n,r){"time"===r&&(e='<div class="graph-tooltip-time">'+t+"</div>"+e),u.html(e).place_tt(n.pageX+20,n.pageY)},this.getMultiSeriesPlotHoverInfo=function(t,e){var n,r,a,i,o,s,u,c,p,d=[[],[],[]],h=0;for(r=0;r<t.length;r++)a=t[r],!a.data.length||l.legend.hideEmpty&&a.allIsNull?d[0].push({hidden:!0,value:0}):!a.data.length||l.legend.hideZero&&a.allIsZero?d[0].push({hidden:!0,value:0}):(i=this.findHoverIndexFromData(e.x,a),o=e.x-a.data[i][0],s=a.data[i][0],(!c||o>=0&&(o<c||c<0)||o<0&&o>c)&&(c=o,p=s),a.stack?"individual"===l.tooltip.value_type?n=a.data[i][1]:a.stack?(h+=a.data[i][1],n=h):n=a.data[i][1]:n=a.data[i][1],(a.lines.steps||a.stack)&&(i=this.findHoverIndexFromDataPoints(e.x,a,i)),u=0,a.yaxis&&(u=a.yaxis.n),d[u].push({value:n,hoverIndex:i,color:a.color,label:a.aliasEscaped,time:s,distance:o,index:r}));return d=d[0].concat(d[1],d[2]),d.time=p,d},t.mouseleave(function(){if(l.tooltip.shared){var e=t.data().plot;e&&(u.detach(),e.unhighlight())}o.b.emit("graph-hover-clear")}),t.bind("plothover",function(e,n,r){a.show(n,r),n.panelRelY=(n.pageY-t.offset().top)/t.height(),o.b.emit("graph-hover",{pos:n,panel:l})}),t.bind("plotclick",function(t,e,n){o.b.emit("graph-click",{pos:e,panel:l,item:n})}),this.clear=function(t){u.detach(),t.clearCrosshair(),t.unhighlight()},this.show=function(n,o){var s,c,p,d,h,f,m,g,v=t.data().plot,y=v.getData(),b=v.getXAxes(),x=b[0].options.mode,S=r(),w=l.tooltip.shared;if(n.panelRelY){var k=v.pointOffset({x:n.x});if(Number.isNaN(k.left)||k.left<0||k.left>t.width())return void a.clear(v);n.pageX=t.offset().left+k.left,n.pageY=t.offset().top+t.height()*n.panelRelY;if(!(n.pageY>=i()(window).scrollTop()&&n.pageY<=i()(window).innerHeight()+i()(window).scrollTop()))return void a.clear(v);if(v.setCrosshair(n),w=!0,e.sharedCrosshairModeOnly())return}if(0!==S.length)if(g=S[0].hasMsResolution?"YYYY-MM-DD HH:mm:ss.SSS":"YYYY-MM-DD HH:mm:ss",w){v.unhighlight();var _=a.getMultiSeriesPlotHoverInfo(y,n);for(m="",p=e.formatDate(_.time,g),2===l.tooltip.sort?_.sort(function(t,e){return e.value-t.value}):1===l.tooltip.sort&&_.sort(function(t,e){return t.value-e.value}),h=0;h<_.length;h++)if(d=_[h],!d.hidden){var C="";o&&d.index===o.seriesIndex&&(C="graph-tooltip-list-item--highlight"),f=S[d.index],c=f.formatValue(d.value),m+='<div class="graph-tooltip-list-item '+C+'"><div class="graph-tooltip-series-name">',m+='<i class="fa fa-minus" style="color:'+d.color+';"></i> '+d.label+":</div>",m+='<div class="graph-tooltip-value">'+c+"</div></div>",v.highlight(d.index,d.hoverIndex)}a.renderAndShow(p,m,n,x)}else o?(f=S[o.seriesIndex],s='<div class="graph-tooltip-list-item"><div class="graph-tooltip-series-name">',s+='<i class="fa fa-minus" style="color:'+o.series.color+';"></i> '+f.aliasEscaped+":</div>",c=l.stack&&"individual"===l.tooltip.value_type?o.datapoint[1]-o.datapoint[2]:o.datapoint[1],c=f.formatValue(c),p=e.formatDate(o.datapoint[0],g),s+='<div class="graph-tooltip-value">'+c+"</div>",a.renderAndShow(p,s,n,x)):u.detach()}}e.a=r;var a=n(16),i=n.n(a),o=n(225)},1601:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(1469),a=(n.n(r),n(16)),i=n.n(a),o=n(4),s=n.n(o),l=function(){function t(t){this.panelCtrl=t}return t.prototype.getHandleHtml=function(t,e,n){var r=e.colorMode;return"custom"===e.colorMode&&(r="critical"),'\n    <div class="alert-handle-wrapper alert-handle-wrapper--T'+t+'">\n      <div class="alert-handle-line alert-handle-line--'+r+'">\n      </div>\n      <div class="alert-handle" data-handle-index="'+t+'">\n        <i class="icon-gf icon-gf-'+r+" alert-state-"+r+'"></i>\n        <span class="alert-handle-value">'+n+'<i class="alert-handle-grip"></i></span>\n      </div>\n    </div>'},t.prototype.initDragging=function(t){function e(t){if(null===s)s=t.clientY;else{var e=t.clientY-s;r+=e,s=t.clientY,a.css({top:r+e})}}function n(){var t=l.c2p({left:0,top:r}).y;t=parseInt(t.toFixed(0)),c.value=t,a.off("mousemove",e),a.off("mouseup",e),a.off("mouseleave",e),u.$scope.$apply(function(){u.render(),u.events.emit("threshold-changed",{threshold:c,handleIndex:o})})}var r,a=i()(t.currentTarget).parents(".alert-handle-wrapper"),o=i()(t.currentTarget).data("handleIndex"),s=null,l=this.plot,u=this.panelCtrl,c=this.thresholds[o];s=null,r=a.position().top,a.on("mousemove",e),a.on("mouseup",n),a.on("mouseleave",n)},t.prototype.cleanUp=function(){this.placeholder.find(".alert-handle-wrapper").remove(),this.needsCleanup=!1},t.prototype.renderHandle=function(t,e){var n=this.thresholds[t],r=n.value,a=r,o=0;if(s.a.isNumber(r)){var l=this.plot.p2c({x:0,y:r});o=Math.round(Math.min(Math.max(l.top,0),this.height)-6)}else a="",o=e;var u=i()(this.getHandleHtml(t,n,a));this.placeholder.append(u),u.toggleClass("alert-handle-wrapper--no-value",""===a),u.css({top:o})},t.prototype.shouldDrawHandles=function(){return!this.hasSecondYAxis&&this.panelCtrl.editingThresholds&&this.panelCtrl.panel.thresholds.length>0},t.prototype.prepare=function(t,e){this.hasSecondYAxis=!1;for(var n=0;n<e.length;n++)if(e[n].yaxis>1){this.hasSecondYAxis=!0;break}if(this.shouldDrawHandles()){var r=this.panelCtrl.panel.thresholds.length>1?"220px":"110px";t.css("margin-right",r)}else this.needsCleanup&&t.css("margin-right","0")},t.prototype.draw=function(t){this.thresholds=this.panelCtrl.panel.thresholds,this.plot=t,this.placeholder=t.getPlaceholder(),this.needsCleanup&&this.cleanUp(),this.shouldDrawHandles()&&(this.height=t.height(),this.thresholds.length>0&&this.renderHandle(0,10),this.thresholds.length>1&&this.renderHandle(1,this.height-30),this.placeholder.off("mousedown",".alert-handle"),this.placeholder.on("mousedown",".alert-handle",this.initDragging.bind(this)),this.needsCleanup=!0)},t.prototype.addFlotOptions=function(t,e){if(e.thresholds&&0!==e.thresholds.length){var n,r,a,i=1/0,o=-1/0;for(n=0;n<e.thresholds.length;n++)if(r=e.thresholds[n],s.a.isNumber(r.value)){var l;switch(r.op){case"gt":l=i,e.thresholds.length>n+1&&(a=e.thresholds[n+1],a.value>r.value&&(l=a.value,o=l));break;case"lt":l=o,e.thresholds.length>n+1&&(a=e.thresholds[n+1],a.value<r.value&&(l=a.value,i=l))}var u,c;switch(r.colorMode){case"critical":u="rgba(234, 112, 112, 0.12)",c="rgba(237, 46, 24, 0.60)";break;case"warning":u="rgba(235, 138, 14, 0.12)",c="rgba(247, 149, 32, 0.60)";break;case"ok":u="rgba(11, 237, 50, 0.090)",c="rgba(6,163,69, 0.60)";break;case"custom":u=r.fillColor,c=r.lineColor}r.fill&&("right"===r.yaxis&&this.hasSecondYAxis?t.grid.markings.push({y2axis:{from:r.value,to:l},color:u}):t.grid.markings.push({yaxis:{from:r.value,to:l},color:u})),r.line&&("right"===r.yaxis&&this.hasSecondYAxis?t.grid.markings.push({y2axis:{from:r.value,to:r.value},color:c}):t.grid.markings.push({yaxis:{from:r.value,to:r.value},color:c}))}}},t}()},1602:function(t,e,n){"use strict";function r(t){for(var e=[],n=0;n<t.length;n++)for(var r=t[n],a=r.datapoints,i=0;i<a.length;i++)null!==a[i][0]&&e.push(a[i][0]);return e}function a(t,e,n,r){for(var a={},i=o(n,e),s=o(r,e),u=i,c=0;u<=s;)a[u]=0,u=i+e*c,c++;for(var p=0;p<t.length;p++){var d=o(t[p],e);a[d]=a[d]+1}var h=l.a.map(a,function(t,e){return[Number(e),t]});return l.a.sortBy(h,function(t){return t[0]})}function i(t,e,n,i,o){return t.map(function(t){var s=r([t]);if(t.histogram=!0,n[t.alias])t.data=[];else{var l=a(s,e,i,o);t.data=l}return t})}function o(t,e){return Math.floor(t/e)*e}e.a=i;var s=n(4),l=n.n(s)},1603:function(t,e,n){"use strict";function r(t,e){if(!isNaN(e)&&s(t)){var n=t[0],r=t[1];i(n,r,e),a(n,r);var l=0===n.min||0===r.min||0===n.max||0===r.max,h=u(n,r);if(l&&h)n.min=n.max>0?0:n.min,n.max=n.max>0?n.max:0,r.min=r.max>0?0:r.min,r.max=r.max>0?r.max:0;else if(p(n,r))n.min>=0?(n.min=-n.max,r.max=-r.min):(n.max=-n.min,r.min=-r.max);else{var f=d(n,r);h?n.min>0?(n.min=n.max/f,r.min=r.max/f):(n.max=n.min/f,r.max=r.min/f):c(n,r)?(n.min=r.min?r.min*f:n.min,r.min=n.min?n.min/f:r.min,n.max=r.max?r.max*f:n.max,r.max=n.max?n.max/f:r.max):(n.min=n.min>0?r.min*f:n.min,r.min=r.min>0?n.min/f:r.min,n.max=n.max<0?r.max*f:n.max,r.max=r.max<0?n.max/f:r.max)}o(n,r,e)}}function a(t,e){t.max===t.min&&(t.min-=.25,t.max+=.25),e.max===e.min&&(e.min-=.25,e.max+=.25)}function i(t,e,n){0!==n&&(t.min-=n,t.max-=n,e.min-=n,e.max-=n)}function o(t,e,n){0!==n&&(t.min+=n,t.max+=n,e.min+=n,e.max+=n)}function s(t){return 2===t.length&&l(t[0])&&l(t[1])}function l(t){return"min"in t&&"max"in t}function u(t,e){return t.min>=0&&e.min>=0||t.max<=0&&e.max<=0}function c(t,e){return t.min<=0&&t.max>=0&&e.min<=0&&e.max>=0}function p(t,e){return t.min>=0&&e.max<=0||t.max<=0&&e.min>=0}function d(t,e){var n,r;if(c(t,e))n=e.min?t.min/e.min:0,r=e.max?t.max/e.max:0;else if(u(t,e)){var a=Math.abs(t.min),i=Math.abs(t.max),o=Math.abs(e.min),s=Math.abs(e.max),l=f.a.max([a,i]),p=f.a.min([a,i]),d=f.a.max([o,s]),h=f.a.min([o,s]);n=p?l/p:l,r=h?d/h:d}else t.min>0||e.min>0?(n=t.max/e.max,r=0):(n=0,r=t.min/e.min);return n>r?n:r}e.a=r;var h=n(4),f=n.n(h)},1604:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(16),l=n.n(s),u=n(229),c=n.n(u);a.a.module("grafana.directives").directive("graphLegend",["popoverSrv","$timeout",function(t,e){return{link:function(n,r){function a(t){return t.parents("[data-series-index]").data("series-index")}function i(n){if(!l()(n.target).parents(".popover").length){var r=l()(n.currentTarget).find(".fa-minus"),i=a(r),o=y[i];e(function(){t.show({element:r[0],position:"bottom left",targetAttachment:"top left",template:'<series-color-picker series="series" onToggleAxis="toggleAxis" onColorChange="colorSelected"></series-color-picker>',openOn:"hover",model:{series:o,toggleAxis:function(){w.toggleAxis(o)},colorSelected:function(t){w.changeSeriesColor(o,t)}}})})}}function s(t){var e=l()(t.currentTarget),n=a(e),i=y[n],o=l()(r.children("tbody")).scrollTop();w.toggleSeries(i,t),l()(r.children("tbody")).scrollTop(o)}function u(t){var e=l()(t.currentTarget),n=e.data("stat");if(n!==k.legend.sort&&(k.legend.sortDesc=null),!1===k.legend.sortDesc)return k.legend.sort=null,k.legend.sortDesc=null,void w.render();k.legend.sortDesc=!k.legend.sortDesc,k.legend.sort=n,w.render()}function p(t){if(!k.legend[t])return"";var e='<th class="pointer" data-stat="'+t+'">'+t;return k.legend.sort===t&&(e+=' <span class="'+(k.legend.sortDesc?"fa fa-caret-down":"fa fa-caret-up")+'"></span>'),e+"</th>"}function d(){var t=C.width();if(!w.panel.legend.show)return r.empty(),void(S=!0);S&&(r.on("click",".graph-legend-icon",i),r.on("click",".graph-legend-alias",s),r.on("click","th",u),S=!1),y=v,r.empty();var e=k.legend.rightSide&&k.legend.sideWidth?k.legend.sideWidth+"px":"",n=k.legend.rightSide&&k.legend.sideWidth?k.legend.sideWidth-1+"px":"";C.css("min-width",e),C.css("width",n),r.toggleClass("graph-legend-table",!0===k.legend.alignAsTable);var a;if(k.legend.alignAsTable){var c="<tr>";c+='<th colspan="2" style="text-align:left"></th>',k.legend.values&&(c+=p("min"),c+=p("max"),c+=p("avg"),c+=p("current"),c+=p("total")),c+="</tr>",a=l()(c)}k.legend.sort&&(y=o.a.sortBy(y,function(t){var e=t.stats[k.legend.sort];return null===e&&(e=-1/0),e}),k.legend.sortDesc&&(y=y.reverse())),(!k.legend.rightSide||k.legend.rightSide&&t!==_)&&(f(a),r.empty()),f(a)}function h(){var t=[];for(b=0;b<y.length;b++){var e=y[b];if(!e.hideFromLegend(k.legend)){var n='<div class="graph-legend-series';if(2===e.yaxis&&(n+=" graph-legend-series--right-y"),w.hiddenSeries[e.alias]&&(n+=" graph-legend-series-hidden"),n+='" data-series-index="'+b+'">',n+='<div class="graph-legend-icon">',n+='<i class="fa fa-minus pointer" style="color:'+e.color+'"></i>',n+="</div>",n+='<a class="graph-legend-alias pointer" title="'+e.aliasEscaped+'">'+e.aliasEscaped+"</a>",k.legend.values){var r=e.formatValue(e.stats.avg),a=e.formatValue(e.stats.current),i=e.formatValue(e.stats.min),o=e.formatValue(e.stats.max),s=e.formatValue(e.stats.total);k.legend.min&&(n+='<div class="graph-legend-value min">'+i+"</div>"),k.legend.max&&(n+='<div class="graph-legend-value max">'+o+"</div>"),k.legend.avg&&(n+='<div class="graph-legend-value avg">'+r+"</div>"),k.legend.current&&(n+='<div class="graph-legend-value current">'+a+"</div>"),k.legend.total&&(n+='<div class="graph-legend-value total">'+s+"</div>")}n+="</div>",t.push(l()(n))}}return t}function f(t){var e=r.width(),n=h();if(k.legend.alignAsTable){var a=l()("<tbody></tbody>");a.append(t),a.append(n),r.append(a),a.wrap('<div class="graph-legend-scroll"></div>')}else r.append('<div class="graph-legend-scroll"></div>'),r.find(".graph-legend-scroll").append(n);!k.legend.rightSide||k.legend.rightSide&&e!==_?m():g()}function m(){var t=r,e=r.find(".graph-legend-scroll");t.find(".baron__track").remove(),t.addClass("baron baron__root"),l()('\n          <div class="baron__track">\n            <div class="baron__bar"></div>\n          </div>\n        ').appendTo(t),e.addClass("baron__scroller");var n={root:t[0],scroller:e[0],bar:".baron__bar",track:".baron__track",barOnCls:"_scrollbar",scrollingCls:"_scrolling"};x?(g(),x=c()(n)):x=c()(n),e[0].style.marginRight="-"+(e[0].offsetWidth-e[0].clientWidth)+"px",x.scroll()}function g(){x&&(x.dispose(),x=void 0)}var v,y,b,x,S=!0,w=n.ctrl,k=w.panel,_=10,C=r.parent();n.$on("$destroy",function(){g()}),w.events.on("render-legend",function(){v=w.seriesList,v&&d(),w.events.emit("legend-rendering-complete")})}}}])},1605:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(21),o=n.n(i),s=function(){function t(t,e,n){t.overrideMenu=[],t.currentOverrides=[],t.override=t.override||{},t.addOverrideOption=function(e,n,r){var i={text:e,propertyName:n,index:t.overrideMenu.lenght,values:r,submenu:a.a.map(r,function(t){return{text:String(t),value:t}})};t.overrideMenu.push(i)},t.setOverride=function(e,n){if("color"===e.propertyName)return void t.openColorSelector(t.override.color);t.override[e.propertyName]=n.value,"fillBelowTo"===e.propertyName&&(t.override.lines=!1,t.ctrl.addSeriesOverride({alias:n.value,lines:!1})),t.updateCurrentOverrides(),t.ctrl.render()},t.colorSelected=function(e){t.override.color=e,t.updateCurrentOverrides(),t.ctrl.render()},t.openColorSelector=function(r){var a={color:r};n.show({element:e.find(".dropdown")[0],position:"top center",openOn:"click",template:'<series-color-picker series="series" onColorChange="colorSelected" />',model:{autoClose:!0,colorSelected:t.colorSelected,series:a},onClose:function(){t.ctrl.render()}})},t.removeOverride=function(e){delete t.override[e.propertyName],t.updateCurrentOverrides(),t.ctrl.refresh()},t.getSeriesNames=function(){return a.a.map(t.ctrl.seriesList,function(t){return t.alias})},t.updateCurrentOverrides=function(){t.currentOverrides=[],a.a.each(t.overrideMenu,function(e){var n=t.override[e.propertyName];a.a.isUndefined(n)||t.currentOverrides.push({name:e.text,propertyName:e.propertyName,value:String(n)})})},t.addOverrideOption("Bars","bars",[!0,!1]),t.addOverrideOption("Lines","lines",[!0,!1]),t.addOverrideOption("Line fill","fill",[0,1,2,3,4,5,6,7,8,9,10]),t.addOverrideOption("Line width","linewidth",[0,1,2,3,4,5,6,7,8,9,10]),t.addOverrideOption("Null point mode","nullPointMode",["connected","null","null as zero"]),t.addOverrideOption("Fill below to","fillBelowTo",t.getSeriesNames()),t.addOverrideOption("Staircase line","steppedLine",[!0,!1]),t.addOverrideOption("Dashes","dashes",[!0,!1]),t.addOverrideOption("Dash Length","dashLength",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),t.addOverrideOption("Dash Space","spaceLength",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),t.addOverrideOption("Points","points",[!0,!1]),t.addOverrideOption("Points Radius","pointradius",[1,2,3,4,5]),t.addOverrideOption("Stack","stack",[!0,!1,"A","B","C","D"]),t.addOverrideOption("Color","color",["change"]),t.addOverrideOption("Y-axis","yaxis",[1,2]),t.addOverrideOption("Z-index","zindex",[-3,-2,-1,0,1,2,3]),t.addOverrideOption("Transform","transform",["negative-Y"]),t.addOverrideOption("Legend","legend",[!0,!1]),t.updateCurrentOverrides()}return t.$inject=["$scope","$element","popoverSrv"],t}();o.a.module("grafana.controllers").controller("SeriesOverridesCtrl",s)},1606:function(t,e,n){"use strict";var r=n(3),a=function(){function t(t){var e=this;this.panel=this.panelCtrl.panel,this.panel.alert&&(this.disabled=!0);var n=t.$on("$destroy",function(){e.panelCtrl.editingThresholds=!1,e.panelCtrl.render(),n()});this.panelCtrl.editingThresholds=!0}return t.$inject=["$scope"],t.prototype.addThreshold=function(){this.panel.thresholds.push({value:void 0,colorMode:"critical",op:"gt",fill:!0,line:!0,yaxis:"left"}),this.panelCtrl.render()},t.prototype.removeThreshold=function(t){this.panel.thresholds.splice(t,1),this.panelCtrl.render()},t.prototype.render=function(){this.panelCtrl.render()},t.prototype.onFillColorChange=function(t){var e=this;return function(n){e.panel.thresholds[t].fillColor=n,e.render()}},t.prototype.onLineColorChange=function(t){var e=this;return function(n){e.panel.thresholds[t].lineColor=n,e.render()}},t}();r.a.directive("graphThresholdForm",function(){return{restrict:"E",template:'\n<div class="gf-form-group">\n  <h5>Thresholds</h5>\n  <p class="muted" ng-show="ctrl.disabled">\n    Visual thresholds options <strong>disabled.</strong>\n    Visit the Alert tab update your thresholds. <br>\n    To re-enable thresholds, the alert rule must be deleted from this panel.\n  </p>\n  <div ng-class="{\'thresholds-form-disabled\': ctrl.disabled}">\n    <div class="gf-form-inline" ng-repeat="threshold in ctrl.panel.thresholds">\n      <div class="gf-form">\n        <label class="gf-form-label">T{{$index+1}}</label>\n      </div>\n\n      <div class="gf-form">\n        <div class="gf-form-select-wrapper">\n          <select class="gf-form-input" ng-model="threshold.op"\n                  ng-options="f for f in [\'gt\', \'lt\']" ng-change="ctrl.render()" ng-disabled="ctrl.disabled"></select>\n        </div>\n        <input type="number" ng-model="threshold.value" class="gf-form-input width-8"\n               ng-change="ctrl.render()" placeholder="value" ng-disabled="ctrl.disabled">\n      </div>\n\n      <div class="gf-form">\n        <label class="gf-form-label">Color</label>\n        <div class="gf-form-select-wrapper">\n          <select class="gf-form-input" ng-model="threshold.colorMode"\n                  ng-options="f for f in [\'custom\', \'critical\', \'warning\', \'ok\']" ng-change="ctrl.render()" ng-disabled="ctrl.disabled">\n          </select>\n        </div>\n      </div>\n\n      <gf-form-switch class="gf-form" label="Fill" checked="threshold.fill"\n                      on-change="ctrl.render()" ng-disabled="ctrl.disabled"></gf-form-switch>\n\n      <div class="gf-form" ng-if="threshold.fill && threshold.colorMode === \'custom\'">\n        <label class="gf-form-label">Fill color</label>\n        <span class="gf-form-label">\n          <color-picker color="threshold.fillColor" onChange="ctrl.onFillColorChange($index)"></color-picker>\n        </span>\n      </div>\n\n      <gf-form-switch class="gf-form" label="Line" checked="threshold.line"\n                      on-change="ctrl.render()" ng-disabled="ctrl.disabled"></gf-form-switch>\n\n      <div class="gf-form" ng-if="threshold.line && threshold.colorMode === \'custom\'">\n        <label class="gf-form-label">Line color</label>\n        <span class="gf-form-label">\n          <color-picker color="threshold.lineColor" onChange="ctrl.onLineColorChange($index)"></color-picker>\n        </span>\n      </div>\n\n      <div class="gf-form">\n        <label class="gf-form-label">Y-Axis</label>\n        <div class="gf-form-select-wrapper">\n          <select class="gf-form-input" ng-model="threshold.yaxis"\n                  ng-init="threshold.yaxis = threshold.yaxis === \'left\' || threshold.yaxis === \'right\' ? threshold.yaxis : \'left\'"\n                  ng-options="f for f in [\'left\', \'right\']" ng-change="ctrl.render()" ng-disabled="ctrl.disabled">\n          </select>\n        </div>\n      </div>\n\n      <div class="gf-form">\n        <label class="gf-form-label">\n          <a class="pointer" ng-click="ctrl.removeThreshold($index)" ng-disabled="ctrl.disabled">\n            <i class="fa fa-trash"></i>\n          </a>\n        </label>\n      </div>\n    </div>\n\n    <div class="gf-form-button-row">\n      <button class="btn btn-inverse" ng-click="ctrl.addThreshold()" ng-disabled="ctrl.disabled">\n        <i class="fa fa-plus"></i>&nbsp;Add Threshold\n      </button>\n    </div>\n  </div>\n</div>\n',controller:a,bindToController:!0,controllerAs:"ctrl",scope:{panelCtrl:"="}}})},1607:function(t,e,n){"use strict";e.a='\n<div class="graph-panel" ng-class="{\'graph-panel--legend-right\': ctrl.panel.legend.rightSide}">\n  <div class="graph-panel__chart" grafana-graph ng-dblclick="ctrl.zoomOut()">\n  </div>\n\n  <div class="graph-legend">\n    <div class="graph-legend-content" graph-legend></div>\n  </div>\n</div>\n'},1608:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n(4),a=n.n(r),i=n(144),o=n(108),s=function(){function t(t){this.panel=t}return t.prototype.getSeriesList=function(t){var e=this;if(!t.dataList||0===t.dataList.length)return[];var n;if(t.dataList&&t.dataList.length>0){n=t.dataList[0];var r=this.getAutoDetectXAxisMode(n);this.panel.xaxis.mode!==r&&(this.panel.xaxis.mode=r,this.setPanelDefaultsForNewXAxisMode())}switch(this.panel.xaxis.mode){case"series":case"time":return t.dataList.map(function(n,r){return e.timeSeriesHandler(n,r,t)});case"histogram":var i=void 0;return i=this.panel.stack?t.dataList:[{target:"count",datapoints:a.a.concat([],a.a.flatten(a.a.map(t.dataList,"datapoints")))}],i.map(function(n,r){return e.timeSeriesHandler(n,r,t)});case"field":return this.customHandler(n)}},t.prototype.getAutoDetectXAxisMode=function(t){switch(t.type){case"docs":case"table":return"field";default:return"series"===this.panel.xaxis.mode?"series":"histogram"===this.panel.xaxis.mode?"histogram":"time"}},t.prototype.setPanelDefaultsForNewXAxisMode=function(){switch(this.panel.xaxis.mode){case"time":this.panel.bars=!1,this.panel.lines=!0,this.panel.points=!1,this.panel.legend.show=!0,this.panel.tooltip.shared=!0,this.panel.xaxis.values=[];break;case"series":this.panel.bars=!0,this.panel.lines=!1,this.panel.points=!1,this.panel.stack=!1,this.panel.legend.show=!1,this.panel.tooltip.shared=!1,this.panel.xaxis.values=["total"];break;case"histogram":this.panel.bars=!0,this.panel.lines=!1,this.panel.points=!1,this.panel.stack=!1,this.panel.legend.show=!1,this.panel.tooltip.shared=!1}},t.prototype.timeSeriesHandler=function(t,e,n){var r=t.datapoints||[],a=t.target,s=e%o.f.length,l=this.panel.aliasColors[a]||o.f[s],u=new i.a({datapoints:r,alias:a,color:l,unit:t.unit});if(r&&r.length>0){r[r.length-1][1]-n.range.from<-1e4&&(u.isOutsideRange=!0)}return u},t.prototype.customHandler=function(t){if(!this.panel.xaxis.name)throw{message:"No field name specified to use for x-axis, check your axes settings"};return[]},t.prototype.validateXAxisSeriesValue=function(){switch(this.panel.xaxis.mode){case"series":if(0===this.panel.xaxis.values.length)return void(this.panel.xaxis.values=["total"]);var t=this.getXAxisValueOptions({});return void(a.a.find(t,{value:this.panel.xaxis.values[0]})||(this.panel.xaxis.values=["total"]))}},t.prototype.getDataFieldNames=function(t,e){function n(t){a.a.forEach(t,function(t,i){if(a.a.isObject(t))o.push(i),n(t);else if(!e||a.a.isNumber(t)){var s=o.concat(i).join(".");r.push(s)}}),o.pop()}if(0===t.length)return[];var r=[],i=t[0],o=[];if("docs"===i.type){if(0===i.datapoints.length)return[];n(i.datapoints[0])}return r},t.prototype.getXAxisValueOptions=function(t){switch(this.panel.xaxis.mode){case"series":return[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Count",value:"count"}]}return[]},t.prototype.pluckDeep=function(t,e){for(var n=e.split("."),r=t,a=0;a<n.length;++a){if(!r[n[a]])return;r=r[n[a]]}return r},t}()},1609:function(t,e,n){"use strict";function r(){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/graph/axes_editor.html",controller:i}}e.a=r;var a=n(224),i=function(){function t(t,e){this.$scope=t,this.$q=e,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.$scope.ctrl=this,this.unitFormats=a.a.getUnitFormats(),this.logScales={linear:1,"log (base 2)":2,"log (base 10)":10,"log (base 32)":32,"log (base 1024)":1024},this.xAxisModes={Time:"time",Series:"series",Histogram:"histogram"},this.xAxisStatOptions=[{text:"Avg",value:"avg"},{text:"Min",value:"min"},{text:"Max",value:"max"},{text:"Total",value:"total"},{text:"Count",value:"count"},{text:"Current",value:"current"}],"custom"===this.panel.xaxis.mode&&(this.panel.xaxis.name||(this.panel.xaxis.name="specify field"))}return t.$inject=["$scope","$q"],t.prototype.setUnitFormat=function(t,e){t.format=e.value,this.panelCtrl.render()},t.prototype.render=function(){this.panelCtrl.render()},t.prototype.xAxisModeChanged=function(){this.panelCtrl.processor.setPanelDefaultsForNewXAxisMode(),this.panelCtrl.onDataReceived(this.panelCtrl.dataList)},t.prototype.xAxisValueChanged=function(){this.panelCtrl.onDataReceived(this.panelCtrl.dataList)},t.prototype.getDataFieldNames=function(t){var e=this.panelCtrl.processor.getDataFieldNames(this.panelCtrl.dataList,t),n=e.map(function(t){return{text:t,value:t}});return this.$q.when(n)},t}()},1610:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"DashListCtrl",function(){return l}),n.d(e,"PanelCtrl",function(){return l});var r=n(4),a=n.n(r),i=n(1464),o=n(517),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.backendSrv=r,o.dashboardSrv=i,o.panelDefaults={query:"",limit:10,tags:[],recent:!1,search:!1,starred:!0,headings:!0,folderId:0},a.a.defaults(o.panel,o.panelDefaults),o.panel.tag&&(o.panel.tags=[o.panel.tag],delete o.panel.tag),o.events.on("refresh",o.onRefresh.bind(o)),o.events.on("init-edit-mode",o.onInitEditMode.bind(o)),o.groups=[{list:[],show:!1,header:"Starred dashboards"},{list:[],show:!1,header:"Recently viewed dashboards"},{list:[],show:!1,header:"Search"}],o.panel.mode&&("starred"===o.panel.mode&&(o.panel.starred=!0,o.panel.headings=!1),"recently viewed"===o.panel.mode&&(o.panel.recent=!0,o.panel.starred=!1,o.panel.headings=!1),"search"===o.panel.mode&&(o.panel.search=!0,o.panel.starred=!1,o.panel.headings=!1),delete o.panel.mode),o}return s(e,t),e.$inject=["$scope","$injector","backendSrv","dashboardSrv"],e.prototype.onInitEditMode=function(){this.editorTabIndex=1,this.modes=["starred","search","recently viewed"],this.addEditorTab("Options","public/app/plugins/panel/dashlist/editor.html")},e.prototype.onRefresh=function(){var t=[];return t.push(this.getRecentDashboards()),t.push(this.getStarred()),t.push(this.getSearch()),Promise.all(t).then(this.renderingCompleted.bind(this))},e.prototype.getSearch=function(){var t=this;if(this.groups[2].show=this.panel.search,!this.panel.search)return Promise.resolve();var e={limit:this.panel.limit,query:this.panel.query,tag:this.panel.tags,folderId:this.panel.folderId};return this.backendSrv.search(e).then(function(e){t.groups[2].list=e})},e.prototype.getStarred=function(){var t=this;if(this.groups[0].show=this.panel.starred,!this.panel.starred)return Promise.resolve();var e={limit:this.panel.limit,starred:"true"};return this.backendSrv.search(e).then(function(e){t.groups[0].list=e})},e.prototype.starDashboard=function(t,e){this.dashboardSrv.starDashboard(t.id,t.isStarred).then(function(e){t.isStarred=e}),e&&(e.stopPropagation(),e.preventDefault())},e.prototype.getRecentDashboards=function(){var t=this;if(this.groups[1].show=this.panel.recent,!this.panel.recent)return Promise.resolve();var e=a.a.take(o.a.getDashboardOpened(),this.panel.limit);return this.backendSrv.search({dashboardIds:e,limit:this.panel.limit}).then(function(n){t.groups[1].list=e.map(function(t){return a.a.find(n,function(e){return e.id===t})}).filter(function(t){return void 0!==t})})},e.prototype.onFolderChange=function(t){this.panel.folderId=t.id,this.refresh()},e.templateUrl="module.html",e.scrollable=!0,e}(i.PanelCtrl)},1611:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"PluginListCtrl",function(){return s}),n.d(e,"PanelCtrl",function(){return s});var r=n(4),a=n.n(r),i=n(1468),o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.backendSrv=r,o.$location=i,o.panelDefaults={},a.a.defaults(o.panel,o.panelDefaults),o.events.on("init-edit-mode",o.onInitEditMode.bind(o)),o.pluginList=[],o.viewModel=[{header:"Installed Apps",list:[],type:"app"},{header:"Installed Panels",list:[],type:"panel"},{header:"Installed Datasources",list:[],type:"datasource"}],o.update(),o}return o(e,t),e.$inject=["$scope","$injector","backendSrv","$location"],e.prototype.onInitEditMode=function(){this.editorTabIndex=1,this.addEditorTab("Options","public/app/plugins/panel/pluginlist/editor.html")},e.prototype.gotoPlugin=function(t,e){e&&e.stopPropagation(),this.$location.url("plugins/"+t.id+"/edit")},e.prototype.updateAvailable=function(t,e){e.stopPropagation(),e.preventDefault();var n=this.$scope.$new(!0);n.plugin=t,this.publishAppEvent("show-modal",{src:"public/app/features/plugins/partials/update_instructions.html",scope:n})},e.prototype.update=function(){var t=this;this.backendSrv.get("api/plugins",{embedded:0,core:0}).then(function(e){t.pluginList=e,t.viewModel[0].list=a.a.filter(e,{type:"app"}),t.viewModel[1].list=a.a.filter(e,{type:"panel"}),t.viewModel[2].list=a.a.filter(e,{type:"datasource"});for(var n=0,r=t.pluginList;n<r.length;n++){var i=r[n];i.hasUpdate?i.state="has-update":i.enabled||(i.state="not-enabled")}})},e.templateUrl="module.html",e.scrollable=!0,e}(i.a)},1612:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AlertListPanel",function(){return p}),n.d(e,"PanelCtrl",function(){return p});var r=n(4),a=n.n(r),i=n(1),o=n.n(i),s=n(518),l=n(1464),u=n(512),c=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;i.backendSrv=r,i.showOptions=[{text:"Current state",value:"current"},{text:"Recent state changes",value:"changes"}],i.sortOrderOptions=[{text:"Alphabetical (asc)",value:1},{text:"Alphabetical (desc)",value:2},{text:"Importance",value:3}],i.stateFilter={},i.currentAlerts=[],i.alertHistory=[],i.panelDefaults={show:"current",limit:10,stateFilter:[],onlyAlertsOnDashboard:!1,sortOrder:1},a.a.defaults(i.panel,i.panelDefaults),i.events.on("init-edit-mode",i.onInitEditMode.bind(i)),i.events.on("refresh",i.onRefresh.bind(i));for(var o in i.panel.stateFilter)i.stateFilter[i.panel.stateFilter[o]]=!0;return i}return c(e,t),e.$inject=["$scope","$injector","backendSrv"],e.prototype.sortResult=function(t){if(3===this.panel.sortOrder)return a.a.sortBy(t,function(t){return s.a.alertStateSortScore[t.state]});var e=a.a.sortBy(t,function(t){return t.name.toLowerCase()});return 2===this.panel.sortOrder&&e.reverse(),e},e.prototype.updateStateFilter=function(){var t=[];for(var e in this.stateFilter)this.stateFilter[e]&&t.push(e);this.panel.stateFilter=t,this.onRefresh()},e.prototype.onRefresh=function(){var t,e=this;"current"===this.panel.show&&(t=this.getCurrentAlertState()),"changes"===this.panel.show&&(t=this.getStateChanges()),t.then(function(){e.renderingCompleted()})},e.prototype.getStateChanges=function(){var t=this,e={limit:this.panel.limit,type:"alert",newState:this.panel.stateFilter};return this.panel.onlyAlertsOnDashboard&&(e.dashboardId=this.dashboard.id),e.from=1e3*u.parse(this.dashboard.time.from).unix(),e.to=1e3*u.parse(this.dashboard.time.to).unix(),this.backendSrv.get("/api/annotations",e).then(function(e){return t.alertHistory=a.a.map(e,function(e){return e.time=t.dashboard.formatDate(e.time,"MMM D, YYYY HH:mm:ss"),e.stateModel=s.a.getStateDisplayModel(e.newState),e.info=s.a.getAlertAnnotationInfo(e),e}),t.noAlertsMessage=0===t.alertHistory.length?"No alerts in current time range":"",t.alertHistory})},e.prototype.getCurrentAlertState=function(){var t=this,e={state:this.panel.stateFilter};return this.panel.onlyAlertsOnDashboard&&(e.dashboardId=this.dashboard.id),this.backendSrv.get("/api/alerts",e).then(function(e){return t.currentAlerts=t.sortResult(a.a.map(e,function(t){return t.stateModel=s.a.getStateDisplayModel(t.state),t.newStateDateAgo=o()(t.newStateDate).locale("en").fromNow(!0),t})),t.noAlertsMessage=0===t.currentAlerts.length?"No alerts":"",t.currentAlerts})},e.prototype.onInitEditMode=function(){this.addEditorTab("Options","public/app/plugins/panel/alertlist/editor.html")},e.templateUrl="module.html",e.scrollable=!0,e}(l.PanelCtrl)},1613:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=(n(1614),n(1615));n.d(e,"PanelCtrl",function(){return r.a})},1614:function(t,e,n){"use strict";function r(t,e,n,r,a,o){var s=y()(t).find("svg"),u=b.select(s.get(0));l(t);var c=Math.floor(s.outerWidth())-30,p=s.attr("height"),d=1;r-n>c&&(d=Math.floor((r-n)/c));var h=c/(r-n),f=b.range(n,r,d),m=Object(w.a)(e,x.c.user.lightTheme,a,o);u.selectAll(".heatmap-color-legend-rect").data(f).enter().append("rect").attr("x",function(t){return t*h}).attr("y",0).attr("width",d*h+1).attr("height",p).attr("stroke-width",0).attr("fill",function(t){return m(t)}),i(t,m,n,r,a,o,c)}function a(t,e,n,r,a,o){var s=y()(t).find("svg"),u=b.select(s.get(0));l(t);var c=Math.floor(s.outerWidth())-30,p=s.attr("height"),d=1;r-n>c&&(d=Math.floor((r-n)/c));var h=c/(r-n),f=b.range(n,r,d),m=Object(w.b)(e,a,o);u.selectAll(".heatmap-opacity-legend-rect").data(f).enter().append("rect").attr("x",function(t){return t*h}).attr("y",0).attr("width",d*h).attr("height",p).attr("stroke-width",0).attr("fill",e.cardColor).style("opacity",function(t){return m(t)}),i(t,m,n,r,a,o,c)}function i(t,e,n,r,a,i,o){var s=y()(t).find("svg"),l=b.select(s.get(0));if(!(o<=0||0===s.get(0).childNodes.length)){var d=b.scaleLinear().domain([0,r]).range([0,o]),h=p(0,r,a,i),f=b.axisBottom(d).tickValues(h).tickSize(k),m=s.find(":first-child"),g=c(s)+_,v=u(m);b.select(s.get(0)).append("g").attr("class","axis").attr("transform","translate("+v+","+g+")").call(f),l.select(".axis").select(".domain").remove()}}function o(t,e){var n=y()(t).find("svg");l(t);var r=Math.floor(n.outerWidth()),a=n.attr("height");if(r){var i=Math.floor(r/2),o=Math.floor(r/i),s=b.range(0,r,o);b.select(n.get(0)).selectAll(".heatmap-color-legend-rect").data(s).enter().append("rect").attr("x",function(t){return t}).attr("y",0).attr("width",o+1).attr("height",a).attr("stroke-width",0).attr("fill",function(t){return e(t)})}}function s(t,e){var n=y()(t).find("svg");l(t);var r=b.select(n.get(0)),a=Math.floor(n.outerWidth()),i=n.attr("height");if(a){var o;"linear"===e.colorScale?o=b.scaleLinear().domain([0,a]).range([0,1]):"sqrt"===e.colorScale&&(o=b.scalePow().exponent(e.exponent).domain([0,a]).range([0,1]));var s=b.range(0,a,10);r.selectAll(".heatmap-opacity-legend-rect").data(s).enter().append("rect").attr("x",function(t){return t}).attr("y",0).attr("width",10).attr("height",i).attr("stroke-width",0).attr("fill",e.cardColor).style("opacity",function(t){return o(t)})}}function l(t){y()(t).find("svg").empty()}function u(t){var e=t.get(0);return e&&e.x&&e.x.baseVal?e.x.baseVal.value:0}function c(t){var e=t.get(0);return e&&e.height&&e.height.baseVal?e.height.baseVal.value:0}function p(t,e,n,r){for(var a=e-t,i=Object(S.tickStep)(t,e,3),o=Math.round(a/i),s=[],l=0;l<o;l++){var u=i*l;d(r,u,i)?s.push(r):(r<u&&s.push(r),d(n,u,i)?s.push(n):(n<u&&s.push(n),s.push(i*l)))}return d(n,e,i)||s.push(n),s.push(e),s=g.a.sortBy(g.a.uniq(s))}function d(t,e,n){return Math.abs(t-e)<.3*n}var h=n(21),f=n.n(h),m=n(4),g=n.n(m),v=n(16),y=n.n(v),b=n(515),x=n(225),S=n(516),w=n(1493),t=f.a.module("grafana.directives"),k=0,_=0;t.directive("colorLegend",function(){return{restrict:"E",template:'<div class="heatmap-color-legend"><svg width="16.5rem" height="24px"></svg></div>',link:function(t,e,n){function r(){var t=y()(e).find("svg"),n=Math.floor(t.outerWidth());if("spectrum"===i.color.mode){var r=g.a.find(a.colorSchemes,{value:i.color.colorScheme}),l=Object(w.a)(r,x.c.user.lightTheme,n);o(e,l)}else if("opacity"===i.color.mode){var u=i.color;s(e,u)}}var a=t.ctrl,i=t.ctrl.panel;r(),a.events.on("render",function(){r()})}}}),t.directive("heatmapLegend",function(){return{restrict:"E",template:'<div class="heatmap-color-legend"><svg width="100px" height="6px"></svg></div>',link:function(t,e,n){function i(){if(l(e),!g.a.isEmpty(o.data)&&!g.a.isEmpty(o.data.cards)){var t=o.data.cardStats.max,n=s.color.max||t,i=s.color.min||0;if("spectrum"===s.color.mode){var u=g.a.find(o.colorSchemes,{value:s.color.colorScheme});r(e,u,0,t,n,i)}else if("opacity"===s.color.mode){var c=s.color;a(e,c,0,t,n,i)}}}var o=t.ctrl,s=t.ctrl.panel;i(),o.events.on("render",function(){i()})}}})},1615:function(t,e,n){"use strict";n.d(e,"a",function(){return y});var r=n(1464),a=n(4),i=n.n(a),o=n(224),s=n(144),l=n(1616),u=n(1617),c=n(1618),p=n(1471),d=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h={heatmap:{},cards:{cardPadding:null,cardRound:null},color:{mode:"spectrum",cardColor:"#b4ff00",colorScale:"sqrt",exponent:.5,colorScheme:"interpolateOranges"},legend:{show:!1},dataFormat:"timeseries",yBucketBound:"auto",xAxis:{show:!0},yAxis:{show:!0,format:"short",decimals:null,logBase:1,splitFactor:null,min:null,max:null},xBucketSize:null,xBucketNumber:null,yBucketSize:null,yBucketNumber:null,tooltip:{show:!0,showHistogram:!1},highlightCards:!0},f=["opacity","spectrum"],m=["linear","sqrt"],g=[{name:"Spectral",value:"interpolateSpectral",invert:"always"},{name:"RdYlGn",value:"interpolateRdYlGn",invert:"always"},{name:"Blues",value:"interpolateBlues",invert:"dark"},{name:"Greens",value:"interpolateGreens",invert:"dark"},{name:"Greys",value:"interpolateGreys",invert:"dark"},{name:"Oranges",value:"interpolateOranges",invert:"dark"},{name:"Purples",value:"interpolatePurples",invert:"dark"},{name:"Reds",value:"interpolateReds",invert:"dark"},{name:"BuGn",value:"interpolateBuGn",invert:"dark"},{name:"BuPu",value:"interpolateBuPu",invert:"dark"},{name:"GnBu",value:"interpolateGnBu",invert:"dark"},{name:"OrRd",value:"interpolateOrRd",invert:"dark"},{name:"PuBuGn",value:"interpolatePuBuGn",invert:"dark"},{name:"PuBu",value:"interpolatePuBu",invert:"dark"},{name:"PuRd",value:"interpolatePuRd",invert:"dark"},{name:"RdPu",value:"interpolateRdPu",invert:"dark"},{name:"YlGnBu",value:"interpolateYlGnBu",invert:"dark"},{name:"YlGn",value:"interpolateYlGn",invert:"dark"},{name:"YlOrBr",value:"interpolateYlOrBr",invert:"dark"},{name:"YlOrRd",value:"interpolateYlOrRd",invert:"darm"}],v=["prometheus","elasticsearch"],y=function(t){function e(e,n,r){var a=t.call(this,e,n)||this;return a.opacityScales=[],a.colorModes=[],a.colorSchemes=[],a.timeSrv=r,a.selectionActivated=!1,i.a.defaultsDeep(a.panel,h),a.opacityScales=m,a.colorModes=f,a.colorSchemes=g,a.events.on("render",a.onRender.bind(a)),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-error",a.onDataError.bind(a)),a.events.on("data-snapshot-load",a.onDataReceived.bind(a)),a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.onCardColorChange=a.onCardColorChange.bind(a),a}return d(e,t),e.$inject=["$scope","$injector","timeSrv"],e.prototype.onInitEditMode=function(){this.addEditorTab("Axes",l.a,2),this.addEditorTab("Display",u.a,3),this.unitFormats=o.a.getUnitFormats()},e.prototype.zoomOut=function(t){this.publishAppEvent("zoom-out",2)},e.prototype.onRender=function(){this.range&&("tsbuckets"===this.panel.dataFormat?this.convertHistogramToHeatmapData():this.convertTimeSeriesToHeatmapData())},e.prototype.convertTimeSeriesToHeatmapData=function(){var t,e,n,r,a=this.panel.yAxis.logBase,i=this.panel.xBucketNumber||30,s=Math.floor((this.range.to-this.range.from)/i);t=o.a.interval_regex.test(this.panel.xBucketSize)?o.a.interval_to_ms(this.panel.xBucketSize):isNaN(Number(this.panel.xBucketSize))||""===this.panel.xBucketSize||null===this.panel.xBucketSize?s:Number(this.panel.xBucketSize),r=this.parseSeries(this.series);var l=this.panel.yBucketNumber||10;1!==a?e=this.panel.yAxis.splitFactor:(e=r.max===r.min?r.max?r.max/10:1:(r.max-r.min)/l,e=this.panel.yBucketSize||e),n=Object(p.c)(this.series,e,t,a),r.min||r.max||(r={min:-1,max:1,minLog:1},e=1);var u=Object(p.b)(n),c=u.cards,d=u.cardStats;this.data={buckets:n,heatmapStats:r,xBucketSize:t,yBucketSize:e,cards:c,cardStats:d}},e.prototype.convertHistogramToHeatmapData=function(){var t,e,n,r,a=this.getPanelDataSourceType();i.a.includes(v,a)||this.series.sort(p.g),n=Object(p.e)(this.series),r=i.a.map(this.series,"label");var o=this.panel.yBucketBound;"prometheus"===a&&"lower"!==o||"upper"===o?r=[""].concat(r):r.push("");var s=i.a.map(i.a.keys(n),function(t){return Number(t)});t=Object(p.a)(s),e=1;var l=Object(p.b)(n),u=l.cards,c=l.cardStats;this.data={buckets:n,xBucketSize:t,yBucketSize:e,tsBuckets:r,cards:u,cardStats:c}},e.prototype.getPanelDataSourceType=function(){return this.datasource.meta&&this.datasource.meta.id?this.datasource.meta.id:"unknown"},e.prototype.onDataReceived=function(t){if(this.series=t.map(this.seriesHandler.bind(this)),this.dataWarning=null,0===i.a.reduce(this.series,function(t,e){return t+e.datapoints.length},0))this.dataWarning={title:"No data points",tip:"No datapoints returned from data query"};else for(var e=0,n=this.series;e<n.length;e++){var r=n[e];if(r.isOutsideRange){this.dataWarning={title:"Data points outside time range",tip:"Can be caused by timezone mismatch or missing time filter in query"};break}}this.render()},e.prototype.onDataError=function(){this.series=[],this.render()},e.prototype.onCardColorChange=function(t){this.panel.color.cardColor=t,this.render()},e.prototype.seriesHandler=function(t){var e=new s.a({datapoints:t.datapoints,alias:t.target});e.flotpairs=e.getFlotPairs(this.panel.nullPointMode);var n=t.datapoints||[];if(n&&n.length>0){n[n.length-1][1]-this.range.from<-1e4&&(e.isOutsideRange=!0)}return e},e.prototype.parseSeries=function(t){var e=i.a.min(i.a.map(t,function(t){return t.stats.min})),n=i.a.min(i.a.map(t,function(t){return t.stats.logmin}));return{max:i.a.max(i.a.map(t,function(t){return t.stats.max})),min:e,minLog:n}},e.prototype.parseHistogramSeries=function(t){var e=i.a.map(t,function(t){return Number(t.alias)}),n=i.a.min(e),r=i.a.min(e);return{max:i.a.max(e),min:n,minLog:r}},e.prototype.link=function(t,e,n,r){Object(c.a)(t,e,n,r)},e.templateUrl="module.html",e}(r.MetricsPanelCtrl)},1616:function(t,e,n){"use strict";function r(){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/heatmap/partials/axes_editor.html",controller:i}}e.a=r;var a=n(224),i=function(){function t(t,e){t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=a.a.getUnitFormats(),this.logScales={linear:1,"log (base 2)":2,"log (base 10)":10,"log (base 32)":32,"log (base 1024)":1024},this.dataFormats={"Time series":"timeseries","Time series buckets":"tsbuckets"},this.yBucketBoundModes={Auto:"auto",Upper:"upper",Lower:"lower"}}return t.$inject=["$scope","uiSegmentSrv"],t.prototype.setUnitFormat=function(t){this.panel.yAxis.format=t.value,this.panelCtrl.render()},t}()},1617:function(t,e,n){"use strict";function r(){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/heatmap/partials/display_editor.html",controller:a}}e.a=r;var a=function(){function t(t){t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.panelCtrl.render()}return t.$inject=["$scope"],t}()},1618:function(t,e,n){"use strict";function r(t,e,n,r){function a(){try{var t=r.height||ut.height||r.row.height;return i.a.isString(t)&&(t=parseInt(t.replace("px",""),10)),t-=ut.legend.show?28:11,Pt.css("height",t+"px"),!0}catch(t){return!1}}function o(t){var e=t.selectAll(".axis-y text").nodes();return i.a.max(i.a.map(e,function(t){return t.getBBox().width}))}function l(t){if(t.select(".axis-x line").empty())return 30;var e=parseFloat(t.select(".axis-x line").attr("y2"));return parseFloat(t.attr("height"))-e}function T(){t.xScale=ft=c.scaleTime().domain([lt.from,lt.to]).range([0,mt]);var e,n=mt/S,a=h.grafanaTimeFormat(n,lt.from,lt.to);e="utc"===r.dashboard.getTimezone()?c.utcFormat(a):c.timeFormat(a);var i=c.axisBottom(ft).ticks(n).tickFormat(e).tickPadding(k).tickSize(gt),o=At.top,s=bt;ct.append("g").attr("class","axis axis-x").attr("transform","translate("+s+","+o+")").call(i),ct.select(".axis-x").select(".domain").remove()}function M(){var e=Math.ceil(gt/w),n=h.tickStep(st.heatmapStats.min,st.heatmapStats.max,e),a=P(st.heatmapStats.min,st.heatmapStats.max,n),s=a.y_min,l=a.y_max;s=null!==ut.yAxis.min?ut.yAxis.min:s,l=null!==ut.yAxis.max?ut.yAxis.max:l,n=h.tickStep(s,l,e),e=Math.ceil((l-s)/n);var u=h.getPrecision(n),p=null===ut.yAxis.decimals?u:ut.yAxis.decimals,d=h.getFlotTickSize(s,l,e,u),f=h.getScaledDecimals(p,d);r.decimals=p,r.scaledDecimals=f,i.a.isEmpty(st.buckets)&&(l=1,s=-1,e=3,p=1),st.yAxis={min:s,max:l,ticks:e},t.yScale=ht=c.scaleLinear().domain([s,l]).range([gt,0]);var m=c.axisLeft(ht).ticks(e).tickFormat(F(p,f)).tickSizeInner(0-pt).tickSizeOuter(0).tickPadding(_);ct.append("g").attr("class","axis axis-y").call(m);var g=At.top,v=o(ct)+_;ct.select(".axis-y").attr("transform","translate("+v+","+g+")"),ct.select(".axis-y").select(".domain").remove()}function P(t,e,n){var r,a,i=(e*(Dt-1)-t*(Dt-1))/2;return 0===n?(a=e*Dt,r=t-t*(Dt-1),n=(a-r)/2):(a=Math.ceil((e+i)/n)*n,r=Math.floor((t-i)/n)*n),t>=0&&r<0&&(r=0),{y_min:r,y_max:a}}function O(){var e=ut.yAxis.logBase,n=$(st.heatmapStats.minLog,st.heatmapStats.max,e),a=n.y_min,s=n.y_max;a=ut.yAxis.min&&"0"!==ut.yAxis.min?D(ut.yAxis.min,e):a,s=null!==ut.yAxis.max?A(ut.yAxis.max,e):s,i.a.isEmpty(st.buckets)&&(s=Math.pow(e,2),a=1),t.yScale=ht=c.scaleLog().base(ut.yAxis.logBase).domain([a,s]).range([gt,0]);var l=ht.domain(),u=I(l,e),p=h.getPrecision(a),d=ut.yAxis.decimals||p,f=h.getFlotTickSize(a,s,u.length,p),m=h.getScaledDecimals(d,f);r.decimals=d,r.scaledDecimals=m,st.yAxis={min:a,max:s,ticks:u.length};var g=c.axisLeft(ht).tickValues(u).tickFormat(F(d,m)).tickSizeInner(0-pt).tickSizeOuter(0).tickPadding(_);ct.append("g").attr("class","axis axis-y").call(g);var v=At.top,y=o(ct)+_;ct.select(".axis-y").attr("transform","translate("+y+","+v+")"),a<1&&ct.select(".axis-y").select(".tick text").text("0"),ct.select(".axis-y").select(".domain").remove()}function E(){function e(t){var e=n[t];return i.a.isNaN(i.a.toNumber(e))||""===e||(e=F(l)(i.a.toNumber(e))),e}var n=st.tsBuckets;t.yScale=ht=c.scaleLinear().domain([0,n.length-1]).range([gt,0]);var a=i.a.map(n,function(t,e){return e}),s=i.a.max(i.a.map(n,h.getStringPrecision)),l=null===ut.yAxis.decimals?s:ut.yAxis.decimals;r.decimals=l;var u=i.a.map(n,function(t,n){return e(n)});st.tsBucketsFormatted=u;var p=c.axisLeft(ht).tickValues(a).tickFormat(e).tickSizeInner(0-pt).tickSizeOuter(0).tickPadding(_);ct.append("g").attr("class","axis axis-y").call(p);var d=At.top,f=o(ct)+_;ct.select(".axis-y").attr("transform","translate("+f+","+d+")"),ct.select(".axis-y").select(".domain").remove()}function $(t,e,n){var r,a;return r=st.heatmapStats.minLog,r=st.heatmapStats.minLog>1||!st.heatmapStats.minLog?1:D(st.heatmapStats.minLog,n),a=A(st.heatmapStats.max,n),{y_min:r,y_max:a}}function A(t,e){return Math.pow(e,Math.ceil(h.logp(t,e)))}function D(t,e){return Math.pow(e,Math.floor(h.logp(t,e)))}function I(t,e){var n=t[0],r=t[1],a=[];if(n<1)for(var i=Math.floor(h.logp(n,e)),o=i;o<0;o++){var s=Math.pow(e,o);a.push(s)}for(var l=Math.ceil(h.logp(r,e)),o=0;o<=l;o++){var s=Math.pow(e,o);a.push(s)}return a}function F(t,e){void 0===e&&(e=null);var n=ut.yAxis.format;return function(r){try{return"none"!==n?p.a.valueFormats[n](r,t,e):r}catch(t){return console.error(t.message||t),r}}}function q(){ct.select(".axis-y").selectAll(".tick line").attr("x2",mt)}function R(){gt=dt-At.top-At.bottom,vt=At.top,yt=vt+gt,"tsbuckets"===ut.dataFormat?E():1===ut.yAxis.logBase?M():O(),bt=o(ct)+_,mt=pt-bt-At.right,q(),T(),xt=l(ct),ut.yAxis.show||ct.select(".axis-y").selectAll("line").style("opacity",0),ut.xAxis.show||ct.select(".axis-x").selectAll("line").style("opacity",0)}function j(){var t=Pt[0];pt=Math.floor(Pt.width())-$t.right,dt=Math.floor(Pt.height())-$t.bottom,St=null!==ut.cards.cardPadding?ut.cards.cardPadding:y,wt=null!==ut.cards.cardRound?ut.cards.cardRound:b,ct&&ct.remove(),ct=c.select(t).append("svg").attr("width",pt).attr("height",dt)}function N(){if(j(),R(),1!==ut.yAxis.logBase&&"tsbuckets"!==ut.dataFormat){var t=ut.yAxis.logBase,e=ht.domain(),n=I(e,t);st.buckets=Object(m.f)(st.buckets,i.a.min(n))}var a=st.cards,o=st.cardStats.max,s=ut.color.max||o,l=ut.color.min||0,u=i.a.find(r.colorSchemes,{value:ut.color.colorScheme});Ct=Object(g.a)(u,d.c.user.lightTheme,s,l),Tt=Object(g.b)(ut.color,s),V();var c=ct.selectAll(".heatmap-card").data(a);c.append("title"),c=c.enter().append("rect").attr("x",B).attr("width",z).attr("y",Q).attr("height",H).attr("rx",wt).attr("ry",wt).attr("class","bordered heatmap-card").style("fill",Y).style("stroke",Y).style("stroke-width",0).style("opacity",W),Pt.find(".heatmap-card").on("mouseenter",function(t){Ot.mouseOverBucket=!0,L(t)}).on("mouseleave",function(t){Ot.mouseOverBucket=!1,U(t)})}function L(t){var e=c.select(t.target).style("fill"),n=c.color(e).darker(2),r=c.color(e).brighter(4),a=c.select(t.target);Ot.originalFillColor=e,a.style("fill",n.toString()).style("stroke",r.toString()).style("stroke-width",1)}function U(t){c.select(t.target).style("fill",Ot.originalFillColor).style("stroke",Ot.originalFillColor).style("stroke-width",0)}function V(){var t=Math.floor(ft(st.xBucketSize)-ft(0)),e=Math.floor(ht(ht.invert(0)-st.yBucketSize));if(1!==ut.yAxis.logBase){var n=ut.yAxis.logBase,r=st.yBucketSize||1;e=Math.floor((ht(1)-ht(n))/r)}kt=t-2*St,_t=e?e-2*St:0}function B(t){return ft(t.x)<0?bt+St:ft(t.x)+bt+St}function z(t){var e;if(ft(t.x)<0){var n=ft(t.x)+kt;e=n>0?n:0}else e=ft(t.x)+kt>mt?mt-ft(t.x)-St:kt;return e=Math.max(e,v)}function Q(t){var e=ht(t.y)+vt-_t-St;return 1!==ut.yAxis.logBase&&0===t.y?e=yt-_t-St:e<vt&&(e=vt),e}function H(t){var e=ht(t.y)+vt-_t-St,n=_t;return 1!==ut.yAxis.logBase&&0===t.y?_t:(e<vt?n=ht(t.y)-St:ht(t.y)>yt?n=yt-e:e+_t>yt&&(n=yt-e),n=Math.min(n,gt),n=Math.max(n,v))}function Y(t){return"opacity"===ut.color.mode?ut.color.cardColor:Ct(t.count)}function W(t){return"opacity"===ut.color.mode?Tt(t.count):1}function G(t){Et.active=!0,Et.x1=t.offsetX,Mt=function(){K()},s()(document).one("mouseup",Mt)}function K(){s()(document).unbind("mouseup",Mt),Mt=null,Et.active=!1;var t=Math.abs(Et.x2-Et.x1);if(Et.x2>=0&&t>C){var e=ft.invert(Math.min(Et.x1,Et.x2)-bt),n=ft.invert(Math.max(Et.x1,Et.x2)-bt);r.timeSrv.setTime({from:u.a.utc(e),to:u.a.utc(n)})}nt()}function J(){d.b.emit("graph-hover-clear"),it()}function X(t){ct&&(Et.active?(it(),Ot.destroy(),Et.x2=tt(t.offsetX),et(Et.x1,Et.x2)):(Z(t),rt(t.offsetX),Ot.show(t,st)))}function Z(t){var e=ft.invert(t.offsetX-bt).valueOf(),n=ht.invert(t.offsetY),r={pageX:t.pageX,pageY:t.pageY,x:e,x1:e,y:n,y1:n,panelRelY:null};r.panelRelY=Math.max(t.offsetY/dt,.001),d.b.emit("graph-hover",{pos:r,panel:ut})}function tt(t){return t=Math.max(t,bt),t=Math.min(t,mt+bt)}function et(t,e){if(ct){ct.selectAll(".heatmap-selection").remove();var n=Math.min(t,e),r=Math.abs(t-e);r>C&&ct.append("rect").attr("class","heatmap-selection").attr("x",n).attr("width",r).attr("y",vt).attr("height",gt)}}function nt(){Et.x1=-1,Et.x2=-1,ct&&ct.selectAll(".heatmap-selection").remove()}function rt(t){if(ct){ct.selectAll(".heatmap-crosshair").remove();var e=t;e=Math.max(e,bt),e=Math.min(e,mt+bt),ct.append("g").attr("class","heatmap-crosshair").attr("transform","translate("+e+",0)").append("line").attr("x1",1).attr("y1",vt).attr("x2",1).attr("y2",yt).attr("stroke-width",1)}}function at(t){if(ct&&0!==r.dashboard.graphTooltip){rt(ft(t.x)+bt)}}function it(){ct&&ct.selectAll(".heatmap-crosshair").remove()}function ot(){if(st=r.data,ut=r.panel,lt=r.range,a()&&st){if(i.a.isEmpty(st.buckets))return j(),void R();N(),t.yAxisWidth=bt,t.xAxisHeight=xt,t.chartHeight=gt,t.chartWidth=mt,t.chartTop=vt}}var st,lt,ut,ct,pt,dt,ht,ft,mt,gt,vt,yt,bt,xt,St,wt,kt,_t,Ct,Tt,Mt,Pt=e.find(".heatmap-panel"),Ot=new f.a(Pt,t),Et={active:!1,x1:-1,x2:-1},$t={left:0,right:0,top:0,bottom:0},At={left:25,right:15,top:10,bottom:20},Dt=x;r.events.on("render",function(){ot(),r.renderingCompleted()}),r.tickValueFormatter=F,d.b.on("graph-hover",function(t){at(t.pos)},t),d.b.on("graph-hover-clear",function(){it()},t),Pt.on("mousedown",G),Pt.on("mousemove",X),Pt.on("mouseleave",J)}e.a=r;var a=n(4),i=n.n(a),o=n(16),s=n.n(o),l=n(1),u=n.n(l),c=n(515),p=n(224),d=n(225),h=n(516),f=n(1619),m=n(1471),g=n(1493),v=1,y=1,b=0,x=1.2,S=100,w=50,k=10,_=5,C=2},1619:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=n(515),a=n(16),i=n.n(a),o=n(4),s=n.n(o),l=n(224),u=n(1471),c=function(){function t(t,e){this.scope=e,this.dashboard=e.ctrl.dashboard,this.panelCtrl=e.ctrl,this.panel=e.ctrl.panel,this.heatmapPanel=t,this.mouseOverBucket=!1,this.originalFillColor=null,t.on("mouseover",this.onMouseOver.bind(this)),t.on("mouseleave",this.onMouseLeave.bind(this))}return t.prototype.onMouseOver=function(t){this.panel.tooltip.show&&this.scope.ctrl.data&&!s.a.isEmpty(this.scope.ctrl.data.buckets)&&(this.tooltip||(this.add(),this.move(t)))},t.prototype.onMouseLeave=function(){this.destroy()},t.prototype.onMouseMove=function(t){this.panel.tooltip.show&&this.move(t)},t.prototype.add=function(){this.tooltip=r.select("body").append("div").attr("class","heatmap-tooltip graph-tooltip grafana-tooltip")},t.prototype.destroy=function(){this.tooltip&&this.tooltip.remove(),this.tooltip=null},t.prototype.show=function(t,e){if(this.panel.tooltip.show&&e&&!t.panelRelY){var n=this.getBucketIndexes(t,e),r=n.xBucketIndex,a=n.yBucketIndex;if(!e.buckets[r]||!this.tooltip)return void this.destroy();var i,o,l,u,c,p=e.buckets[r],d=s.a.find(p.buckets,function(t,e){return t.bounds.bottom===a||e===a.toString()}),h=this.dashboard.formatDate(p.x,"YYYY-MM-DD HH:mm:ss");if(s.a.isNumber(this.panel.tooltipDecimals))u=this.countValueFormatter(this.panel.tooltipDecimals,null),c=this.panelCtrl.tickValueFormatter(this.panelCtrl.decimals,null);else{var f=(this.panelCtrl.decimals||-1)+1;u=this.countValueFormatter(f,this.panelCtrl.scaledDecimals+2),c=this.panelCtrl.tickValueFormatter(f,this.panelCtrl.scaledDecimals+2)}var m='<div class="graph-tooltip-time">'+h+'</div>\n      <div class="heatmap-histogram"></div>';if(d)if(d.bounds){if(e.tsBuckets){var g=function(t){return e.tsBucketsFormatted?e.tsBucketsFormatted[t]:e.tsBuckets[t]};i=g(a),o=a<e.tsBuckets.length-1?g(a+1):""}else{var v=d.y?d.bounds.bottom:0;i=c(v),o=c(d.bounds.top)}l=u(d.count),m+="<div>\n          bucket: <b>"+i+" - "+o+"</b> <br>\n          count: <b>"+l+"</b> <br>\n        </div>"}else m+="<div>count: <b>"+d.count+"</b><br></div>";else{if(!this.panel.tooltip.showHistogram)return void this.destroy();i=a,o="",l=0}this.tooltip.html(m),this.panel.tooltip.showHistogram&&this.addHistogram(p),this.move(t)}},t.prototype.getBucketIndexes=function(t,e){return{xBucketIndex:this.getXBucketIndex(t.offsetX,e),yBucketIndex:this.getYBucketIndex(t.offsetY,e)}},t.prototype.getXBucketIndex=function(t,e){var n=this.scope.xScale.invert(t-this.scope.yAxisWidth).valueOf(),r=s.a.find(e.buckets,function(t){return n>t.x&&n-t.x<=e.xBucketSize});return r?r.x:Object(u.d)(n,e.xBucketSize,1)},t.prototype.getYBucketIndex=function(t,e){var n=this.scope.yScale.invert(t-this.scope.chartTop);return e.tsBuckets?Math.floor(n):Object(u.d)(n,e.yBucketSize,this.panel.yAxis.logBase)},t.prototype.getSharedTooltipPos=function(t){return t.pageX=this.heatmapPanel.offset().left+this.scope.xScale(t.x),t.pageY=this.heatmapPanel.offset().top+this.scope.chartHeight*t.panelRelY,t},t.prototype.addHistogram=function(t){var e,n,a,i=this.scope.ctrl.data.buckets[t.x],o=this.scope.ctrl.data.yBucketSize;this.scope.ctrl.data.tsBuckets?(e=0,n=this.scope.ctrl.data.tsBuckets.length-1,a=this.scope.ctrl.data.tsBuckets.length):(e=this.scope.ctrl.data.yAxis.min,n=this.scope.ctrl.data.yAxis.max,a=this.scope.ctrl.data.yAxis.ticks);var l=s.a.map(i.buckets,function(t){var e=void 0!==t.count?t.count:t.values.length;return[t.bounds.bottom,e]});l=s.a.filter(l,function(t){return t[0]>=e&&t[0]<=n});var u,c=this.scope.yScale.copy(),p=c.domain([e,n]).range([0,160]);if(1===this.panel.yAxis.logBase)u=Math.floor(160/(n-e)*o*.9);else{var d=o||1;u=Math.floor(160/a/d*.9)}u=Math.max(u,1);var h=s.a.reduce(s.a.map(l,function(t){return t[1]}),function(t,e){return t+e},0),f=r.scaleLinear().domain([0,h]).range([0,40]);this.tooltip.select(".heatmap-histogram").append("svg").attr("width",160).attr("height",40).selectAll(".bar").data(l).enter().append("rect").attr("x",function(t){return p(t[0])}).attr("width",u).attr("y",function(t){return 40-f(t[1])}).attr("height",function(t){return f(t[1])})},t.prototype.move=function(t){if(this.tooltip){var e=i()(this.tooltip.node())[0],n=e.clientWidth,r=e.clientHeight,a=t.pageX+30,o=t.pageY+5;return t.pageX+n+40>window.innerWidth&&(a=t.pageX-n-30),t.pageY-window.pageYOffset+r+20>window.innerHeight&&(o=t.pageY-r-5),this.tooltip.style("left",a+"px").style("top",o+"px")}},t.prototype.countValueFormatter=function(t,e){void 0===e&&(e=null);return function(n){return l.a.valueFormats.short(n,t,e)}},t}()},1620:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"TablePanelCtrl",function(){return h}),n.d(e,"PanelCtrl",function(){return h});var r=n(4),a=n.n(r),i=n(16),o=n.n(i),s=n(1464),l=n(1494),u=n(1621),c=n(1622),p=n(1623),d=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(t){function e(e,n,r,i,o,s){var l=t.call(this,e,n)||this;return l.annotationsSrv=i,l.$sanitize=o,l.variableSrv=s,l.panelDefaults={targets:[{}],transform:"timeseries_to_columns",pageSize:null,showHeader:!0,styles:[{type:"date",pattern:"Time",alias:"Time",dateFormat:"YYYY-MM-DD HH:mm:ss"},{unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"/.*/",thresholds:[]}],columns:[],scroll:!0,fontSize:"100%",sort:{col:0,desc:!0}},l.pageIndex=0,void 0===l.panel.styles&&(l.panel.styles=l.panel.columns,l.panel.columns=l.panel.fields,delete l.panel.columns,delete l.panel.fields),a.a.defaults(l.panel,l.panelDefaults),l.events.on("data-received",l.onDataReceived.bind(l)),l.events.on("data-error",l.onDataError.bind(l)),l.events.on("data-snapshot-load",l.onDataReceived.bind(l)),l.events.on("init-edit-mode",l.onInitEditMode.bind(l)),l.events.on("init-panel-actions",l.onInitPanelActions.bind(l)),l}return d(e,t),e.$inject=["$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv"],e.prototype.onInitEditMode=function(){this.addEditorTab("Options",u.a,2),this.addEditorTab("Column Styles",c.a,3)},e.prototype.onInitPanelActions=function(t){t.push({text:"Export CSV",click:"ctrl.exportCsv()"})},e.prototype.issueQueries=function(e){return this.pageIndex=0,"annotations"===this.panel.transform?(this.setTimeQueryStart(),this.annotationsSrv.getAnnotations({dashboard:this.dashboard,panel:this.panel,range:this.range}).then(function(t){return{data:t}})):t.prototype.issueQueries.call(this,e)},e.prototype.onDataError=function(t){this.dataRaw=[],this.render()},e.prototype.onDataReceived=function(t){this.dataRaw=t,this.pageIndex=0,this.dataRaw&&this.dataRaw.length&&("table"===this.dataRaw[0].type?this.panel.transform="table":"docs"===this.dataRaw[0].type?this.panel.transform="json":"table"!==this.panel.transform&&"json"!==this.panel.transform||(this.panel.transform="timeseries_to_rows")),this.render()},e.prototype.render=function(){return this.table=Object(l.a)(this.dataRaw,this.panel),this.table.sort(this.panel.sort),this.renderer=new p.a(this.panel,this.table,this.dashboard.isTimezoneUtc(),this.$sanitize,this.templateSrv),t.prototype.render.call(this,this.table)},e.prototype.toggleColumnSort=function(t,e){this.table.columns[this.panel.sort.col]&&(this.table.columns[this.panel.sort.col].sort=!1),this.panel.sort.col===e?this.panel.sort.desc?this.panel.sort.desc=!1:this.panel.sort.col=null:(this.panel.sort.col=e,this.panel.sort.desc=!0),this.render()},e.prototype.exportCsv=function(){var t=this.$scope.$new(!0);t.tableData=this.renderer.render_values(),t.panel="table",this.publishAppEvent("show-modal",{templateHtml:'<export-data-modal panel="panel" data="tableData"></export-data-modal>',scope:t,modalClass:"modal--narrow"})},e.prototype.link=function(t,e,n,r){function a(){var t=r.height;return h>1&&(t-=26),t-31+"px"}function i(t){r.renderer.setTable(p),t.empty(),t.html(r.renderer.render(r.pageIndex))}function s(t){var e=o()(t.currentTarget);r.pageIndex=parseInt(e.text(),10)-1,u()}function l(t){t.empty();var e=d.pageSize||100;if(1!==(h=Math.ceil(p.rows.length/e))){for(var n=Math.max(r.pageIndex-3,0),a=Math.min(h,n+9),i=o()("<ul></ul>"),s=n;s<a;s++){var l=s===r.pageIndex?"active":"",u=o()('<li><a class="table-panel-page-link pointer '+l+'">'+(s+1)+"</a></li>");i.append(u)}t.append(i)}}function u(){var t=e.parents(".panel"),n=e.find(".table-panel-scroll"),r=e.find("tbody"),o=e.find(".table-panel-footer");e.css({"font-size":d.fontSize}),t.addClass("table-panel-wrapper"),i(r),l(o),n.css({"max-height":d.scroll?a():""})}function c(t){var e=o()(t.currentTarget).data(),n={datasource:d.datasource,key:p.columns[e.column].text,value:p.rows[e.row][e.column],operator:e.operator};r.variableSrv.setAdhocFilter(n)}var p,d=r.panel,h=0;e.tooltip({selector:"[data-link-tooltip]"}),e.on("click",".table-panel-page-link",s),e.on("click",".table-panel-filter-link",c);var f=t.$on("$destroy",function(){e.off("click",".table-panel-page-link"),e.off("click",".table-panel-filter-link"),f()});r.events.on("render",function(t){p=t||p,p&&u(),r.renderingCompleted()})},e.templateUrl="module.html",e}(s.MetricsPanelCtrl)},1621:function(t,e,n){"use strict";function r(t,e){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table/editor.html",controller:s}}r.$inject=["$q","uiSegmentSrv"],e.a=r;var a=n(4),i=n.n(a),o=n(1494),s=function(){function t(t,e,n){this.$q=e,this.uiSegmentSrv=n,t.editor=this,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.transformers=o.b,this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.addColumnSegment=n.newPlusButton(),this.updateTransformHints()}return t.$inject=["$scope","$q","uiSegmentSrv"],t.prototype.updateTransformHints=function(){switch(this.canSetColumns=!1,this.columnsHelpMessage="",this.panel.transform){case"timeseries_aggregations":case"json":this.canSetColumns=!0;break;case"table":this.columnsHelpMessage="Columns and their order are determined by the data query"}},t.prototype.getColumnOptions=function(){var t=this;if(!this.panelCtrl.dataRaw)return this.$q.when([]);var e=this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw),n=i.a.map(e,function(e){return t.uiSegmentSrv.newSegment({value:e.text})});return this.$q.when(n)},t.prototype.addColumn=function(){var t=o.b[this.panel.transform].getColumns(this.panelCtrl.dataRaw),e=i.a.find(t,{text:this.addColumnSegment.value});e&&(this.panel.columns.push(e),this.render());var n=this.uiSegmentSrv.newPlusButton();this.addColumnSegment.html=n.html,this.addColumnSegment.value=n.value},t.prototype.transformChanged=function(){this.panel.columns=[],"timeseries_aggregations"===this.panel.transform&&this.panel.columns.push({text:"Avg",value:"avg"}),this.updateTransformHints(),this.render()},t.prototype.render=function(){this.panelCtrl.render()},t.prototype.removeColumn=function(t){this.panel.columns=i.a.without(this.panel.columns,t),this.panelCtrl.render()},t}()},1622:function(t,e,n){"use strict";function r(t,e){return{restrict:"E",scope:!0,templateUrl:"public/app/plugins/panel/table/column_options.html",controller:s}}r.$inject=["$q","uiSegmentSrv"],e.a=r;var a=n(4),i=n.n(a),o=n(224),s=function(){function t(t){var e=this;t.editor=this,this.activeStyleIndex=0,this.panelCtrl=t.ctrl,this.panel=this.panelCtrl.panel,this.unitFormats=o.a.getUnitFormats(),this.colorModes=[{text:"Disabled",value:null},{text:"Cell",value:"cell"},{text:"Value",value:"value"},{text:"Row",value:"row"}],this.columnTypes=[{text:"Number",value:"number"},{text:"String",value:"string"},{text:"Date",value:"date"},{text:"Hidden",value:"hidden"}],this.fontSizes=["80%","90%","100%","110%","120%","130%","150%","160%","180%","200%","220%","250%"],this.dateFormats=[{text:"YYYY-MM-DD HH:mm:ss",value:"YYYY-MM-DD HH:mm:ss"},{text:"YYYY-MM-DD HH:mm:ss.SSS",value:"YYYY-MM-DD HH:mm:ss.SSS"},{text:"MM/DD/YY h:mm:ss a",value:"MM/DD/YY h:mm:ss a"},{text:"MMMM D, YYYY LT",value:"MMMM D, YYYY LT"}],this.mappingTypes=[{text:"Value to text",value:1},{text:"Range to text",value:2}],this.getColumnNames=function(){return e.panelCtrl.table?i.a.map(e.panelCtrl.table.columns,function(t){return t.text}):[]},this.onColorChange=this.onColorChange.bind(this)}return t.$inject=["$scope"],t.prototype.render=function(){this.panelCtrl.render()},t.prototype.setUnitFormat=function(t,e){t.unit=e.value,this.panelCtrl.render()},t.prototype.addColumnStyle=function(){var t={unit:"short",type:"number",alias:"",decimals:2,colors:["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],colorMode:null,pattern:"",dateFormat:"YYYY-MM-DD HH:mm:ss",thresholds:[],mappingType:1},e=this.panel.styles,n=e.length,r=n;if(n>0){"/.*/"===e[n-1].pattern&&(r=n-1)}e.splice(r,0,t),this.activeStyleIndex=r},t.prototype.removeColumnStyle=function(t){this.panel.styles=i.a.without(this.panel.styles,t)},t.prototype.invertColorOrder=function(t){var e=this.panel.styles[t].colors,n=e[0];e[0]=e[2],e[2]=n,this.panelCtrl.render()},t.prototype.onColorChange=function(t,e){var n=this;return function(r){n.panel.styles[t].colors[e]=r,n.render()}},t.prototype.addValueMap=function(t){t.valueMaps||(t.valueMaps=[]),t.valueMaps.push({value:"",text:""}),this.panelCtrl.render()},t.prototype.removeValueMap=function(t,e){t.valueMaps.splice(e,1),this.panelCtrl.render()},t.prototype.addRangeMap=function(t){t.rangeMaps||(t.rangeMaps=[]),t.rangeMaps.push({from:"",to:"",text:""}),this.panelCtrl.render()},t.prototype.removeRangeMap=function(t,e){t.rangeMaps.splice(e,1),this.panelCtrl.render()},t}()},1623:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(4),a=n.n(r),i=n(1),o=n.n(i),s=n(224),l=function(){function t(t,e,n,r,a){this.panel=t,this.table=e,this.isUtc=n,this.sanitize=r,this.templateSrv=a,this.initColumns()}return t.prototype.setTable=function(t){this.table=t,this.initColumns()},t.prototype.initColumns=function(){this.formatters=[],this.colorState={};for(var t=0;t<this.table.columns.length;t++){var e=this.table.columns[t];e.title=e.text;for(var n=0;n<this.panel.styles.length;n++){var r=this.panel.styles[n],a=s.a.stringToJsRegex(r.pattern);if(e.text.match(a)){e.style=r,r.alias&&(e.title=e.text.replace(a,r.alias));break}}this.formatters[t]=this.createColumnFormatter(e)}},t.prototype.getColorForValue=function(t,e){if(!e.thresholds)return null;for(var n=e.thresholds.length;n>0;n--)if(t>=e.thresholds[n-1])return e.colors[n];return a.a.first(e.colors)},t.prototype.defaultCellFormatter=function(t,e){return null===t||void 0===t||void 0===t?"":(a.a.isArray(t)&&(t=t.join(", ")),e&&e.sanitize?this.sanitize(t):a.a.escape(t))},t.prototype.createColumnFormatter=function(t){var e=this;if(!t.style)return this.defaultCellFormatter;if("hidden"===t.style.type)return function(t){};if("date"===t.style.type)return function(n){if(void 0===n||null===n)return"-";a.a.isArray(n)&&(n=n[0]);var r=o()(n);return e.isUtc&&(r=r.utc()),r.format(t.style.dateFormat)};if("string"===t.style.type)return function(n){a.a.isArray(n)&&(n=n.join(", "));var r=t.style.mappingType||0;if(1===r&&t.style.valueMaps)for(var i=0;i<t.style.valueMaps.length;i++){var o=t.style.valueMaps[i];if(null!==n){if(!a.a.isString(n)&&Number(o.value)===Number(n)||o.value===n)return e.setColorState(n,t.style),e.defaultCellFormatter(o.text,t.style)}else if("null"===o.value)return o.text}if(2===r&&t.style.rangeMaps)for(var i=0;i<t.style.rangeMaps.length;i++){var o=t.style.rangeMaps[i];if(null!==n){if(Number(o.from)<=Number(n)&&Number(o.to)>=Number(n))return e.setColorState(n,t.style),e.defaultCellFormatter(o.text,t.style)}else if("null"===o.from&&"null"===o.to)return o.text}return null===n||void 0===n?"-":(e.setColorState(n,t.style),e.defaultCellFormatter(n,t.style))};if("number"===t.style.type){var n=s.a.valueFormats[t.unit||t.style.unit];return function(r){return null===r||void 0===r?"-":a.a.isString(r)||a.a.isArray(r)?e.defaultCellFormatter(r,t.style):(e.setColorState(r,t.style),n(r,t.style.decimals,null))}}return function(n){return e.defaultCellFormatter(n,t.style)}},t.prototype.setColorState=function(t,e){if(e.colorMode&&null!==t&&void 0!==t&&!a.a.isArray(t)){var n=Number(t);NaN!==n&&(this.colorState[e.colorMode]=this.getColorForValue(n,e))}},t.prototype.renderRowVariables=function(t){for(var e,n={},r=this.table.rows[t],a=0;a<r.length;a++)e="__cell_"+a,n[e]={value:r[a]};return n},t.prototype.formatColumnValue=function(t,e){return this.formatters[t]?this.formatters[t](e):e},t.prototype.renderCell=function(t,e,n,r){void 0===r&&(r=!1),n=this.formatColumnValue(t,n);var a=this.table.columns[t],i="",o=[],s="";this.colorState.cell?(i=' style="background-color:'+this.colorState.cell+';color: white"',this.colorState.cell=null):this.colorState.value&&(i=' style="color:'+this.colorState.value+'"',this.colorState.value=null);var l="";if(r&&(l='<div class="table-panel-width-hack">'+this.table.columns[t].title+"</div>"),void 0===n?(i=' style="display:none;"',a.hidden=!0):a.hidden=!1,a.style&&a.style.preserveFormat&&o.push("table-panel-cell-pre"),a.style&&a.style.link){var u=this.renderRowVariables(e);u.__cell={value:n};var c=this.templateSrv.replace(a.style.linkUrl,u),p=this.templateSrv.replace(a.style.linkTooltip,u),d=a.style.linkTargetBlank?"_blank":"";o.push("table-panel-cell-link"),l+='\n        <a href="'+c+'" target="'+d+'" data-link-tooltip data-original-title="'+p+'" data-placement="right">\n          '+n+"\n        </a>\n      "}else l+=n;return a.filterable&&(o.push("table-panel-cell-filterable"),l+='\n        <a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter out value" data-placement="bottom"\n           data-row="'+e+'" data-column="'+t+'" data-operator="!=">\n          <i class="fa fa-search-minus"></i>\n        </a>\n        <a class="table-panel-filter-link" data-link-tooltip data-original-title="Filter for value" data-placement="bottom"\n           data-row="'+e+'" data-column="'+t+'" data-operator="=">\n          <i class="fa fa-search-plus"></i>\n        </a>'),o.length&&(s=' class="'+o.join(" ")+'"'),l="<td"+s+i+">"+l+"</td>"},t.prototype.render=function(t){for(var e=this.panel.pageSize||100,n=t*e,r=Math.min(n+e,this.table.rows.length),a="",i=n;i<r;i++){for(var o=this.table.rows[i],s="",l="",u=0;u<this.table.columns.length;u++)s+=this.renderCell(u,i,o[u],i===n);this.colorState.row&&(l=' style="background-color:'+this.colorState.row+';color: white"',this.colorState.row=null),a+="<tr "+l+">"+s+"</tr>"}return a},t.prototype.render_values=function(){for(var t=[],e=0;e<this.table.rows.length;e++){for(var n=this.table.rows[e],r=[],a=0;a<this.table.columns.length;a++)r.push(this.formatColumnValue(a,n[a]));t.push(r)}return{columns:this.table.columns,rows:t}},t}()},1624:function(t,e,n){"use strict";function r(t,e){if(!i.a.isFinite(e))return null;for(var n=t.thresholds.length;n>0;n--)if(e>=t.thresholds[n-1])return t.colorMap[n];return i.a.first(t.colorMap)}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"SingleStatCtrl",function(){return m}),n.d(e,"PanelCtrl",function(){return m}),n.d(e,"getColorForValue",function(){return r});var a=n(4),i=n.n(a),o=n(16),s=n.n(o),l=n(1469),u=(n.n(l),n(1625)),c=(n.n(u),n(1474),n(224)),p=n(22),d=n(144),h=n(1464),f=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=function(t){function e(e,n,r,a){var o=t.call(this,e,n)||this;return o.$location=r,o.linkSrv=a,o.dataType="timeseries",o.valueNameOptions=[{value:"min",text:"Min"},{value:"max",text:"Max"},{value:"avg",text:"Average"},{value:"current",text:"Current"},{value:"total",text:"Total"},{value:"name",text:"Name"},{value:"first",text:"First"},{value:"delta",text:"Delta"},{value:"diff",text:"Difference"},{value:"range",text:"Range"},{value:"last_time",text:"Time of last point"}],o.panelDefaults={links:[],datasource:null,maxDataPoints:100,interval:null,targets:[{}],cacheTimeout:null,format:"none",prefix:"",postfix:"",nullText:null,valueMaps:[{value:"null",op:"=",text:"N/A"}],mappingTypes:[{name:"value to text",value:1},{name:"range to text",value:2}],rangeMaps:[{from:"null",to:"null",text:"N/A"}],mappingType:1,nullPointMode:"connected",valueName:"avg",prefixFontSize:"50%",valueFontSize:"80%",postfixFontSize:"50%",thresholds:"",colorBackground:!1,colorValue:!1,colors:["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],sparkline:{show:!1,full:!1,lineColor:"rgb(31, 120, 193)",fillColor:"rgba(31, 118, 189, 0.18)"},gauge:{show:!1,minValue:0,maxValue:100,thresholdMarkers:!0,thresholdLabels:!1},tableColumn:""},i.a.defaults(o.panel,o.panelDefaults),o.events.on("data-received",o.onDataReceived.bind(o)),o.events.on("data-error",o.onDataError.bind(o)),o.events.on("data-snapshot-load",o.onDataReceived.bind(o)),o.events.on("init-edit-mode",o.onInitEditMode.bind(o)),o.onSparklineColorChange=o.onSparklineColorChange.bind(o),o.onSparklineFillChange=o.onSparklineFillChange.bind(o),o}return f(e,t),e.$inject=["$scope","$injector","$location","linkSrv"],e.prototype.onInitEditMode=function(){this.fontSizes=["20%","30%","50%","70%","80%","100%","110%","120%","150%","170%","200%"],this.addEditorTab("Options","public/app/plugins/panel/singlestat/editor.html",2),this.addEditorTab("Value Mappings","public/app/plugins/panel/singlestat/mappings.html",3),this.unitFormats=c.a.getUnitFormats()},e.prototype.setUnitFormat=function(t){this.panel.format=t.value,this.refresh()},e.prototype.onDataError=function(t){this.onDataReceived([])},e.prototype.onDataReceived=function(t){var e={};if(t.length>0&&"table"===t[0].type){this.dataType="table";var n=t.map(this.tableHandler.bind(this));this.setTableValues(n,e)}else this.dataType="timeseries",this.series=t.map(this.seriesHandler.bind(this)),this.setValues(e);this.data=e,this.render()},e.prototype.seriesHandler=function(t){var e=new d.a({datapoints:t.datapoints||[],alias:t.target});return e.flotpairs=e.getFlotPairs(this.panel.nullPointMode),e},e.prototype.tableHandler=function(t){var e=[],n={};return t.columns.forEach(function(t,e){n[e]=t.text}),this.tableColumnOptions=n,i.a.find(t.columns,["text",this.panel.tableColumn])||this.setTableColumnToSensibleDefault(t),t.rows.forEach(function(t){var r={};t.forEach(function(t,e){var a=n[e];r[a]=t}),e.push(r)}),e},e.prototype.setTableColumnToSensibleDefault=function(t){1===t.columns.length?this.panel.tableColumn=t.columns[0].text:this.panel.tableColumn=i.a.find(t.columns,function(t){return"time"!==t.type}).text},e.prototype.setTableValues=function(t,e){if(t&&0!==t.length&&0!==t[0].length&&void 0!==t[0][0][this.panel.tableColumn]){var n=t[0][0];if(e.value=n[this.panel.tableColumn],i.a.isString(e.value))e.valueFormatted=i.a.escape(e.value),e.value=0,e.valueRounded=0;else{var r=this.getDecimalsForValue(e.value),a=c.a.valueFormats[this.panel.format];e.valueFormatted=a(n[this.panel.tableColumn],r.decimals,r.scaledDecimals),e.valueRounded=c.a.roundValue(e.value,this.panel.decimals||0)}this.setValueMapping(e)}},e.prototype.canChangeFontSize=function(){return this.panel.gauge.show},e.prototype.setColoring=function(t){t.background?(this.panel.colorValue=!1,this.panel.colors=["rgba(71, 212, 59, 0.4)","rgba(245, 150, 40, 0.73)","rgba(225, 40, 40, 0.59)"]):(this.panel.colorBackground=!1,this.panel.colors=["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"]),this.render()},e.prototype.invertColorOrder=function(){var t=this.panel.colors[0];this.panel.colors[0]=this.panel.colors[2],this.panel.colors[2]=t,this.render()},e.prototype.onColorChange=function(t){var e=this;return function(n){e.panel.colors[t]=n,e.render()}},e.prototype.onSparklineColorChange=function(t){this.panel.sparkline.lineColor=t,this.render()},e.prototype.onSparklineFillChange=function(t){this.panel.sparkline.fillColor=t,this.render()},e.prototype.getDecimalsForValue=function(t){if(i.a.isNumber(this.panel.decimals))return{decimals:this.panel.decimals,scaledDecimals:null};var e,n=t/2,r=-Math.floor(Math.log(n)/Math.LN10),a=Math.pow(10,-r),o=n/a;o<1.5?e=1:o<3?(e=2,o>2.25&&(e=2.5,++r)):e=o<7.5?5:10,e*=a,Math.floor(t)===t&&(r=0);var s={};return s.decimals=Math.max(0,r),s.scaledDecimals=s.decimals-Math.floor(Math.log(e)/Math.LN10)+2,s},e.prototype.setValues=function(t){if(t.flotpairs=[],this.series.length>1){var e=new Error;throw e.message="Multiple Series Error",e.data="Metric query returns "+this.series.length+" series. Single Stat Panel expects a single series.\n\nResponse:\n"+JSON.stringify(this.series),e}if(this.series&&this.series.length>0){var n=i.a.last(this.series[0].datapoints),r=i.a.isArray(n)?n[0]:null;if("name"===this.panel.valueName)t.value=0,t.valueRounded=0,t.valueFormatted=this.series[0].alias;else if(i.a.isString(r))t.value=0,t.valueFormatted=i.a.escape(r),t.valueRounded=0;else if("last_time"===this.panel.valueName){var a=c.a.valueFormats[this.panel.format];t.value=n[1],t.valueRounded=t.value,t.valueFormatted=a(t.value,0,0)}else{t.value=this.series[0].stats[this.panel.valueName],t.flotpairs=this.series[0].flotpairs;var o=this.getDecimalsForValue(t.value),a=c.a.valueFormats[this.panel.format];t.valueFormatted=a(t.value,o.decimals,o.scaledDecimals),t.valueRounded=c.a.roundValue(t.value,o.decimals)}t.scopedVars=i.a.extend({},this.panel.scopedVars),t.scopedVars.__name={value:this.series[0].label}}this.setValueMapping(t)},e.prototype.setValueMapping=function(t){if(1===this.panel.mappingType)for(var e=0;e<this.panel.valueMaps.length;e++){var n=this.panel.valueMaps[e];if("null"!==n.value){var r=parseFloat(n.value);if(r===t.valueRounded)return void(t.valueFormatted=n.text)}else if(null===t.value||void 0===t.value)return void(t.valueFormatted=n.text)}else if(2===this.panel.mappingType)for(var e=0;e<this.panel.rangeMaps.length;e++){var n=this.panel.rangeMaps[e];if("null"!==n.from||"null"!==n.to){var a=parseFloat(n.from),i=parseFloat(n.to);if(i>=t.valueRounded&&a<=t.valueRounded)return void(t.valueFormatted=n.text)}else if(null===t.value||void 0===t.value)return void(t.valueFormatted=n.text)}null!==t.value&&void 0!==t.value||(t.valueFormatted="no value")},e.prototype.removeValueMap=function(t){var e=i.a.indexOf(this.panel.valueMaps,t);this.panel.valueMaps.splice(e,1),this.render()},e.prototype.addValueMap=function(){this.panel.valueMaps.push({value:"",op:"=",text:""})},e.prototype.removeRangeMap=function(t){var e=i.a.indexOf(this.panel.rangeMaps,t);this.panel.rangeMaps.splice(e,1),this.render()},e.prototype.addRangeMap=function(){this.panel.rangeMaps.push({from:"",to:"",text:""})},e.prototype.link=function(t,e,n,a){function i(t,e){if(!b.colorValue)return e;var n=r(f,t);return n?'<span style="color:'+n+'">'+e+"</span>":e}function o(t,e,n){return n=x.replace(n,f.scopedVars),'<span class="'+t+'" style="font-size:'+e+'">'+n+"</span>"}function l(){var t='<div class="singlestat-panel-value-container">';if(b.prefix){var e=i(f.value,b.prefix);t+=o("singlestat-panel-prefix",b.prefixFontSize,e)}var n=i(f.value,f.valueFormatted);if(t+=o("singlestat-panel-value",b.valueFontSize,n),b.postfix){var r=i(f.value,b.postfix);t+=o("singlestat-panel-postfix",b.postfixFontSize,r)}return t+="</div>"}function u(){var t=b.prefix?x.replace(b.prefix,f.scopedVars):"";return t+=f.valueFormatted,t+=b.postfix?x.replace(b.postfix,f.scopedVars):""}function c(){var t=e.width(),n=e.height(),i=Math.min(t,1.3*n);if(a.invalidGaugeRange=!1,b.gauge.minValue>b.gauge.maxValue)return void(a.invalidGaugeRange=!0);var o=s()("<div></div>"),l={top:"10px",margin:"auto",position:"relative",height:.9*n+"px",width:i+"px"};o.css(l);for(var c=[],d=0;d<f.thresholds.length;d++)c.push({value:f.thresholds[d],color:f.colorMap[d]});c.push({value:b.gauge.maxValue,color:f.colorMap[f.colorMap.length-1]});var h=p.a.bootData.user.lightTheme?"rgb(230,230,230)":"rgb(38,38,38)",m=parseInt(b.valueFontSize)/100,g=Math.min(i/5,100)*m,v=b.gauge.thresholdLabels?1.5:1,y=Math.min(i/6,60)/v,x=y/5,S=g/2.5,w={series:{gauges:{gauge:{min:b.gauge.minValue,max:b.gauge.maxValue,background:{color:h},border:{color:null},shadow:{show:!1},width:y},frame:{show:!1},label:{show:!1},layout:{margin:0,thresholdWidth:0},cell:{border:{width:0}},threshold:{values:c,label:{show:b.gauge.thresholdLabels,margin:x+1,font:{size:S}},show:b.gauge.thresholdMarkers,width:x},value:{color:b.colorValue?r(f,f.valueRounded):null,formatter:function(){return u()},font:{size:g,family:'"Helvetica Neue", Helvetica, Arial, sans-serif'}},show:!0}}};e.append(o);var k={data:[[0,f.valueRounded]]};s.a.plot(o,[k],w)}function d(){var t=e.width()+20;if(t<30)return void setTimeout(d,30);var n=a.height,r=s()("<div></div>"),i={};if(i.position="absolute",b.sparkline.full){i.bottom="5px",i.left="-5px",i.width=t-10+"px";var o=n<=100?5:15*Math.round(n/100)+5;i.height=n-o+"px"}else i.bottom="0px",i.left="-5px",i.width=t-10+"px",i.height=Math.floor(.25*n)+"px";r.css(i);var l={legend:{show:!1},series:{lines:{show:!0,fill:1,lineWidth:1,fillColor:b.sparkline.fillColor}},yaxes:{show:!1},xaxis:{show:!1,mode:"time",min:a.range.from.valueOf(),max:a.range.to.valueOf()},grid:{hoverable:!1,show:!1}};e.append(r);var u={data:f.flotpairs,color:b.sparkline.lineColor};s.a.plot(r,[u],l)}function h(){if(a.data){f=a.data,f.thresholds=b.thresholds.split(",").map(function(t){return Number(t.trim())}),f.colorMap=b.colors;var n=b.gauge.show?"":l();if(b.colorBackground){var i=r(f,f.value);i&&(S.css("background-color",i),t.fullscreen?e.css("background-color",i):e.css("background-color",""))}else S.css("background-color",""),e.css("background-color","");e.html(n),b.sparkline.show&&d(),b.gauge.show&&c(),e.toggleClass("pointer",b.links.length>0),m=b.links.length>0?v.getPanelLinkAnchorInfo(b.links[0],f.scopedVars):null}}var f,m,g=this.$location,v=this.linkSrv,y=this.$timeout,b=a.panel,x=this.templateSrv,S=e.find(".panel-container");e=e.find(".singlestat-panel"),function(){var t=s()('<div id="tooltip" class="">hello</div>"');e.mouseleave(function(){0!==b.links.length&&y(function(){t.detach()})}),e.click(function(e){if(m&&!(s()(e).parents(".panel-header").length>0)){if("_blank"===m.target)return void window.open(m.href,"_blank");0===m.href.indexOf("http")?window.location.href=m.href:y(function(){g.url(m.href)}),t.detach()}}),e.mousemove(function(e){m&&(t.text("click to go to: "+m.title),t.place_tt(e.pageX,e.pageY-50))})}(),this.events.on("render",function(){h(),a.renderingCompleted()})},e.templateUrl="module.html",e}(h.MetricsPanelCtrl)},1625:function(t,e){/*!
 * jquery.flot.gauge v1.1.0 *
 *
 * Flot plugin for rendering gauge charts.
 *
 * Copyright (c) 2015 @toyoty99.
 * Licensed under the MIT license.
 */
!function(t){function e(t){return"undefined"!=typeof Logger?new Logger(t):null}function n(t,e){return e%t}function r(t,e){return Math.floor(e/t)}function a(t){return t*Math.PI}function i(t,e,n,r,a,i,o,s,l,u){if(i!==o){t.save(),t.beginPath(),t.arc(e,n,r,i,o,!1),t.lineTo(e+(r-a)*Math.cos(o),n+(r-a)*Math.sin(o)),t.arc(e,n,r-a,o,i,!0),t.closePath(),l&&(t.lineWidth=l),s&&(t.strokeStyle=s,t.stroke()),u&&(t.fillStyle=u,t.fill()),t.restore()}}function o(n){n.hooks.processOptions.push(function(t,n){e(n.series.gauges.debug);n.series.gauges.show&&(n.grid.show=!1,n.legend.show=!1),n.series.gauges.threshold.values.sort(function(t,e){return t.value<e.value?-1:t.value>e.value?1:0})}),n.hooks.draw.push(function(n,r){var a=n.getOptions(),i=a.series.gauges;e(i.debug);if(i.show){var o=n.getData();if(o&&o.length){var l=new s(n,r),u=l.calculateLayout();i.debug.layout,l.drawBackground(u);for(var c=0;c<o.length;c++){var p=o[c],d=t.extend({},i,p.gauges);p.gauges&&l.calculateAutoValues(d,u.cellWidth);var h=l.calculateCellLayout(d,u,c);l.drawCellBackground(d,h),d.debug.layout,d.label.show&&l.drawLable(d,u,h,c,p),l.drawGauge(d,u,h,p.label,p.data[0][1]),d.threshold.show&&l.drawThreshold(d,u,h),d.threshold.label.show&&l.drawThresholdValues(d,u,h,c),d.value.show&&l.drawValue(d,u,h,c,p)}}}})}var s=function(){function o(t,e){"auto"===t.gauge.width&&(t.gauge.width=Math.max(5,e/8)),"auto"===t.label.margin&&(t.label.margin=Math.max(1,e/20)),"auto"===t.label.font.size&&(t.label.font.size=Math.max(5,e/8)),"auto"===t.value.margin&&(t.value.margin=Math.max(1,e/30)),"auto"===t.value.font.size&&(t.value.font.size=Math.max(5,e/9)),"auto"===t.threshold.width&&(t.threshold.width=Math.max(3,e/100)),"auto"===t.threshold.label.margin&&(t.threshold.label.margin=Math.max(3,e/40)),"auto"===t.threshold.label.font.size&&(t.threshold.label.font.size=Math.max(5,e/15))}function s(t,e){for(var n,r=0;r<t.threshold.values.length;r++){var a=t.threshold.values[r];if(n=a.color,e<a.value)break}return n}function l(t,e,n){var r=t.gauge.startAngle+(t.gauge.endAngle-t.gauge.startAngle)*((n-t.gauge.min)/(t.gauge.max-t.gauge.min));return r<t.gauge.startAngle?r=t.gauge.startAngle:r>t.gauge.endAngle&&(r=t.gauge.endAngle),r}function u(t,e,n,r,a,o,s,l,u,c){a!==o&&(d.save(),i(d,t,e,n,r,a,o,s,l,u),c&&(i(d,t,e,n,r,a,o),d.clip(),d.shadowOffsetX=0,d.shadowOffsetY=0,d.shadowBlur=10,d.shadowColor="gray",i(d,t,e,n+1,r+2,a,o,s,1)),d.restore())}function c(t,e,n,r,i,o){p(n.cx+(e.thresholdLabelMargin+e.thresholdLabelFontSize/2+e.radius)*Math.cos(a(o)),n.cy+(e.thresholdLabelMargin+e.thresholdLabelFontSize/2+e.radius)*Math.sin(a(o)),"flotGagueThresholdValue"+r,t.threshold.label.formatter?t.threshold.label.formatter(i):i,t.threshold.label,o)}function p(e,n,r,a,i,o){var s=t("."+r,h),l=s.length;l||(s=t("<span></span>"),s.attr("id",r),s.css("position","absolute"),s.css("top",n+"px"),i.font.size&&s.css("font-size",i.font.size+"px"),i.font.family&&s.css("font-family",i.font.family),i.color&&s.css("color",i.color),i.background.color&&s.css("background-color",i.background.color),i.background.opacity&&s.css("opacity",i.background.opacity),h.append(s)),s.text(a),s.css("left",e+"px"),s.css("left",parseInt(s.css("left"))-s.width()/2+"px"),!l&&o&&(s.css("top",parseInt(s.css("top"))-s.height()/2+"px"),s.css("transform","rotate("+(180*o+90)+"deg)"))}var d,h,f,m,g,v,y=function(t,n){d=n,h=t.getPlaceholder(),f=t.getOptions(),m=f.series.gauges,g=t.getData(),v=e(m.debug)};return y.prototype.calculateLayout=function(){var t=h.width(),e=h.height(),n=Math.min(g.length,m.layout.columns),r=Math.ceil(g.length/n),i=m.layout.margin,s=m.layout.hMargin,l=m.layout.vMargin,u=(t-2*i-s*(n-1))/n,c=(e-2*i-l*(r-1))/r;if(m.layout.square){var p=Math.min(u,c);u=p,c=p}o(m,u);var d=m.cell.margin,f=0,v=0;m.label.show&&(f=m.label.margin,v=m.label.font.size);var y=0,b=0;m.value.show&&(y=m.value.margin,b=m.value.font.size);var x=0;m.threshold.show&&(x=m.threshold.width);var S=0,w=0;m.threshold.label.show&&(S=m.threshold.label.margin,w=m.threshold.label.font.size);for(var k=u/2-d-x-2*S-w,_=m.gauge.startAngle,C=m.gauge.endAngle,T=(C-_)/100,M=-1,P=_;P<C;P+=T)M=Math.max(M,Math.sin(a(P)));M=Math.max(M,Math.sin(a(C)));var O=(c-2*d-2*f-v)/(1+M);O*M<y+b/2&&(O=c-2*d-2*f-v-y-b/2);var E=O-2*S-w-x,$=Math.min(k,E),A=m.gauge.width;A>=$&&(A=Math.max(3,$/3));var D=2*S+w+x+$;return{canvasWidth:t,canvasHeight:e,margin:i,hMargin:s,vMargin:l,columns:n,rows:r,cellWidth:u,cellHeight:c,cellMargin:d,labelMargin:f,labelFontSize:v,valueMargin:y,valueFontSize:b,width:A,radius:$,thresholdWidth:x,thresholdLabelMargin:S,thresholdLabelFontSize:w,gaugeOuterHeight:Math.max(D*(1+M),D+y+b/2)}},y.prototype.calculateAutoValues=o,y.prototype.calculateCellLayout=function(t,e,a){var i=n(e.columns,a),o=r(e.columns,a),s=e.margin+(e.cellWidth+e.hMargin)*i,l=e.margin+(e.cellHeight+e.vMargin)*o,u=s+e.cellWidth/2,c=l+e.cellMargin+2*e.labelMargin+e.labelFontSize+e.thresholdWidth+e.thresholdLabelFontSize+2*e.thresholdLabelMargin+e.radius,p=e.cellHeight-2*e.cellMargin-2*e.labelMargin-e.labelFontSize-e.gaugeOuterHeight,d=0;return"middle"===t.cell.vAlign?d=p/2:"bottom"===t.cell.vAlign&&(d=p),c+=d,{col:i,row:o,x:s,y:l,offsetY:d,cellWidth:e.cellWidth,cellHeight:e.cellHeight,cellMargin:e.cellMargin,cx:u,cy:c}},y.prototype.drawBackground=function(t){m.frame.show&&(d.save(),d.strokeStyle=f.grid.borderColor,d.lineWidth=f.grid.borderWidth,d.strokeRect(0,0,t.canvasWidth,t.canvasHeight),f.grid.backgroundColor&&(d.fillStyle=f.grid.backgroundColor,d.fillRect(0,0,t.canvasWidth,t.canvasHeight)),d.restore())},y.prototype.drawCellBackground=function(t,e){d.save(),t.cell.border&&t.cell.border.show&&t.cell.border.color&&t.cell.border.width&&(d.strokeStyle=t.cell.border.color,d.lineWidth=t.cell.border.width,d.strokeRect(e.x,e.y,e.cellWidth,e.cellHeight)),t.cell.background&&t.cell.background.color&&(d.fillStyle=t.cell.background.color,d.fillRect(e.x,e.y,e.cellWidth,e.cellHeight)),d.restore()},y.prototype.drawGauge=function(t,e,n,r,i){var o=t.gauge.shadow.show?t.gauge.shadow.blur:0;u(n.cx,n.cy,e.radius,e.width,a(t.gauge.startAngle),a(t.gauge.endAngle),t.gauge.border.color,t.gauge.border.width,t.gauge.background.color,o);var c=s(t,i),p=l(t,e,i);u(n.cx,n.cy,e.radius-1,e.width-2,a(t.gauge.startAngle),a(p),c,1,c,o)},y.prototype.drawThreshold=function(t,e,n){for(var r=t.gauge.startAngle,o=0;o<t.threshold.values.length;o++){var s=t.threshold.values[o];c1=s.color,a2=l(t,e,s.value),i(d,n.cx,n.cy,e.radius+e.thresholdWidth,e.thresholdWidth-2,a(r),a(a2),c1,1,c1),r=a2}},y.prototype.drawLable=function(t,e,n,r,a){p(n.cx,n.y+n.cellMargin+e.labelMargin+n.offsetY,"flotGagueLabel"+r,t.label.formatter?t.label.formatter(a.label,a.data[0][1]):text,t.label)},y.prototype.drawValue=function(t,e,n,r,a){p(n.cx,n.cy-t.value.font.size/2,"flotGagueValue"+r,t.value.formatter?t.value.formatter(a.label,a.data[0][1]):text,t.value)},y.prototype.drawThresholdValues=function(t,e,n,r){c(t,e,n,"Min"+r,t.gauge.min,t.gauge.startAngle),c(t,e,n,"Max"+r,t.gauge.max,t.gauge.endAngle);for(var a=0;a<t.threshold.values.length;a++){var i=t.threshold.values[a];if(i.value>t.gauge.min&&i.value<t.gauge.max){var o=l(t,e,i.value);c(t,e,n,r+"_"+a,i.value,o)}}},y}(),l={series:{gauges:{debug:{log:!1,layout:!1,alert:!1},show:!1,layout:{margin:5,columns:3,hMargin:5,vMargin:5,square:!1},frame:{show:!0},cell:{background:{color:null},border:{show:!0,color:"black",width:1},margin:5,vAlign:"middle"},gauge:{width:"auto",startAngle:.9,endAngle:2.1,min:0,max:100,background:{color:"white"},border:{color:"lightgray",width:2},shadow:{show:!0,blur:5}},label:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:"sans-serif"},color:null,formatter:function(t,e){return t}},value:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:"sans-serif"},color:null,formatter:function(t,e){return parseInt(e)}},threshold:{show:!0,width:"auto",label:{show:!0,margin:"auto",background:{color:null,opacity:0},font:{size:"auto",family:",sans-serif"},color:null,formatter:function(t){return t}},values:[{value:50,color:"lightgreen"},{value:80,color:"yellow"},{value:100,color:"red"}]}}}};t.plot.plugins.push({init:o,options:l,name:"gauge",version:"1.1.0"})}(jQuery)},1626:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"GettingStartedPanelCtrl",function(){return o}),n.d(e,"PanelCtrl",function(){return o});var r=n(1464),a=n(225),i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=function(t){function e(e,n,r,a,i){var o=t.call(this,e,n)||this;return o.backendSrv=r,o.$q=i,o.stepIndex=0,o.steps=[],o.steps.push({title:"Install Grafana",icon:"icon-gf icon-gf-check",href:"http://docs.grafana.org/",target:"_blank",note:"Review the installation docs",check:function(){return i.when(!0)}}),o.steps.push({title:"Create your first data source",cta:"Add data source",icon:"icon-gf icon-gf-datasources",href:"datasources/new?gettingstarted",check:function(){return i.when(a.getMetricSources().filter(function(t){return!0!==t.meta.builtIn}).length>0)}}),o.steps.push({title:"Create your first dashboard",cta:"New dashboard",icon:"icon-gf icon-gf-dashboard",href:"dashboard/new?gettingstarted",check:function(){return o.backendSrv.search({limit:1}).then(function(t){return t.length>0})}}),o.steps.push({title:"Invite your team",cta:"Add Users",icon:"icon-gf icon-gf-users",href:"org/users?gettingstarted",check:function(){return o.backendSrv.get("/api/org/users").then(function(t){return t.length>1})}}),o.steps.push({title:"Install apps & plugins",cta:"Explore plugin repository",icon:"icon-gf icon-gf-apps",href:"https://grafana.com/plugins?utm_source=grafana_getting_started",check:function(){return o.backendSrv.get("/api/plugins",{embedded:0,core:0}).then(function(t){return t.length>0})}}),o}return i(e,t),e.$inject=["$scope","$injector","backendSrv","datasourceSrv","$q"],e.prototype.$onInit=function(){var t=this;return this.stepIndex=-1,this.nextStep().then(function(e){t.checksDone=!0})},e.prototype.nextStep=function(){var t=this;if(this.stepIndex===this.steps.length-1)return this.$q.when();this.stepIndex+=1;var e=this.steps[this.stepIndex];return e.check().then(function(n){return n?(e.cssClass="completed",t.nextStep()):(e.cssClass="active",t.$q.when())})},e.prototype.dismiss=function(){this.dashboard.removePanel(this.panel,!1),this.backendSrv.request({method:"PUT",url:"/api/user/helpflags/1",showSuccessAlert:!1}).then(function(t){a.c.user.helpFlags1=t.helpFlags1})},e.templateUrl="public/app/plugins/panel/gettingstarted/module.html",e}(r.PanelCtrl)},1627:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"ConfigCtrl",function(){return r});var r=function(){function t(t){this.backendSrv=t,this.appEditCtrl.setPreUpdateHook(this.initDatasource.bind(this))}return t.$inject=["backendSrv"],t.prototype.initDatasource=function(){var t=this;return this.backendSrv.get("/api/datasources").then(function(e){for(var n=!1,r=0,a=e;r<a.length;r++){"grafana-testdata-datasource"===a[r].type&&(n=!0)}if(!n){var i={name:"Grafana TestData",type:"grafana-testdata-datasource",access:"direct",jsonData:{}};return t.backendSrv.post("/api/datasources",i)}return Promise.resolve()})},t.template="",t}()},1628:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AnnotationsQueryCtrl",function(){return i});var r=n(1629),a=n(1630);n.d(e,"TestDataDatasource",function(){return r.a}),n.d(e,"Datasource",function(){return r.a}),n.d(e,"QueryCtrl",function(){return a.a});var i=function(){function t(){}return t.template="<h2>test data</h2>",t}()},1629:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(4),a=n.n(r),i=function(){function t(t,e,n){this.backendSrv=e,this.$q=n,this.id=t.id}return t.$inject=["instanceSettings","backendSrv","$q"],t.prototype.query=function(t){var e=this,n=a.a.filter(t.targets,function(t){return!0!==t.hide}).map(function(n){return{refId:n.refId,scenarioId:n.scenarioId,intervalMs:t.intervalMs,maxDataPoints:t.maxDataPoints,stringInput:n.stringInput,points:n.points,alias:n.alias,datasourceId:e.id}});return 0===n.length?this.$q.when({data:[]}):this.backendSrv.post("/api/tsdb/query",{from:t.range.from.valueOf().toString(),to:t.range.to.valueOf().toString(),queries:n}).then(function(t){var e=[];return t.results&&a.a.forEach(t.results,function(t){for(var n=0,r=t.series;n<r.length;n++){var a=r[n];e.push({target:a.name,datapoints:a.points})}}),{data:e}})},t.prototype.annotationQuery=function(t){return this.backendSrv.get("/api/annotations",{from:t.range.from.valueOf(),to:t.range.to.valueOf(),limit:t.limit,type:t.type})},t}()},1630:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n(4),a=n.n(r),i=n(1464),o=n(1),s=n.n(o),l=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(t){function e(e,n,r){var a=t.call(this,e,n)||this;return a.backendSrv=r,a.target.scenarioId=a.target.scenarioId||"random_walk",a.scenarioList=[],a.newPointTime=s()(),a.selectedPoint={text:"Select point",value:null},a}return l(e,t),e.$inject=["$scope","$injector","backendSrv"],e.prototype.getPoints=function(){return a.a.map(this.target.points,function(t,e){return{text:s()(t[1]).format("MMMM Do YYYY, H:mm:ss")+" : "+t[0],value:e}})},e.prototype.pointSelected=function(t){this.selectedPoint=t},e.prototype.deletePoint=function(){this.target.points.splice(this.selectedPoint.value,1),this.selectedPoint={text:"Select point",value:null},this.refresh()},e.prototype.addPoint=function(){this.target.points=this.target.points||[],this.target.points.push([this.newPointValue,this.newPointTime.valueOf()]),this.target.points=a.a.sortBy(this.target.points,function(t){return t[1]}),this.refresh()},e.prototype.$onInit=function(){var t=this;return this.backendSrv.get("/api/tsdb/testdata/scenarios").then(function(e){t.scenarioList=e,t.scenario=a.a.find(t.scenarioList,{id:t.target.scenarioId})})},e.prototype.scenarioChanged=function(){this.scenario=a.a.find(this.scenarioList,{id:this.target.scenarioId}),this.target.stringInput=this.scenario.stringInput,"manual_entry"===this.target.scenarioId?this.target.points=this.target.points||[]:delete this.target.points,this.refresh()},e.templateUrl="partials/query.editor.html",e}(i.QueryCtrl)},1631:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(511),i=n(513),o=n(521),s=n(1632),l=n(1633),u=n(230),c=function(t){function e(e){t.call(this,e),this.destination=e}return r(e,t),e}(i.Subscriber);e.SubjectSubscriber=c;var p=function(t){function e(){t.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return r(e,t),e.prototype[u.rxSubscriber]=function(){return new c(this)},e.prototype.lift=function(t){var e=new d(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new s.ObjectUnsubscribedError;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),a=0;a<n;a++)r[a].next(t)},e.prototype.error=function(t){if(this.closed)throw new s.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),a=0;a<n;a++)r[a].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new s.ObjectUnsubscribedError;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new s.ObjectUnsubscribedError;return this.hasError?(t.error(this.thrownError),o.Subscription.EMPTY):this.isStopped?(t.complete(),o.Subscription.EMPTY):(this.observers.push(t),new l.SubjectSubscription(this,t))},e.prototype.asObservable=function(){var t=new a.Observable;return t.source=this,t},e.create=function(t,e){return new d(t,e)},e}(a.Observable);e.Subject=p;var d=function(t){function e(e,n){t.call(this),this.destination=e,this.source=n}return r(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):o.Subscription.EMPTY},e}(p);e.AnonymousSubject=d},1632:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=function(t){function e(){var e=t.call(this,"object unsubscribed");this.name=e.name="ObjectUnsubscribedError",this.stack=e.stack,this.message=e.message}return r(e,t),e}(Error);e.ObjectUnsubscribedError=a},1633:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(521),i=function(t){function e(e,n){t.call(this),this.subject=e,this.subscriber=n,this.closed=!1}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(a.Subscription);e.SubjectSubscription=i},1634:function(t,e,n){"use strict";var r=n(511),a=n(1635);r.Observable.empty=a.empty},1635:function(t,e,n){"use strict";var r=n(1472);e.empty=r.EmptyObservable.create},1636:function(t,e,n){"use strict";var r=n(511),a=n(1637);r.Observable.from=a.from},1637:function(t,e,n){"use strict";var r=n(1638);e.from=r.FromObservable.create},1638:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(522),i=n(1495),o=n(1496),s=n(1639),l=n(1640),u=n(1497),c=n(1642),p=n(1473),d=n(511),h=n(1643),f=n(523),m=function(t){function e(e,n){t.call(this,null),this.ish=e,this.scheduler=n}return r(e,t),e.create=function(t,n){if(null!=t){if("function"==typeof t[f.observable])return t instanceof d.Observable&&!n?t:new e(t,n);if(a.isArray(t))return new u.ArrayObservable(t,n);if(o.isPromise(t))return new s.PromiseObservable(t,n);if("function"==typeof t[p.iterator]||"string"==typeof t)return new l.IteratorObservable(t,n);if(i.isArrayLike(t))return new c.ArrayLikeObservable(t,n)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")},e.prototype._subscribe=function(t){var e=this.ish,n=this.scheduler;return null==n?e[f.observable]().subscribe(t):e[f.observable]().subscribe(new h.ObserveOnSubscriber(t,n,0))},e}(d.Observable);e.FromObservable=m},1639:function(t,e,n){"use strict";function r(t){var e=t.value,n=t.subscriber;n.closed||(n.next(e),n.complete())}function a(t){var e=t.err,n=t.subscriber;n.closed||n.error(e)}var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},o=n(145),s=n(511),l=function(t){function e(e,n){t.call(this),this.promise=e,this.scheduler=n}return i(e,t),e.create=function(t,n){return new e(t,n)},e.prototype._subscribe=function(t){var e=this,n=this.promise,i=this.scheduler;if(null==i)this._isScalar?t.closed||(t.next(this.value),t.complete()):n.then(function(n){e.value=n,e._isScalar=!0,t.closed||(t.next(n),t.complete())},function(e){t.closed||t.error(e)}).then(null,function(t){o.root.setTimeout(function(){throw t})});else if(this._isScalar){if(!t.closed)return i.schedule(r,0,{value:this.value,subscriber:t})}else n.then(function(n){e.value=n,e._isScalar=!0,t.closed||t.add(i.schedule(r,0,{value:n,subscriber:t}))},function(e){t.closed||t.add(i.schedule(a,0,{err:e,subscriber:t}))}).then(null,function(t){o.root.setTimeout(function(){throw t})})},e}(s.Observable);e.PromiseObservable=l},1640:function(t,e,n){"use strict";function r(t){var e=t[c.iterator];if(!e&&"string"==typeof t)return new d(t);if(!e&&void 0!==t.length)return new h(t);if(!e)throw new TypeError("object is not iterable");return t[c.iterator]()}function a(t){var e=+t.length;return isNaN(e)?0:0!==e&&i(e)?(e=o(e)*Math.floor(Math.abs(e)),e<=0?0:e>f?f:e):e}function i(t){return"number"==typeof t&&l.root.isFinite(t)}function o(t){var e=+t;return 0===e?e:isNaN(e)?e:e<0?-1:1}var s=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},l=n(145),u=n(511),c=n(1473),p=function(t){function e(e,n){if(t.call(this),this.scheduler=n,null==e)throw new Error("iterator cannot be null.");this.iterator=r(e)}return s(e,t),e.create=function(t,n){return new e(t,n)},e.dispatch=function(t){var e=t.index,n=t.hasError,r=t.iterator,a=t.subscriber;if(n)return void a.error(t.error);var i=r.next();return i.done?void a.complete():(a.next(i.value),t.index=e+1,a.closed?void("function"==typeof r.return&&r.return()):void this.schedule(t))},e.prototype._subscribe=function(t){var n=this,r=n.iterator,a=n.scheduler;if(a)return a.schedule(e.dispatch,0,{index:0,iterator:r,subscriber:t});for(;;){var i=r.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed){"function"==typeof r.return&&r.return();break}}},e}(u.Observable);e.IteratorObservable=p;var d=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.length),this.str=t,this.idx=e,this.len=n}return t.prototype[c.iterator]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},t}(),h=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=a(t)),this.arr=t,this.idx=e,this.len=n}return t.prototype[c.iterator]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},t}(),f=Math.pow(2,53)-1},1641:function(t,e,n){"use strict";function r(t){return t&&"function"==typeof t.schedule}e.isScheduler=r},1642:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(511),i=n(1498),o=n(1472),s=function(t){function e(e,n){t.call(this),this.arrayLike=e,this.scheduler=n,n||1!==e.length||(this._isScalar=!0,this.value=e[0])}return r(e,t),e.create=function(t,n){var r=t.length;return 0===r?new o.EmptyObservable:1===r?new i.ScalarObservable(t[0],n):new e(t,n)},e.dispatch=function(t){var e=t.arrayLike,n=t.index,r=t.length,a=t.subscriber;if(!a.closed){if(n>=r)return void a.complete();a.next(e[n]),t.index=n+1,this.schedule(t)}},e.prototype._subscribe=function(t){var n=this,r=n.arrayLike,a=n.scheduler,i=r.length;if(a)return a.schedule(e.dispatch,0,{arrayLike:r,index:0,length:i,subscriber:t});for(var o=0;o<i&&!t.closed;o++)t.next(r[o]);t.complete()},e}(a.Observable);e.ArrayLikeObservable=s},1643:function(t,e,n){"use strict";function r(t,e){return void 0===e&&(e=0),function(n){return n.lift(new s(t,e))}}var a=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(513),o=n(1644);e.observeOn=r;var s=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.scheduler,this.delay))},t}();e.ObserveOnOperator=s;var l=function(t){function e(e,n,r){void 0===r&&(r=0),t.call(this,e),this.scheduler=n,this.delay=r}return a(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.add(this.scheduler.schedule(e.dispatch,this.delay,new u(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(o.Notification.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(o.Notification.createError(t))},e.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete())},e}(i.Subscriber);e.ObserveOnSubscriber=l;var u=function(){function t(t,e){this.notification=t,this.destination=e}return t}();e.ObserveOnMessage=u},1644:function(t,e,n){"use strict";var r=n(511),a=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return r.Observable.of(this.value);case"E":return r.Observable.throw(this.error);case"C":return r.Observable.empty()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();e.Notification=a},1645:function(t,e,n){"use strict";var r=n(511),a=n(1646);r.Observable.prototype.map=a.map},1646:function(t,e,n){"use strict";function r(t,e){return a.map(t,e)(this)}var a=n(1647);e.map=r},1647:function(t,e,n){"use strict";function r(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(t,e))}}var a=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(513);e.map=r;var o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.project,this.thisArg))},t}();e.MapOperator=o;var s=function(t){function e(e,n,r){t.call(this,e),this.project=n,this.count=0,this.thisArg=r||this}return a(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(i.Subscriber)},1648:function(t,e,n){"use strict";var r=n(511),a=n(1649);r.Observable.prototype.combineAll=a.combineAll},1649:function(t,e,n){"use strict";function r(t){return a.combineAll(t)(this)}var a=n(1650);e.combineAll=r},1650:function(t,e,n){"use strict";function r(t){return function(e){return e.lift(new a.CombineLatestOperator(t))}}var a=n(1651);e.combineAll=r},1651:function(t,e,n){"use strict";function r(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=null;return"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&o.isArray(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(new i.ArrayObservable([e].concat(t)),new c(n))}}var a=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},i=n(1497),o=n(522),s=n(1652),l=n(1653),u={};e.combineLatest=r;var c=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new p(t,this.project))},t}();e.CombineLatestOperator=c;var p=function(t){function e(e,n){t.call(this,e),this.project=n,this.active=0,this.values=[],this.observables=[]}return a(e,t),e.prototype._next=function(t){this.values.push(u),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var r=t[n];this.add(l.subscribeToResult(this,r,r,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n,r,a){var i=this.values,o=i[n],s=this.toRespond?o===u?--this.toRespond:this.toRespond:0;i[n]=e,0===s&&(this.project?this._tryProject(i):this.destination.next(i.slice()))},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(s.OuterSubscriber);e.CombineLatestSubscriber=p},1652:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(513),i=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.notifyNext=function(t,e,n,r,a){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(a.Subscriber);e.OuterSubscriber=i},1653:function(t,e,n){"use strict";function r(t,e,n,r){var d=new c.InnerSubscriber(t,n,r);if(d.closed)return null;if(e instanceof l.Observable)return e._isScalar?(d.next(e.value),d.complete(),null):(d.syncErrorThrowable=!0,e.subscribe(d));if(i.isArrayLike(e)){for(var h=0,f=e.length;h<f&&!d.closed;h++)d.next(e[h]);d.closed||d.complete()}else{if(o.isPromise(e))return e.then(function(t){d.closed||(d.next(t),d.complete())},function(t){return d.error(t)}).then(null,function(t){a.root.setTimeout(function(){throw t})}),d;if(e&&"function"==typeof e[u.iterator])for(var m=e[u.iterator]();;){var g=m.next();if(g.done){d.complete();break}if(d.next(g.value),d.closed)break}else if(e&&"function"==typeof e[p.observable]){var v=e[p.observable]();if("function"==typeof v.subscribe)return v.subscribe(new c.InnerSubscriber(t,n,r));d.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var y=s.isObject(e)?"an invalid object":"'"+e+"'",b="You provided "+y+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";d.error(new TypeError(b))}}return null}var a=n(145),i=n(1495),o=n(1496),s=n(527),l=n(511),u=n(1473),c=n(1654),p=n(523);e.subscribeToResult=r},1654:function(t,e,n){"use strict";var r=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=n(513),i=function(t){function e(e,n,r){t.call(this),this.parent=e,this.outerValue=n,this.outerIndex=r,this.index=0}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(a.Subscriber);e.InnerSubscriber=i},1655:function(t,e){!function(t){function e(e){function i(e,n,r){k||(k=!0,y=e.getCanvas(),b=t(y).parent(),a=e.getOptions(),e.setData(o(e.getData())))}function o(e){for(var n=0,r=0,i=0,o=a.series.pie.combine.color,s=[],l=0;l<e.length;++l){var u=e[l].data;t.isArray(u)&&1==u.length&&(u=u[0]),t.isArray(u)?!isNaN(parseFloat(u[1]))&&isFinite(u[1])?u[1]=+u[1]:u[1]=0:u=!isNaN(parseFloat(u))&&isFinite(u)?[1,+u]:[1,0],e[l].data=[u]}for(var l=0;l<e.length;++l)n+=e[l].data[0][1];for(var l=0;l<e.length;++l){var u=e[l].data[0][1];u/n<=a.series.pie.combine.threshold&&(r+=u,i++,o||(o=e[l].color))}for(var l=0;l<e.length;++l){var u=e[l].data[0][1];(i<2||u/n>a.series.pie.combine.threshold)&&s.push({data:[[1,u]],color:e[l].color,label:e[l].label,angle:u*Math.PI*2/n,percent:u/(n/100)})}return i>1&&s.push({data:[[1,r]],color:o,label:a.series.pie.combine.label,angle:r*Math.PI*2/n,percent:r/(n/100)}),s}function s(e,i){function o(){_.clearRect(0,0,s,u),b.children().filter(".pieLabel, .pieLabelBackground").remove()}if(b){var s=e.getPlaceholder().width(),u=e.getPlaceholder().height(),c=b.children().filter(".legend").children().width()||0;_=i,k=!1,x=Math.min(s,u/a.series.pie.tilt)/2,w=u/2+a.series.pie.offset.top,S=s/2,"auto"==a.series.pie.offset.left?a.legend.position.match("w")?S+=c/2:S-=c/2:S+=a.series.pie.offset.left,S<x?S=x:S>s-x&&(S=s-x);var p=e.getData(),d=0;do{d>0&&(x*=r),d+=1,o(),a.series.pie.tilt<=.8&&function(){var t=a.series.pie.shadow.left,e=a.series.pie.shadow.top,n=a.series.pie.shadow.alpha,r=a.series.pie.radius>1?a.series.pie.radius:x*a.series.pie.radius;if(!(r>=s/2-t||r*a.series.pie.tilt>=u/2-e||r<=10)){_.save(),_.translate(t,e),_.globalAlpha=n,_.fillStyle="#000",_.translate(S,w),_.scale(1,a.series.pie.tilt);for(var i=1;i<=10;i++)_.beginPath(),_.arc(0,0,r,0,2*Math.PI,!1),_.fill(),r-=i;_.restore()}}()}while(!function(){function e(t,e,n){t<=0||isNaN(t)||(n?_.fillStyle=e:(_.strokeStyle=e,_.lineJoin="round"),_.beginPath(),Math.abs(t-2*Math.PI)>1e-9&&_.moveTo(0,0),_.arc(0,0,r,i,i+t/2,!1),_.arc(0,0,r,i+t/2,i+t,!1),_.closePath(),i+=t,n?_.fill():_.stroke())}var n=Math.PI*a.series.pie.startAngle,r=a.series.pie.radius>1?a.series.pie.radius:x*a.series.pie.radius;_.save(),_.translate(S,w),_.scale(1,a.series.pie.tilt),_.save();for(var i=n,o=0;o<p.length;++o)p[o].startAngle=i,e(p[o].angle,p[o].color,!0);if(_.restore(),a.series.pie.stroke.width>0){_.save(),_.lineWidth=a.series.pie.stroke.width,i=n;for(var o=0;o<p.length;++o)e(p[o].angle,a.series.pie.stroke.color,!1);_.restore()}return l(_),_.restore(),!a.series.pie.label.show||function(){for(var e=n,r=a.series.pie.label.radius>1?a.series.pie.label.radius:x*a.series.pie.label.radius,i=0;i<p.length;++i){if(p[i].percent>=100*a.series.pie.label.threshold&&!function(e,n,i){if(0==e.data[0][1])return!0;var o,l=a.legend.labelFormatter,c=a.series.pie.label.formatter;o=l?l(e.label,e):e.label,c&&(o=c(o,e));var p=(n+e.angle+n)/2,d=S+Math.round(Math.cos(p)*r),h=w+Math.round(Math.sin(p)*r)*a.series.pie.tilt,f="<span class='pieLabel' id='pieLabel"+i+"' style='position:absolute;top:"+h+"px;left:"+d+"px;'>"+o+"</span>";b.append(f);var m=b.children("#pieLabel"+i),g=h-m.height()/2,v=d-m.width()/2;if(m.css("top",g),m.css("left",v),0-g>0||0-v>0||u-(g+m.height())<0||s-(v+m.width())<0)return!1;if(0!=a.series.pie.label.background.opacity){var y=a.series.pie.label.background.color;null==y&&(y=e.color);var x="top:"+g+"px;left:"+v+"px;";t("<div class='pieLabelBackground' style='position:absolute;width:"+m.width()+"px;height:"+m.height()+"px;"+x+"background-color:"+y+";'></div>").css("opacity",a.series.pie.label.background.opacity).insertBefore(m)}return!0}(p[i],e,i))return!1;e+=p[i].angle}return!0}()}()&&d<n);d>=n&&(o(),b.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(p),e.insertLegend())}}function l(t){if(a.series.pie.innerRadius>0){t.save();var e=a.series.pie.innerRadius>1?a.series.pie.innerRadius:x*a.series.pie.innerRadius;t.globalCompositeOperation="destination-out",t.beginPath(),t.fillStyle=a.series.pie.stroke.color,t.arc(0,0,e,0,2*Math.PI,!1),t.fill(),t.closePath(),t.restore(),t.save(),t.beginPath(),t.strokeStyle=a.series.pie.stroke.color,t.arc(0,0,e,0,2*Math.PI,!1),t.stroke(),t.closePath(),t.restore()}}function u(t,e){for(var n=!1,r=-1,a=t.length,i=a-1;++r<a;i=r)(t[r][1]<=e[1]&&e[1]<t[i][1]||t[i][1]<=e[1]&&e[1]<t[r][1])&&e[0]<(t[i][0]-t[r][0])*(e[1]-t[r][1])/(t[i][1]-t[r][1])+t[r][0]&&(n=!n);return n}function c(t,n){for(var r,a,i=e.getData(),o=e.getOptions(),s=o.series.pie.radius>1?o.series.pie.radius:x*o.series.pie.radius,l=0;l<i.length;++l){var c=i[l];if(c.pie.show){if(_.save(),_.beginPath(),_.moveTo(0,0),_.arc(0,0,s,c.startAngle,c.startAngle+c.angle/2,!1),_.arc(0,0,s,c.startAngle+c.angle/2,c.startAngle+c.angle,!1),_.closePath(),r=t-S,a=n-w,_.isPointInPath){if(_.isPointInPath(t-S,n-w))return _.restore(),{datapoint:[c.percent,c.data],dataIndex:0,series:c,seriesIndex:l}}else{if(u([[0,0],[s*Math.cos(c.startAngle),s*Math.sin(c.startAngle)],[s*Math.cos(c.startAngle+c.angle/4),s*Math.sin(c.startAngle+c.angle/4)],[s*Math.cos(c.startAngle+c.angle/2),s*Math.sin(c.startAngle+c.angle/2)],[s*Math.cos(c.startAngle+c.angle/1.5),s*Math.sin(c.startAngle+c.angle/1.5)],[s*Math.cos(c.startAngle+c.angle),s*Math.sin(c.startAngle+c.angle)]],[r,a]))return _.restore(),{datapoint:[c.percent,c.data],dataIndex:0,series:c,seriesIndex:l}}_.restore()}}return null}function p(t){h("plothover",t)}function d(t){h("plotclick",t)}function h(t,n){var r=e.offset(),i=parseInt(n.pageX-r.left),o=parseInt(n.pageY-r.top),s=c(i,o);if(a.grid.autoHighlight)for(var l=0;l<C.length;++l){var u=C[l];u.auto!=t||s&&u.series==s.series||m(u.series)}s&&f(s.series,t);var p={pageX:n.pageX,pageY:n.pageY};b.trigger(t,[p,s])}function f(t,n){var r=g(t);-1==r?(C.push({series:t,auto:n}),e.triggerRedrawOverlay()):n||(C[r].auto=!1)}function m(t){null==t&&(C=[],e.triggerRedrawOverlay());var n=g(t);-1!=n&&(C.splice(n,1),e.triggerRedrawOverlay())}function g(t){for(var e=0;e<C.length;++e){if(C[e].series==t)return e}return-1}function v(t,e){var n=t.getOptions(),r=n.series.pie.radius>1?n.series.pie.radius:x*n.series.pie.radius;e.save(),e.translate(S,w),e.scale(1,n.series.pie.tilt);for(var a=0;a<C.length;++a)!function(t){t.angle<=0||isNaN(t.angle)||(e.fillStyle="rgba(255, 255, 255, "+n.series.pie.highlight.opacity+")",e.beginPath(),Math.abs(t.angle-2*Math.PI)>1e-9&&e.moveTo(0,0),e.arc(0,0,r,t.startAngle,t.startAngle+t.angle/2,!1),e.arc(0,0,r,t.startAngle+t.angle/2,t.startAngle+t.angle,!1),e.closePath(),e.fill())}(C[a].series);l(e),e.restore()}var y=null,b=null,x=null,S=null,w=null,k=!1,_=null,C=[];e.hooks.processOptions.push(function(t,e){e.series.pie.show&&(e.grid.show=!1,"auto"==e.series.pie.label.show&&(e.legend.show?e.series.pie.label.show=!1:e.series.pie.label.show=!0),"auto"==e.series.pie.radius&&(e.series.pie.label.show?e.series.pie.radius=.75:e.series.pie.radius=1),e.series.pie.tilt>1?e.series.pie.tilt=1:e.series.pie.tilt<0&&(e.series.pie.tilt=0))}),e.hooks.bindEvents.push(function(t,e){var n=t.getOptions();n.series.pie.show&&(n.grid.hoverable&&e.unbind("mousemove").mousemove(p),n.grid.clickable&&e.unbind("click").click(d))}),e.hooks.processDatapoints.push(function(t,e,n,r){t.getOptions().series.pie.show&&i(t,e,n)}),e.hooks.drawOverlay.push(function(t,e){t.getOptions().series.pie.show&&v(t,e)}),e.hooks.draw.push(function(t,e){t.getOptions().series.pie.show&&s(t,e)})}var n=10,r=.95,a={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(t,e){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+e.color+";'>"+t+"<br/>"+Math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};t.plot.plugins.push({init:e,options:a,name:"pie",version:"1.1"})}(jQuery)},1656:function(t,e,n){"use strict";function r(t,e,n,r,a,o){function h(t){if(t.template)return r.when(t.template);var e=o.get(t.templateUrl);return e?r.when(e):a.get(t.templateUrl).then(function(t){return t.data})}function f(t,e){if(t)return 0===t.indexOf("public")?t:e+"/"+t}function m(t){return t.Component.templateUrl=f(t.Component.templateUrl,t.baseUrl),function(){return{templateUrl:t.Component.templateUrl,template:t.Component.template,restrict:"E",controller:t.Component,controllerAs:"ctrl",bindToController:!0,scope:t.bindings,link:function(t,e,n,r){r.link&&r.link(t,e,n,r),r.init&&r.init()}}}}function g(t,e){if("row"===t.panel.type)return r.when({name:"dashboard-row",bindings:{dashboard:"=",panel:"="},attrs:{dashboard:"ctrl.dashboard",panel:"panel"},Component:d.a});var n={name:"panel-plugin-"+t.panel.type,bindings:{dashboard:"=",panel:"=",row:"="},attrs:{dashboard:"dashboard",panel:"panel",class:"panel-height-helper"}},a=l.a.panels[t.panel.type],i=Promise.resolve(p.a);return a&&(i=Object(c.a)(a.module).then(function(t){return t.PanelCtrl})),i.then(function(t){return n.Component=t,!t||t.registered?n:t.templatePromise?t.templatePromise.then(function(t){return n}):(a&&(t.templateUrl=f(t.templateUrl,a.baseUrl)),t.templatePromise=h(t).then(function(e){return t.templateUrl=null,t.template='<grafana-panel ctrl="ctrl" class="panel-height-helper">'+e+"</grafana-panel>",n}),t.templatePromise)})}function v(t,n){switch(n.type){case"query-ctrl":var a=t.target.datasource||t.ctrl.panel.datasource;return e.get(a).then(function(e){return t.datasource=e,Object(c.a)(e.meta.module).then(function(t){return{baseUrl:e.meta.baseUrl,name:"query-ctrl-"+e.meta.id,bindings:{target:"=",panelCtrl:"=",datasource:"="},attrs:{target:"target","panel-ctrl":"ctrl.panelCtrl",datasource:"datasource"},Component:t.QueryCtrl}})});case"query-options-ctrl":return e.get(t.ctrl.panel.datasource).then(function(t){return Object(c.a)(t.meta.module).then(function(e){return e.QueryOptionsCtrl?{baseUrl:t.meta.baseUrl,name:"query-options-ctrl-"+t.meta.id,bindings:{panelCtrl:"="},attrs:{"panel-ctrl":"ctrl.panelCtrl"},Component:e.QueryOptionsCtrl}:{notFound:!0}})});case"annotations-query-ctrl":return Object(c.a)(t.ctrl.currentDatasource.meta.module).then(function(e){return{baseUrl:t.ctrl.currentDatasource.meta.baseUrl,name:"annotations-query-ctrl-"+t.ctrl.currentDatasource.meta.id,bindings:{annotation:"=",datasource:"="},attrs:{annotation:"ctrl.currentAnnotation",datasource:"ctrl.currentDatasource"},Component:e.AnnotationsQueryCtrl}});case"datasource-config-ctrl":var i=t.ctrl.datasourceMeta;return Object(c.a)(i.module).then(function(t){return t.ConfigCtrl?{baseUrl:i.baseUrl,name:"ds-config-"+i.id,bindings:{meta:"=",current:"="},attrs:{meta:"ctrl.datasourceMeta",current:"ctrl.current"},Component:t.ConfigCtrl}:{notFound:!0}});case"app-config-ctrl":var o=t.ctrl.model;return Object(c.a)(o.module).then(function(t){return{baseUrl:o.baseUrl,name:"app-config-"+o.id,bindings:{appModel:"=",appEditCtrl:"="},attrs:{"app-model":"ctrl.model","app-edit-ctrl":"ctrl"},Component:t.ConfigCtrl}});case"app-page":var s=t.ctrl.appModel;return Object(c.a)(s.module).then(function(e){return{baseUrl:s.baseUrl,name:"app-page-"+s.id+"-"+t.ctrl.page.slug,bindings:{appModel:"="},attrs:{"app-model":"ctrl.appModel"},Component:e[t.ctrl.page.component]}});case"panel":return g(t,n);default:return r.reject({message:"Could not find component type: "+n.type})}}function y(e,n,r){var a=i.a.element(document.createElement(r.name));s.a.each(r.attrs,function(t,e){a.attr(e,t)}),t(a)(e),n.empty(),setTimeout(function(){n.append(a),e.$applyAsync(function(){e.$broadcast("component-did-mount"),e.$broadcast("refresh")})})}function b(t,e,n,r){if(r.notFound)return void e.empty();if(!r.Component)throw{message:"Failed to find exported plugin component for "+r.name};if(!r.Component.registered){var a=n.$normalize(r.name),i=m(r);u.a.directive(a,i),r.Component.registered=!0}y(t,e,r)}return{restrict:"E",link:function(t,e,r){v(t,r).then(function(n){b(t,e,r,n)}).catch(function(t){n.appEvent("alert-error",["Plugin Error",t.message||t]),console.log("Plugin component error",t)})}}}r.$inject=["$compile","datasourceSrv","$rootScope","$q","$http","$templateCache"];var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=n(22),u=n(3),c=n(1470),p=n(1657),d=n(1658);u.a.directive("pluginComponent",r)},1657:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(1468),a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(t){function e(e,n){return t.call(this,e,n)||this}return a(e,t),e.$inject=["$scope","$injector"],e.templateUrl="public/app/plugins/panel/unknown/module.html",e}(r.a)},1658:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(4),a=n.n(r),i=function(){function t(){this.panel.hiddenPanels=this.panel.hiddenPanels||[]}return t.prototype.toggle=function(){if(this.panel.collapse){for(var t=a.a.indexOf(this.dashboard.panels,this.panel),e=0,n=this.panel.hiddenPanels;e<n.length;e++){var r=n[e];this.dashboard.panels.splice(t+1,0,r),r.y=this.panel.y+1,console.log("restoring child",r)}return this.panel.hiddenPanels=[],void(this.panel.collapse=!1)}this.panel.collapse=!0;for(var i=!1,o=0;o<this.dashboard.panels.length;o++){var s=this.dashboard.panels[o];if(s!==this.panel){if(i){if("row"===s.type)break;this.panel.hiddenPanels.push(s),console.log("hiding child",s.id)}}else console.log("found row"),i=!0}for(var l=0,u=this.panel.hiddenPanels;l<u.length;l++){var c=u[l];this.dashboard.removePanel(c,!1)}},t.prototype.moveUp=function(){},t.prototype.link=function(t,e){var n=this;e.addClass("dashboard-row"),t.$watch("ctrl.panel.collapse",function(){e.toggleClass("dashboard-row--collapse",!0===n.panel.collapse)})},t.template='\n    <div class="dashboard-row__center">\n      <div class="dashboard-row__actions-left">\n        <i class="fa fa-chevron-down" ng-hide="ctrl.panel.collapse"></i>\n        <i class="fa fa-chevron-right" ng-show="ctrl.panel.collapse"></i>\n      </div>\n      <a class="dashboard-row__title pointer" ng-click="ctrl.toggle()">\n        <span class="dashboard-row__title-text">\n          {{ctrl.panel.title | interpolateTemplateVars:this}}\n        </span>\n      </a>\n      <div class="dashboard-row__actions-right">\n        <a class="pointer" ng-click="ctrl.openSettings()"><span class="fa fa-cog"></i></a>\n      </div>\n    </div>\n\n  <div class="dashboard-row__panel_count">\n    ({{ctrl.panel.hiddenPanels.length}} hidden panels)\n  </div>\n  <div class="dashboard-row__drag grid-drag-handle">\n  </div>\n  ',t}()},1659:function(t,e,n){"use strict";var r=(n(1660),n(1661),n(1662),n(1664),n(1665),n(1666),n(1667),n(1668),n(1669),n(1670),n(1671),n(1672),n(1673),n(1674),n(1675),n(1676),n(1678),n(1679),n(1681),n(1682),n(1684),n(1685),n(1686),n(1687),n(1693),n(1694),n(1695),n(1696),n(1697),n(3)),a=n(1698),i=n(1699),o=n(1700),s=n(1701),l=n(1702);r.a.controller("DashboardListCtrl",a.a),r.a.controller("FolderDashboardsCtrl",i.a),r.a.controller("FolderSettingsCtrl",o.a),r.a.controller("DashboardImportCtrl",s.a),r.a.controller("CreateFolderCtrl",l.a)},1660:function(t,e,n){"use strict";var r=n(22),a=n(3),i=function(){function t(t,e,n,r,a,i,o,s,l,u,c){this.$scope=t,this.$rootScope=e,this.keybindingSrv=n,this.timeSrv=r,this.variableSrv=a,this.alertingSrv=i,this.dashboardSrv=o,this.unsavedChangesSrv=s,this.dashboardViewStateSrv=l,this.playlistSrv=u,this.panelLoader=c,t.ctrl=this,this.editTab=0,this.getPanelContainer=this.getPanelContainer.bind(this)}return t.$inject=["$scope","$rootScope","keybindingSrv","timeSrv","variableSrv","alertingSrv","dashboardSrv","unsavedChangesSrv","dashboardViewStateSrv","playlistSrv","panelLoader"],t.prototype.setupDashboard=function(t){try{this.setupDashboardInternal(t)}catch(t){this.onInitFailed(t,"Dashboard init failed",!0)}},t.prototype.setupDashboardInternal=function(t){var e=this,n=this.dashboardSrv.create(t.dashboard,t.meta);this.dashboardSrv.setCurrent(n),this.timeSrv.init(n),this.alertingSrv.init(n,t.alerts),this.variableSrv.init(n).catch(this.onInitFailed.bind(this,"Templating init failed",!1)).finally(function(){e.dashboard=n,e.dashboard.processRepeats(),e.unsavedChangesSrv.init(n,e.$scope),e.$scope.dashboard=n,e.dashboardViewState=e.dashboardViewStateSrv.create(e.$scope),e.keybindingSrv.setupDashboardBindings(e.$scope,n),e.dashboard.updateSubmenuVisibility(),e.setWindowTitleAndTheme(),e.$scope.appEvent("dashboard-initialized",n)}).catch(this.onInitFailed.bind(this,"Dashboard init failed",!0))},t.prototype.onInitFailed=function(t,e,n){console.log(t,n),n.data&&n.data.message?n.message=n.data.message:n.message||(n={message:n.toString()}),this.$scope.appEvent("alert-error",[t,n.message]),e&&!this.loadedFallbackDashboard&&(this.loadedFallbackDashboard=!0,this.setupDashboard({dashboard:{title:"Dashboard Init failed"}}))},t.prototype.templateVariableUpdated=function(){this.dashboard.processRepeats()},t.prototype.setWindowTitleAndTheme=function(){window.document.title=r.a.window_title_prefix+this.dashboard.title},t.prototype.showJsonEditor=function(t,e){var n=this.$rootScope.$new();n.object=e.object,n.updateHandler=e.updateHandler,this.$scope.appEvent("show-dash-editor",{src:"public/app/partials/edit_json.html",scope:n})},t.prototype.getDashboard=function(){return this.dashboard},t.prototype.getPanelLoader=function(){return this.panelLoader},t.prototype.timezoneChanged=function(){this.$rootScope.$broadcast("refresh")},t.prototype.getPanelContainer=function(){return this},t.prototype.onRemovingPanel=function(t,e){if(e=e||{},e.panelId){var n=this.dashboard.getPanelInfoById(e.panelId);this.removePanel(n.panel,!0)}},t.prototype.removePanel=function(t,e){var n=this;if(!1!==e){var r,a;return t.alert&&(r="Panel includes an alert rule, removing panel will also remove alert rule",a="YES"),void this.$scope.appEvent("confirm-modal",{title:"Remove Panel",text:"Are you sure you want to remove this panel?",text2:r,icon:"fa-trash",confirmText:a,yesText:"Remove",onConfirm:function(){n.removePanel(t,!1)}})}this.dashboard.removePanel(t)},t.prototype.init=function(t){this.$scope.onAppEvent("show-json-editor",this.showJsonEditor.bind(this)),this.$scope.onAppEvent("template-variable-value-updated",this.templateVariableUpdated.bind(this)),this.$scope.onAppEvent("panel-remove",this.onRemovingPanel.bind(this)),this.setupDashboard(t)},t}();a.a.controller("DashboardCtrl",i)},1661:function(t,e,n){"use strict";var r=n(3),a=function(){function t(){}return t.prototype.init=function(t,e){this.dashboard=t,this.alerts=e||[]},t}();r.a.service("alertingSrv",a)},1662:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/history/history.html",controller:p,bindToController:!0,controllerAs:"ctrl",scope:{dashboard:"="}}}var a=(n(1663),n(4)),i=n.n(a),o=n(21),s=n.n(o),l=n(1),u=n.n(l),c=n(226),p=function(){function t(t,e,n,r,a,i){this.$route=t,this.$rootScope=e,this.$location=n,this.$q=r,this.historySrv=a,this.$scope=i,this.appending=!1,this.diff="basic",this.limit=10,this.loading=!1,this.max=2,this.mode="list",this.start=0,this.canCompare=!1,this.$rootScope.onAppEvent("dashboard-saved",this.onDashboardSaved.bind(this),i),this.resetFromSource()}return t.$inject=["$route","$rootScope","$location","$q","historySrv","$scope"],t.prototype.onDashboardSaved=function(){this.resetFromSource()},t.prototype.switchMode=function(t){this.mode=t,"list"===this.mode&&this.reset()},t.prototype.dismiss=function(){this.$rootScope.appEvent("hide-dash-editor")},t.prototype.addToLog=function(){this.start=this.start+this.limit,this.getLog(!0)},t.prototype.revisionSelectionChanged=function(){var t=i.a.filter(this.revisions,{checked:!0}).length;this.canCompare=2===t},t.prototype.formatDate=function(t){return this.dashboard.formatDate(t)},t.prototype.formatBasicDate=function(t){var e="browser"===this.dashboard.timezone?u()():u.a.utc();return("browser"===this.dashboard.timezone?u()(t):u.a.utc(t)).from(e)},t.prototype.getDiff=function(t){var e=this;if(this.diff=t,this.mode="compare",this.delta[this.diff])return this.$q.when(this.delta[this.diff]);var n=i.a.filter(this.revisions,{checked:!0});this.newInfo=n[0],this.baseInfo=n[1],this.isNewLatest=this.newInfo.version===this.dashboard.version,this.loading=!0;var r={new:{dashboardId:this.dashboard.id,version:this.newInfo.version},base:{dashboardId:this.dashboard.id,version:this.baseInfo.version},diffType:t};return this.historySrv.calculateDiff(r).then(function(t){e.delta[e.diff]=t}).catch(function(){e.mode="list"}).finally(function(){e.loading=!1})},t.prototype.getLog=function(t){var e=this;void 0===t&&(t=!1),this.loading=!t,this.appending=t;var n={limit:this.limit,start:this.start};return this.historySrv.getHistoryList(this.dashboard,n).then(function(n){for(var r=0,a=n;r<a.length;r++){var i=a[r];i.createdDateString=e.formatDate(i.created),i.ageString=e.formatBasicDate(i.created),i.checked=!1}e.revisions=t?e.revisions.concat(n):n}).catch(function(t){e.loading=!1}).finally(function(){e.loading=!1,e.appending=!1})},t.prototype.isLastPage=function(){return i.a.find(this.revisions,function(t){return 1===t.version})},t.prototype.reset=function(){this.delta={basic:"",json:""},this.diff="basic",this.mode="list",this.revisions=i.a.map(this.revisions,function(t){return i.a.extend({},t,{checked:!1})}),this.canCompare=!1,this.start=0,this.isNewLatest=!1},t.prototype.resetFromSource=function(){return this.revisions=[],this.getLog().then(this.reset.bind(this))},t.prototype.restore=function(t){this.$rootScope.appEvent("confirm-modal",{title:"Restore version",text:"",text2:"Are you sure you want to restore the dashboard to version "+t+"? All unsaved changes will be lost.",icon:"fa-history",yesText:"Yes, restore to version "+t,onConfirm:this.restoreConfirm.bind(this,t)})},t.prototype.restoreConfirm=function(t){var e=this;return this.loading=!0,this.historySrv.restoreDashboard(this.dashboard,t).then(function(n){e.$location.url(c.a.stripBaseFromUrl(n.url)).replace(),e.$route.reload(),e.$rootScope.appEvent("alert-success",["Dashboard restored","Restored from version "+t])}).catch(function(){e.mode="list",e.loading=!1})},t}();s.a.module("grafana.directives").directive("gfDashboardHistory",r)},1663:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(3),o=function(){function t(t,e){this.backendSrv=t,this.$q=e}return t.$inject=["backendSrv","$q"],t.prototype.getHistoryList=function(t,e){var n=t&&t.id?t.id:void 0;return n?this.backendSrv.get("api/dashboards/id/"+n+"/versions",e):this.$q.when([])},t.prototype.calculateDiff=function(t){return this.backendSrv.post("api/dashboards/calculate-diff",t)},t.prototype.restoreDashboard=function(t,e){var n=t&&t.id?t.id:void 0,r="api/dashboards/id/"+n+"/restore";return n&&a.a.isNumber(e)?this.backendSrv.post(r,{version:e}):this.$q.when({})},t}();i.a.service("historySrv",o)},1664:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(1),o=n.n(i),s=n(4),l=n.n(s),u=n(16),c=n.n(u),p=n(224),d=n(512),h=n(517),f=function(){function t(t,e,n,r,a,i,o,s,l){this.backendSrv=t,this.dashboardSrv=e,this.datasourceSrv=n,this.$http=r,this.$q=a,this.$timeout=i,this.$routeParams=s,this.$rootScope=l}return t.$inject=["backendSrv","dashboardSrv","datasourceSrv","$http","$q","$timeout","contextSrv","$routeParams","$rootScope"],t.prototype._dashboardLoadFailed=function(t,e){return e=e||!1,{meta:{canStar:!1,isSnapshot:e,canDelete:!1,canSave:!1,canEdit:!1,dashboardNotFound:!0},dashboard:{title:t}}},t.prototype.loadDashboard=function(t,e,n){var r,a=this;return r="script"===t?this._loadScriptedDashboard(e):"snapshot"===t?this.backendSrv.get("/api/snapshots/"+e).catch(function(){return a._dashboardLoadFailed("Snapshot not found",!0)}):this.backendSrv.getDashboardByUid(n).then(function(t){if(t.meta.isFolder)throw a.$rootScope.appEvent("alert-error",["Dashboard not found"]),new Error("Dashboard not found");return t}).catch(function(){return a._dashboardLoadFailed("Not found",!0)}),r.then(function(t){return!0!==t.meta.dashboardNotFound&&h.a.addDashboardImpression(t.dashboard.id),t}),r},t.prototype._loadScriptedDashboard=function(t){var e=this,n="public/dashboards/"+t.replace(/\.(?!js)/,"/")+"?"+(new Date).getTime();return this.$http({url:n,method:"GET"}).then(this._executeScript.bind(this)).then(function(t){return{meta:{fromScript:!0,canDelete:!1,canSave:!1,canStar:!1},dashboard:t.data}},function(t){return console.log("Script dashboard error "+t),e.$rootScope.appEvent("alert-error",["Script Error","Please make sure it exists and returns a valid dashboard"]),e._dashboardLoadFailed("Scripted dashboard")})},t.prototype._executeScript=function(t){var e=this,n={dashboardSrv:this.dashboardSrv,datasourceSrv:this.datasourceSrv,$q:this.$q},r=new Function("ARGS","kbn","dateMath","_","moment","window","document","$","jQuery","services",t.data),a=r(this.$routeParams,p.a,d,l.a,o.a,window,document,c.a,c.a,n);if(l.a.isFunction(a)){var i=this.$q.defer();return a(function(t){e.$timeout(function(){i.resolve({data:t})})}),i.promise}return{data:a}},t}();a.a.module("grafana.services").service("dashboardLoaderSrv",f)},1665:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/dashnav/dashnav.html",controller:u,bindToController:!0,controllerAs:"ctrl",transclude:!0,scope:{dashboard:"="}}}var a=n(1),i=n.n(a),o=n(21),s=n.n(o),l=n(225),u=function(){function t(t,e,n,r){if(this.$scope=t,this.dashboardSrv=e,this.$location=n,this.playlistSrv=r,l.b.on("save-dashboard",this.saveDashboard.bind(this),t),this.dashboard.meta.isSnapshot){var a=this.dashboard.meta;this.titleTooltip="Created: &nbsp;"+i()(a.created).calendar(),a.expires&&(this.titleTooltip+="<br>Expires: &nbsp;"+i()(a.expires).fromNow()+"<br>")}}return t.$inject=["$scope","dashboardSrv","$location","playlistSrv"],t.prototype.toggleSettings=function(){var t=this.$location.search();t.editview?delete t.editview:t.editview="settings",this.$location.search(t)},t.prototype.close=function(){var t=this.$location.search();t.editview?delete t.editview:t.fullscreen&&(delete t.fullscreen,delete t.edit),this.$location.search(t)},t.prototype.starDashboard=function(){var t=this;this.dashboardSrv.starDashboard(this.dashboard.id,this.dashboard.meta.isStarred).then(function(e){t.dashboard.meta.isStarred=e})},t.prototype.shareDashboard=function(t){var e=this.$scope.$new();e.tabIndex=t,e.dashboard=this.dashboard,l.b.emit("show-modal",{src:"public/app/features/dashboard/partials/shareModal.html",scope:e})},t.prototype.hideTooltip=function(t){s.a.element(t.currentTarget).tooltip("hide")},t.prototype.saveDashboard=function(){return this.dashboardSrv.saveDashboard()},t.prototype.showSearch=function(){l.b.emit("show-dash-search")},t.prototype.addPanel=function(){l.b.emit("dash-scroll",{animate:!0,evt:0}),this.dashboard.panels.length>0&&"add-panel"===this.dashboard.panels[0].type||this.dashboard.addPanel({type:"add-panel",gridPos:{x:0,y:0,w:12,h:9},title:"Panel Title"})},t.prototype.navItemClicked=function(t,e){t.clickHandler&&(t.clickHandler(),e.preventDefault())},t}();s.a.module("grafana.directives").directive("dashnav",r)},1666:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/submenu/submenu.html",controller:l,bindToController:!0,controllerAs:"ctrl",scope:{dashboard:"="}}}var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=function(){function t(t,e,n){this.$rootScope=t,this.variableSrv=e,this.$location=n,this.annotations=this.dashboard.templating.list,this.variables=this.variableSrv.variables}return t.$inject=["$rootScope","variableSrv","$location"],t.prototype.annotationStateChanged=function(){this.$rootScope.$broadcast("refresh")},t.prototype.variableUpdated=function(t){this.variableSrv.variableUpdated(t,!0)},t.prototype.openEditView=function(t){var e=s.a.extend(this.$location.search(),{editview:t});this.$location.search(e)},t}();i.a.module("grafana.directives").directive("dashboardSubmenu",r)},1667:function(t,e,n){"use strict";function r(){return{restrict:"E",template:i,controller:o,bindToController:!0,controllerAs:"ctrl",scope:{dismiss:"&"}}}var a=n(3),i='\n<div class="modal-body">\n\t<div class="modal-header">\n\t\t<h2 class="modal-header-title">\n\t\t\t<i class="fa fa-copy"></i>\n\t\t\t<span class="p-l-1">Save As...</span>\n\t\t</h2>\n\n\t\t<a class="modal-header-close" ng-click="ctrl.dismiss();">\n\t\t\t<i class="fa fa-remove"></i>\n\t\t</a>\n\t</div>\n\n\t<form name="ctrl.saveForm" class="modal-content" novalidate>\n\t\t<div class="p-t-2">\n\t\t\t<div class="gf-form">\n\t\t\t\t<label class="gf-form-label width-7">New name</label>\n\t\t\t\t<input type="text" class="gf-form-input" ng-model="ctrl.clone.title" give-focus="true" required>\n\t\t\t</div>\n      <div class="gf-form">\n        <folder-picker initial-folder-id="ctrl.folderId"\n                       on-change="ctrl.onFolderChange($folder)"\n                       enter-folder-creation="ctrl.onEnterFolderCreation()"\n                       exit-folder-creation="ctrl.onExitFolderCreation()"\n                       enable-create-new="true"\n                       label-class="width-7">\n        </folder-picker>\n      </div>\n\t\t</div>\n\n\t\t<div class="gf-form-button-row text-center">\n\t\t\t<button type="submit" class="btn btn-success" ng-click="ctrl.save()" ng-disabled="!ctrl.isValidFolderSelection">Save</button>\n\t\t\t<a class="btn-text" ng-click="ctrl.dismiss();">Cancel</a>\n\t\t</div>\n\t</form>\n</div>\n',o=function(){function t(t){this.dashboardSrv=t,this.isValidFolderSelection=!0;var e=this.dashboardSrv.getCurrent();this.clone=e.getSaveModelClone(),this.clone.id=null,this.clone.uid="",this.clone.title+=" Copy",this.clone.editable=!0,this.clone.hideControls=!1,this.folderId=e.meta.folderId,e.id>0&&this.clone.panels.forEach(function(t){"graph"===t.type&&t.alert&&delete t.thresholds,delete t.alert}),delete this.clone.autoUpdate}return t.$inject=["dashboardSrv"],t.prototype.save=function(){return this.dashboardSrv.save(this.clone,{folderId:this.folderId}).then(this.dismiss)},t.prototype.keyDown=function(t){13===t.keyCode&&this.save()},t.prototype.onFolderChange=function(t){this.folderId=t.id},t.prototype.onEnterFolderCreation=function(){this.isValidFolderSelection=!1},t.prototype.onExitFolderCreation=function(){this.isValidFolderSelection=!0},t}();a.a.directive("saveDashboardAsModal",r)},1668:function(t,e,n){"use strict";function r(){return{restrict:"E",template:i,controller:o,bindToController:!0,controllerAs:"ctrl",scope:{dismiss:"&"}}}var a=n(3),i='\n<div class="modal-body">\n  <div class="modal-header">\n    <h2 class="modal-header-title">\n      <i class="fa fa-save"></i>\n      <span class="p-l-1">Save changes</span>\n    </h2>\n\n    <a class="modal-header-close" ng-click="ctrl.dismiss();">\n      <i class="fa fa-remove"></i>\n    </a>\n  </div>\n\n  <form name="ctrl.saveForm" ng-submit="ctrl.save()" class="modal-content" novalidate>\n    <h6 class="text-center">Add a note to describe your changes</h6>\n    <div class="p-t-2">\n      <div class="gf-form">\n        <label class="gf-form-hint">\n          <input\n            type="text"\n            name="message"\n            class="gf-form-input"\n            placeholder="Updates to &hellip;"\n            give-focus="true"\n            ng-model="ctrl.message"\n            ng-model-options="{allowInvalid: true}"\n            ng-maxlength="this.max"\n            autocomplete="off" />\n          <small class="gf-form-hint-text muted" ng-cloak>\n            <span ng-class="{\'text-error\': ctrl.saveForm.message.$invalid && ctrl.saveForm.message.$dirty }">\n              {{ctrl.message.length || 0}}\n            </span>\n            / {{ctrl.max}} characters\n          </small>\n        </label>\n      </div>\n    </div>\n\n    <div class="gf-form-button-row text-center">\n      <button type="submit" class="btn btn-success" ng-disabled="ctrl.saveForm.$invalid">Save</button>\n      <button class="btn btn-inverse" ng-click="ctrl.dismiss();">Cancel</button>\n    </div>\n  </form>\n</div>\n',o=function(){function t(t){this.dashboardSrv=t,this.message="",this.max=64}return t.$inject=["dashboardSrv"],t.prototype.save=function(){if(this.saveForm.$valid){var t=this.dashboardSrv.getCurrent(),e=t.getSaveModelClone(),n={message:this.message};return this.dashboardSrv.save(e,n).then(this.dismiss)}},t}();a.a.directive("saveDashboardModal",r)},1669:function(t,e,n){"use strict";function r(){return{restrict:"E",template:l,controller:u,bindToController:!0,controllerAs:"ctrl",scope:{dismiss:"&"}}}var a=n(21),i=n.n(a),o=n(227),s=(n.n(o),n(3)),l='\n<div class="modal-body">\n  <div class="modal-header">\n    <h2 class="modal-header-title">\n      <i class="fa fa-save"></i><span class="p-l-1">Cannot save provisioned dashboard</span>\n    </h2>\n\n    <a class="modal-header-close" ng-click="ctrl.dismiss();">\n      <i class="fa fa-remove"></i>\n    </a>\n  </div>\n\n  <div class="modal-content">\n    <small>\n      This dashboard cannot be saved from Grafana\'s UI since it has been provisioned from another source.\n      Copy the JSON or save it to a file below. Then you can update your dashboard in corresponding provisioning source.<br/>\n      <i>See <a class="external-link" href="http://docs.grafana.org/administration/provisioning/#dashboards" target="_blank">\n      documentation</a> for more information about provisioning.</i>\n    </small>\n    <div class="p-t-2">\n      <div class="gf-form">\n        <code-editor content="ctrl.dashboardJson" data-mode="json" data-max-lines=15></code-editor>\n      </div>\n      <div class="gf-form-button-row">\n        <button class="btn btn-success" clipboard-button="ctrl.getJsonForClipboard()">\n          <i class="fa fa-clipboard"></i>&nbsp;Copy JSON to Clipboard\n        </button>\n        <button class="btn btn-secondary" clipboard-button="ctrl.save()">\n          <i class="fa fa-save"></i>&nbsp;Save JSON to file\n        </button>\n        <a class="btn btn-link" ng-click="ctrl.dismiss();">Cancel</a>\n      </div>\n    </div>\n  </div>\n</div>\n',u=function(){function t(t){this.dash=t.getCurrent().getSaveModelClone(),delete this.dash.id,this.dashboardJson=JSON.stringify(this.dash,null,2)}return t.$inject=["dashboardSrv"],t.prototype.save=function(){var t=new Blob([i.a.toJson(this.dash,!0)],{type:"application/json;charset=utf-8"});Object(o.saveAs)(t,this.dash.title+"-"+(new Date).getTime()+".json")},t.prototype.getJsonForClipboard=function(){return this.dashboardJson},t}();s.a.directive("saveProvisionedDashboardModal",r)},1670:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(1),o=n.n(i),s=n(22),l=function(){function t(t,e,n,r,i,l,u){t.options={forCurrent:!0,includeTemplateVars:!0,theme:"current"},t.editor={index:t.tabIndex||0},t.init=function(){t.modeSharePanel=!!t.panel,t.tabs=[{title:"Link",src:"shareLink.html"}],t.modeSharePanel?(t.modalTitle="Share Panel",t.tabs.push({title:"Embed",src:"shareEmbed.html"})):t.modalTitle="Share",t.dashboard.meta.isSnapshot||t.tabs.push({title:"Snapshot",src:"shareSnapshot.html"}),t.dashboard.meta.isSnapshot||t.modeSharePanel||t.tabs.push({title:"Export",src:"shareExport.html"}),t.buildUrl()},t.buildUrl=function(){var e=n.absUrl(),r=e.indexOf("?");-1!==r&&(e=e.substring(0,r));var c=a.a.copy(n.search()),p=i.timeRange();c.from=p.from.valueOf(),c.to=p.to.valueOf(),c.orgId=s.a.bootData.user.orgId,t.options.includeTemplateVars&&l.fillVariableValuesForUrl(c),t.options.forCurrent||(delete c.from,delete c.to),"current"!==t.options.theme&&(c.theme=t.options.theme),t.modeSharePanel?(c.panelId=t.panel.id,c.fullscreen=!0):(delete c.panelId,delete c.fullscreen),t.shareUrl=u.addParamsToUrl(e,c);var d=e.replace(s.a.appSubUrl+"/dashboard/",s.a.appSubUrl+"/dashboard-solo/");d=d.replace(s.a.appSubUrl+"/d/",s.a.appSubUrl+"/d-solo/"),delete c.fullscreen,delete c.edit,d=u.addParamsToUrl(d,c),t.iframeHtml='<iframe src="'+d+'" width="450" height="200" frameborder="0"></iframe>',t.imageUrl=d.replace(s.a.appSubUrl+"/dashboard-solo/",s.a.appSubUrl+"/render/dashboard-solo/"),t.imageUrl=t.imageUrl.replace(s.a.appSubUrl+"/d-solo/",s.a.appSubUrl+"/render/d-solo/"),t.imageUrl+="&width=1000",t.imageUrl+="&height=500",t.imageUrl+="&tz=UTC"+encodeURIComponent(o()().format("Z"))},t.getShareUrl=function(){return t.shareUrl}}return t.$inject=["$scope","$rootScope","$location","$timeout","timeSrv","templateSrv","linkSrv"],t}();a.a.module("grafana.controllers").controller("ShareModalCtrl",l)},1671:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=function(){function t(t,e,n,r,a,i){t.snapshot={name:t.dashboard.title,expires:0,timeoutSeconds:4},t.step=1,t.expireOptions=[{text:"1 Hour",value:3600},{text:"1 Day",value:86400},{text:"7 Days",value:604800},{text:"Never",value:0}],t.accessOptions=[{text:"Anyone with the link",value:1},{text:"Organization users",value:2},{text:"Public on the web",value:3}],t.init=function(){r.get("/api/snapshot/shared-options").then(function(e){t.externalUrl=e.externalSnapshotURL,t.sharingButtonText=e.externalSnapshotName,t.externalEnabled=e.externalEnabled})},t.apiUrl="/api/snapshots",t.createSnapshot=function(r){t.dashboard.snapshot={timestamp:new Date},r||(t.dashboard.snapshot.originalUrl=n.absUrl()),t.loading=!0,t.snapshot.external=r,e.$broadcast("refresh"),a(function(){t.saveSnapshot(r)},1e3*t.snapshot.timeoutSeconds)},t.saveSnapshot=function(e){var a=t.dashboard.getSaveModelClone();t.scrubDashboard(a);var i={dashboard:a,name:a.title,expires:t.snapshot.expires},o=e?t.externalUrl+t.apiUrl:t.apiUrl;r.post(o,i).then(function(r){if(t.loading=!1,e)t.deleteUrl=r.deleteUrl,t.snapshotUrl=r.url,t.saveExternalSnapshotRef(i,r);else{var a=n.url(),o=n.absUrl();"/"!==a&&(o=o.replace(a,"")+"/"),t.snapshotUrl=o+"dashboard/snapshot/"+r.key,t.deleteUrl=o+"api/snapshots-delete/"+r.deleteKey}t.step=2},function(){t.loading=!1})},t.getSnapshotUrl=function(){return t.snapshotUrl},t.scrubDashboard=function(e){if(e.title=t.snapshot.name,e.time=i.timeRange(),o.a.each(e.panels,function(t){t.targets=[],t.links=[],t.datasource=null}),e.annotations.list=o.a.chain(e.annotations.list).filter(function(t){return t.enable}).map(function(t){return{name:t.name,enable:t.enable,iconColor:t.iconColor,snapshotData:t.snapshotData}}).value(),o.a.each(e.templating.list,function(t){t.query="",t.options=t.current,t.refresh=!1}),t.modeSharePanel){var n=t.panel.getSaveModel();n.gridPos.w=24,n.gridPos.x=0,n.gridPos.y=0,n.gridPos.h=20,e.panels=[n]}delete t.dashboard.snapshot,t.dashboard.forEachPanel(function(t){delete t.snapshotData}),o.a.each(t.dashboard.annotations.list,function(t){delete t.snapshotData})},t.deleteSnapshot=function(){r.get(t.deleteUrl).then(function(){t.step=3})},t.saveExternalSnapshotRef=function(t,e){t.external=!0,t.key=e.key,t.deleteKey=e.deleteKey,r.post("/api/snapshots/",t)}}return t.$inject=["$scope","$rootScope","$location","backendSrv","$timeout","timeSrv"],t}();a.a.module("grafana.controllers").controller("ShareSnapshotCtrl",s)},1672:function(t,e,n){"use strict";var r=n(3),a=n(524),i=n(226),o=function(){function t(t,e,n){this.backendSrv=t,this.$rootScope=e,this.$location=n}return t.$inject=["backendSrv","$rootScope","$location"],t.prototype.create=function(t,e){return new a.a(t,e)},t.prototype.setCurrent=function(t){this.dash=t},t.prototype.getCurrent=function(){return this.dash},t.prototype.handleSaveDashboardError=function(t,e,n){var r=this;e=e||{},e.overwrite=!0,n.data&&"version-mismatch"===n.data.status&&(n.isHandled=!0,this.$rootScope.appEvent("confirm-modal",{title:"Conflict",text:"Someone else has updated this dashboard.",text2:"Would you still like to save this dashboard?",yesText:"Save & Overwrite",icon:"fa-warning",onConfirm:function(){r.save(t,e)}})),n.data&&"name-exists"===n.data.status&&(n.isHandled=!0,this.$rootScope.appEvent("confirm-modal",{title:"Conflict",text:"A dashboard with the same name in selected folder already exists.",text2:"Would you still like to save this dashboard?",yesText:"Save & Overwrite",icon:"fa-warning",onConfirm:function(){r.save(t,e)}})),n.data&&"plugin-dashboard"===n.data.status&&(n.isHandled=!0,this.$rootScope.appEvent("confirm-modal",{title:"Plugin Dashboard",text:n.data.message,text2:"Your changes will be lost when you update the plugin. Use Save As to create custom version.",yesText:"Overwrite",icon:"fa-warning",altActionText:"Save As",onAltAction:function(){r.showSaveAsModal()},onConfirm:function(){r.save(t,{overwrite:!0})}}))},t.prototype.postSave=function(t,e){this.dash.version=e.version;var n=i.a.stripBaseFromUrl(e.url);return n!==this.$location.path()&&this.$location.url(n).replace(),this.$rootScope.appEvent("dashboard-saved",this.dash),this.$rootScope.appEvent("alert-success",["Dashboard saved"]),this.dash},t.prototype.save=function(t,e){return e=e||{},e.folderId=e.folderId>=0?e.folderId:this.dash.meta.folderId||t.folderId,this.backendSrv.saveDashboard(t,e).then(this.postSave.bind(this,t)).catch(this.handleSaveDashboardError.bind(this,t,e))},t.prototype.saveDashboard=function(t,e){return e&&this.setCurrent(this.create(e,this.dash.meta)),this.dash.meta.provisioned?this.showDashboardProvisionedModal():this.dash.meta.canSave||!0===t.makeEditable?"New dashboard"===this.dash.title?this.showSaveAsModal():this.dash.version>0?this.showSaveModal():this.save(this.dash.getSaveModelClone(),t):Promise.resolve()},t.prototype.showDashboardProvisionedModal=function(){this.$rootScope.appEvent("show-modal",{templateHtml:'<save-provisioned-dashboard-modal dismiss="dismiss()"></save-provisioned-dashboard-modal>'})},t.prototype.showSaveAsModal=function(){this.$rootScope.appEvent("show-modal",{templateHtml:'<save-dashboard-as-modal dismiss="dismiss()"></save-dashboard-as-modal>',modalClass:"modal--narrow"})},t.prototype.showSaveModal=function(){this.$rootScope.appEvent("show-modal",{templateHtml:'<save-dashboard-modal dismiss="dismiss()"></save-dashboard-modal>',modalClass:"modal--narrow"})},t.prototype.starDashboard=function(t,e){var n,r=this;return n=e?this.backendSrv.delete("/api/user/stars/dashboard/"+t).then(function(){return!1}):this.backendSrv.post("/api/user/stars/dashboard/"+t).then(function(){return!0}),n.then(function(e){return r.dash&&r.dash.id===t&&(r.dash.meta.isStarred=e),e})},t}();r.a.service("dashboardSrv",o)},1673:function(t,e,n){"use strict";function r(t,e,n){return{create:function(r){return new u(r,t,e,n)}}}r.$inject=["$location","$timeout","$rootScope"];var a=n(21),i=n.n(a),o=n(4),s=n.n(o),l=n(22),u=function(){function t(t,e,n,r){this.$location=e,this.$timeout=n,this.$rootScope=r;var a=this;a.state={},a.panelScopes=[],a.$scope=t,a.dashboard=t.dashboard,t.onAppEvent("$routeUpdate",function(){var t=a.getQueryStringState();a.needsSync(t)&&a.update(t,!0)}),t.onAppEvent("panel-change-view",function(t,e){a.update(e)}),t.onAppEvent("panel-initialized",function(t,e){a.registerPanel(e.scope)}),e.replace(),this.update(this.getQueryStringState())}return t.$inject=["$scope","$location","$timeout","$rootScope"],t.prototype.needsSync=function(t){return!1===s.a.isEqual(this.state,t)},t.prototype.getQueryStringState=function(){var t=this.$location.search();return t.panelId=parseInt(t.panelId)||null,t.fullscreen=!!t.fullscreen||null,t.edit="true"===t.edit||!0===t.edit||null,t.editview=t.editview||null,t.orgId=l.a.bootData.user.orgId,t},t.prototype.serializeToUrl=function(){var t=s.a.clone(this.state);return t.fullscreen=!!this.state.fullscreen||null,t.edit=!!this.state.edit||null,t},t.prototype.update=function(t,e){t.toggle&&(delete t.toggle,this.state.fullscreen&&t.fullscreen&&this.state.edit===t.edit&&(t.fullscreen=!t.fullscreen)),this.editStateChanged=(t.edit||!1)!==(this.state.edit||!1),s.a.extend(this.state,t),this.dashboard.meta.fullscreen=this.state.fullscreen,this.state.fullscreen||(this.state.fullscreen=null,this.state.edit=null,this.dashboard.meta.soloMode||(this.state.panelId=null)),(this.state.fullscreen||this.dashboard.meta.soloMode)&&this.state.panelId&&this.toggleCollapsedPanelRow(this.state.panelId),this.state.edit||delete this.state.tab,!0!==e&&this.$location.search(this.serializeToUrl()),this.syncState()},t.prototype.toggleCollapsedPanelRow=function(t){for(var e=0,n=this.dashboard.panels;e<n.length;e++){var r=n[e];if(r.collapsed)for(var a=0,i=r.panels;a<i.length;a++){var o=i[a];if(o.id===t)return void this.dashboard.toggleRow(r)}}},t.prototype.syncState=function(){if(0!==this.panelScopes.length)if(this.dashboard.meta.fullscreen){var t=this.getPanelScope(this.state.panelId);if(!t)return;if(this.fullscreenPanel){if(this.fullscreenPanel===t&&!1===this.editStateChanged)return;this.leaveFullscreen(!1)}t.ctrl.editModeInitiated||t.ctrl.initEditMode(),t.ctrl.fullscreen||this.enterFullscreen(t)}else this.fullscreenPanel&&this.leaveFullscreen(!0)},t.prototype.getPanelScope=function(t){return s.a.find(this.panelScopes,function(e){return e.ctrl.panel.id===t})},t.prototype.leaveFullscreen=function(t){var e=this,n=e.fullscreenPanel.ctrl;return n.editMode=!1,n.fullscreen=!1,this.dashboard.setViewMode(n.panel,!1,!1),this.$scope.appEvent("panel-fullscreen-exit",{panelId:n.panel.id}),this.$scope.appEvent("dash-scroll",{restore:!0}),!!t&&(this.$timeout(function(){e.oldTimeRange!==n.range?e.$rootScope.$broadcast("refresh"):e.$rootScope.$broadcast("render"),delete e.fullscreenPanel}),!0)},t.prototype.enterFullscreen=function(t){var e=t.ctrl;e.editMode=this.state.edit&&this.dashboard.meta.canEdit,e.fullscreen=!0,this.oldTimeRange=e.range,this.fullscreenPanel=t,this.$scope.appEvent("dash-scroll",{animate:!1,pos:0}),this.dashboard.setViewMode(e.panel,!0,e.editMode),this.$scope.appEvent("panel-fullscreen-enter",{panelId:e.panel.id})},t.prototype.registerPanel=function(t){var e=this;e.panelScopes.push(t),e.dashboard.meta.soloMode||e.state.panelId===t.ctrl.panel.id&&(e.state.edit?t.ctrl.editPanel():t.ctrl.viewPanel());var n=t.$on("$destroy",function(){e.panelScopes=s.a.without(e.panelScopes,t),n()})},t}();i.a.module("grafana.services").factory("dashboardViewStateSrv",r)},1674:function(t,e,n){"use strict";var r=n(3),a={FOLDER:"dash-folder",DASHBOARD:"dash-db"},i=function(){function t(t,e){this.$q=t,this.backendSrv=e,this.rootName="general"}return t.$inject=["$q","backendSrv"],t.prototype.validateNewDashboardName=function(t,e){return this.validate(t,e,"A dashboard in this folder with the same name already exists")},t.prototype.validateNewFolderName=function(t){return this.validate(0,t,"A folder or dashboard in the general folder with the same name already exists")},t.prototype.validate=function(t,e,n){e=(e||"").trim();var r=e.toLowerCase();if(0===e.length)return this.$q.reject({type:"REQUIRED",message:"Name is required"});if(0===t&&r===this.rootName)return this.$q.reject({type:"EXISTING",message:"This is a reserved name and cannot be used for a folder."});var i=this.$q.defer(),o=[];return o.push(this.backendSrv.search({type:a.FOLDER,folderIds:[t],query:e})),o.push(this.backendSrv.search({type:a.DASHBOARD,folderIds:[t],query:e})),this.$q.all(o).then(function(t){var e=[];t.length>0&&t[0].length>0&&(e=t[0]),t.length>1&&t[1].length>0&&(e=e.concat(t[1]));for(var a=0,o=e;a<o.length;a++){var s=o[a];if(r===s.title.toLowerCase()){i.reject({type:"EXISTING",message:n});break}}i.resolve()}),i.promise},t}();r.a.service("validationSrv",i)},1675:function(t,e,n){"use strict";var r=n(1),a=n.n(r),i=n(4),o=n.n(i),s=n(3),l=n(224),u=n(512),c=function(){function t(t,e,n,r,a){var i=this;this.$rootScope=t,this.$timeout=e,this.$location=n,this.timer=r,this.contextSrv=a,this.time={from:"6h",to:"now"},t.$on("zoom-out",this.zoomOut.bind(this)),t.$on("$routeUpdate",this.routeUpdated.bind(this)),document.addEventListener("visibilitychange",function(){i.autoRefreshBlocked&&"visible"===document.visibilityState&&(i.autoRefreshBlocked=!1,i.refreshDashboard())})}return t.$inject=["$rootScope","$timeout","$location","timer","contextSrv"],t.prototype.init=function(t){this.timer.cancelAll(),this.dashboard=t,this.time=t.time,this.refresh=t.refresh,this.initTimeFromUrl(),this.parseTime(),this.timeAtLoad=o.a.cloneDeep(this.time),this.refresh&&this.setAutoRefresh(this.refresh)},t.prototype.parseTime=function(){o.a.isString(this.time.from)&&this.time.from.indexOf("Z")>=0&&(this.time.from=a()(this.time.from).utc()),o.a.isString(this.time.to)&&this.time.to.indexOf("Z")>=0&&(this.time.to=a()(this.time.to).utc())},t.prototype.parseUrlParam=function(t){if(-1!==t.indexOf("now"))return t;if(8===t.length)return a.a.utc(t,"YYYYMMDD");if(15===t.length)return a.a.utc(t,"YYYYMMDDTHHmmss");if(!isNaN(t)){var e=parseInt(t);return a.a.utc(e)}return null},t.prototype.initTimeFromUrl=function(){var t=this.$location.search();t.from&&(this.time.from=this.parseUrlParam(t.from)||this.time.from),t.to&&(this.time.to=this.parseUrlParam(t.to)||this.time.to),t.refresh&&(this.refresh=t.refresh||this.refresh)},t.prototype.routeUpdated=function(){var t=this.$location.search(),e=this.timeRangeForUrl();t.from&&t.to?t.from===e.from&&t.to===e.to||(this.initTimeFromUrl(),this.setTime(this.time,!0)):this.timeHasChangedSinceLoad()&&this.setTime(this.timeAtLoad,!0)},t.prototype.timeHasChangedSinceLoad=function(){return this.timeAtLoad.from!==this.time.from||this.timeAtLoad.to!==this.time.to},t.prototype.setAutoRefresh=function(t){var e=this;if(this.dashboard.refresh=t,this.cancelNextRefresh(),t){var n=l.a.interval_to_ms(t);this.refreshTimer=this.timer.register(this.$timeout(function(){e.startNextRefreshTimer(n),e.refreshDashboard()},n))}var r=this.$location.search();t?(r.refresh=t,this.$location.search(r)):r.refresh&&(delete r.refresh,this.$location.search(r))},t.prototype.refreshDashboard=function(){this.$rootScope.$broadcast("refresh")},t.prototype.startNextRefreshTimer=function(t){var e=this;this.cancelNextRefresh(),this.refreshTimer=this.timer.register(this.$timeout(function(){e.startNextRefreshTimer(t),e.contextSrv.isGrafanaVisible()?e.refreshDashboard():e.autoRefreshBlocked=!0},t))},t.prototype.cancelNextRefresh=function(){this.timer.cancel(this.refreshTimer)},t.prototype.setTime=function(t,e){if(o.a.extend(this.time,t),a.a.isMoment(t.to)?(this.oldRefresh=this.dashboard.refresh||this.oldRefresh,this.setAutoRefresh(!1)):this.oldRefresh&&this.oldRefresh!==this.dashboard.refresh&&(this.setAutoRefresh(this.oldRefresh),this.oldRefresh=null),!0!==e){var n=this.timeRangeForUrl(),r=this.$location.search();r.from=n.from,r.to=n.to,this.$location.search(r)}this.$rootScope.appEvent("time-range-changed",this.time),this.$timeout(this.refreshDashboard.bind(this),0)},t.prototype.timeRangeForUrl=function(){var t=this.timeRange().raw;return a.a.isMoment(t.from)&&(t.from=t.from.valueOf().toString()),a.a.isMoment(t.to)&&(t.to=t.to.valueOf().toString()),t},t.prototype.timeRange=function(){var t={from:a.a.isMoment(this.time.from)?a()(this.time.from):this.time.from,to:a.a.isMoment(this.time.to)?a()(this.time.to):this.time.to},e=this.dashboard&&this.dashboard.getTimezone();return{from:u.parse(t.from,!1,e),to:u.parse(t.to,!0,e),raw:t}},t.prototype.zoomOut=function(t,e){var n=this.timeRange(),r=n.to.valueOf()-n.from.valueOf(),i=n.to.valueOf()-r/2,o=i+r*e/2,s=i-r*e/2;if(o>Date.now()&&n.to<=Date.now()){s-=o-Date.now(),o=Date.now()}this.setTime({from:a.a.utc(s),to:a.a.utc(o)})},t}();s.a.service("timeSrv",c)},1676:function(t,e,n){"use strict";function r(t,e,n,r,a,i,s){this.init=function(e,i){return this.tracker=new o.a(e,i,1e3,n,s,r,a,t),this.tracker}}r.$inject=["$rootScope","$q","$location","$timeout","contextSrv","dashboardSrv","$window"];var a=n(21),i=n.n(a),o=n(1677);i.a.module("grafana.services").service("unsavedChangesSrv",r)},1677:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=n(524),l=function(){function t(t,e,n,r,a,i,o,s){var l=this;this.$location=r,this.$timeout=i,this.contextSrv=o,this.$rootScope=s,this.$location=r,this.$window=a,this.current=t,this.originalPath=r.path(),this.scope=e,e.onAppEvent("dashboard-saved",function(){l.original=l.current.getSaveModelClone(),l.originalPath=r.path()}),a.onbeforeunload=function(){if(!l.ignoreChanges())return l.hasChanges()?"There are unsaved changes to this dashboard":void 0},e.$on("$locationChangeStart",function(t,e){return l.originalPath===r.path()||(!!l.ignoreChanges()||(l.hasChanges()&&(t.preventDefault(),l.next=e,l.$timeout(function(){l.open_modal()})),!1))}),n?this.$timeout(function(){l.original=t.getSaveModelClone()},n):this.original=t.getSaveModelClone()}return t.$inject=["dashboard","scope","originalCopyDelay","$location","$window","$timeout","contextSrv","$rootScope"],t.prototype.ignoreChanges=function(){if(!this.original)return!0;if(!this.contextSrv.isEditor)return!0;if(!this.current||!this.current.meta)return!0;var t=this.current.meta;return!t.canSave||t.fromScript||t.fromFile},t.prototype.cleanDashboardFromIgnoredChanges=function(t){var e=new s.a(t);e.expandRows();var n=e.getSaveModelClone();return n.time=0,n.refresh=0,n.schemaVersion=0,delete n.iteration,n.panels=o.a.filter(n.panels,function(t){return!t.repeatPanelId&&(t.scopedVars=null,t.legend&&(delete t.legend.sort,delete t.legend.sortDesc),!0)}),o.a.each(n.templating.list,function(t){t.current=null,t.options=null,t.filters=null}),n},t.prototype.hasChanges=function(){var t=this.cleanDashboardFromIgnoredChanges(this.current.getSaveModelClone()),e=this.cleanDashboardFromIgnoredChanges(this.original),n=o.a.find(t.nav,{type:"timepicker"}),r=o.a.find(e.nav,{type:"timepicker"});return n&&r&&(n.now=r.now),a.a.toJson(t,!0)!==a.a.toJson(e,!0)},t.prototype.discardChanges=function(){this.original=null,this.gotoNext()},t.prototype.open_modal=function(){this.$rootScope.appEvent("show-modal",{templateHtml:'<unsaved-changes-modal dismiss="dismiss()"></unsaved-changes-modal>',modalClass:"modal--narrow confirm-modal"})},t.prototype.saveChanges=function(){var t=this,e=this,n=this.$rootScope.$on("dashboard-saved",function(){n(),t.$timeout(function(){e.gotoNext()})});this.$rootScope.appEvent("save-dashboard")},t.prototype.gotoNext=function(){var t=this.$location.absUrl().length-this.$location.url().length,e=this.next.substring(t);this.$location.url(e)},t}()},1678:function(t,e,n){"use strict";function r(){return{restrict:"E",template:i,controller:o,bindToController:!0,controllerAs:"ctrl",scope:{dismiss:"&"}}}var a=n(3),i='\n<div class="modal-body">\n  <div class="modal-header">\n    <h2 class="modal-header-title">\n      <i class="fa fa-exclamation"></i>\n      <span class="p-l-1">Unsaved changes</span>\n    </h2>\n\n    <a class="modal-header-close" ng-click="ctrl.dismiss();">\n      <i class="fa fa-remove"></i>\n    </a>\n  </div>\n\n  <div class="modal-content text-center">\n\n    <div class="confirm-modal-text">\n      Do you want to save your changes?\n    </div>\n\n    <div class="confirm-modal-buttons">\n      <button type="button" class="btn btn-success" ng-click="ctrl.save()">Save</button>\n      <button type="button" class="btn btn-danger" ng-click="ctrl.discard()">Discard</button>\n      <button type="button" class="btn btn-inverse" ng-click="ctrl.dismiss()">Cancel</button>\n    </div>\n  </div>\n</div>\n',o=function(){function t(t){this.unsavedChangesSrv=t}return t.$inject=["unsavedChangesSrv"],t.prototype.discard=function(){this.dismiss(),this.unsavedChangesSrv.tracker.discardChanges()},t.prototype.save=function(){this.dismiss(),this.unsavedChangesSrv.tracker.saveChanges()},t}();a.a.directive("unsavedChangesModal",r)},1679:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/timepicker/settings.html",controller:h,bindToController:!0,controllerAs:"ctrl",scope:{dashboard:"="}}}function a(){return{restrict:"E",templateUrl:"public/app/features/dashboard/timepicker/timepicker.html",controller:h,bindToController:!0,controllerAs:"ctrl",scope:{dashboard:"="}}}var i=n(4),o=n.n(i),s=n(21),l=n.n(s),u=n(1),c=n.n(u),p=n(519),d=n(1680),h=function(){function t(e,n,r){var a=this;this.$scope=e,this.$rootScope=n,this.timeSrv=r,this.$scope.ctrl=this,n.onAppEvent("shift-time-forward",function(){return a.move(1)},e),n.onAppEvent("shift-time-backward",function(){return a.move(-1)},e),n.onAppEvent("refresh",this.onRefresh.bind(this),e),n.onAppEvent("closeTimepicker",this.openDropdown.bind(this),e),this.panel=this.dashboard.timepicker,o.a.defaults(this.panel,t.defaults),this.firstDayOfWeek=c.a.localeData().firstDayOfWeek(),this.onRefresh()}return t.$inject=["$scope","$rootScope","timeSrv"],t.prototype.onRefresh=function(){var t=l.a.copy(this.timeSrv.timeRange()),e=l.a.copy(t.raw);this.dashboard.isTimezoneUtc()?this.isUtc=!0:(t.from.local(),t.to.local(),c.a.isMoment(e.from)&&e.from.local(),c.a.isMoment(e.to)&&e.to.local(),this.isUtc=!1),this.rangeString=p.b(e),this.absolute={fromJs:t.from.toDate(),toJs:t.to.toDate()},this.tooltip=this.dashboard.formatDate(t.from)+" <br>to<br>",this.tooltip+=this.dashboard.formatDate(t.to),this.timeRaw=e},t.prototype.zoom=function(t){this.$rootScope.appEvent("zoom-out",2)},t.prototype.move=function(t){var e,n,r=this.timeSrv.timeRange(),a=(r.to.valueOf()-r.from.valueOf())/2;-1===t?(e=r.to.valueOf()-a,n=r.from.valueOf()-a):1===t?(e=r.to.valueOf()+a,n=r.from.valueOf()+a,e>Date.now()&&r.to<Date.now()&&(e=Date.now(),n=r.from.valueOf())):(e=r.to.valueOf(),n=r.from.valueOf()),this.timeSrv.setTime({from:c.a.utc(n),to:c.a.utc(e)})},t.prototype.openDropdown=function(){if(this.isOpen)return void this.closeDropdown();this.onRefresh(),this.editTimeRaw=this.timeRaw,this.timeOptions=p.c(this.panel,this.rangeString),this.refresh={value:this.dashboard.refresh,options:o.a.map(this.panel.refresh_intervals,function(t){return{text:t,value:t}})},this.refresh.options.unshift({text:"off"}),this.isOpen=!0,this.$rootScope.appEvent("timepickerOpen")},t.prototype.closeDropdown=function(){this.isOpen=!1,this.$rootScope.appEvent("timepickerClosed")},t.prototype.applyCustom=function(){this.refresh.value!==this.dashboard.refresh&&this.timeSrv.setAutoRefresh(this.refresh.value),this.timeSrv.setTime(this.editTimeRaw),this.closeDropdown()},t.prototype.absoluteFromChanged=function(){this.editTimeRaw.from=this.getAbsoluteMomentForTimezone(this.absolute.fromJs)},t.prototype.absoluteToChanged=function(){this.editTimeRaw.to=this.getAbsoluteMomentForTimezone(this.absolute.toJs)},t.prototype.getAbsoluteMomentForTimezone=function(t){return this.dashboard.isTimezoneUtc()?c()(t).utc():c()(t)},t.prototype.setRelativeFilter=function(t){var e={from:t.from,to:t.to};this.panel.nowDelay&&"now"===e.to&&(e.to="now-"+this.panel.nowDelay),this.timeSrv.setTime(e),this.closeDropdown()},t.tooltipFormat="MMM D, YYYY HH:mm:ss",t.defaults={time_options:["5m","15m","1h","6h","12h","24h","2d","7d","30d"],refresh_intervals:["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},t}();l.a.module("grafana.directives").directive("gfTimePickerSettings",r),l.a.module("grafana.directives").directive("gfTimePicker",a),l.a.module("grafana.directives").directive("inputDatetime",d.a)},1680:function(t,e,n){"use strict";function r(){return{restrict:"A",require:"ngModel",link:function(t,e,n,r){var a="YYYY-MM-DD HH:mm:ss",s=function(e){if(-1!==e.indexOf("now"))return o.isValid(e)?(r.$setValidity("error",!0),e):void r.$setValidity("error",!1);var n;return n=t.ctrl.isUtc?i.a.utc(e,a):i()(e,a),n.isValid()?(r.$setValidity("error",!0),n):void r.$setValidity("error",!1)},l=function(t){return i.a.isMoment(t)?t.format(a):t};r.$parsers.push(s),r.$formatters.push(l)}}}e.a=r;var a=n(1),i=n.n(a),o=n(512)},1681:function(t,e,n){"use strict";function r(t,e,n){return{restrict:"E",template:a,scope:{onUpload:"&"},link:function(t){function n(e){for(var n,r=e.target.files,a=0;n=r[a];a++){var i=new FileReader;i.onload=function(){return function(e){var n;try{n=JSON.parse(e.target.result)}catch(e){return console.log(e),void t.appEvent("alert-error",["Import failed","JSON -> JS Serialization failed: "+e.message])}t.$apply(function(){t.onUpload({dash:n})})}}(),i.readAsText(n)}}var r=window;r.File&&r.FileReader&&r.FileList&&r.Blob?document.getElementById("dashupload").addEventListener("change",n,!1):e.set("Oops","Sorry, the HTML5 File APIs are not fully supported in this browser.","error")}}}r.$inject=["timer","alertSrv","$location"];var a='\n<input type="file" id="dashupload" name="dashupload" class="hide"/>\n<label class="btn btn-success" for="dashupload">\n  <i class="fa fa-upload"></i>\n  Upload .json File\n</label>\n';n(3).a.directive("dashUpload",r)},1682:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/export/export_modal.html",controller:u,bindToController:!0,controllerAs:"ctrl",scope:{dismiss:"&"}}}var a=n(21),i=n.n(a),o=n(227),s=(n.n(o),n(3)),l=n(1683),u=function(){function t(t,e,n,r){var a=this;this.dashboardSrv=t,this.$scope=n,this.$rootScope=r,this.exporter=new l.a(e),this.exporter.makeExportable(this.dashboardSrv.getCurrent()).then(function(t){a.$scope.$apply(function(){a.dash=t})})}return t.$inject=["dashboardSrv","datasourceSrv","$scope","$rootScope"],t.prototype.save=function(){var t=new Blob([i.a.toJson(this.dash,!0)],{type:"application/json;charset=utf-8"});Object(o.saveAs)(t,this.dash.title+"-"+(new Date).getTime()+".json")},t.prototype.saveJson=function(){var t=this.dash,e=this.$rootScope.$new();e.object=t,e.enableCopy=!0,this.$rootScope.appEvent("show-modal",{src:"public/app/partials/edit_json.html",scope:e}),this.dismiss()},t}();s.a.directive("dashExportModal",r)},1683:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(22),a=n(4),i=n.n(a),o=function(){function t(t){this.datasourceSrv=t}return t.prototype.makeExportable=function(t){var e=this;t.cleanUpRepeats();var n=t.getSaveModelClone();n.id=null,t.processRepeats();for(var a=[],o={},s={},l=[],u={},c=0,p=n.templating.list;c<p.length;c++){var d=p[c];u[d.name]=d}for(var h=function(t){t.datasource&&0===t.datasource.indexOf("$")&&u[t.datasource.substring(1)]||l.push(e.datasourceSrv.get(t.datasource).then(function(e){if(!e.meta.builtIn){var n="DS_"+e.name.replace(" ","_").toUpperCase();s[n]={name:n,label:e.name,description:"",type:"datasource",pluginId:e.meta.id,pluginName:e.meta.name},t.datasource="${"+n+"}",o["datasource"+e.meta.id]={type:"datasource",id:e.meta.id,name:e.meta.name,version:e.meta.info.version||"1.0.0"}}}))},f=0,m=n.panels;f<m.length;f++){var g=m[f];if(void 0!==g.datasource&&h(g),g.targets)for(var v=0,y=g.targets;v<y.length;v++){var b=y[v];void 0!==b.datasource&&h(b)}var x=r.a.panels[g.type];x&&(o["panel"+x.id]={type:"panel",id:x.id,name:x.name,version:x.info.version})}for(var S=0,w=n.templating.list;S<w.length;S++){var d=w[S];"query"===d.type&&(h(d),d.options=[],d.current={},d.refresh=d.refresh>0?d.refresh:1)}for(var k=0,_=n.annotations.list;k<_.length;k++){h(_[k])}return o.grafana={type:"grafana",id:"grafana",name:"Grafana",version:r.a.buildInfo.version},Promise.all(l).then(function(){i.a.each(s,function(t,e){a.push(t)});for(var t=0,e=n.templating.list;t<e.length;t++){var r=e[t];if("constant"===r.type){var l="VAR_"+r.name.replace(" ","_").toUpperCase();a.push({name:l,type:"constant",label:r.label||r.name,value:r.current.value,description:""}),r.query="${"+l+"}",r.options[0]=r.current={value:r.query,text:r.query}}}var u={};return u.__inputs=a,u.__requires=i.a.sortBy(o,["id"]),i.a.defaults(u,n),u}).catch(function(t){return console.log("Export failed:",t),{error:t}})},t}()},1684:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/export_data/export_data_modal.html",controller:l,controllerAs:"ctrl",scope:{panel:"<",data:"<"},bindToController:!0}}var a=n(21),i=n.n(a),o=n(1479),s=n(17),l=function(){function t(){this.asRows=!0,this.dateTimeFormat="YYYY-MM-DDTHH:mm:ssZ"}return t.prototype.export=function(){"table"===this.panel?o.exportTableDataToCsv(this.data,this.excel):this.asRows?o.exportSeriesListToCsv(this.data,this.dateTimeFormat,this.excel):o.exportSeriesListToCsvColumns(this.data,this.dateTimeFormat,this.excel),this.dismiss()},t.prototype.dismiss=function(){s.a.emit("hide-modal")},t}();i.a.module("grafana.directives").directive("exportDataModal",r)},1685:function(t,e,n){"use strict";function r(){return{restrict:"E",template:c,controller:u,bindToController:!0,controllerAs:"ctrl",scope:{variable:"="}}}var a=n(4),i=n.n(a),o=n(21),s=n.n(o),l=n(3),u=function(){function t(t,e,n,r,a,i){this.uiSegmentSrv=t,this.datasourceSrv=e,this.$q=n,this.variableSrv=r,this.$rootScope=i,this.removeTagFilterSegment=t.newSegment({fake:!0,value:"-- remove filter --"}),this.buildSegmentModel(),this.$rootScope.onAppEvent("template-variable-value-updated",this.buildSegmentModel.bind(this),a)}return t.$inject=["uiSegmentSrv","datasourceSrv","$q","variableSrv","$scope","$rootScope"],t.prototype.buildSegmentModel=function(){this.segments=[],this.variable.value&&i.a.isArray(this.variable.value);for(var t=0,e=this.variable.filters;t<e.length;t++){var n=e[t];this.segments.length>0&&this.segments.push(this.uiSegmentSrv.newCondition("AND")),void 0!==n.key&&void 0!==n.value&&(this.segments.push(this.uiSegmentSrv.newKey(n.key)),this.segments.push(this.uiSegmentSrv.newOperator(n.operator)),this.segments.push(this.uiSegmentSrv.newKeyValue(n.value)))}this.segments.push(this.uiSegmentSrv.newPlusButton())},t.prototype.getOptions=function(t,e){var n=this;return"operator"===t.type?this.$q.when(this.uiSegmentSrv.newOperators(["=","!=","<",">","=~","!~"])):"condition"===t.type?this.$q.when([this.uiSegmentSrv.newSegment("AND")]):this.datasourceSrv.get(this.variable.datasource).then(function(r){var a={},o=null;return"value"!==t.type?o=r.getTagKeys():(a.key=n.segments[e-2].value,o=r.getTagValues(a)),o.then(function(e){return e=i.a.map(e,function(t){return n.uiSegmentSrv.newSegment({value:t.text})}),"key"===t.type&&e.splice(0,0,s.a.copy(n.removeTagFilterSegment)),e})})},t.prototype.segmentChanged=function(t,e){this.segments[e]=t,t.value===this.removeTagFilterSegment.value?(this.segments.splice(e,3),0===this.segments.length?this.segments.push(this.uiSegmentSrv.newPlusButton()):this.segments.length>2&&(this.segments.splice(Math.max(e-1,0),1),"plus-button"!==this.segments[this.segments.length-1].type&&this.segments.push(this.uiSegmentSrv.newPlusButton()))):("plus-button"===t.type&&(e>2&&this.segments.splice(e,0,this.uiSegmentSrv.newCondition("AND")),this.segments.push(this.uiSegmentSrv.newOperator("=")),this.segments.push(this.uiSegmentSrv.newFake("select tag value","value","query-segment-value")),t.type="key",t.cssClass="query-segment-key"),e+1===this.segments.length&&this.segments.push(this.uiSegmentSrv.newPlusButton())),this.updateVariableModel()},t.prototype.updateVariableModel=function(){var t=[],e=-1,n=!1;this.segments.forEach(function(r){if("value"===r.type&&r.fake)return void(n=!0);switch(r.type){case"key":t.push({key:r.value}),e+=1;break;case"value":t[e].value=r.value;break;case"operator":t[e].operator=r.value;break;case"condition":t[e].condition=r.value}}),n||(this.variable.setFilters(t),this.variableSrv.variableUpdated(this.variable,!0))},t}(),c='\n<div class="gf-form-inline">\n  <div class="gf-form" ng-repeat="segment in ctrl.segments">\n    <metric-segment segment="segment" get-options="ctrl.getOptions(segment, $index)"\n                    on-change="ctrl.segmentChanged(segment, $index)"></metric-segment>\n  </div>\n</div>\n';l.a.directive("adHocFilters",r)},1686:function(t,e,n){"use strict";function r(t){return{restrict:"E",template:a,scope:{panel:"="},link:function(e,n){n.css({display:"block",width:"100%"}),e.variables=t.variables.map(function(t){return{text:t.name,value:t.name}}),0===e.variables.length&&e.variables.unshift({text:"No template variables found",value:null}),e.variables.unshift({text:"Disabled",value:null}),e.panel.repeat&&!e.panel.repeatDirection&&(e.panel.repeatDirection="h"),e.optionChanged=function(){e.panel.repeat&&(e.panel.repeatDirection="h")}}}}r.$inject=["variableSrv"];var a='\n<div class="gf-form-select-wrapper max-width-18">\n  <select class="gf-form-input" ng-model="panel.repeat" ng-options="f.value as f.text for f in variables" ng-change="optionChanged()">\n  <option value=""></option>\n</div>\n';n(225).d.directive("dashRepeatOption",r)},1687:function(t,e,n){"use strict";var r=n(147),a=n(1688);Object(r.a)("dashboardGrid",a.a,[["getPanelContainer",{watchDepth:"reference",wrapApply:!1}]])},1688:function(t,e,n){"use strict";function r(t){var e=t.size,n=t.layout,r=t.onLayoutChange,a=t.children,o=t.onDragStop,u=t.onResize,c=t.onResizeStop,p=t.onWidthChange,d=t.className,h=t.isResizable,f=t.isDraggable;0===e.width&&console.log("size is zero!");var g=e.width>0?e.width:m;return g!==m&&(p(),m=g),i.a.createElement(s.a,{width:m,className:d,isDraggable:f,isResizable:h,measureBeforeMount:!1,containerPadding:[0,0],useCSSTransforms:!0,margin:[l.d,l.d],cols:l.e,rowHeight:l.c,draggableHandle:".grid-drag-handle",layout:n,onResize:u,onResizeStop:c,onDragStop:o,onLayoutChange:r},a)}n.d(e,"a",function(){return v});var a=n(2),i=n.n(a),o=n(530),s=n.n(o),l=n(228),u=n(1689),c=n(61),p=n.n(c),d=n(531),h=n.n(d),f=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=1200,g=h()({monitorWidth:!0})(r),v=function(t){function e(e){var n=t.call(this,e)||this;return n.panelContainer=n.props.getPanelContainer(),n.onLayoutChange=n.onLayoutChange.bind(n),n.onResize=n.onResize.bind(n),n.onResizeStop=n.onResizeStop.bind(n),n.onDragStop=n.onDragStop.bind(n),n.onWidthChange=n.onWidthChange.bind(n),n.state={animated:!1},n.dashboard=n.panelContainer.getDashboard(),n.dashboard.on("panel-added",n.triggerForceUpdate.bind(n)),n.dashboard.on("panel-removed",n.triggerForceUpdate.bind(n)),n.dashboard.on("repeats-processed",n.triggerForceUpdate.bind(n)),n.dashboard.on("view-mode-changed",n.triggerForceUpdate.bind(n)),n.dashboard.on("row-collapsed",n.triggerForceUpdate.bind(n)),n.dashboard.on("row-expanded",n.triggerForceUpdate.bind(n)),n}return f(e,t),e.prototype.buildLayout=function(){var t=[];this.panelMap={};for(var e=0,n=this.dashboard.panels;e<n.length;e++){var r=n[e],a=r.id.toString();if(this.panelMap[a]=r,r.gridPos){var i={i:a,x:r.gridPos.x,y:r.gridPos.y,w:r.gridPos.w,h:r.gridPos.h};"row"===r.type&&(i.w=l.e,i.h=1,i.isResizable=!1,i.isDraggable=r.collapsed),t.push(i)}else console.log("panel without gridpos")}return t},e.prototype.onLayoutChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this.panelMap[r.i].updateGridPos(r)}this.dashboard.sortPanelsByGridPos()},e.prototype.triggerForceUpdate=function(){this.forceUpdate()},e.prototype.onWidthChange=function(){for(var t=0,e=this.dashboard.panels;t<e.length;t++){e[t].resizeDone()}},e.prototype.updateGridPos=function(t,e){this.panelMap[t.i].updateGridPos(t),this.onLayoutChange(e)},e.prototype.onResize=function(t,e,n){this.panelMap[n.i].updateGridPos(n)},e.prototype.onResizeStop=function(t,e,n){this.updateGridPos(n,t),this.panelMap[n.i].resizeDone()},e.prototype.onDragStop=function(t,e,n){this.updateGridPos(n,t)},e.prototype.componentDidMount=function(){var t=this;setTimeout(function(){t.setState(function(){return{animated:!0}})})},e.prototype.renderPanels=function(){for(var t=[],e=0,n=this.dashboard.panels;e<n.length;e++){var r=n[e],a=p()({panel:!0,"panel--fullscreen":r.fullscreen});t.push(i.a.createElement("div",{key:r.id.toString(),className:a},i.a.createElement(u.a,{panel:r,getPanelContainer:this.props.getPanelContainer})))}return t},e.prototype.render=function(){return i.a.createElement(g,{className:p()({layout:!0,animated:this.state.animated}),layout:this.buildLayout(),isResizable:this.dashboard.meta.canEdit,isDraggable:this.dashboard.meta.canEdit,onLayoutChange:this.onLayoutChange,onWidthChange:this.onWidthChange,onDragStop:this.onDragStop,onResize:this.onResize,onResizeStop:this.onResizeStop},this.renderPanels())},e}(i.a.Component)},1689:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n(2),a=n.n(r),i=n(1690),o=n(1691),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function e(e){var n=t.call(this,e)||this;return n.state={},n}return s(e,t),e.prototype.componentDidMount=function(){if(this.element){var t=this.props.getPanelContainer(),e=t.getDashboard(),n=t.getPanelLoader();this.attachedPanel=n.load(this.element,this.props.panel,e)}},e.prototype.componentWillUnmount=function(){this.attachedPanel&&this.attachedPanel.destroy()},e.prototype.render=function(){var t=this;return"row"===this.props.panel.type?a.a.createElement(i.a,{panel:this.props.panel,getPanelContainer:this.props.getPanelContainer}):"add-panel"===this.props.panel.type?a.a.createElement(o.a,{panel:this.props.panel,getPanelContainer:this.props.getPanelContainer}):a.a.createElement("div",{ref:function(e){return t.element=e},className:"panel-height-helper"})},e}(a.a.Component)},1690:function(t,e,n){"use strict";n.d(e,"a",function(){return c});var r=n(2),a=n.n(r),i=n(61),o=n.n(i),s=n(1477),l=n(17),u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),c=function(t){function e(e){var n=t.call(this,e)||this;return n.state={collapsed:n.props.panel.collapsed},n.panelContainer=n.props.getPanelContainer(),n.dashboard=n.panelContainer.getDashboard(),n.toggle=n.toggle.bind(n),n.openSettings=n.openSettings.bind(n),n.delete=n.delete.bind(n),n.update=n.update.bind(n),n}return u(e,t),e.prototype.toggle=function(){this.dashboard.toggleRow(this.props.panel),this.setState(function(t){return{collapsed:!t.collapsed}})},e.prototype.update=function(){this.dashboard.processRepeats(),this.forceUpdate()},e.prototype.openSettings=function(){l.a.emit("show-modal",{templateHtml:'<row-options row="model.row" on-updated="model.onUpdated()" dismiss="dismiss()"></row-options>',modalClass:"modal--narrow",model:{row:this.props.panel,onUpdated:this.update.bind(this)}})},e.prototype.delete=function(){var t=this;l.a.emit("confirm-modal",{title:"Delete Row",text:"Are you sure you want to remove this row and all its panels?",altActionText:"Delete row only",icon:"fa-trash",onConfirm:function(){t.props.getPanelContainer().getDashboard().removeRow(t.props.panel,!0)},onAltAction:function(){t.props.getPanelContainer().getDashboard().removeRow(t.props.panel,!1)}})},e.prototype.render=function(){var t=o()({"dashboard-row":!0,"dashboard-row--collapsed":this.state.collapsed}),e=o()({fa:!0,"fa-chevron-down":!this.state.collapsed,"fa-chevron-right":this.state.collapsed}),n=s.a.replaceWithText(this.props.panel.title,this.props.panel.scopedVars),r=this.props.panel.panels?this.props.panel.panels.length:0;return a.a.createElement("div",{className:t},a.a.createElement("a",{className:"dashboard-row__title pointer",onClick:this.toggle},a.a.createElement("i",{className:e}),n,a.a.createElement("span",{className:"dashboard-row__panel_count"},"(",r," hidden panels)")),!0===this.dashboard.meta.canEdit&&a.a.createElement("div",{className:"dashboard-row__actions"},a.a.createElement("a",{className:"pointer",onClick:this.openSettings},a.a.createElement("i",{className:"fa fa-cog"})),a.a.createElement("a",{className:"pointer",onClick:this.delete},a.a.createElement("i",{className:"fa fa-trash"}))),a.a.createElement("div",{className:"dashboard-row__drag grid-drag-handle"}))},e}(a.a.Component)},1691:function(t,e,n){"use strict";n.d(e,"a",function(){return g});var r=n(2),a=n.n(r),i=n(4),o=n.n(i),s=n(61),l=n.n(s),u=n(22),c=n(1692),p=n(109),d=n(228),h=n(232),f=n.n(h),m=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=function(t){function e(e){var n=t.call(this,e)||this;return n.onAddPanel=function(t){var e=n.props.getPanelContainer(),r=e.getDashboard(),a=n.props.panel.gridPos,i={type:t.id,title:"Panel Title",gridPos:{x:a.x,y:a.y,w:a.w,h:a.h}};"row"===t.id&&(i.title="Row title",i.gridPos={x:0,y:0}),t.defaults&&(o.a.defaults(i,t.defaults),i.gridPos.w=t.defaults.gridPos.w,i.gridPos.h=t.defaults.gridPos.h,i.title=t.defaults.title,p.a.delete(d.f)),r.addPanel(i),r.removePanel(n.props.panel)},n.handleCloseAddPanel=n.handleCloseAddPanel.bind(n),n.renderPanelItem=n.renderPanelItem.bind(n),n.panelSizeChanged=n.panelSizeChanged.bind(n),n.state={panelPlugins:n.getPanelPlugins(""),copiedPanelPlugins:n.getCopiedPanelPlugins(""),filter:"",tab:"Add"},n}return m(e,t),e.prototype.componentDidMount=function(){this.props.panel.events.on("panel-size-changed",this.panelSizeChanged)},e.prototype.componentWillUnmount=function(){this.props.panel.events.off("panel-size-changed",this.panelSizeChanged)},e.prototype.panelSizeChanged=function(){var t=this;setTimeout(function(){t.scrollbar.update()})},e.prototype.getPanelPlugins=function(t){var e=o.a.chain(u.a.panels).filter({hideFromList:!1}).map(function(t){return t}).value();return e.push({id:"row",name:"Row",sort:8,info:{logos:{small:"public/img/icn-row.svg"}}}),e=this.filterPanels(e,t),o.a.sortBy(e,"sort")},e.prototype.getCopiedPanelPlugins=function(t){var e=o.a.chain(u.a.panels).filter({hideFromList:!1}).map(function(t){return t}).value(),n=[],r=p.a.get(d.f);if(r){var a=JSON.parse(r),i=o.a.find(e,{id:a.type});if(i){var s=o.a.cloneDeep(i);s.name=a.title,s.sort=-1,s.defaults=a,n.push(s)}}return n=this.filterPanels(n,t),o.a.sortBy(n,"sort")},e.prototype.handleCloseAddPanel=function(t){t.preventDefault();var e=this.props.getPanelContainer(),n=e.getDashboard();n.removePanel(n.panels[0])},e.prototype.renderText=function(t){var e=this.state.filter.split("");return a.a.createElement(f.a,{highlightClassName:"highlight-search-match",textToHighlight:t,searchWords:e})},e.prototype.renderPanelItem=function(t,e){var n=this;return a.a.createElement("div",{key:e,className:"add-panel__item",onClick:function(){return n.onAddPanel(t)},title:t.name},a.a.createElement("img",{className:"add-panel__item-img",src:t.info.logos.small}),a.a.createElement("div",{className:"add-panel__item-name"},this.renderText(t.name)))},e.prototype.noCopiedPanelPlugins=function(){return a.a.createElement("div",{className:"add-panel__no-panels"},"No copied panels yet.")},e.prototype.filterChange=function(t){this.setState({filter:t.target.value,panelPlugins:this.getPanelPlugins(t.target.value),copiedPanelPlugins:this.getCopiedPanelPlugins(t.target.value)})},e.prototype.filterPanels=function(t,e){var n=new RegExp(e,"i");return t.filter(function(t){return n.test(t.name)})},e.prototype.openCopy=function(){this.setState({tab:"Copy",filter:"",panelPlugins:this.getPanelPlugins(""),copiedPanelPlugins:this.getCopiedPanelPlugins("")})},e.prototype.openAdd=function(){this.setState({tab:"Add",filter:"",panelPlugins:this.getPanelPlugins(""),copiedPanelPlugins:this.getCopiedPanelPlugins("")})},e.prototype.render=function(){var t,e=this,n=l()({"active active--panel":"Add"===this.state.tab,"":"Copy"===this.state.tab}),r=l()({"":"Add"===this.state.tab,"active active--panel":"Copy"===this.state.tab});return"Add"===this.state.tab?t=this.state.panelPlugins.map(this.renderPanelItem):"Copy"===this.state.tab&&(t=this.state.copiedPanelPlugins.length>0?this.state.copiedPanelPlugins.map(this.renderPanelItem):this.noCopiedPanelPlugins()),a.a.createElement("div",{className:"panel-container add-panel-container"},a.a.createElement("div",{className:"add-panel"},a.a.createElement("div",{className:"add-panel__header"},a.a.createElement("i",{className:"gicon gicon-add-panel"}),a.a.createElement("span",{className:"add-panel__title"},"New Panel"),a.a.createElement("ul",{className:"gf-tabs"},a.a.createElement("li",{className:"gf-tabs-item"},a.a.createElement("div",{className:"gf-tabs-link pointer "+n,onClick:this.openAdd.bind(this)},"Add")),a.a.createElement("li",{className:"gf-tabs-item"},a.a.createElement("div",{className:"gf-tabs-link pointer "+r,onClick:this.openCopy.bind(this)},"Paste"))),a.a.createElement("button",{className:"add-panel__close",onClick:this.handleCloseAddPanel},a.a.createElement("i",{className:"fa fa-close"}))),a.a.createElement(c.a,{ref:function(t){return e.scrollbar=t},className:"add-panel__items"},a.a.createElement("div",{className:"add-panel__searchbar"},a.a.createElement("label",{className:"gf-form gf-form--grow gf-form--has-input-icon"},a.a.createElement("input",{type:"text",className:"gf-form-input max-width-20",placeholder:"Panel Search Filter",value:this.state.filter,onChange:this.filterChange.bind(this)}),a.a.createElement("i",{className:"gf-form-input-icon fa fa-search"}))),t)))},e}(a.a.Component)},1692:function(t,e,n){"use strict";var r=n(2),a=n.n(r),i=n(229),o=n.n(i),s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),l=function(t){function e(e){var n=t.call(this,e)||this;return n.handleRef=function(t){n.container=t},n}return s(e,t),e.prototype.componentDidMount=function(){this.scrollbar=o()({root:this.container.parentElement,scroller:this.container,bar:".baron__bar",barOnCls:"_scrollbar",scrollingCls:"_scrolling",track:".baron__track"})},e.prototype.componentDidUpdate=function(){this.scrollbar.update()},e.prototype.componentWillUnmount=function(){this.scrollbar.dispose()},e.prototype.setScrollTop=function(t){return!!this.container&&(this.container.scrollTop=t,this.scrollbar.update(),!0)},e.prototype.setScrollLeft=function(t){return!!this.container&&(this.container.scrollLeft=t,this.scrollbar.update(),!0)},e.prototype.update=function(){this.scrollbar.update()},e.prototype.render=function(){return a.a.createElement("div",{className:"baron baron__root baron__clipper"},a.a.createElement("div",{className:this.props.className+" baron__scroller",ref:this.handleRef},this.props.children),a.a.createElement("div",{className:"baron__track"},a.a.createElement("div",{className:"baron__bar"})))},e}(a.a.Component);e.a=l},1693:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(3),o=function(){function t(t,e){this.$compile=t,this.$rootScope=e}return t.$inject=["$compile","$rootScope"],t.prototype.load=function(t,e,n){var r=this.$rootScope.$new();r.panel=e,r.dashboard=n;var i=this.$compile('<plugin-component type="panel" class="panel-height-helper"></plugin-component>')(r);return a.a.element(t).append(i),{destroy:function(){r.$destroy(),i.remove()}}},t}();i.a.service("panelLoader",o)},1694:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/partials/row_options.html",controller:i,bindToController:!0,controllerAs:"ctrl",scope:{row:"=",dismiss:"&",onUpdated:"&"}}}var a=n(225),i=function(){function t(){this.source=this.row,this.row=this.row.getSaveModel()}return t.prototype.update=function(){this.source.title=this.row.title,this.source.repeat=this.row.repeat,this.onUpdated(),this.dismiss()},t}();a.d.directive("rowOptions",r)},1695:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/folder_picker/folder_picker.html",controller:l,bindToController:!0,controllerAs:"ctrl",scope:{initialTitle:"<",initialFolderId:"<",labelClass:"@",rootName:"@",onChange:"&",onLoad:"&",onCreateFolder:"&",enterFolderCreation:"&",exitFolderCreation:"&",enableCreateNew:"@"}}}var a=n(4),i=n.n(a),o=n(3),s=n(17),l=function(){function t(t,e,n){this.backendSrv=t,this.validationSrv=e,this.contextSrv=n,this.rootName="General",this.isEditor=this.contextSrv.isEditor,this.labelClass||(this.labelClass="width-7"),this.loadInitialValue()}return t.$inject=["backendSrv","validationSrv","contextSrv"],t.prototype.getOptions=function(t){var e=this,n={query:t,type:"dash-folder",permission:"Edit"};return this.backendSrv.get("api/search",n).then(function(n){return!e.isEditor||""!==t&&"g"!==t.toLowerCase()&&"ge"!==t.toLowerCase()&&"gen"!==t.toLowerCase()&&"gene"!==t.toLowerCase()&&"gener"!==t.toLowerCase()&&"genera"!==t.toLowerCase()&&"general"!==t.toLowerCase()||n.unshift({title:e.rootName,id:0}),e.isEditor&&e.enableCreateNew&&""===t&&n.unshift({title:"-- New Folder --",id:-1}),i.a.map(n,function(t){return{text:t.title,value:t.id}})})},t.prototype.onFolderChange=function(t){if(-1===t.value)return this.createNewFolder=!0,void this.enterFolderCreation();this.onChange({$folder:{id:t.value,title:t.text}})},t.prototype.newFolderNameChanged=function(){var t=this;this.newFolderNameTouched=!0,this.validationSrv.validateNewFolderName(this.newFolderName).then(function(){t.hasValidationError=!1}).catch(function(e){t.hasValidationError=!0,t.validationError=e.message})},t.prototype.createFolder=function(t){var e=this;return t&&(t.stopPropagation(),t.preventDefault()),this.backendSrv.createFolder({title:this.newFolderName}).then(function(t){s.a.emit("alert-success",["Folder Created","OK"]),e.closeCreateFolder(),e.folder={text:t.title,value:t.id},e.onFolderChange(e.folder)})},t.prototype.cancelCreateFolder=function(t){t&&(t.stopPropagation(),t.preventDefault()),this.closeCreateFolder(),this.loadInitialValue()},t.prototype.closeCreateFolder=function(){this.exitFolderCreation(),this.createNewFolder=!1,this.hasValidationError=!1,this.validationError=null,this.newFolderName="",this.newFolderNameTouched=!1},t.prototype.loadInitialValue=function(){var t=this;this.initialFolderId&&this.initialFolderId>0?this.getOptions("").then(function(e){t.folder=i.a.find(e,{value:t.initialFolderId}),t.folder||(t.folder={text:t.initialTitle,value:t.initialFolderId}),t.onFolderLoad()}):(this.initialTitle?this.folder={text:this.initialTitle,value:null}:this.folder={text:this.rootName,value:0},this.onFolderLoad())},t.prototype.onFolderLoad=function(){this.onLoad&&this.onLoad({$folder:{id:this.folder.value,title:this.folder.text}})},t}();o.a.directive("folderPicker",r)},1696:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/move_to_folder_modal/move_to_folder.html",controller:o,bindToController:!0,controllerAs:"ctrl",scope:{dismiss:"&",dashboards:"=",afterSave:"&"}}}var a=n(3),i=n(17),o=function(){function t(t){this.backendSrv=t,this.isValidFolderSelection=!0}return t.$inject=["backendSrv"],t.prototype.onFolderChange=function(t){this.folder=t},t.prototype.save=function(){var t=this;return this.backendSrv.moveDashboards(this.dashboards,this.folder).then(function(e){if(e.successCount>0){var n="Dashboard"+(1===e.successCount?"":"s")+" Moved",r=e.successCount+" dashboard"+(1===e.successCount?"":"s")+" moved to "+t.folder.title;i.a.emit("alert-success",[n,r])}return e.totalCount===e.alreadyInFolderCount&&i.a.emit("alert-error",["Error","Dashboards already belongs to folder "+t.folder.title]),t.dismiss(),t.afterSave()})},t.prototype.onEnterFolderCreation=function(){this.isValidFolderSelection=!1},t.prototype.onExitFolderCreation=function(){this.isValidFolderSelection=!0},t}();a.a.directive("moveToFolderModal",r)},1697:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/dashboard/settings/settings.html",controller:c,bindToController:!0,controllerAs:"ctrl",transclude:!0,scope:{dashboard:"="}}}var a=n(225),i=n(16),o=n.n(i),s=n(4),l=n.n(s),u=n(22),c=function(){function t(t,e,n,r,i){var o=this;this.$scope=t,this.$location=e,this.$rootScope=n,this.backendSrv=r,this.dashboardSrv=i,t.dashboard=this.dashboard,this.$scope.$on("$destroy",function(){o.dashboard.updateSubmenuVisibility(),o.$rootScope.$broadcast("refresh"),setTimeout(function(){o.$rootScope.appEvent("dash-scroll",{restore:!0})})}),this.canSaveAs=a.c.isEditor,this.canSave=this.dashboard.meta.canSave,this.canDelete=this.dashboard.meta.canSave,this.buildSectionList(),this.onRouteUpdated(),this.$rootScope.onAppEvent("$routeUpdate",this.onRouteUpdated.bind(this),t),this.$rootScope.appEvent("dash-scroll",{animate:!1,pos:0}),this.$rootScope.onAppEvent("dashboard-saved",this.onPostSave.bind(this),t)}return t.$inject=["$scope","$location","$rootScope","backendSrv","dashboardSrv"],t.prototype.buildSectionList=function(){this.sections=[],this.dashboard.meta.canEdit&&(this.sections.push({title:"General",id:"settings",icon:"gicon gicon-preferences"}),this.sections.push({title:"Annotations",id:"annotations",icon:"gicon gicon-annotation"}),this.sections.push({title:"Variables",id:"templating",icon:"gicon gicon-variable"}),this.sections.push({title:"Links",id:"links",icon:"gicon gicon-link"})),this.dashboard.id&&this.dashboard.meta.canSave&&this.sections.push({title:"Versions",id:"versions",icon:"fa fa-fw fa-history"}),this.dashboard.id&&this.dashboard.meta.canAdmin&&this.sections.push({title:"Permissions",id:"permissions",icon:"fa fa-fw fa-lock"}),this.dashboard.meta.canMakeEditable&&this.sections.push({title:"General",icon:"gicon gicon-preferences",id:"make_editable"}),this.sections.push({title:"View JSON",id:"view_json",icon:"gicon gicon-json"});for(var t=this.$location.search(),e=this.$location.path(),n=0,r=this.sections;n<r.length;n++){var a=r[n],i=l.a.defaults({editview:a.id},t);a.url=u.a.appSubUrl+e+"?"+o.a.param(i)}},t.prototype.onRouteUpdated=function(){this.viewId=this.$location.search().editview,this.viewId&&(this.json=JSON.stringify(this.dashboard.getSaveModelClone(),null,2)),"settings"===this.viewId&&this.dashboard.meta.canMakeEditable&&(this.viewId="make_editable"),l.a.find(this.sections,{id:this.viewId})||(this.sections.unshift({title:"Not found",id:"404",icon:"fa fa-fw fa-warning"}),this.viewId="404")},t.prototype.openSaveAsModal=function(){this.dashboardSrv.showSaveAsModal()},t.prototype.saveDashboard=function(){this.dashboardSrv.saveDashboard()},t.prototype.onPostSave=function(){this.hasUnsavedFolderChange=!1},t.prototype.hideSettings=function(){var t=this,e=this.$location.search();delete e.editview,setTimeout(function(){t.$rootScope.$apply(function(){t.$location.search(e)})})},t.prototype.makeEditable=function(){this.dashboard.editable=!0,this.dashboard.meta.canMakeEditable=!1,this.dashboard.meta.canEdit=!0,this.dashboard.meta.canSave=!0,this.canDelete=!0,this.viewId="settings",this.buildSectionList();var t=l.a.find(this.sections,{id:this.viewId});this.$location.url(t.url)},t.prototype.deleteDashboard=function(){var t=this,e="",n=this.dashboard.title,r=l.a.sumBy(this.dashboard.panels,function(t){return t.alert?1:0});r>0&&(e="DELETE",n="This dashboard contains "+r+" alerts. Deleting this dashboard will also delete those alerts"),a.b.emit("confirm-modal",{title:"Delete",text:"Do you want to delete this dashboard?",text2:n,icon:"fa-trash",confirmText:e,yesText:"Delete",onConfirm:function(){t.dashboard.meta.canSave=!1,t.deleteDashboardConfirmed()}})},t.prototype.deleteDashboardConfirmed=function(){var t=this;this.backendSrv.deleteDashboard(this.dashboard.uid).then(function(){a.b.emit("alert-success",["Dashboard Deleted",t.dashboard.title+" has been deleted"]),t.$location.url("/")})},t.prototype.onFolderChange=function(t){this.dashboard.meta.folderId=t.id,this.dashboard.meta.folderTitle=t.title,this.hasUnsavedFolderChange=!0},t.prototype.getFolder=function(){return{id:this.dashboard.meta.folderId,title:this.dashboard.meta.folderTitle,url:this.dashboard.meta.folderUrl}},t}();a.d.directive("dashboardSettings",r)},1698:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(){function t(t){this.navModel=t.getNav("dashboards","manage-dashboards",0)}return t.$inject=["navModelSrv"],t}()},1699:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(1499),a=n(226),i=function(){function t(t,e,n,i){if(this.backendSrv=t,this.$routeParams=n,this.$routeParams.uid){this.uid=n.uid;new r.a(this.backendSrv).load(this,this.uid,"manage-folder-dashboards").then(function(t){var e=a.a.stripBaseFromUrl(t.url);e!==i.path()&&i.path(e).replace()})}}return t.$inject=["backendSrv","navModelSrv","$routeParams","$location"],t}()},1700:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(1499),a=n(17),i=function(){function t(t,e,n,a){var i=this;this.backendSrv=t,this.$routeParams=n,this.$location=a,this.canSave=!1,this.$routeParams.uid&&(this.uid=n.uid,this.folderPageLoader=new r.a(this.backendSrv),this.folderPageLoader.load(this,this.uid,"manage-folder-settings").then(function(t){a.path()!==t.meta.url&&a.path(t.meta.url+"/settings").replace(),i.folder=t,i.canSave=i.folder.canSave,i.title=i.folder.title}))}return t.$inject=["backendSrv","navModelSrv","$routeParams","$location"],t.prototype.save=function(){var t=this;if(this.titleChanged(),this.hasChanged)return this.folder.title=this.title.trim(),this.backendSrv.updateFolder(this.folder).then(function(e){e.url!==t.$location.path()&&t.$location.url(e.url+"/settings"),a.a.emit("dashboard-saved"),a.a.emit("alert-success",["Folder saved"])}).catch(this.handleSaveFolderError)},t.prototype.titleChanged=function(){this.hasChanged=this.folder.title.toLowerCase()!==this.title.trim().toLowerCase()},t.prototype.delete=function(t){var e=this;t&&(t.stopPropagation(),t.preventDefault()),a.a.emit("confirm-modal",{title:"Delete",text:"Do you want to delete this folder and all its dashboards?",icon:"fa-trash",yesText:"Delete",onConfirm:function(){return e.backendSrv.deleteFolder(e.uid).then(function(){a.a.emit("alert-success",["Folder Deleted",e.folder.title+" has been deleted"]),e.$location.url("dashboards")})}})},t.prototype.handleSaveFolderError=function(t){var e=this;t.data&&"version-mismatch"===t.data.status&&(t.isHandled=!0,a.a.emit("confirm-modal",{title:"Conflict",text:"Someone else has updated this folder.",text2:"Would you still like to save this folder?",yesText:"Save & Overwrite",icon:"fa-warning",onConfirm:function(){e.backendSrv.updateFolder(e.folder,{overwrite:!0})}}))},t}()},1701:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(4),a=n.n(r),i=n(22),o=function(){function t(t,e,n,r,a){this.backendSrv=t,this.validationSrv=e,this.$location=r,this.navModel=n.getNav("create","import"),this.step=1,this.nameExists=!1,a.gnetId&&(this.gnetUrl=a.gnetId,this.checkGnetDashboard())}return t.$inject=["backendSrv","validationSrv","navModelSrv","$location","$routeParams"],t.prototype.onUpload=function(t){if(this.dash=t,this.dash.id=null,this.step=2,this.inputs=[],this.dash.__inputs)for(var e=0,n=this.dash.__inputs;e<n.length;e++){var r=n[e],a={name:r.name,label:r.label,info:r.description,value:r.value,type:r.type,pluginId:r.pluginId,options:[]};"datasource"===r.type?this.setDatasourceOptions(r,a):a.info||(a.info="Specify a string constant"),this.inputs.push(a)}this.inputsValid=0===this.inputs.length,this.titleChanged()},t.prototype.setDatasourceOptions=function(t,e){var n=a.a.filter(i.a.datasources,function(e){return e.type===t.pluginId});0===n.length?e.info="No data sources of type "+t.pluginName+" found":e.info||(e.info="Select a "+t.pluginName+" data source"),e.options=n.map(function(t){return{text:t.name,value:t.name}})},t.prototype.inputValueChanged=function(){this.inputsValid=!0;for(var t=0,e=this.inputs;t<e.length;t++){e[t].value||(this.inputsValid=!1)}},t.prototype.titleChanged=function(){var t=this;this.titleTouched=!0,this.nameExists=!1,this.validationSrv.validateNewDashboardName(0,this.dash.title).then(function(){t.hasNameValidationError=!1}).catch(function(e){"EXISTING"===e.type&&(t.nameExists=!0),t.hasNameValidationError=!0,t.nameValidationError=e.message})},t.prototype.saveDashboard=function(){var t=this,e=this.inputs.map(function(t){return{name:t.name,type:t.type,pluginId:t.pluginId,value:t.value}});return this.backendSrv.post("api/dashboards/import",{dashboard:this.dash,overwrite:!0,inputs:e}).then(function(e){t.$location.url(e.importedUrl)})},t.prototype.loadJsonText=function(){try{this.parseError="";var t=JSON.parse(this.jsonText);this.onUpload(t)}catch(t){return console.log(t),void(this.parseError=t.message)}},t.prototype.checkGnetDashboard=function(){var t=this;this.gnetError="";var e,n=/(^\d+$)|dashboards\/(\d+)/.exec(this.gnetUrl);return n&&n[1]?e=n[1]:n&&n[2]?e=n[2]:this.gnetError="Could not find dashboard",this.backendSrv.get("api/gnet/dashboards/"+e).then(function(e){t.gnetInfo=e,e.json.gnetId=e.id,t.onUpload(e.json)}).catch(function(e){e.isHandled=!0,t.gnetError=e.data.message||e})},t.prototype.back=function(){this.gnetUrl="",this.step=1,this.gnetError="",this.gnetInfo=""},t}()},1702:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(17),a=n(226),i=function(){function t(t,e,n,r){this.backendSrv=t,this.$location=e,this.validationSrv=n,this.title="",this.titleTouched=!1,this.navModel=r.getNav("dashboards","manage-dashboards",0)}return t.$inject=["backendSrv","$location","validationSrv","navModelSrv"],t.prototype.create=function(){var t=this;if(!this.hasValidationError)return this.backendSrv.createFolder({title:this.title}).then(function(e){r.a.emit("alert-success",["Folder Created","OK"]),t.$location.url(a.a.stripBaseFromUrl(e.url))})},t.prototype.titleChanged=function(){var t=this;this.titleTouched=!0,this.validationSrv.validateNewFolderName(this.title).then(function(){t.hasValidationError=!1}).catch(function(e){t.hasValidationError=!0,t.validationError=e.message})},t}()},1703:function(t,e,n){"use strict";n(1704),n(1705),n(1706),n(1707),n(1708)},1704:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(3),o=function(){function t(t,e,n){var r=this;this.$scope=t,this.backendSrv=e,this.navModel=n.getNav("dashboards","playlists",0),e.get("/api/playlists").then(function(t){r.playlists=t})}return t.$inject=["$scope","backendSrv","navModelSrv"],t.prototype.removePlaylistConfirmed=function(t){var e=this;a.a.remove(this.playlists,{id:t.id}),this.backendSrv.delete("/api/playlists/"+t.id).then(function(){e.$scope.appEvent("alert-success",["Playlist deleted",""])},function(){e.$scope.appEvent("alert-error",["Unable to delete playlist",""]),e.playlists.push(t)})},t.prototype.removePlaylist=function(t){var e=this;this.$scope.appEvent("confirm-modal",{title:"Delete",text:"Are you sure you want to delete playlist "+t.name+"?",yesText:"Delete",icon:"fa-trash",onConfirm:function(){e.removePlaylistConfirmed(t)}})},t}();i.a.controller("PlaylistsCtrl",o)},1705:function(t,e,n){"use strict";function r(){return{restrict:"E",templateUrl:"public/app/features/playlist/partials/playlist_search.html",controller:i,bindToController:!0,controllerAs:"ctrl",scope:{searchStarted:"&"}}}var a=n(3),i=function(){function t(t,e){var n=this;this.backendSrv=e,this.query={query:"",tag:[],starred:!1,limit:30},t(function(){n.query.query="",n.query.type="dash-db",n.searchDashboards()},100)}return t.$inject=["$timeout","backendSrv"],t.prototype.searchDashboards=function(){this.tagsMode=!1;var t={};t.promise=this.backendSrv.search(this.query).then(function(t){return{dashboardResult:t,tagResult:[]}}),this.searchStarted(t)},t.prototype.showStarred=function(){this.query.starred=!this.query.starred,this.searchDashboards()},t.prototype.queryHasNoFilters=function(){return""===this.query.query&&!1===this.query.starred&&0===this.query.tag.length},t.prototype.filterByTag=function(t,e){this.query.tag.push(t),this.searchDashboards(),e&&(e.stopPropagation(),e.preventDefault())},t.prototype.getTags=function(){var t={};t.promise=this.backendSrv.get("/api/dashboards/tags").then(function(t){return{dashboardResult:[],tagResult:t}}),this.searchStarted(t)},t}();a.a.directive("playlistSearch",r)},1706:function(t,e,n){"use strict";var r=n(3),a=n(224),i=n(17),o=function(){function t(t,e,n,r){this.$location=t,this.$timeout=e,this.backendSrv=n,this.$routeParams=r}return t.$inject=["$location","$timeout","backendSrv","$routeParams"],t.prototype.next=function(){var t=this;if(this.$timeout.cancel(this.cancelPromise),this.index>this.dashboards.length-1)return void(window.location.href=this.getUrlWithKioskMode());var e=this.dashboards[this.index];this.$location.url("dashboard/"+e.uri),this.index++,this.cancelPromise=this.$timeout(function(){return t.next()},this.interval)},t.prototype.getUrlWithKioskMode=function(){var t=document.body.classList.contains("page-kiosk-mode");return t&&-1===this.startUrl.indexOf("kiosk")?this.startUrl+"?kiosk=true":t?this.startUrl:this.startUrl.split("?")[0]},t.prototype.prev=function(){this.index=Math.max(this.index-2,0),this.next()},t.prototype.start=function(t){var e=this;this.stop(),this.startUrl=window.location.href,this.index=0,this.isPlaying=!0,this.$routeParams.kiosk&&i.a.emit("toggle-kiosk-mode"),this.backendSrv.get("/api/playlists/"+t).then(function(n){e.backendSrv.get("/api/playlists/"+t+"/dashboards").then(function(t){e.dashboards=t,e.interval=a.a.interval_to_ms(n.interval),e.next()})})},t.prototype.stop=function(){this.index=0,this.isPlaying=!1,this.cancelPromise&&this.$timeout.cancel(this.cancelPromise)},t}();r.a.service("playlistSrv",o)},1707:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(3),o=function(){function t(t,e,n,r,a){var i=this;if(this.$scope=t,this.backendSrv=e,this.$location=n,this.filteredDashboards=[],this.filteredTags=[],this.searchQuery="",this.loading=!1,this.playlist={interval:"5m"},this.playlistItems=[],this.dashboardresult=[],this.tagresult=[],this.navModel=a.getNav("dashboards","playlists",0),this.isNew=r.current.params.id,r.current.params.id){var o=r.current.params.id;e.get("/api/playlists/"+o).then(function(t){i.playlist=t,i.navModel.node={text:t.name,icon:i.navModel.node.icon},i.navModel.breadcrumbs.push(i.navModel.node)}),e.get("/api/playlists/"+o+"/items").then(function(t){i.playlistItems=t})}else this.navModel.node={text:"New playlist",icon:this.navModel.node.icon},this.navModel.breadcrumbs.push(this.navModel.node)}return t.$inject=["$scope","backendSrv","$location","$route","navModelSrv"],t.prototype.filterFoundPlaylistItems=function(){var t=this;this.filteredDashboards=a.a.reject(this.dashboardresult,function(e){return a.a.find(t.playlistItems,function(t){return parseInt(t.value)===e.id})}),this.filteredTags=a.a.reject(this.tagresult,function(e){return a.a.find(t.playlistItems,function(t){return t.value===e.term})})},t.prototype.addPlaylistItem=function(t){t.value=t.id.toString(),t.type="dashboard_by_id",t.order=this.playlistItems.length+1,this.playlistItems.push(t),this.filterFoundPlaylistItems()},t.prototype.addTagPlaylistItem=function(t){var e={value:t.term,type:"dashboard_by_tag",order:this.playlistItems.length+1,title:t.term};this.playlistItems.push(e),this.filterFoundPlaylistItems()},t.prototype.removePlaylistItem=function(t){a.a.remove(this.playlistItems,function(e){return t===e}),this.filterFoundPlaylistItems()},t.prototype.savePlaylist=function(t,e){var n,r=this;t.items=e,n=t.id?this.backendSrv.put("/api/playlists/"+t.id,t):this.backendSrv.post("/api/playlists",t),n.then(function(){r.$scope.appEvent("alert-success",["Playlist saved",""]),r.$location.path("/playlists")},function(){r.$scope.appEvent("alert-error",["Unable to save playlist",""])})},t.prototype.isPlaylistEmpty=function(){return!this.playlistItems.length},t.prototype.backToList=function(){this.$location.path("/playlists")},t.prototype.searchStarted=function(t){var e=this;t.then(function(t){e.dashboardresult=t.dashboardResult,e.tagresult=t.tagResult,e.filterFoundPlaylistItems()})},t.prototype.movePlaylistItem=function(t,e){var n=this.playlistItems.indexOf(t),r=n+e;r>=0&&r<this.playlistItems.length&&(this.playlistItems.splice(n,1),this.playlistItems.splice(r,0,t))},t.prototype.movePlaylistItemUp=function(t){this.movePlaylistItem(t,-1)},t.prototype.movePlaylistItemDown=function(t){this.movePlaylistItem(t,1)},t}();i.a.controller("PlaylistEditCtrl",o)},1708:function(t,e,n){"use strict";function r(t){t.when("/playlists",{templateUrl:"public/app/features/playlist/partials/playlists.html",controllerAs:"ctrl",controller:"PlaylistsCtrl"}).when("/playlists/create",{templateUrl:"public/app/features/playlist/partials/playlist.html",controllerAs:"ctrl",controller:"PlaylistEditCtrl"}).when("/playlists/edit/:id",{templateUrl:"public/app/features/playlist/partials/playlist.html",controllerAs:"ctrl",controller:"PlaylistEditCtrl"}).when("/playlists/play/:id",{templateUrl:"public/app/features/playlist/partials/playlists.html",controllerAs:"ctrl",controller:"PlaylistsCtrl",resolve:{init:["playlistSrv","$route",function(t,e){var n=e.current.params.id;t.start(n)}]}})}r.$inject=["$routeProvider"];var a=n(21);n.n(a).a.module("grafana.routes").config(r)},1709:function(t,e,n){"use strict";n(1710)},1710:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=function(){function t(t,e,n){var r=this;this.$rootScope=t,this.backendSrv=e,this.navModel=n.getNav("dashboards","snapshots",0),this.backendSrv.get("/api/dashboard/snapshots").then(function(t){r.snapshots=t})}return t.$inject=["$rootScope","backendSrv","navModelSrv"],t.prototype.removeSnapshotConfirmed=function(t){var e=this;o.a.remove(this.snapshots,{key:t.key}),this.backendSrv.get("/api/snapshots-delete/"+t.deleteKey).then(function(){e.$rootScope.appEvent("alert-success",["Snapshot deleted",""])},function(){e.$rootScope.appEvent("alert-error",["Unable to delete snapshot",""]),e.snapshots.push(t)})},t.prototype.removeSnapshot=function(t){var e=this;this.$rootScope.appEvent("confirm-modal",{title:"Delete",text:"Are you sure you want to delete snapshot "+t.name+"?",yesText:"Delete",icon:"fa-trash",onConfirm:function(){e.removeSnapshotConfirmed(t)}})},t}();a.a.module("grafana.controllers").controller("SnapshotsCtrl",s)},1711:function(t,e,n){"use strict";n(1712),n(1713),n(1714),n(1478),n(1715),n(1716),n(1717)},1712:function(t,e,n){"use strict";function r(t,e){var n="",a="";if(t.divider)return'<li class="divider"></li>';if(t.submenu&&(a="dropdown-submenu"),n+='<li class="'+a+'"><a ',t.click&&(n+=' ng-click="'+t.click+'"'),t.href&&(n+=' href="'+t.href+'"'),n+='><i class="'+t.icon+'"></i>',n+='<span class="dropdown-item-text">'+t.text+"</span>",t.shortcut&&(n+='<span class="dropdown-menu-item-shortcut">'+t.shortcut+"</span>"),n+="</a>",t.submenu){n+='<ul class="dropdown-menu dropdown-menu--menu panel-menu">';for(var i=0,o=t.submenu;i<o.length;i++){n+=r(o[i],e)}n+="</ul>"}return n+="</li>"}function a(t){for(var e="",n=0,a=t.getMenu();n<a.length;n++){e+=r(a[n],t)}return e}function i(t){return{restrict:"E",template:l,link:function(e,n,r){function i(t){u||(t.stopPropagation(),o(),n.find("[data-toggle=dropdown]").dropdown("toggle"))}function o(){var t=n.find("[data-toggle=dropdown]").parentsUntil(".panel").parent(),e=n.find("[data-toggle=dropdown]").parent();if(t=t&&t.length?t[0]:void 0){t=s()(t),s()(".react-grid-item.panel").removeClass("dropdown-menu-open");var r=!e.hasClass("open");t.toggleClass("dropdown-menu-open",r)}}var l,u,c=n.find(".panel-menu");n.click(function(n){var r=n.target.className;l&&l.$destroy(),l=e.$new();var o=a(e.ctrl);c.html(o),t(c)(l),(r.indexOf("panel-title-text")>=0||r.indexOf("panel-title")>=0)&&i(n)}),n.find(".panel-menu-toggle").click(function(){o()});var p,d;n.mousedown(function(t){p=t.pageX,d=t.pageY}),n.mouseup(function(t){u=p!==t.pageX||d!==t.pageY})}}}i.$inject=["$compile"];var o=n(16),s=n.n(o),l='\n<span class="panel-title">\n  <span class="icon-gf panel-alert-icon"></span>\n  <span class="panel-title-text">{{ctrl.panel.title | interpolateTemplateVars:this}}</span>\n  <span class="panel-menu-container dropdown">\n    <span class="fa fa-caret-down panel-menu-toggle" data-toggle="dropdown"></span>\n    <ul class="dropdown-menu dropdown-menu--menu panel-menu" role="menu">\n      <li>\n        <a ng-click="ctrl.addDataQuery(datasource);">\n          <i class="fa fa-cog"></i> Edit <span class="dropdown-menu-item-shortcut">e</span>\n        </a>\n      </li>\n      <li class="dropdown-submenu">\n        <a ng-click="ctrl.addDataQuery(datasource);"><i class="fa fa-cube"></i> Actions</a>\n        <ul class="dropdown-menu panel-menu">\n          <li><a ng-click="ctrl.addDataQuery(datasource);"><i class="fa fa-flash"></i> Add Annotation</a></li>\n          <li><a ng-click="ctrl.addDataQuery(datasource);"><i class="fa fa-bullseye"></i> Toggle Legend</a></li>\n          <li><a ng-click="ctrl.addDataQuery(datasource);"><i class="fa fa-download"></i> Export to CSV</a></li>\n          <li><a ng-click="ctrl.addDataQuery(datasource);"><i class="fa fa-eye"></i> View JSON</a></li>\n        </ul>\n      </li>\n      <li><a ng-click="ctrl.addDataQuery(datasource);"><i class="fa fa-trash"></i> Remove</a></li>\n    </ul>\n  </span>\n  <span class="panel-time-info" ng-show="ctrl.timeInfo"><i class="fa fa-clock-o"></i> {{ctrl.timeInfo}}</span>\n</span>';n(225).d.directive("panelHeader",i)},1713:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(16),o=n.n(i),s=n(87),l=n.n(s),u=n(229),c=n.n(u),t=a.a.module("grafana.directives");t.directive("grafanaPanel",["$rootScope","$document","$timeout",function(t,e,n){return{restrict:"E",template:'\n  <div class="panel-container">\n    <div class="panel-header" ng-class="{\'grid-drag-handle\': !ctrl.fullscreen}">\n      <span class="panel-info-corner">\n        <i class="fa"></i>\n        <span class="panel-info-corner-inner"></span>\n      </span>\n\n      <span class="panel-loading" ng-show="ctrl.loading">\n        <i class="fa fa-spinner fa-spin"></i>\n      </span>\n\n      <panel-header class="panel-title-container" panel-ctrl="ctrl"></panel-header>\n    </div>\n\n    <div class="panel-content">\n      <ng-transclude class="panel-height-helper"></ng-transclude>\n    </div>\n  </div>\n\n  <div class="panel-full-edit" ng-if="ctrl.editMode">\n    <div class="tabbed-view tabbed-view--panel-edit">\n      <div class="tabbed-view-header">\n        <h3 class="tabbed-view-panel-title">\n          {{ctrl.pluginName}}\n        </h3>\n\n        <ul class="gf-tabs">\n          <li class="gf-tabs-item" ng-repeat="tab in ::ctrl.editorTabs">\n            <a class="gf-tabs-link" ng-click="ctrl.changeTab($index)" ng-class="{active: ctrl.editorTabIndex === $index}">\n              {{::tab.title}}\n            </a>\n          </li>\n        </ul>\n\n        <button class="tabbed-view-close-btn" ng-click="ctrl.exitFullscreen();">\n          <i class="fa fa-remove"></i>\n        </button>\n      </div>\n\n      <div class="tabbed-view-body">\n        <div ng-repeat="tab in ctrl.editorTabs" ng-if="ctrl.editorTabIndex === $index">\n          <panel-editor-tab editor-tab="tab" ctrl="ctrl" index="$index"></panel-editor-tab>\n        </div>\n      </div>\n    </div>\n  </div>\n',transclude:!0,scope:{ctrl:"="},link:function(t,e){function r(){m.toggleClass("panel-hover-highlight",!0),y.dashboard.setPanelFocus(y.panel.id)}function a(){m.toggleClass("panel-hover-highlight",!1),y.dashboard.setPanelFocus(0)}function i(){g.css({height:y.height+"px"})}function s(){d&&d.update()}function u(){var t=y.getInfoMode();v[0].className="panel-info-corner panel-info-corner--"+t,t&&(p&&p.destroy(),p=new l.a({target:v[0],content:function(){return y.getInfoContent({mode:"tooltip"})},classes:y.error?"drop-error":"drop-help",openOn:"hover",hoverOpenDelay:100,tetherOptions:{attachment:"bottom left",targetAttachment:"top left",constraints:[{to:"window",attachment:"together",pin:!0}]}}))}var p,d,h,f,m=e.find(".panel-container"),g=e.find(".panel-content"),v=e.find(".panel-info-corner"),y=t.ctrl,b=!1,x=!1;y.panel.transparent&&(b=!0,m.addClass("panel-transparent",!0)),y.events.on("component-did-mount",function(){if(y.__proto__.constructor.scrollable){var t=g,e=g.find(":first").find(":first");t.addClass("baron baron__root baron__clipper panel-content--scrollable"),o()('\n            <div class="baron__track">\n              <div class="baron__bar"></div>\n            </div>\n          ').appendTo(t),e.addClass("baron__scroller"),d=c()({root:t[0],scroller:e[0],bar:".baron__bar",barOnCls:"_scrollbar",scrollingCls:"_scrolling"}),d.scroll()}}),y.events.on("panel-size-changed",function(){y.calculatePanelHeight(),i(),n(function(){s(),y.render()})}),y.calculatePanelHeight(),i(),y.events.on("render",function(){b!==y.panel.transparent&&(m.toggleClass("panel-transparent",!0===y.panel.transparent),b=y.panel.transparent),f=void 0!==y.panel.alert,x!==f&&(m.toggleClass("panel-has-alert",f),x=f),y.alertState?(h&&m.removeClass("panel-alert-state--"+h),"ok"!==y.alertState.state&&"alerting"!==y.alertState.state||m.addClass("panel-alert-state--"+y.alertState.state),h=y.alertState.state):h&&(m.removeClass("panel-alert-state--"+h),h=null)}),t.$watchGroup(["ctrl.error","ctrl.panel.description"],u),t.$watchCollection("ctrl.panel.links",u),v.on("click",function(){p.close(),t.$apply(y.openInspector.bind(y))}),e.on("mouseenter",r),e.on("mouseleave",a),t.$on("$destroy",function(){e.off(),v.off(),p&&p.destroy(),d&&d.dispose()})}}}]),t.directive("panelHelpCorner",["$rootScope",function(t){return{restrict:"E",template:'\n    <span class="alert-error panel-error small pointer" ng-if="ctrl.error" ng-click="ctrl.openInspector()">\n    <span data-placement="top" bs-tooltip="ctrl.error">\n    <i class="fa fa-exclamation"></i><span class="panel-error-arrow"></span>\n    </span>\n    </span>\n    ',link:function(t,e){}}}])},1714:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(226),o=n(17),s=function(){function t(t,e,n,r,a,s){var l;t.init=function(){a.sidemenu=!1,o.a.emit("toggle-sidemenu-hidden");var u=n.search();if(l=parseInt(u.panelId),t.onAppEvent("dashboard-initialized",t.initPanelScope),"script"!==e.type&&"snapshot"!==e.type&&!e.uid)return void s.getDashboardBySlug(e.slug).then(function(t){if(t){var e=i.a.stripBaseFromUrl(t.meta.url.replace("/d/","/d-solo/"));n.path(e).replace()}});r.loadDashboard(e.type,e.slug,e.uid).then(function(e){e.meta.soloMode=!0,t.initDashboard(e,t)})},t.initPanelScope=function(){var e=t.dashboard.getPanelInfoById(l);if(t.ctrl={dashboard:t.dashboard},t.panel=e.panel,t.panel.soloMode=!0,t.$index=0,!t.panel)return void t.appEvent("alert-error",["Panel not found",""])},t.init()}return t.$inject=["$scope","$routeParams","$location","dashboardLoaderSrv","contextSrv","backendSrv"],t}();a.a.module("grafana.routes").controller("SoloPanelCtrl",s)},1715:function(t,e,n){"use strict";function r(t){return t.create({scope:{ctrl:"=",editorTab:"=",index:"="},directive:function(t){var e=t.ctrl.pluginId,n=t.index,r=function(){return t.editorTab.directiveFn()};return Promise.resolve({name:"panel-editor-tab-"+e+n,fn:r})}})}r.$inject=["dynamicDirectiveSrv"];var a=n(21);n.n(a).a.module("grafana.directives").directive("panelEditorTab",r)},1716:function(t,e,n){"use strict";function r(){return{restrict:"E",controller:o,bindToController:!0,controllerAs:"ctrl",templateUrl:"public/app/features/panel/partials/query_editor_row.html",transclude:!0,scope:{queryCtrl:"=",canCollapse:"=",hasTextEditMode:"="}}}var a=n(21),i=n.n(a),t=i.a.module("grafana.directives"),o=function(){function t(){this.panelCtrl=this.queryCtrl.panelCtrl,this.target=this.queryCtrl.target,this.panel=this.panelCtrl.panel,this.target.refId||(this.target.refId=this.panelCtrl.dashboard.getNextQueryLetter(this.panel)),this.toggleCollapse(!0),this.target.isNew&&(delete this.target.isNew,this.toggleCollapse(!1)),this.panel.targets.length<4&&(this.collapsed=!1)}return t.prototype.toggleHideQuery=function(){this.target.hide=!this.target.hide,this.panelCtrl.refresh()},t.prototype.toggleCollapse=function(t){if(this.canCollapse){this.panelCtrl.__collapsedQueryCache||(this.panelCtrl.__collapsedQueryCache={}),t?this.collapsed=!1!==this.panelCtrl.__collapsedQueryCache[this.target.refId]:(this.collapsed=!this.collapsed,this.panelCtrl.__collapsedQueryCache[this.target.refId]=this.collapsed);try{this.collapsedText=this.queryCtrl.getCollapsedText()}catch(t){var e=t.message||t.toString();this.collapsedText="Error: "+e}}},t.prototype.toggleEditorMode=function(){this.canCollapse&&this.collapsed&&(this.collapsed=!1),this.queryCtrl.toggleEditorMode()},t.prototype.removeQuery=function(){this.panelCtrl.__collapsedQueryCache&&delete this.panelCtrl.__collapsedQueryCache[this.target.refId],this.panelCtrl.removeQuery(this.target)},t.prototype.duplicateQuery=function(){var t=i.a.copy(this.target);this.panelCtrl.addQuery(t)},t.prototype.moveQuery=function(t){this.panelCtrl.moveQuery(this.target,t)},t}();t.directive("queryEditorRow",r)},1717:function(t,e,n){"use strict";function r(){return{restrict:"E",template:l,controller:u,bindToController:!0,controllerAs:"ctrl",scope:{panelCtrl:"=",isOpen:"="},link:function(t,e,n,r){r.renderJsonExplorer=function(t){var n=e.find(".query-troubleshooter-json");r.jsonExplorer=new s.a(t,3,{animateOpen:!0});var a=r.jsonExplorer.render(!0);n.html(a)}}}}var a=n(4),i=n.n(a),o=n(17),s=n(225),l='\n<div class="query-troubleshooter" ng-if="ctrl.isOpen">\n  <div class="query-troubleshooter__header">\n    <a class="pointer" ng-click="ctrl.toggleMocking()">Mock Response</a>\n    <a class="pointer" ng-click="ctrl.toggleExpand()" ng-hide="ctrl.allNodesExpanded">\n      <i class="fa fa-plus-square-o"></i> Expand All\n    </a>\n    <a class="pointer" ng-click="ctrl.toggleExpand()" ng-show="ctrl.allNodesExpanded">\n      <i class="fa fa-minus-square-o"></i> Collapse All\n    </a>\n    <a class="pointer" clipboard-button="ctrl.getClipboardText()"><i class="fa fa-clipboard"></i> Copy to Clipboard</a>\n  </div>\n  <div class="query-troubleshooter__body" ng-hide="ctrl.isMocking">\n    <i class="fa fa-spinner fa-spin" ng-show="ctrl.isLoading"></i>\n    <div class="query-troubleshooter-json"></div>\n  </div>\n  <div class="query-troubleshooter__body" ng-show="ctrl.isMocking">\n    <div class="gf-form p-l-1 gf-form--v-stretch">\n\t\t\t<textarea class="gf-form-input" style="width: 95%" rows="10" ng-model="ctrl.mockedResponse"  placeholder="JSON"></textarea>\n    </div>\n  </div>\n</div>\n',u=function(){function t(t,e){this.$timeout=e,this.onRequestErrorEventListener=this.onRequestError.bind(this),this.onRequestResponseEventListener=this.onRequestResponse.bind(this),o.a.on("ds-request-response",this.onRequestResponseEventListener),o.a.on("ds-request-error",this.onRequestErrorEventListener),t.$on("$destroy",this.removeEventsListeners.bind(this)),t.$watch("ctrl.isOpen",this.stateChanged.bind(this))}return t.$inject=["$scope","$timeout"],t.prototype.removeEventsListeners=function(){o.a.off("ds-request-response",this.onRequestResponseEventListener),o.a.off("ds-request-error",this.onRequestErrorEventListener)},t.prototype.toggleMocking=function(){this.isMocking=!this.isMocking},t.prototype.onRequestError=function(t){this.isOpen&&(this.isOpen=!0,this.hasError=!0,this.onRequestResponse(t))},t.prototype.stateChanged=function(){this.isOpen&&(this.panelCtrl.refresh(),this.isLoading=!0)},t.prototype.getClipboardText=function(){return this.jsonExplorer?JSON.stringify(this.jsonExplorer.json,null,2):""},t.prototype.handleMocking=function(t){var e;try{e=JSON.parse(this.mockedResponse)}catch(t){return void o.a.emit("alert-error",["Failed to parse mocked response"])}t.data=e},t.prototype.onRequestResponse=function(t){if(this.isOpen){if(this.isMocking)return void this.handleMocking(t);this.isLoading=!1,t=i.a.cloneDeep(t),t.headers&&delete t.headers,t.config&&(t.request=t.config,delete t.config,delete t.request.transformRequest,delete t.request.transformResponse,delete t.request.paramSerializer,delete t.request.jsonpCallbackParam,delete t.request.headers,delete t.request.requestId,delete t.request.inspect,delete t.request.retry,delete t.request.timeout),t.data&&(t.response=t.data,200===t.status&&this.hasError&&(this.hasError=!1,this.isOpen=!1),delete t.data,delete t.status,delete t.statusText,delete t.$$config),this.$timeout(i.a.partial(this.renderJsonExplorer,t))}},t.prototype.toggleExpand=function(t){this.jsonExplorer&&(this.allNodesExpanded=!this.allNodesExpanded,this.jsonExplorer.openAtDepth(this.allNodesExpanded?20:1))},t}();s.d.directive("queryTroubleshooter",r)},1718:function(t,e,n){"use strict";n(1500),n(1719),n(1720),n(1721),n(1722),n(1723),n(1724),n(1725),n(1726),n(1727),n(1728),n(1729)},1719:function(t,e,n){"use strict";var r=n(22),a=n(225),i=function(){function t(t,e,n,a){this.backendSrv=t,this.contextSrv=e,this.$location=n,this.orgs=[],this.showOrgsList=!1,this.readonlyLoginFields=r.a.disableLoginForm,this.getUser(),this.getUserOrgs(),this.navModel=a.getNav("profile","profile-settings",0)}return t.$inject=["backendSrv","contextSrv","$location","navModelSrv"],t.prototype.getUser=function(){var t=this;this.backendSrv.get("/api/user").then(function(e){t.user=e,t.user.theme=e.theme||"dark"})},t.prototype.getUserOrgs=function(){var t=this;this.backendSrv.get("/api/user/orgs").then(function(e){t.orgs=e,t.showOrgsList=e.length>1})},t.prototype.setUsingOrg=function(t){this.backendSrv.post("/api/user/using/"+t.orgId).then(function(){window.location.href=r.a.appSubUrl+"/profile"})},t.prototype.update=function(){var t=this;this.userForm.$valid&&this.backendSrv.put("/api/user/",this.user).then(function(){t.contextSrv.user.name=t.user.name||t.user.login,t.old_theme!==t.user.theme&&(window.location.href=r.a.appSubUrl+t.$location.path())})},t}();a.d.controller("ProfileCtrl",i)},1720:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(22),o=function(){function t(t,e,n){n.sidemenu=!1,t.navModel={main:{icon:"gicon gicon-branding",subTitle:"Preferences",text:"Select active organization"}},t.init=function(){t.getUserOrgs()},t.getUserOrgs=function(){e.get("/api/user/orgs").then(function(e){t.orgs=e})},t.setUsingOrg=function(t){e.post("/api/user/using/"+t.orgId).then(function(){window.location.href=i.a.appSubUrl+"/"})},t.init()}return t.$inject=["$scope","backendSrv","contextSrv"],t}();a.a.module("grafana.controllers").controller("SelectOrgCtrl",o)},1721:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(22),o=function(){function t(t,e,n,r){t.command={},t.authProxyEnabled=i.a.authProxyEnabled,t.ldapEnabled=i.a.ldapEnabled,t.navModel=r.getNav("profile","change-password",0),t.changePassword=function(){if(t.userForm.$valid)return t.command.newPassword!==t.command.confirmNew?void t.appEvent("alert-warning",["New passwords do not match",""]):void e.put("/api/user/password",t.command).then(function(){n.path("profile")})}}return t.$inject=["$scope","backendSrv","$location","navModelSrv"],t}();a.a.module("grafana.controllers").controller("ChangePasswordCtrl",o)},1722:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(22),o=function(){function t(t,e,n,r){t.navModel=r.getNav("cfg","admin","global-orgs",1),t.newOrg={name:""},t.createOrg=function(){n.post("/api/orgs/",t.newOrg).then(function(t){n.post("/api/user/using/"+t.orgId).then(function(){window.location.href=i.a.appSubUrl+"/org"})})}}return t.$inject=["$scope","$http","backendSrv","navModelSrv"],t}();a.a.module("grafana.controllers").controller("NewOrgCtrl",o)},1723:function(t,e,n){"use strict";var r=n(3),a=function(){function t(t,e,n){this.backendSrv=t,this.$location=n,this.navModel=e.getNav("cfg","users",0),this.invite={name:"",email:"",role:"Editor",sendEmail:!0}}return t.$inject=["backendSrv","navModelSrv","$location"],t.prototype.sendInvite=function(){var t=this;if(this.inviteForm.$valid)return this.backendSrv.post("/api/org/invites",this.invite).then(function(){t.$location.path("org/users/")})},t}();r.a.controller("UserInviteCtrl",a)},1724:function(t,e,n){"use strict";var r=n(3),a=n(17),i=function(){function t(t,e){this.backendSrv=t,this.pages=[],this.perPage=50,this.page=1,this.showPaging=!1,this.query="",this.navModel=e.getNav("cfg","teams",0),this.get()}return t.$inject=["backendSrv","navModelSrv"],t.prototype.get=function(){var t=this;this.backendSrv.get("/api/teams/search?perpage="+this.perPage+"&page="+this.page+"&query="+this.query).then(function(e){t.teams=e.teams,t.page=e.page,t.perPage=e.perPage,t.totalPages=Math.ceil(e.totalCount/e.perPage),t.showPaging=t.totalPages>1,t.pages=[];for(var n=1;n<t.totalPages+1;n++)t.pages.push({page:n,current:n===t.page})})},t.prototype.navigateToPage=function(t){this.page=t.page,this.get()},t.prototype.deleteTeam=function(t){var e=this;a.a.emit("confirm-modal",{title:"Delete",text:"Are you sure you want to delete Team "+t.name+"?",yesText:"Delete",icon:"fa-warning",onConfirm:function(){e.deleteTeamConfirmed(t)}})},t.prototype.deleteTeamConfirmed=function(t){this.backendSrv.delete("/api/teams/"+t.id).then(this.get.bind(this))},t.prototype.openTeamModal=function(){a.a.emit("show-modal",{templateHtml:"<create-team-modal></create-team-modal>",modalClass:"modal--narrow"})},t}();r.a.controller("TeamsCtrl",i)},1725:function(t,e,n){"use strict";var r=n(3),a=function(){function t(t,e,n,r){this.$scope=t,this.backendSrv=e,this.$routeParams=n,this.teamMembers=[],this.navModel=r.getNav("cfg","teams",0),this.userPicked=this.userPicked.bind(this),this.get=this.get.bind(this),this.get()}return t.$inject=["$scope","backendSrv","$routeParams","navModelSrv"],t.prototype.get=function(){var t=this;this.$routeParams&&this.$routeParams.id&&(this.backendSrv.get("/api/teams/"+this.$routeParams.id).then(function(e){t.team=e}),this.backendSrv.get("/api/teams/"+this.$routeParams.id+"/members").then(function(e){t.teamMembers=e}))},t.prototype.removeTeamMember=function(t){var e=this;this.$scope.appEvent("confirm-modal",{title:"Remove Member",text:"Are you sure you want to remove "+t.login+" from this group?",yesText:"Remove",icon:"fa-warning",onConfirm:function(){e.removeMemberConfirmed(t)}})},t.prototype.removeMemberConfirmed=function(t){this.backendSrv.delete("/api/teams/"+this.$routeParams.id+"/members/"+t.userId).then(this.get)},t.prototype.update=function(){this.$scope.teamDetailsForm.$valid&&this.backendSrv.put("/api/teams/"+this.team.id,{name:this.team.name,email:this.team.email})},t.prototype.userPicked=function(t){var e=this;this.backendSrv.post("/api/teams/"+this.$routeParams.id+"/members",{userId:t.id}).then(function(){e.$scope.$broadcast("user-picker-reset"),e.get()})},t}();r.a.controller("TeamDetailsCtrl",a)},1726:function(t,e,n){"use strict";var r=n(3),a=function(){function t(t,e,n){this.backendSrv=t,this.$location=e,this.navModel=n.getNav("cfg","teams",0)}return t.$inject=["backendSrv","$location","navModelSrv"],t.prototype.create=function(){var t=this,e={name:this.name,email:this.email};this.backendSrv.post("/api/teams",e).then(function(e){e.teamId&&t.$location.path("/org/teams/edit/"+e.teamId)})},t}();r.a.controller("CreateTeamCtrl",a)},1727:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=function(){function t(t,e,n,r){t.navModel=r.getNav("cfg","apikeys",0),t.roleTypes=["Viewer","Editor","Admin"],t.token={role:"Viewer"},t.init=function(){t.getTokens()},t.getTokens=function(){n.get("/api/auth/keys").then(function(e){t.tokens=e})},t.removeToken=function(e){n.delete("/api/auth/keys/"+e).then(t.getTokens)},t.addToken=function(){n.post("/api/auth/keys",t.token).then(function(e){var n=t.$new(!0);n.key=e.key,n.rootPath=window.location.origin+t.$root.appSubUrl,t.appEvent("show-modal",{src:"public/app/features/org/partials/apikeyModal.html",scope:n}),t.getTokens()})},t.init()}return t.$inject=["$scope","$http","backendSrv","navModelSrv"],t}();a.a.module("grafana.controllers").controller("OrgApiKeysCtrl",i)},1728:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=function(){function t(t,e,n,r,a){t.init=function(){t.getOrgInfo(),t.navModel=a.getNav("cfg","org-settings",0)},t.getOrgInfo=function(){n.get("/api/org").then(function(e){t.org=e,t.address=e.address,r.user.orgName=e.name})},t.update=function(){if(t.orgForm.$valid){var e={name:t.org.name};n.put("/api/org",e).then(t.getOrgInfo)}},t.updateAddress=function(){t.addressForm.$valid&&n.put("/api/org/address",t.address).then(t.getOrgInfo)},t.init()}return t.$inject=["$scope","$http","backendSrv","contextSrv","navModelSrv"],t}();a.a.module("grafana.controllers").controller("OrgDetailsCtrl",i)},1729:function(t,e,n){"use strict";function r(){return{restrict:"E",controller:o,bindToController:!0,controllerAs:"ctrl",template:s,scope:{mode:"@"}}}var a=n(22),i=n(3),o=function(){function t(t,e){this.backendSrv=t,this.$location=e,this.timezones=[{value:"",text:"Default"},{value:"browser",text:"Local browser time"},{value:"utc",text:"UTC"}],this.themes=[{value:"",text:"Default"},{value:"dark",text:"Dark"},{value:"light",text:"Light"}]}return t.$inject=["backendSrv","$location"],t.prototype.$onInit=function(){var t=this;return this.backendSrv.get("/api/"+this.mode+"/preferences").then(function(e){t.prefs=e,t.oldTheme=e.theme})},t.prototype.updatePrefs=function(){var t=this;if(this.prefsForm.$valid){var e={theme:this.prefs.theme,timezone:this.prefs.timezone,homeDashboardId:this.prefs.homeDashboardId};this.backendSrv.put("/api/"+this.mode+"/preferences",e).then(function(){window.location.href=a.a.appSubUrl+t.$location.path()})}},t}(),s='\n<form name="ctrl.prefsForm" class="section gf-form-group">\n  <h3 class="page-heading">Preferences</h3>\n\n  <div class="gf-form">\n    <span class="gf-form-label width-11">UI Theme</span>\n    <div class="gf-form-select-wrapper max-width-20">\n      <select class="gf-form-input" ng-model="ctrl.prefs.theme" ng-options="f.value as f.text for f in ctrl.themes"></select>\n    </div>\n  </div>\n\n  <div class="gf-form">\n    <span class="gf-form-label width-11">\n      Home Dashboard\n      <info-popover mode="right-normal">\n        Not finding dashboard you want? Star it first, then it should appear in this select box.\n      </info-popover>\n    </span>\n    <dashboard-selector class="gf-form-select-wrapper max-width-20" model="ctrl.prefs.homeDashboardId">\n    </dashboard-selector>\n  </div>\n\n  <div class="gf-form">\n    <label class="gf-form-label width-11">Timezone</label>\n    <div class="gf-form-select-wrapper max-width-20">\n      <select class="gf-form-input" ng-model="ctrl.prefs.timezone" ng-options="f.value as f.text for f in ctrl.timezones"></select>\n    </div>\n  </div>\n\n  <div class="gf-form-button-row">\n    <button type="submit" class="btn btn-success" ng-click="ctrl.updatePrefs()">Save</button>\n  </div>\n</form>\n';i.a.directive("prefsControl",r)},1730:function(t,e,n){"use strict";var r=n(1731),a=(n(1732),n(1733),n(1734),n(3)),i=function(){function t(t,e,n){this.navModel=n.getNav("cfg","admin","server-settings",1),e.get("/api/admin/settings").then(function(e){t.settings=e})}return t.$inject=["$scope","backendSrv","navModelSrv"],t}(),o=function(){function t(t){this.navModel=t.getNav("cfg","admin",1)}return t.$inject=["navModelSrv"],t}(),s=function(){function t(t,e){var n=this;this.navModel=e.getNav("cfg","admin","server-stats",1),t.get("/api/admin/stats").then(function(t){n.stats=t})}return t.$inject=["backendSrv","navModelSrv"],t}();a.a.controller("AdminSettingsCtrl",i),a.a.controller("AdminHomeCtrl",o),a.a.controller("AdminStatsCtrl",s),a.a.controller("AdminListUsersCtrl",r.a)},1731:function(t,e,n){"use strict";var r=function(){function t(t,e,n){this.$scope=t,this.backendSrv=e,this.pages=[],this.perPage=50,this.page=1,this.showPaging=!1,this.navModel=n.getNav("cfg","admin","global-users",1),this.query="",this.getUsers()}return t.$inject=["$scope","backendSrv","navModelSrv"],t.prototype.getUsers=function(){var t=this;this.backendSrv.get("/api/users/search?perpage="+this.perPage+"&page="+this.page+"&query="+this.query).then(function(e){t.users=e.users,t.page=e.page,t.perPage=e.perPage,t.totalPages=Math.ceil(e.totalCount/e.perPage),t.showPaging=t.totalPages>1,t.pages=[];for(var n=1;n<t.totalPages+1;n++)t.pages.push({page:n,current:n===t.page})})},t.prototype.navigateToPage=function(t){this.page=t.page,this.getUsers()},t.prototype.deleteUser=function(t){var e=this;this.$scope.appEvent("confirm-modal",{title:"Delete",text:"Do you want to delete "+t.login+"?",icon:"fa-trash",yesText:"Delete",onConfirm:function(){e.backendSrv.delete("/api/admin/users/"+t.id).then(function(){e.getUsers()})}})},t}();e.a=r},1732:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=function(){function t(t,e,n){t.init=function(){t.navModel=n.getNav("cfg","admin","global-orgs",1),t.getOrgs()},t.getOrgs=function(){e.get("/api/orgs").then(function(e){t.orgs=e})},t.deleteOrg=function(n){t.appEvent("confirm-modal",{title:"Delete",text:"Do you want to delete organization "+n.name+"?",text2:"All dashboards for this organization will be removed!",icon:"fa-trash",yesText:"Delete",onConfirm:function(){e.delete("/api/orgs/"+n.id).then(function(){t.getOrgs()})}})},t.init()}return t.$inject=["$scope","backendSrv","navModelSrv"],t}();a.a.module("grafana.controllers").controller("AdminListOrgsCtrl",i)},1733:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=function(){function t(t,e,n,r,a){t.init=function(){t.navModel=a.getNav("cfg","admin","global-orgs",1),e.id&&(t.getOrg(e.id),t.getOrgUsers(e.id))},t.getOrg=function(e){n.get("/api/orgs/"+e).then(function(e){t.org=e})},t.getOrgUsers=function(e){n.get("/api/orgs/"+e+"/users").then(function(e){t.orgUsers=e})},t.update=function(){t.orgDetailsForm.$valid&&n.put("/api/orgs/"+t.org.id,t.org).then(function(){r.path("/admin/orgs")})},t.updateOrgUser=function(t){n.patch("/api/orgs/"+t.orgId+"/users/"+t.userId,t)},t.removeOrgUser=function(e){n.delete("/api/orgs/"+e.orgId+"/users/"+e.userId).then(function(){t.getOrgUsers(t.org.id)})},t.init()}return t.$inject=["$scope","$routeParams","backendSrv","$location","navModelSrv"],t}();a.a.module("grafana.controllers").controller("AdminEditOrgCtrl",i)},1734:function(t,e,n){"use strict";var r=n(21),a=n.n(r),i=n(4),o=n.n(i),s=function(){function t(t,e,n,r,a){t.user={},t.newOrg={name:"",role:"Editor"},t.permissions={},t.navModel=a.getNav("cfg","admin","global-users",1),t.init=function(){e.id&&(t.getUser(e.id),t.getUserOrgs(e.id))},t.getUser=function(e){n.get("/api/users/"+e).then(function(n){t.user=n,t.user_id=e,t.permissions.isGrafanaAdmin=n.isGrafanaAdmin})},t.setPassword=function(){if(t.passwordForm.$valid){var e={password:t.password};n.put("/api/admin/users/"+t.user_id+"/password",e).then(function(){r.path("/admin/users")})}},t.updatePermissions=function(){var e=t.permissions;n.put("/api/admin/users/"+t.user_id+"/permissions",e).then(function(){r.path("/admin/users")})},t.create=function(){t.userForm.$valid&&n.post("/api/admin/users",t.user).then(function(){r.path("/admin/users")})},t.getUserOrgs=function(e){n.get("/api/users/"+e+"/orgs").then(function(e){t.orgs=e})},t.update=function(){t.userForm.$valid&&n.put("/api/users/"+t.user_id,t.user).then(function(){r.path("/admin/users")})},t.updateOrgUser=function(e){n.patch("/api/orgs/"+e.orgId+"/users/"+t.user_id,e).then(function(){})},t.removeOrgUser=function(e){n.delete("/api/orgs/"+e.orgId+"/users/"+t.user_id).then(function(){t.getUserOrgs(t.user_id)})},t.orgsSearchCache=[],t.searchOrgs=function(e,r){if(t.orgsSearchCache.length>0)return void r(o.a.map(t.orgsSearchCache,"name"));n.get("/api/orgs",{query:""}).then(function(e){t.orgsSearchCache=e,r(o.a.map(e,"name"))})},t.addOrgUser=function(){if(t.addOrgForm.$valid){var e=o.a.find(t.orgsSearchCache,{name:t.newOrg.name});e&&(t.newOrg.loginOrEmail=t.user.login,n.post("/api/orgs/"+e.id+"/users/",t.newOrg).then(function(){t.getUserOrgs(t.user_id)}))}},t.init()}return t.$inject=["$scope","$routeParams","backendSrv","$location","navModelSrv"],t}();a.a.module("grafana.controllers").controller("AdminEditUserCtrl",s)},1735:function(t,e,n){"use strict";n(1736),n(1737)},1736:function(t,e,n){"use strict";var r=n(225),a=function(){function t(t,e){this.backendSrv=t,this.loadNotifications(),this.navModel=e.getNav("alerting","channels",0)}return t.$inject=["backendSrv","navModelSrv"],t.prototype.loadNotifications=function(){var t=this;this.backendSrv.get("/api/alert-notifications").then(function(e){t.notifications=e})},t.prototype.deleteNotification=function(t){var e=this;this.backendSrv.delete("/api/alert-notifications/"+t).then(function(){e.notifications=e.notifications.filter(function(e){return e.id!==t})})},t}();r.d.controller("AlertNotificationsListCtrl",a)},1737:function(t,e,n){"use strict";var r=n(4),a=n.n(r),i=n(225),o=function(){function t(t,e,n,r,i){var o=this;this.$routeParams=t,this.backendSrv=e,this.$location=n,this.$templateCache=r,this.testSeverity="critical",this.defaults={type:"email",settings:{httpMethod:"POST",autoResolve:!0,uploadImage:!0},isDefault:!1},this.navModel=i.getNav("alerting","channels",0),this.isNew=!this.$routeParams.id,this.backendSrv.get("/api/alert-notifiers").then(function(t){o.notifiers=t;for(var e=0,n=o.notifiers;e<n.length;e++){var r=n[e];o.$templateCache.put(o.getNotifierTemplateId(r.type),r.optionsTemplate)}return o.$routeParams.id?o.backendSrv.get("/api/alert-notifications/"+o.$routeParams.id).then(function(t){return o.navModel.breadcrumbs.push({text:t.name}),o.navModel.node={text:t.name},t.settings=a.a.defaults(t.settings,o.defaults.settings),t}):(o.navModel.breadcrumbs.push({text:"New channel"}),o.navModel.node={text:"New channel"},a.a.defaults(o.model,o.defaults))}).then(function(t){o.model=t,o.notifierTemplateId=o.getNotifierTemplateId(o.model.type)})}return t.$inject=["$routeParams","backendSrv","$location","$templateCache","navModelSrv"],t.prototype.save=function(){var t=this;this.theForm.$valid&&(this.model.id?this.backendSrv.put("/api/alert-notifications/"+this.model.id,this.model).then(function(e){t.model=e,i.b.emit("alert-success",["Notification updated",""])}).catch(function(t){t.data&&t.data.error&&i.b.emit("alert-error",[t.data.error])}):this.backendSrv.post("/api/alert-notifications",this.model).then(function(e){i.b.emit("alert-success",["Notification created",""]),t.$location.path("alerting/notifications")}).catch(function(t){t.data&&t.data.error&&i.b.emit("alert-error",[t.data.error])}))},t.prototype.getNotifierTemplateId=function(t){return"notifier-options-"+t},t.prototype.typeChanged=function(){this.model.settings=a.a.defaults({},this.defaults.settings),this.notifierTemplateId=this.getNotifierTemplateId(this.model.type)},t.prototype.testNotification=function(){if(this.theForm.$valid){var t={name:this.model.name,type:this.model.type,settings:this.model.settings};this.backendSrv.post("/api/alert-notifications/test",t).then(function(t){i.b.emit("alert-success",["Test notification sent",""])})}},t}();i.d.controller("AlertNotificationEditCtrl",o)},1738:function(t,e,n){"use strict";var r=n(3),a=n(22),i=function(){function t(t,e,n){this.$routeParams=t,this.backendSrv=e,this.buttonNames=["primary","secondary","inverse","success","warning","danger"],this.buttonSizes=["btn-small","","btn-large"],this.buttonVariants=["-"],this.navModel=n.getNav("cfg","admin","styleguide",1),this.theme=a.a.bootData.user.lightTheme?"light":"dark"}return t.$inject=["$routeParams","backendSrv","navModelSrv"],t.prototype.switchTheme=function(){this.$routeParams.theme="dark"===this.theme?"light":"dark";var t={theme:this.$routeParams.theme};this.backendSrv.put("/api/user/preferences",t).then(function(){window.location.href=window.location.href})},t}();r.a.controller("StyleGuideCtrl",i)}});
//# sourceMappingURL=0.5c89ac3fc7a3e78b3629.js.map